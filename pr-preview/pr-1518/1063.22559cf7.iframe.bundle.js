/*! For license information please see 1063.22559cf7.iframe.bundle.js.LICENSE.txt */
(self.webpackChunklayerswap=self.webpackChunklayerswap||[]).push([[1063],{"./node_modules/@walletconnect/environment/dist/cjs/crypto.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";function getBrowerCrypto(){return(null===__webpack_require__.g||void 0===__webpack_require__.g?void 0:__webpack_require__.g.crypto)||(null===__webpack_require__.g||void 0===__webpack_require__.g?void 0:__webpack_require__.g.msCrypto)||{}}function getSubtleCrypto(){const browserCrypto=getBrowerCrypto();return browserCrypto.subtle||browserCrypto.webkitSubtle}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isBrowserCryptoAvailable=exports.getSubtleCrypto=exports.getBrowerCrypto=void 0,exports.getBrowerCrypto=getBrowerCrypto,exports.getSubtleCrypto=getSubtleCrypto,exports.isBrowserCryptoAvailable=function isBrowserCryptoAvailable(){return!!getBrowerCrypto()&&!!getSubtleCrypto()}},"./node_modules/@walletconnect/environment/dist/cjs/env.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var process=__webpack_require__("./node_modules/process/browser.js");function isReactNative(){return"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product}function isNode(){return void 0!==process&&void 0!==process.versions&&void 0!==process.versions.node}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isBrowser=exports.isNode=exports.isReactNative=void 0,exports.isReactNative=isReactNative,exports.isNode=isNode,exports.isBrowser=function isBrowser(){return!isReactNative()&&!isNode()}},"./node_modules/@walletconnect/environment/dist/cjs/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__("./node_modules/@walletconnect/environment/node_modules/tslib/tslib.es6.js");tslib_1.__exportStar(__webpack_require__("./node_modules/@walletconnect/environment/dist/cjs/crypto.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/@walletconnect/environment/dist/cjs/env.js"),exports)},"./node_modules/@walletconnect/environment/node_modules/tslib/tslib.es6.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{__assign:()=>__assign,__asyncDelegator:()=>__asyncDelegator,__asyncGenerator:()=>__asyncGenerator,__asyncValues:()=>__asyncValues,__await:()=>__await,__awaiter:()=>__awaiter,__classPrivateFieldGet:()=>__classPrivateFieldGet,__classPrivateFieldSet:()=>__classPrivateFieldSet,__createBinding:()=>__createBinding,__decorate:()=>__decorate,__exportStar:()=>__exportStar,__extends:()=>__extends,__generator:()=>__generator,__importDefault:()=>__importDefault,__importStar:()=>__importStar,__makeTemplateObject:()=>__makeTemplateObject,__metadata:()=>__metadata,__param:()=>__param,__read:()=>__read,__rest:()=>__rest,__spread:()=>__spread,__spreadArrays:()=>__spreadArrays,__values:()=>__values});var extendStatics=function(d,b){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},extendStatics(d,b)};function __extends(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}var __assign=function(){return __assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t},__assign.apply(this,arguments)};function __rest(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t}function __decorate(decorators,target,key,desc){var d,c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r}function __param(paramIndex,decorator){return function(target,key){decorator(target,key,paramIndex)}}function __metadata(metadataKey,metadataValue){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(metadataKey,metadataValue)}function __awaiter(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}function __generator(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=_.trys,(t=t.length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}function __createBinding(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}function __exportStar(m,exports){for(var p in m)"default"===p||exports.hasOwnProperty(p)||(exports[p]=m[p])}function __values(o){var s="function"==typeof Symbol&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&"number"==typeof o.length)return{next:function(){return o&&i>=o.length&&(o=void 0),{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(o,n){var m="function"==typeof Symbol&&o[Symbol.iterator];if(!m)return o;var r,e,i=m.call(o),ar=[];try{for(;(void 0===n||n-- >0)&&!(r=i.next()).done;)ar.push(r.value)}catch(error){e={error}}finally{try{r&&!r.done&&(m=i.return)&&m.call(i)}finally{if(e)throw e.error}}return ar}function __spread(){for(var ar=[],i=0;i<arguments.length;i++)ar=ar.concat(__read(arguments[i]));return ar}function __spreadArrays(){for(var s=0,i=0,il=arguments.length;i<il;i++)s+=arguments[i].length;var r=Array(s),k=0;for(i=0;i<il;i++)for(var a=arguments[i],j=0,jl=a.length;j<jl;j++,k++)r[k]=a[j];return r}function __await(v){return this instanceof __await?(this.v=v,this):new __await(v)}function __asyncGenerator(thisArg,_arguments,generator){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,g=generator.apply(thisArg,_arguments||[]),q=[];return i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i;function verb(n){g[n]&&(i[n]=function(v){return new Promise(function(a,b){q.push([n,v,a,b])>1||resume(n,v)})})}function resume(n,v){try{!function step(r){r.value instanceof __await?Promise.resolve(r.value.v).then(fulfill,reject):settle(q[0][2],r)}(g[n](v))}catch(e){settle(q[0][3],e)}}function fulfill(value){resume("next",value)}function reject(value){resume("throw",value)}function settle(f,v){f(v),q.shift(),q.length&&resume(q[0][0],q[0][1])}}function __asyncDelegator(o){var i,p;return i={},verb("next"),verb("throw",function(e){throw e}),verb("return"),i[Symbol.iterator]=function(){return this},i;function verb(n,f){i[n]=o[n]?function(v){return(p=!p)?{value:__await(o[n](v)),done:"return"===n}:f?f(v):v}:f}}function __asyncValues(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,m=o[Symbol.asyncIterator];return m?m.call(o):(o=__values(o),i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i);function verb(n){i[n]=o[n]&&function(v){return new Promise(function(resolve,reject){(function settle(resolve,reject,d,v){Promise.resolve(v).then(function(v){resolve({value:v,done:d})},reject)})(resolve,reject,(v=o[n](v)).done,v.value)})}}}function __makeTemplateObject(cooked,raw){return Object.defineProperty?Object.defineProperty(cooked,"raw",{value:raw}):cooked.raw=raw,cooked}function __importStar(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result}function __importDefault(mod){return mod&&mod.__esModule?mod:{default:mod}}function __classPrivateFieldGet(receiver,privateMap){if(!privateMap.has(receiver))throw new TypeError("attempted to get private field on non-instance");return privateMap.get(receiver)}function __classPrivateFieldSet(receiver,privateMap,value){if(!privateMap.has(receiver))throw new TypeError("attempted to set private field on non-instance");return privateMap.set(receiver,value),value}},"./node_modules/@walletconnect/jsonrpc-ws-connection/node_modules/ws/browser.js":module=>{"use strict";module.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},"./node_modules/@walletconnect/logger/dist/index.es.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{D5:()=>A,U5:()=>E,h6:()=>pino__WEBPACK_IMPORTED_MODULE_0___default.a,iP:()=>k,oI:()=>y});var pino__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/pino/browser.js"),pino__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(pino__WEBPACK_IMPORTED_MODULE_0__),_walletconnect_safe_json__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@walletconnect/safe-json/dist/esm/index.js"),console=__webpack_require__("./node_modules/console-browserify/index.js");const c={level:"info"},n="custom_context",l=1024e3;class O{constructor(e){this.nodeValue=e,this.sizeInBytes=(new TextEncoder).encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}}class d{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const t=new O(e);if(t.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${t.size}`);for(;this.size+t.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=t),this.tail=t):(this.head=t,this.tail=t),this.lengthInNodes++,this.sizeInBytes+=t.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let t=this.head;for(;null!==t;)e.push(t.value),t=t.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const t=e.value;return e=e.next,{done:!1,value:t}}}}}class L{constructor(e,t=l){this.level=e??"error",this.levelValue=pino__WEBPACK_IMPORTED_MODULE_0__.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=t,this.logs=new d(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,t){t===pino__WEBPACK_IMPORTED_MODULE_0__.levels.values.error?console.error(e):t===pino__WEBPACK_IMPORTED_MODULE_0__.levels.values.warn?console.warn(e):t===pino__WEBPACK_IMPORTED_MODULE_0__.levels.values.debug?console.debug(e):t===pino__WEBPACK_IMPORTED_MODULE_0__.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append((0,_walletconnect_safe_json__WEBPACK_IMPORTED_MODULE_1__.h)({timestamp:(new Date).toISOString(),log:e}));const t="string"==typeof e?JSON.parse(e).level:e.level;t>=this.levelValue&&this.forwardToConsole(e,t)}getLogs(){return this.logs}clearLogs(){this.logs=new d(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const t=this.getLogArray();return t.push((0,_walletconnect_safe_json__WEBPACK_IMPORTED_MODULE_1__.h)({extraMetadata:e})),new Blob(t,{type:"application/json"})}}class m{constructor(e,t=l){this.baseChunkLogger=new L(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const t=URL.createObjectURL(this.logsToBlob(e)),o=document.createElement("a");o.href=t,o.download=`walletconnect-logs-${(new Date).toISOString()}.txt`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(t)}}class B{constructor(e,t=l){this.baseChunkLogger=new L(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}}var x=Object.defineProperty,S=Object.defineProperties,_=Object.getOwnPropertyDescriptors,p=Object.getOwnPropertySymbols,T=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable,f=(r,e,t)=>e in r?x(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,i=(r,e)=>{for(var t in e||(e={}))T.call(e,t)&&f(r,t,e[t]);if(p)for(var t of p(e))z.call(e,t)&&f(r,t,e[t]);return r},g=(r,e)=>S(r,_(e));function k(r){return g(i({},r),{level:r?.level||c.level})}function y(r,e=n){let t="";return t=typeof r.bindings>"u"?function v(r,e=n){return r[e]||""}(r,e):r.bindings().context||"",t}function E(r,e,t=n){const o=function w(r,e,t=n){const o=y(r,t);return o.trim()?`${o}/${e}`:e}(r,e,t);return function b(r,e,t=n){return r[t]=e,r}(r.child({context:o}),o,t)}function A(r){return typeof r.loggerOverride<"u"&&"string"!=typeof r.loggerOverride?{logger:r.loggerOverride,chunkLoggerController:null}:typeof window<"u"?function C(r){var e,t;const o=new m(null==(e=r.opts)?void 0:e.level,r.maxSizeInBytes);return{logger:pino__WEBPACK_IMPORTED_MODULE_0___default()(g(i({},r.opts),{level:"trace",browser:g(i({},null==(t=r.opts)?void 0:t.browser),{write:a=>o.write(a)})})),chunkLoggerController:o}}(r):function I(r){var e;const t=new B(null==(e=r.opts)?void 0:e.level,r.maxSizeInBytes);return{logger:pino__WEBPACK_IMPORTED_MODULE_0___default()(g(i({},r.opts),{level:"trace"}),t),chunkLoggerController:t}}(r)}},"./node_modules/@walletconnect/relay-api/dist/index.es.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{CG:()=>C});const C={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}}},"./node_modules/@walletconnect/relay-auth/dist/index.es.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Cq:()=>sn,FA:()=>Qo,TZ:()=>Po,UF:()=>Qe});var _walletconnect_time__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@walletconnect/time/dist/cjs/index.js"),_walletconnect_safe_json__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@walletconnect/safe-json/dist/esm/index.js");function fe(t,...e){if(!function En(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&"Uint8Array"===t.constructor.name}(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function De(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}const it="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,_t=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function de(t){return"string"==typeof t&&(t=function yn(t){if("string"!=typeof t)throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}(t)),fe(t),t}class xn{clone(){return this._cloneInto()}}function he(t=32){if(it&&"function"==typeof it.getRandomValues)return it.getRandomValues(new Uint8Array(t));if(it&&"function"==typeof it.randomBytes)return it.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}class An extends xn{constructor(e,n,r,o){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=_t(this.buffer)}update(e){De(this);const{view:n,buffer:r,blockLen:o}=this,s=(e=de(e)).length;for(let a=0;a<s;){const u=Math.min(o-this.pos,s-a);if(u===o){const i=_t(e);for(;o<=s-a;a+=o)this.process(i,a);continue}r.set(e.subarray(a,a+u),this.pos),this.pos+=u,a+=u,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){De(this),function gn(t,e){fe(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:o,isLE:s}=this;let{pos:a}=this;n[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>o-a&&(this.process(r,0),a=0);for(let l=a;l<o;l++)n[l]=0;(function Cn(t,e,n,r){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,n,r);const o=BigInt(32),s=BigInt(4294967295),a=Number(n>>o&s),u=Number(n&s),i=r?4:0,D=r?0:4;t.setUint32(e+i,a,r),t.setUint32(e+D,u,r)})(r,o-8,BigInt(8*this.length),s),this.process(r,0);const u=_t(e),i=this.outputLen;if(i%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const D=i/4,c=this.get();if(D>c.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<D;l++)u.setUint32(4*l,c[l],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:o,finished:s,destroyed:a,pos:u}=this;return e.length=o,e.pos=u,e.finished=s,e.destroyed=a,o%n&&e.buffer.set(r),e}}const wt=BigInt(2**32-1),St=BigInt(32);function le(t,e=!1){return e?{h:Number(t&wt),l:Number(t>>St&wt)}:{h:0|Number(t>>St&wt),l:0|Number(t&wt)}}const x={fromBig:le,split:function mn(t,e=!1){let n=new Uint32Array(t.length),r=new Uint32Array(t.length);for(let o=0;o<t.length;o++){const{h:s,l:a}=le(t[o],e);[n[o],r[o]]=[s,a]}return[n,r]},toBig:(t,e)=>BigInt(t>>>0)<<St|BigInt(e>>>0),shrSH:(t,e,n)=>t>>>n,shrSL:(t,e,n)=>t<<32-n|e>>>n,rotrSH:(t,e,n)=>t>>>n|e<<32-n,rotrSL:(t,e,n)=>t<<32-n|e>>>n,rotrBH:(t,e,n)=>t<<64-n|e>>>n-32,rotrBL:(t,e,n)=>t>>>n-32|e<<64-n,rotr32H:(t,e)=>e,rotr32L:(t,e)=>t,rotlSH:(t,e,n)=>t<<n|e>>>32-n,rotlSL:(t,e,n)=>e<<n|t>>>32-n,rotlBH:(t,e,n)=>e<<n-32|t>>>64-n,rotlBL:(t,e,n)=>t<<n-32|e>>>64-n,add:function qn(t,e,n,r){const o=(e>>>0)+(r>>>0);return{h:t+n+(o/2**32|0)|0,l:0|o}},add3L:(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),add3H:(t,e,n,r)=>e+n+r+(t/2**32|0)|0,add4L:(t,e,n,r)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0),add4H:(t,e,n,r,o)=>e+n+r+o+(t/2**32|0)|0,add5H:(t,e,n,r,o,s)=>e+n+r+o+s+(t/2**32|0)|0,add5L:(t,e,n,r,o)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0)+(o>>>0)},[Vn,Yn]=x.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),P=new Uint32Array(80),Q=new Uint32Array(80);class Jn extends An{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:n,Bh:r,Bl:o,Ch:s,Cl:a,Dh:u,Dl:i,Eh:D,El:c,Fh:l,Fl:p,Gh:w,Gl:h,Hh:g,Hl:S}=this;return[e,n,r,o,s,a,u,i,D,c,l,p,w,h,g,S]}set(e,n,r,o,s,a,u,i,D,c,l,p,w,h,g,S){this.Ah=0|e,this.Al=0|n,this.Bh=0|r,this.Bl=0|o,this.Ch=0|s,this.Cl=0|a,this.Dh=0|u,this.Dl=0|i,this.Eh=0|D,this.El=0|c,this.Fh=0|l,this.Fl=0|p,this.Gh=0|w,this.Gl=0|h,this.Hh=0|g,this.Hl=0|S}process(e,n){for(let d=0;d<16;d++,n+=4)P[d]=e.getUint32(n),Q[d]=e.getUint32(n+=4);for(let d=16;d<80;d++){const m=0|P[d-15],F=0|Q[d-15],q=x.rotrSH(m,F,1)^x.rotrSH(m,F,8)^x.shrSH(m,F,7),z=x.rotrSL(m,F,1)^x.rotrSL(m,F,8)^x.shrSL(m,F,7),I=0|P[d-2],O=0|Q[d-2],ot=x.rotrSH(I,O,19)^x.rotrBH(I,O,61)^x.shrSH(I,O,6),tt=x.rotrSL(I,O,19)^x.rotrBL(I,O,61)^x.shrSL(I,O,6),st=x.add4L(z,tt,Q[d-7],Q[d-16]),at=x.add4H(st,q,ot,P[d-7],P[d-16]);P[d]=0|at,Q[d]=0|st}let{Ah:r,Al:o,Bh:s,Bl:a,Ch:u,Cl:i,Dh:D,Dl:c,Eh:l,El:p,Fh:w,Fl:h,Gh:g,Gl:S,Hh:v,Hl:L}=this;for(let d=0;d<80;d++){const m=x.rotrSH(l,p,14)^x.rotrSH(l,p,18)^x.rotrBH(l,p,41),F=x.rotrSL(l,p,14)^x.rotrSL(l,p,18)^x.rotrBL(l,p,41),q=l&w^~l&g,z=p&h^~p&S,I=x.add5L(L,F,z,Yn[d],Q[d]),O=x.add5H(I,v,m,q,Vn[d],P[d]),ot=0|I,tt=x.rotrSH(r,o,28)^x.rotrBH(r,o,34)^x.rotrBH(r,o,39),st=x.rotrSL(r,o,28)^x.rotrBL(r,o,34)^x.rotrBL(r,o,39),at=r&s^r&u^s&u,Ct=o&a^o&i^a&i;v=0|g,L=0|S,g=0|w,S=0|h,w=0|l,h=0|p,({h:l,l:p}=x.add(0|D,0|c,0|O,0|ot)),D=0|u,c=0|i,u=0|s,i=0|a,s=0|r,a=0|o;const At=x.add3L(ot,st,Ct);r=x.add3H(At,O,tt,at),o=0|At}({h:r,l:o}=x.add(0|this.Ah,0|this.Al,0|r,0|o)),({h:s,l:a}=x.add(0|this.Bh,0|this.Bl,0|s,0|a)),({h:u,l:i}=x.add(0|this.Ch,0|this.Cl,0|u,0|i)),({h:D,l:c}=x.add(0|this.Dh,0|this.Dl,0|D,0|c)),({h:l,l:p}=x.add(0|this.Eh,0|this.El,0|l,0|p)),({h:w,l:h}=x.add(0|this.Fh,0|this.Fl,0|w,0|h)),({h:g,l:S}=x.add(0|this.Gh,0|this.Gl,0|g,0|S)),({h:v,l:L}=x.add(0|this.Hh,0|this.Hl,0|v,0|L)),this.set(r,o,s,a,u,i,D,c,l,p,w,h,g,S,v,L)}roundClean(){P.fill(0),Q.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const Kn=function Bn(t){const e=r=>t().update(de(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}(()=>new Jn),vt=BigInt(0),be=BigInt(1),Wn=BigInt(2);function It(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&"Uint8Array"===t.constructor.name}function Ut(t){if(!It(t))throw new Error("Uint8Array expected")}function Tt(t,e){if("boolean"!=typeof e)throw new Error(t+" boolean expected, got "+e)}const Xn=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Ft(t){Ut(t);let e="";for(let n=0;n<t.length;n++)e+=Xn[t[n]];return e}function pe(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);return""===t?vt:BigInt("0x"+t)}const K__0=48,K__9=57,K_A=65,K_F=70,K_a=97,K_f=102;function we(t){return t>=K__0&&t<=K__9?t-K__0:t>=K_A&&t<=K_F?t-(K_A-10):t>=K_a&&t<=K_f?t-(K_a-10):void 0}function Ee(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let o=0,s=0;o<n;o++,s+=2){const a=we(t.charCodeAt(s)),u=we(t.charCodeAt(s+1));if(void 0===a||void 0===u){const i=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+i+'" at index '+s)}r[o]=16*a+u}return r}function Et(t){return Ut(t),pe(Ft(Uint8Array.from(t).reverse()))}function ge(t,e){return Ee(t.toString(16).padStart(2*e,"0"))}function Nt(t,e){return ge(t,e).reverse()}function W(t,e,n){let r;if("string"==typeof e)try{r=Ee(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else{if(!It(e))throw new Error(t+" must be hex string or Uint8Array");r=Uint8Array.from(e)}const o=r.length;if("number"==typeof n&&o!==n)throw new Error(t+" of length "+n+" expected, got "+o);return r}function ye(...t){let e=0;for(let r=0;r<t.length;r++){const o=t[r];Ut(o),e+=o.length}const n=new Uint8Array(e);for(let r=0,o=0;r<t.length;r++){const s=t[r];n.set(s,o),o+=s.length}return n}const Lt=t=>"bigint"==typeof t&&vt<=t;function ft(t,e,n,r){if(!function Qn(t,e,n){return Lt(t)&&Lt(e)&&Lt(n)&&e<=t&&t<n}(e,n,r))throw new Error("expected valid "+t+": "+n+" <= n < "+r+", got "+e)}const er=t=>(Wn<<BigInt(t-1))-be,nr={bigint:t=>"bigint"==typeof t,function:t=>"function"==typeof t,boolean:t=>"boolean"==typeof t,string:t=>"string"==typeof t,stringOrUint8Array:t=>"string"==typeof t||It(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>"function"==typeof t&&Number.isSafeInteger(t.outputLen)};function Ot(t,e,n={}){const r=(o,s,a)=>{const u=nr[s];if("function"!=typeof u)throw new Error("invalid validator function");const i=t[o];if(!(a&&void 0===i||u(i,t)))throw new Error("param "+String(o)+" is invalid. Expected "+s+", got "+i)};for(const[o,s]of Object.entries(e))r(o,s,!1);for(const[o,s]of Object.entries(n))r(o,s,!0);return t}function xe(t){const e=new WeakMap;return(n,...r)=>{const o=e.get(n);if(void 0!==o)return o;const s=t(n,...r);return e.set(n,s),s}}const M=BigInt(0),N=BigInt(1),nt=BigInt(2),rr=BigInt(3),Ht=BigInt(4),Be=BigInt(5),Ce=BigInt(8);function H(t,e){const n=t%e;return n>=M?n:e+n}function or(t,e,n){if(e<M)throw new Error("invalid exponent, negatives unsupported");if(n<=M)throw new Error("invalid modulus");if(n===N)return M;let r=N;for(;e>M;)e&N&&(r=r*t%n),t=t*t%n,e>>=N;return r}function J(t,e,n){let r=t;for(;e-- >M;)r*=r,r%=n;return r}function Ae(t,e){if(t===M)throw new Error("invert: expected non-zero number");if(e<=M)throw new Error("invert: expected positive modulus, got "+e);let n=H(t,e),r=e,o=M,s=N;for(;n!==M;){const i=r%n,D=o-s*(r/n);r=n,n=i,o=s,s=D}if(r!==N)throw new Error("invert: does not exist");return H(o,e)}function ir(t){if(t%Ht===rr){const e=(t+N)/Ht;return function(r,o){const s=r.pow(o,e);if(!r.eql(r.sqr(s),o))throw new Error("Cannot find square root");return s}}if(t%Ce===Be){const e=(t-Be)/Ce;return function(r,o){const s=r.mul(o,nt),a=r.pow(s,e),u=r.mul(o,a),i=r.mul(r.mul(u,nt),a),D=r.mul(u,r.sub(i,r.ONE));if(!r.eql(r.sqr(D),o))throw new Error("Cannot find square root");return D}}return function sr(t){const e=(t-N)/nt;let n,r,o;for(n=t-N,r=0;n%nt===M;n/=nt,r++);for(o=nt;o<t&&or(o,e,t)!==t-N;o++)if(o>1e3)throw new Error("Cannot find square root: likely non-prime P");if(1===r){const a=(t+N)/Ht;return function(i,D){const c=i.pow(D,a);if(!i.eql(i.sqr(c),D))throw new Error("Cannot find square root");return c}}const s=(n+N)/nt;return function(u,i){if(u.pow(i,e)===u.neg(u.ONE))throw new Error("Cannot find square root");let D=r,c=u.pow(u.mul(u.ONE,o),n),l=u.pow(i,s),p=u.pow(i,n);for(;!u.eql(p,u.ONE);){if(u.eql(p,u.ZERO))return u.ZERO;let w=1;for(let g=u.sqr(p);w<D&&!u.eql(g,u.ONE);w++)g=u.sqr(g);const h=u.pow(c,N<<BigInt(D-w-1));c=u.sqr(h),l=u.mul(l,h),p=u.mul(p,c),D=w}return l}}(t)}const cr=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function me(t,e){const n=void 0!==e?e:t.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function _e(t,e,n=!1,r={}){if(t<=M)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:o,nByteLength:s}=me(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let a;const u=Object.freeze({ORDER:t,isLE:n,BITS:o,BYTES:s,MASK:er(o),ZERO:M,ONE:N,create:i=>H(i,t),isValid:i=>{if("bigint"!=typeof i)throw new Error("invalid field element: expected bigint, got "+typeof i);return M<=i&&i<t},is0:i=>i===M,isOdd:i=>(i&N)===N,neg:i=>H(-i,t),eql:(i,D)=>i===D,sqr:i=>H(i*i,t),add:(i,D)=>H(i+D,t),sub:(i,D)=>H(i-D,t),mul:(i,D)=>H(i*D,t),pow:(i,D)=>function fr(t,e,n){if(n<M)throw new Error("invalid exponent, negatives unsupported");if(n===M)return t.ONE;if(n===N)return e;let r=t.ONE,o=e;for(;n>M;)n&N&&(r=t.mul(r,o)),o=t.sqr(o),n>>=N;return r}(u,i,D),div:(i,D)=>H(i*Ae(D,t),t),sqrN:i=>i*i,addN:(i,D)=>i+D,subN:(i,D)=>i-D,mulN:(i,D)=>i*D,inv:i=>Ae(i,t),sqrt:r.sqrt||(i=>(a||(a=ir(t)),a(u,i))),invertBatch:i=>function Dr(t,e){const n=new Array(e.length),r=e.reduce((s,a,u)=>t.is0(a)?s:(n[u]=s,t.mul(s,a)),t.ONE),o=t.inv(r);return e.reduceRight((s,a,u)=>t.is0(a)?s:(n[u]=t.mul(s,n[u]),t.mul(s,a)),o),n}(u,i),cmov:(i,D,c)=>c?D:i,toBytes:i=>n?Nt(i,s):ge(i,s),fromBytes:i=>{if(i.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+i.length);return n?Et(i):function Pn(t){return pe(Ft(t))}(i)}});return Object.freeze(u)}const Se=BigInt(0),gt=BigInt(1);function zt(t,e){const n=e.negate();return t?n:e}function ve(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Mt(t,e){ve(t,e);return{windows:Math.ceil(e/t)+1,windowSize:2**(t-1)}}const qt=new WeakMap,Ie=new WeakMap;function $t(t){return Ie.get(t)||1}function br(t,e,n,r){if(function dr(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,r)=>{if(!(n instanceof e))throw new Error("invalid point at index "+r)})}(n,t),function hr(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,r)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+r)})}(r,e),n.length!==r.length)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,s=function tr(t){let e;for(e=0;t>vt;t>>=be,e+=1);return e}(BigInt(n.length)),a=s>12?s-3:s>4?s-2:s?2:1,u=(1<<a)-1,i=new Array(u+1).fill(o);let c=o;for(let l=Math.floor((e.BITS-1)/a)*a;l>=0;l-=a){i.fill(o);for(let w=0;w<r.length;w++){const h=r[w],g=Number(h>>BigInt(l)&BigInt(u));i[g]=i[g].add(n[w])}let p=o;for(let w=i.length-1,h=o;w>0;w--)h=h.add(i[w]),p=p.add(h);if(c=c.add(p),0!==l)for(let w=0;w<a;w++)c=c.double()}return c}function pr(t){return function ar(t){return Ot(t,cr.reduce((r,o)=>(r[o]="function",r),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"}))}(t.Fp),Ot(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...me(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const G=BigInt(0),j=BigInt(1),yt=BigInt(2),wr=BigInt(8),Er={zip215:!0};function yr(t){const e=function gr(t){const e=pr(t);return Ot(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}(t),{Fp:n,n:r,prehash:o,hash:s,randomBytes:a,nByteLength:u,h:i}=e,D=yt<<BigInt(8*u)-j,c=n.create,l=_e(e.n,e.nBitLength),p=e.uvRatio||((y,f)=>{try{return{isValid:!0,value:n.sqrt(y*n.inv(f))}}catch{return{isValid:!1,value:G}}}),w=e.adjustScalarBytes||(y=>y),h=e.domain||((y,f,b)=>{if(Tt("phflag",b),f.length||b)throw new Error("Contexts/pre-hash are not supported");return y});function g(y,f){ft("coordinate "+y,f,G,D)}function S(y){if(!(y instanceof d))throw new Error("ExtendedPoint expected")}const v=xe((y,f)=>{const{ex:b,ey:E,ez:B}=y,C=y.is0();null==f&&(f=C?wr:n.inv(B));const A=c(b*f),U=c(E*f),_=c(B*f);if(C)return{x:G,y:j};if(_!==j)throw new Error("invZ was invalid");return{x:A,y:U}}),L=xe(y=>{const{a:f,d:b}=e;if(y.is0())throw new Error("bad point: ZERO");const{ex:E,ey:B,ez:C,et:A}=y,U=c(E*E),_=c(B*B),T=c(C*C),$=c(T*T),R=c(U*f);if(c(T*c(R+_))!==c($+c(b*c(U*_))))throw new Error("bad point: equation left != right (1)");if(c(E*B)!==c(C*A))throw new Error("bad point: equation left != right (2)");return!0});class d{constructor(f,b,E,B){this.ex=f,this.ey=b,this.ez=E,this.et=B,g("x",f),g("y",b),g("z",E),g("t",B),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(f){if(f instanceof d)throw new Error("extended point not allowed");const{x:b,y:E}=f||{};return g("x",b),g("y",E),new d(b,E,j,c(b*E))}static normalizeZ(f){const b=n.invertBatch(f.map(E=>E.ez));return f.map((E,B)=>E.toAffine(b[B])).map(d.fromAffine)}static msm(f,b){return br(d,l,f,b)}_setWindowSize(f){q.setWindowSize(this,f)}assertValidity(){L(this)}equals(f){S(f);const{ex:b,ey:E,ez:B}=this,{ex:C,ey:A,ez:U}=f,_=c(b*U),T=c(C*B),$=c(E*U),R=c(A*B);return _===T&&$===R}is0(){return this.equals(d.ZERO)}negate(){return new d(c(-this.ex),this.ey,this.ez,c(-this.et))}double(){const{a:f}=e,{ex:b,ey:E,ez:B}=this,C=c(b*b),A=c(E*E),U=c(yt*c(B*B)),_=c(f*C),T=b+E,$=c(c(T*T)-C-A),R=_+A,V=R-U,Y=_-A,Z=c($*V),X=c(R*Y),et=c($*Y),pt=c(V*R);return new d(Z,X,pt,et)}add(f){S(f);const{a:b,d:E}=e,{ex:B,ey:C,ez:A,et:U}=this,{ex:_,ey:T,ez:$,et:R}=f;if(b===BigInt(-1)){const re=c((C-B)*(T+_)),oe=c((C+B)*(T-_)),mt=c(oe-re);if(mt===G)return this.double();const se=c(A*yt*R),ie=c(U*yt*$),ue=ie+se,ce=oe+re,ae=ie-se,Dn=c(ue*mt),dn=c(ce*ae),hn=c(ue*ae),ln=c(mt*ce);return new d(Dn,dn,ln,hn)}const V=c(B*_),Y=c(C*T),Z=c(U*E*R),X=c(A*$),et=c((B+C)*(_+T)-V-Y),pt=X-Z,ee=X+Z,ne=c(Y-b*V),un=c(et*pt),cn=c(ee*ne),an=c(et*ne),fn=c(pt*ee);return new d(un,cn,fn,an)}subtract(f){return this.add(f.negate())}wNAF(f){return q.wNAFCached(this,f,d.normalizeZ)}multiply(f){const b=f;ft("scalar",b,j,r);const{p:E,f:B}=this.wNAF(b);return d.normalizeZ([E,B])[0]}multiplyUnsafe(f,b=d.ZERO){const E=f;return ft("scalar",E,G,r),E===G?F:this.is0()||E===j?this:q.wNAFCachedUnsafe(this,E,d.normalizeZ,b)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}isTorsionFree(){return q.unsafeLadder(this,r).is0()}toAffine(f){return v(this,f)}clearCofactor(){const{h:f}=e;return f===j?this:this.multiplyUnsafe(f)}static fromHex(f,b=!1){const{d:E,a:B}=e,C=n.BYTES;f=W("pointHex",f,C),Tt("zip215",b);const A=f.slice(),U=f[C-1];A[C-1]=-129&U;const _=Et(A),T=b?D:n.ORDER;ft("pointHex.y",_,G,T);const $=c(_*_),R=c($-j),V=c(E*$-B);let{isValid:Y,value:Z}=p(R,V);if(!Y)throw new Error("Point.fromHex: invalid y coordinate");const X=(Z&j)===j,et=!!(128&U);if(!b&&Z===G&&et)throw new Error("Point.fromHex: x=0 and x_0=1");return et!==X&&(Z=c(-Z)),d.fromAffine({x:Z,y:_})}static fromPrivateKey(f){return O(f).point}toRawBytes(){const{x:f,y:b}=this.toAffine(),E=Nt(b,n.BYTES);return E[E.length-1]|=f&j?128:0,E}toHex(){return Ft(this.toRawBytes())}}d.BASE=new d(e.Gx,e.Gy,j,c(e.Gx*e.Gy)),d.ZERO=new d(G,j,j,G);const{BASE:m,ZERO:F}=d,q=function lr(t,e){return{constTimeNegate:zt,hasPrecomputes:n=>1!==$t(n),unsafeLadder(n,r,o=t.ZERO){let s=n;for(;r>Se;)r&gt&&(o=o.add(s)),s=s.double(),r>>=gt;return o},precomputeWindow(n,r){const{windows:o,windowSize:s}=Mt(r,e),a=[];let u=n,i=u;for(let D=0;D<o;D++){i=u,a.push(i);for(let c=1;c<s;c++)i=i.add(u),a.push(i);u=i.double()}return a},wNAF(n,r,o){const{windows:s,windowSize:a}=Mt(n,e);let u=t.ZERO,i=t.BASE;const D=BigInt(2**n-1),c=2**n,l=BigInt(n);for(let p=0;p<s;p++){const w=p*a;let h=Number(o&D);o>>=l,h>a&&(h-=c,o+=gt);const g=w,S=w+Math.abs(h)-1,v=p%2!=0,L=h<0;0===h?i=i.add(zt(v,r[g])):u=u.add(zt(L,r[S]))}return{p:u,f:i}},wNAFUnsafe(n,r,o,s=t.ZERO){const{windows:a,windowSize:u}=Mt(n,e),i=BigInt(2**n-1),D=2**n,c=BigInt(n);for(let l=0;l<a;l++){const p=l*u;if(o===Se)break;let w=Number(o&i);if(o>>=c,w>u&&(w-=D,o+=gt),0===w)continue;let h=r[p+Math.abs(w)-1];w<0&&(h=h.negate()),s=s.add(h)}return s},getPrecomputes(n,r,o){let s=qt.get(r);return s||(s=this.precomputeWindow(r,n),1!==n&&qt.set(r,o(s))),s},wNAFCached(n,r,o){const s=$t(n);return this.wNAF(s,this.getPrecomputes(s,n,o),r)},wNAFCachedUnsafe(n,r,o,s){const a=$t(n);return 1===a?this.unsafeLadder(n,r,s):this.wNAFUnsafe(a,this.getPrecomputes(a,n,o),r,s)},setWindowSize(n,r){ve(r,e),Ie.set(n,r),qt.delete(n)}}}(d,8*u);function z(y){return H(y,r)}function I(y){return z(Et(y))}function O(y){const f=n.BYTES;y=W("private key",y,f);const b=W("hashed private key",s(y),2*f),E=w(b.slice(0,f)),B=b.slice(f,2*f),C=I(E),A=m.multiply(C),U=A.toRawBytes();return{head:E,prefix:B,scalar:C,point:A,pointBytes:U}}function tt(y=new Uint8Array,...f){const b=ye(...f);return I(s(h(b,W("context",y),!!o)))}const at=Er;return m._setWindowSize(8),{CURVE:e,getPublicKey:function ot(y){return O(y).pointBytes},sign:function st(y,f,b={}){y=W("message",y),o&&(y=o(y));const{prefix:E,scalar:B,pointBytes:C}=O(f),A=tt(b.context,E,y),U=m.multiply(A).toRawBytes(),T=z(A+tt(b.context,U,C,y)*B);return ft("signature.s",T,G,r),W("result",ye(U,Nt(T,n.BYTES)),2*n.BYTES)},verify:function Ct(y,f,b,E=at){const{context:B,zip215:C}=E,A=n.BYTES;y=W("signature",y,2*A),f=W("message",f),b=W("publicKey",b,A),void 0!==C&&Tt("zip215",C),o&&(f=o(f));const U=Et(y.slice(A,2*A));let _,T,$;try{_=d.fromHex(b,C),T=d.fromHex(y.slice(0,A),C),$=m.multiplyUnsafe(U)}catch{return!1}if(!C&&_.isSmallOrder())return!1;const R=tt(B,T.toRawBytes(),_.toRawBytes(),f);return T.add(_.multiplyUnsafe(R)).subtract($).clearCofactor().equals(d.ZERO)},ExtendedPoint:d,utils:{getExtendedPublicKey:O,randomPrivateKey:()=>a(n.BYTES),precompute:(y=8,f=d.BASE)=>(f._setWindowSize(y),f.multiply(BigInt(3)),f)}}}BigInt(0),BigInt(1);const kt=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Ue=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const xr=BigInt(1),Te=BigInt(2);BigInt(3);const Br=BigInt(5),Cr=BigInt(8);function mr(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function _r(t,e){const n=kt,r=H(e*e*e,n),s=function Ar(t){const e=BigInt(10),n=BigInt(20),r=BigInt(40),o=BigInt(80),s=kt,u=t*t%s*t%s,i=J(u,Te,s)*u%s,D=J(i,xr,s)*t%s,c=J(D,Br,s)*D%s,l=J(c,e,s)*c%s,p=J(l,n,s)*l%s,w=J(p,r,s)*p%s,h=J(w,o,s)*w%s,g=J(h,o,s)*w%s,S=J(g,e,s)*c%s;return{pow_p_5_8:J(S,Te,s)*t%s,b2:u}}(t*H(r*r*e,n)).pow_p_5_8;let a=H(t*r*s,n);const u=H(e*a*a,n),i=a,D=H(a*Ue,n),c=u===t,l=u===H(-t,n),p=u===H(-t*Ue,n);return c&&(a=i),(l||p)&&(a=D),((t,e)=>(H(t,e)&N)===N)(a,n)&&(a=H(-a,n)),{isValid:c||l,value:a}}const Sr=_e(kt,void 0,!0),Rt=yr({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Sr,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:Cr,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Kn,randomBytes:he,adjustScalarBytes:mr,uvRatio:_r}),jt="EdDSA",Zt="JWT",ut=".",Dt="base64url",Gt="utf8",xt="utf8",Vt=":",Yt="did",Jt="key",dt="base58btc",Kt="z",Wt="K36",Ne=32;function Xt(t){return null!=globalThis.Buffer?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Le(t=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?Xt(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Oe(t,e){e||(e=t.reduce((o,s)=>o+s.length,0));const n=Le(e);let r=0;for(const o of t)n.set(o,r),r+=o.length;return Xt(n)}var Tr=function Ir(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var o=0;o<t.length;o++){var s=t.charAt(o),a=s.charCodeAt(0);if(255!==n[a])throw new TypeError(s+" is ambiguous");n[a]=o}var u=t.length,i=t.charAt(0),D=Math.log(u)/Math.log(256),c=Math.log(256)/Math.log(u);function p(h){if("string"!=typeof h)throw new TypeError("Expected String");if(0===h.length)return new Uint8Array;var g=0;if(" "!==h[g]){for(var S=0,v=0;h[g]===i;)S++,g++;for(var L=(h.length-g)*D+1>>>0,d=new Uint8Array(L);h[g];){var m=n[h.charCodeAt(g)];if(255===m)return;for(var F=0,q=L-1;(0!==m||F<v)&&-1!==q;q--,F++)m+=u*d[q]>>>0,d[q]=m%256>>>0,m=m/256>>>0;if(0!==m)throw new Error("Non-zero carry");v=F,g++}if(" "!==h[g]){for(var z=L-v;z!==L&&0===d[z];)z++;for(var I=new Uint8Array(S+(L-z)),O=S;z!==L;)I[O++]=d[z++];return I}}}return{encode:function l(h){if(h instanceof Uint8Array||(ArrayBuffer.isView(h)?h=new Uint8Array(h.buffer,h.byteOffset,h.byteLength):Array.isArray(h)&&(h=Uint8Array.from(h))),!(h instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===h.length)return"";for(var g=0,S=0,v=0,L=h.length;v!==L&&0===h[v];)v++,g++;for(var d=(L-v)*c+1>>>0,m=new Uint8Array(d);v!==L;){for(var F=h[v],q=0,z=d-1;(0!==F||q<S)&&-1!==z;z--,q++)F+=256*m[z]>>>0,m[z]=F%u>>>0,F=F/u>>>0;if(0!==F)throw new Error("Non-zero carry");S=q,v++}for(var I=d-S;I!==d&&0===m[I];)I++;for(var O=i.repeat(g);I<d;++I)O+=t.charAt(m[I]);return O},decodeUnsafe:p,decode:function w(h){var g=p(h);if(g)return g;throw new Error(`Non-${e} character`)}}};const He=t=>{if(t instanceof Uint8Array&&"Uint8Array"===t.constructor.name)return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")};class Lr{constructor(e,n,r){this.name=e,this.prefix=n,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Or{constructor(e,n,r){if(this.name=e,this.prefix=n,void 0===n.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return ze(this,e)}}class Hr{constructor(e){this.decoders=e}or(e){return ze(this,e)}decode(e){const n=e[0],r=this.decoders[n];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ze=(t,e)=>new Hr({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class zr{constructor(e,n,r,o){this.name=e,this.prefix=n,this.baseEncode=r,this.baseDecode=o,this.encoder=new Lr(e,n,r),this.decoder=new Or(e,n,o)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Bt=({name:t,prefix:e,encode:n,decode:r})=>new zr(t,e,n,r),ht=({prefix:t,name:e,alphabet:n})=>{const{encode:r,decode:o}=Tr(n,e);return Bt({prefix:t,name:e,encode:r,decode:s=>He(o(s))})},k=({name:t,prefix:e,bitsPerChar:n,alphabet:r})=>Bt({prefix:e,name:t,encode:o=>((t,e,n)=>{const r="="===e[e.length-1],o=(1<<n)-1;let s="",a=0,u=0;for(let i=0;i<t.length;++i)for(u=u<<8|t[i],a+=8;a>n;)a-=n,s+=e[o&u>>a];if(a&&(s+=e[o&u<<n-a]),r)for(;s.length*n&7;)s+="=";return s})(o,r,n),decode:o=>((t,e,n,r)=>{const o={};for(let c=0;c<e.length;++c)o[e[c]]=c;let s=t.length;for(;"="===t[s-1];)--s;const a=new Uint8Array(s*n/8|0);let u=0,i=0,D=0;for(let c=0;c<s;++c){const l=o[t[c]];if(void 0===l)throw new SyntaxError(`Non-${r} character`);i=i<<n|l,u+=n,u>=8&&(u-=8,a[D++]=255&i>>u)}if(u>=n||255&i<<8-u)throw new SyntaxError("Unexpected end of data");return a})(o,r,n,t)}),$r=Bt({prefix:"\0",name:"identity",encode:t=>(t=>(new TextDecoder).decode(t))(t),decode:t=>(t=>(new TextEncoder).encode(t))(t)});var kr=Object.freeze({__proto__:null,identity:$r});const Rr=k({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var jr=Object.freeze({__proto__:null,base2:Rr});const Zr=k({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Gr=Object.freeze({__proto__:null,base8:Zr});const Vr=ht({prefix:"9",name:"base10",alphabet:"0123456789"});var Yr=Object.freeze({__proto__:null,base10:Vr});const Jr=k({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Kr=k({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Wr=Object.freeze({__proto__:null,base16:Jr,base16upper:Kr});const Xr=k({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Pr=k({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Qr=k({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),to=k({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),eo=k({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),no=k({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ro=k({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),oo=k({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),so=k({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var io=Object.freeze({__proto__:null,base32:Xr,base32upper:Pr,base32pad:Qr,base32padupper:to,base32hex:eo,base32hexupper:no,base32hexpad:ro,base32hexpadupper:oo,base32z:so});const uo=ht({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),co=ht({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var ao=Object.freeze({__proto__:null,base36:uo,base36upper:co});const fo=ht({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Do=ht({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var ho=Object.freeze({__proto__:null,base58btc:fo,base58flickr:Do});const lo=k({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),bo=k({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),po=k({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),wo=k({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Eo=Object.freeze({__proto__:null,base64:lo,base64pad:bo,base64url:po,base64urlpad:wo});const Me=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),go=Me.reduce((t,e,n)=>(t[n]=e,t),[]),yo=Me.reduce((t,e,n)=>(t[e.codePointAt(0)]=n,t),[]);const Co=Bt({prefix:"🚀",name:"base256emoji",encode:function xo(t){return t.reduce((e,n)=>e+=go[n],"")},decode:function Bo(t){const e=[];for(const n of t){const r=yo[n.codePointAt(0)];if(void 0===r)throw new Error(`Non-base256emoji character: ${n}`);e.push(r)}return new Uint8Array(e)}});var Ao=Object.freeze({__proto__:null,base256emoji:Co}),mo=function $e(t,e,n){e=e||[];for(var r=n=n||0;t>=vo;)e[n++]=255&t|qe,t/=128;for(;t&So;)e[n++]=255&t|qe,t>>>=7;return e[n]=0|t,$e.bytes=n-r+1,e},qe=128,So=-128,vo=Math.pow(2,31);var Io=function Pt(t,r){var a,n=0,o=0,s=r=r||0,u=t.length;do{if(s>=u)throw Pt.bytes=0,new RangeError("Could not decode varint");a=t[s++],n+=o<28?(a&ke)<<o:(a&ke)*Math.pow(2,o),o+=7}while(a>=Uo);return Pt.bytes=s-r,n},Uo=128,ke=127;var To=Math.pow(2,7),Fo=Math.pow(2,14),No=Math.pow(2,21),Lo=Math.pow(2,28),Oo=Math.pow(2,35),Ho=Math.pow(2,42),zo=Math.pow(2,49),Mo=Math.pow(2,56),qo=Math.pow(2,63),Re={encode:mo,decode:Io,encodingLength:function(t){return t<To?1:t<Fo?2:t<No?3:t<Lo?4:t<Oo?5:t<Ho?6:t<zo?7:t<Mo?8:t<qo?9:10}};const je=(t,e,n=0)=>(Re.encode(t,e,n),e),Ze=t=>Re.encodingLength(t),Qt=(t,e)=>{const n=e.byteLength,r=Ze(t),o=r+Ze(n),s=new Uint8Array(o+n);return je(t,s,0),je(n,s,r),s.set(e,o),new Ro(t,n,e,s)};class Ro{constructor(e,n,r,o){this.code=e,this.size=n,this.digest=r,this.bytes=o}}const Ge=({name:t,code:e,encode:n})=>new jo(t,e,n);class jo{constructor(e,n,r){this.name=e,this.code=n,this.encode=r}digest(e){if(e instanceof Uint8Array){const n=this.encode(e);return n instanceof Uint8Array?Qt(this.code,n):n.then(r=>Qt(this.code,r))}throw Error("Unknown type, must be binary type")}}const Ve=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Zo=Ge({name:"sha2-256",code:18,encode:Ve("SHA-256")}),Go=Ge({name:"sha2-512",code:19,encode:Ve("SHA-512")});Object.freeze({__proto__:null,sha256:Zo,sha512:Go});const Je=He,Ko={code:0,name:"identity",encode:Je,digest:t=>Qt(0,Je(t))};Object.freeze({__proto__:null,identity:Ko});new TextEncoder,new TextDecoder;const Ke={...kr,...jr,...Gr,...Yr,...Wr,...io,...ao,...ho,...Eo,...Ao};function We(t,e,n,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:n},decoder:{decode:r}}}const Xe=We("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>(new TextEncoder).encode(t.substring(1))),te=We("ascii","a",t=>{let e="a";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},t=>{const e=Le((t=t.substring(1)).length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}),Pe={utf8:Xe,"utf-8":Xe,hex:Ke.base16,latin1:te,ascii:te,binary:te,...Ke};function ct(t,e="utf8"){const n=Pe[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return"utf8"!==e&&"utf-8"!==e||null==globalThis.Buffer||null==globalThis.Buffer.from?n.encoder.encode(t).substring(1):globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8")}function rt(t,e="utf8"){const n=Pe[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return"utf8"!==e&&"utf-8"!==e||null==globalThis.Buffer||null==globalThis.Buffer.from?n.decoder.decode(`${n.prefix}${t}`):Xt(globalThis.Buffer.from(t,"utf-8"))}function lt(t){return(0,_walletconnect_safe_json__WEBPACK_IMPORTED_MODULE_1__.j)(ct(rt(t,Dt),Gt))}function bt(t){return ct(rt((0,_walletconnect_safe_json__WEBPACK_IMPORTED_MODULE_1__.h)(t),Gt),Dt)}function Qe(t){const e=rt(Wt,dt),n=Kt+ct(Oe([e,t]),dt);return[Yt,Jt,n].join(Vt)}function en(t){return ct(t,Dt)}function sn(t){const e=t.split(ut),n=lt(e[0]),r=lt(e[1]),o=function nn(t){return rt(t,Dt)}(e[2]);return{header:n,payload:r,signature:o,data:rt(e.slice(0,2).join(ut),xt)}}function Po(t=he(Ne)){const e=Rt.getPublicKey(t);return{secretKey:Oe([t,e]),publicKey:e}}async function Qo(t,e,n,r,o=(0,_walletconnect_time__WEBPACK_IMPORTED_MODULE_0__.fromMiliseconds)(Date.now())){const s={alg:jt,typ:Zt},i={iss:Qe(r.publicKey),sub:t,aud:e,iat:o,exp:o+n},D=function rn(t){return rt([bt(t.header),bt(t.payload)].join(ut),xt)}({header:s,payload:i});return function on(t){return[bt(t.header),bt(t.payload),en(t.signature)].join(ut)}({header:s,payload:i,signature:Rt.sign(D,r.secretKey.slice(0,32))})}},"./node_modules/@walletconnect/safe-json/dist/esm/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{h:()=>safeJsonStringify,j:()=>safeJsonParse});const JSONStringify=data=>JSON.stringify(data,(_,value)=>"bigint"==typeof value?value.toString()+"n":value),JSONParse=json=>{const serializedData=json.replace(/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,'$1"$2n"$3');return JSON.parse(serializedData,(_,value)=>"string"==typeof value&&value.match(/^\d+n$/)?BigInt(value.substring(0,value.length-1)):value)};function safeJsonParse(value){if("string"!=typeof value)throw new Error("Cannot safe json parse value of type "+typeof value);try{return JSONParse(value)}catch(_a){return value}}function safeJsonStringify(value){return"string"==typeof value?value:JSONStringify(value)||""}},"./node_modules/@walletconnect/time/dist/cjs/constants/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__("./node_modules/@walletconnect/time/node_modules/tslib/tslib.es6.js");tslib_1.__exportStar(__webpack_require__("./node_modules/@walletconnect/time/dist/cjs/constants/misc.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/@walletconnect/time/dist/cjs/constants/time.js"),exports)},"./node_modules/@walletconnect/time/dist/cjs/constants/misc.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ONE_THOUSAND=exports.ONE_HUNDRED=void 0,exports.ONE_HUNDRED=100,exports.ONE_THOUSAND=1e3},"./node_modules/@walletconnect/time/dist/cjs/constants/time.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ONE_YEAR=exports.FOUR_WEEKS=exports.THREE_WEEKS=exports.TWO_WEEKS=exports.ONE_WEEK=exports.THIRTY_DAYS=exports.SEVEN_DAYS=exports.FIVE_DAYS=exports.THREE_DAYS=exports.ONE_DAY=exports.TWENTY_FOUR_HOURS=exports.TWELVE_HOURS=exports.SIX_HOURS=exports.THREE_HOURS=exports.ONE_HOUR=exports.SIXTY_MINUTES=exports.THIRTY_MINUTES=exports.TEN_MINUTES=exports.FIVE_MINUTES=exports.ONE_MINUTE=exports.SIXTY_SECONDS=exports.THIRTY_SECONDS=exports.TEN_SECONDS=exports.FIVE_SECONDS=exports.ONE_SECOND=void 0,exports.ONE_SECOND=1,exports.FIVE_SECONDS=5,exports.TEN_SECONDS=10,exports.THIRTY_SECONDS=30,exports.SIXTY_SECONDS=60,exports.ONE_MINUTE=exports.SIXTY_SECONDS,exports.FIVE_MINUTES=5*exports.ONE_MINUTE,exports.TEN_MINUTES=10*exports.ONE_MINUTE,exports.THIRTY_MINUTES=30*exports.ONE_MINUTE,exports.SIXTY_MINUTES=60*exports.ONE_MINUTE,exports.ONE_HOUR=exports.SIXTY_MINUTES,exports.THREE_HOURS=3*exports.ONE_HOUR,exports.SIX_HOURS=6*exports.ONE_HOUR,exports.TWELVE_HOURS=12*exports.ONE_HOUR,exports.TWENTY_FOUR_HOURS=24*exports.ONE_HOUR,exports.ONE_DAY=exports.TWENTY_FOUR_HOURS,exports.THREE_DAYS=3*exports.ONE_DAY,exports.FIVE_DAYS=5*exports.ONE_DAY,exports.SEVEN_DAYS=7*exports.ONE_DAY,exports.THIRTY_DAYS=30*exports.ONE_DAY,exports.ONE_WEEK=exports.SEVEN_DAYS,exports.TWO_WEEKS=2*exports.ONE_WEEK,exports.THREE_WEEKS=3*exports.ONE_WEEK,exports.FOUR_WEEKS=4*exports.ONE_WEEK,exports.ONE_YEAR=365*exports.ONE_DAY},"./node_modules/@walletconnect/time/dist/cjs/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__("./node_modules/@walletconnect/time/node_modules/tslib/tslib.es6.js");tslib_1.__exportStar(__webpack_require__("./node_modules/@walletconnect/time/dist/cjs/utils/index.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/@walletconnect/time/dist/cjs/watch.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/@walletconnect/time/dist/cjs/types/index.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/@walletconnect/time/dist/cjs/constants/index.js"),exports)},"./node_modules/@walletconnect/time/dist/cjs/types/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});__webpack_require__("./node_modules/@walletconnect/time/node_modules/tslib/tslib.es6.js").__exportStar(__webpack_require__("./node_modules/@walletconnect/time/dist/cjs/types/watch.js"),exports)},"./node_modules/@walletconnect/time/dist/cjs/types/watch.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.IWatch=void 0;exports.IWatch=class IWatch{}},"./node_modules/@walletconnect/time/dist/cjs/utils/convert.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fromMiliseconds=exports.toMiliseconds=void 0;const constants_1=__webpack_require__("./node_modules/@walletconnect/time/dist/cjs/constants/index.js");exports.toMiliseconds=function toMiliseconds(seconds){return seconds*constants_1.ONE_THOUSAND},exports.fromMiliseconds=function fromMiliseconds(miliseconds){return Math.floor(miliseconds/constants_1.ONE_THOUSAND)}},"./node_modules/@walletconnect/time/dist/cjs/utils/delay.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.delay=void 0,exports.delay=function delay(timeout){return new Promise(resolve=>{setTimeout(()=>{resolve(!0)},timeout)})}},"./node_modules/@walletconnect/time/dist/cjs/utils/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__("./node_modules/@walletconnect/time/node_modules/tslib/tslib.es6.js");tslib_1.__exportStar(__webpack_require__("./node_modules/@walletconnect/time/dist/cjs/utils/delay.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/@walletconnect/time/dist/cjs/utils/convert.js"),exports)},"./node_modules/@walletconnect/time/dist/cjs/watch.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Watch=void 0;class Watch{constructor(){this.timestamps=new Map}start(label){if(this.timestamps.has(label))throw new Error(`Watch already started for label: ${label}`);this.timestamps.set(label,{started:Date.now()})}stop(label){const timestamp=this.get(label);if(void 0!==timestamp.elapsed)throw new Error(`Watch already stopped for label: ${label}`);const elapsed=Date.now()-timestamp.started;this.timestamps.set(label,{started:timestamp.started,elapsed})}get(label){const timestamp=this.timestamps.get(label);if(void 0===timestamp)throw new Error(`No timestamp found for label: ${label}`);return timestamp}elapsed(label){const timestamp=this.get(label);return timestamp.elapsed||Date.now()-timestamp.started}}exports.Watch=Watch,exports.default=Watch},"./node_modules/@walletconnect/time/node_modules/tslib/tslib.es6.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{__assign:()=>__assign,__asyncDelegator:()=>__asyncDelegator,__asyncGenerator:()=>__asyncGenerator,__asyncValues:()=>__asyncValues,__await:()=>__await,__awaiter:()=>__awaiter,__classPrivateFieldGet:()=>__classPrivateFieldGet,__classPrivateFieldSet:()=>__classPrivateFieldSet,__createBinding:()=>__createBinding,__decorate:()=>__decorate,__exportStar:()=>__exportStar,__extends:()=>__extends,__generator:()=>__generator,__importDefault:()=>__importDefault,__importStar:()=>__importStar,__makeTemplateObject:()=>__makeTemplateObject,__metadata:()=>__metadata,__param:()=>__param,__read:()=>__read,__rest:()=>__rest,__spread:()=>__spread,__spreadArrays:()=>__spreadArrays,__values:()=>__values});var extendStatics=function(d,b){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},extendStatics(d,b)};function __extends(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}var __assign=function(){return __assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t},__assign.apply(this,arguments)};function __rest(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t}function __decorate(decorators,target,key,desc){var d,c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r}function __param(paramIndex,decorator){return function(target,key){decorator(target,key,paramIndex)}}function __metadata(metadataKey,metadataValue){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(metadataKey,metadataValue)}function __awaiter(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}function __generator(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=_.trys,(t=t.length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}function __createBinding(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}function __exportStar(m,exports){for(var p in m)"default"===p||exports.hasOwnProperty(p)||(exports[p]=m[p])}function __values(o){var s="function"==typeof Symbol&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&"number"==typeof o.length)return{next:function(){return o&&i>=o.length&&(o=void 0),{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(o,n){var m="function"==typeof Symbol&&o[Symbol.iterator];if(!m)return o;var r,e,i=m.call(o),ar=[];try{for(;(void 0===n||n-- >0)&&!(r=i.next()).done;)ar.push(r.value)}catch(error){e={error}}finally{try{r&&!r.done&&(m=i.return)&&m.call(i)}finally{if(e)throw e.error}}return ar}function __spread(){for(var ar=[],i=0;i<arguments.length;i++)ar=ar.concat(__read(arguments[i]));return ar}function __spreadArrays(){for(var s=0,i=0,il=arguments.length;i<il;i++)s+=arguments[i].length;var r=Array(s),k=0;for(i=0;i<il;i++)for(var a=arguments[i],j=0,jl=a.length;j<jl;j++,k++)r[k]=a[j];return r}function __await(v){return this instanceof __await?(this.v=v,this):new __await(v)}function __asyncGenerator(thisArg,_arguments,generator){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,g=generator.apply(thisArg,_arguments||[]),q=[];return i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i;function verb(n){g[n]&&(i[n]=function(v){return new Promise(function(a,b){q.push([n,v,a,b])>1||resume(n,v)})})}function resume(n,v){try{!function step(r){r.value instanceof __await?Promise.resolve(r.value.v).then(fulfill,reject):settle(q[0][2],r)}(g[n](v))}catch(e){settle(q[0][3],e)}}function fulfill(value){resume("next",value)}function reject(value){resume("throw",value)}function settle(f,v){f(v),q.shift(),q.length&&resume(q[0][0],q[0][1])}}function __asyncDelegator(o){var i,p;return i={},verb("next"),verb("throw",function(e){throw e}),verb("return"),i[Symbol.iterator]=function(){return this},i;function verb(n,f){i[n]=o[n]?function(v){return(p=!p)?{value:__await(o[n](v)),done:"return"===n}:f?f(v):v}:f}}function __asyncValues(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,m=o[Symbol.asyncIterator];return m?m.call(o):(o=__values(o),i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i);function verb(n){i[n]=o[n]&&function(v){return new Promise(function(resolve,reject){(function settle(resolve,reject,d,v){Promise.resolve(v).then(function(v){resolve({value:v,done:d})},reject)})(resolve,reject,(v=o[n](v)).done,v.value)})}}}function __makeTemplateObject(cooked,raw){return Object.defineProperty?Object.defineProperty(cooked,"raw",{value:raw}):cooked.raw=raw,cooked}function __importStar(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result}function __importDefault(mod){return mod&&mod.__esModule?mod:{default:mod}}function __classPrivateFieldGet(receiver,privateMap){if(!privateMap.has(receiver))throw new TypeError("attempted to get private field on non-instance");return privateMap.get(receiver)}function __classPrivateFieldSet(receiver,privateMap,value){if(!privateMap.has(receiver))throw new TypeError("attempted to set private field on non-instance");return privateMap.set(receiver,value),value}},"./node_modules/@walletconnect/universal-provider/dist/index.es.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{l:()=>Bs,A:()=>dist_index_es_J});var events=__webpack_require__("./node_modules/events/events.js"),events_default=__webpack_require__.n(events),cjs=__webpack_require__("./node_modules/@walletconnect/time/dist/cjs/index.js");class IEvents{}class n extends IEvents{constructor(e){super()}}const s=cjs.FIVE_SECONDS,r_pulse="heartbeat_pulse";class index_es_i extends n{constructor(e){super(e),this.events=new events.EventEmitter,this.interval=s,this.interval=e?.interval||s}static async init(e){const t=new index_es_i(e);return await t.init(),t}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),(0,cjs.toMiliseconds)(this.interval))}pulse(){this.events.emit(r_pulse)}}var console=__webpack_require__("./node_modules/console-browserify/index.js");const suspectProtoRx=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,suspectConstructorRx=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,JsonSigRx=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function jsonParseTransform(key,value){if(!("__proto__"===key||"constructor"===key&&value&&"object"==typeof value&&"prototype"in value))return value;(function warnKeyDropped(key){console.warn(`[destr] Dropping "${key}" key to prevent prototype pollution.`)})(key)}function destr(value,options={}){if("string"!=typeof value)return value;if('"'===value[0]&&'"'===value[value.length-1]&&-1===value.indexOf("\\"))return value.slice(1,-1);const _value=value.trim();if(_value.length<=9)switch(_value.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!JsonSigRx.test(value)){if(options.strict)throw new SyntaxError("[destr] Invalid JSON");return value}try{if(suspectProtoRx.test(value)||suspectConstructorRx.test(value)){if(options.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(value,jsonParseTransform)}return JSON.parse(value)}catch(error){if(options.strict)throw error;return value}}var Buffer=__webpack_require__("./node_modules/buffer/index.js").Buffer;function asyncCall(function_,...arguments_){try{return function wrapToPromise(value){return value&&"function"==typeof value.then?value:Promise.resolve(value)}(function_(...arguments_))}catch(error){return Promise.reject(error)}}function stringify(value){if(function isPrimitive(value){const type=typeof value;return null===value||"object"!==type&&"function"!==type}(value))return String(value);if(function isPureObject(value){const proto=Object.getPrototypeOf(value);return!proto||proto.isPrototypeOf(Object)}(value)||Array.isArray(value))return JSON.stringify(value);if("function"==typeof value.toJSON)return stringify(value.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function serializeRaw(value){return"string"==typeof value?value:"base64:"+function base64Encode(input){if(globalThis.Buffer)return Buffer.from(input).toString("base64");return globalThis.btoa(String.fromCodePoint(...input))}(value)}function deserializeRaw(value){return"string"!=typeof value?value:value.startsWith("base64:")?function base64Decode(input){if(globalThis.Buffer)return Buffer.from(input,"base64");return Uint8Array.from(globalThis.atob(input),c=>c.codePointAt(0))}(value.slice(7)):value}function normalizeKey(key){return key&&key.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function joinKeys(...keys){return normalizeKey(keys.join(":"))}function unstorage_zVDD2mZo_normalizeBaseKey(base){return(base=normalizeKey(base))?base+":":""}var dist_console=__webpack_require__("./node_modules/console-browserify/index.js");const memory=()=>{const data=new Map;return{name:"memory",getInstance:()=>data,hasItem:key=>data.has(key),getItem:key=>data.get(key)??null,getItemRaw:key=>data.get(key)??null,setItem(key,value){data.set(key,value)},setItemRaw(key,value){data.set(key,value)},removeItem(key){data.delete(key)},getKeys:()=>[...data.keys()],clear(){data.clear()},dispose(){data.clear()}}};function createStorage(options={}){const context={mounts:{"":options.driver||memory()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},getMount=key=>{for(const base of context.mountpoints)if(key.startsWith(base))return{base,relativeKey:key.slice(base.length),driver:context.mounts[base]};return{base:"",relativeKey:key,driver:context.mounts[""]}},getMounts=(base,includeParent)=>context.mountpoints.filter(mountpoint=>mountpoint.startsWith(base)||includeParent&&base.startsWith(mountpoint)).map(mountpoint=>({relativeBase:base.length>mountpoint.length?base.slice(mountpoint.length):void 0,mountpoint,driver:context.mounts[mountpoint]})),onChange=(event,key)=>{if(context.watching){key=normalizeKey(key);for(const listener of context.watchListeners)listener(event,key)}},stopWatch=async()=>{if(context.watching){for(const mountpoint in context.unwatch)await context.unwatch[mountpoint]();context.unwatch={},context.watching=!1}},runBatch=(items,commonOptions,cb)=>{const batches=new Map,getBatch=mount=>{let batch=batches.get(mount.base);return batch||(batch={driver:mount.driver,base:mount.base,items:[]},batches.set(mount.base,batch)),batch};for(const item of items){const isStringItem="string"==typeof item,key=normalizeKey(isStringItem?item:item.key),value=isStringItem?void 0:item.value,options2=isStringItem||!item.options?commonOptions:{...commonOptions,...item.options},mount=getMount(key);getBatch(mount).items.push({key,value,relativeKey:mount.relativeKey,options:options2})}return Promise.all([...batches.values()].map(batch=>cb(batch))).then(r=>r.flat())},storage={hasItem(key,opts={}){key=normalizeKey(key);const{relativeKey,driver}=getMount(key);return asyncCall(driver.hasItem,relativeKey,opts)},getItem(key,opts={}){key=normalizeKey(key);const{relativeKey,driver}=getMount(key);return asyncCall(driver.getItem,relativeKey,opts).then(value=>destr(value))},getItems:(items,commonOptions={})=>runBatch(items,commonOptions,batch=>batch.driver.getItems?asyncCall(batch.driver.getItems,batch.items.map(item=>({key:item.relativeKey,options:item.options})),commonOptions).then(r=>r.map(item=>({key:joinKeys(batch.base,item.key),value:destr(item.value)}))):Promise.all(batch.items.map(item=>asyncCall(batch.driver.getItem,item.relativeKey,item.options).then(value=>({key:item.key,value:destr(value)}))))),getItemRaw(key,opts={}){key=normalizeKey(key);const{relativeKey,driver}=getMount(key);return driver.getItemRaw?asyncCall(driver.getItemRaw,relativeKey,opts):asyncCall(driver.getItem,relativeKey,opts).then(value=>deserializeRaw(value))},async setItem(key,value,opts={}){if(void 0===value)return storage.removeItem(key);key=normalizeKey(key);const{relativeKey,driver}=getMount(key);driver.setItem&&(await asyncCall(driver.setItem,relativeKey,stringify(value),opts),driver.watch||onChange("update",key))},async setItems(items,commonOptions){await runBatch(items,commonOptions,async batch=>{if(batch.driver.setItems)return asyncCall(batch.driver.setItems,batch.items.map(item=>({key:item.relativeKey,value:stringify(item.value),options:item.options})),commonOptions);batch.driver.setItem&&await Promise.all(batch.items.map(item=>asyncCall(batch.driver.setItem,item.relativeKey,stringify(item.value),item.options)))})},async setItemRaw(key,value,opts={}){if(void 0===value)return storage.removeItem(key,opts);key=normalizeKey(key);const{relativeKey,driver}=getMount(key);if(driver.setItemRaw)await asyncCall(driver.setItemRaw,relativeKey,value,opts);else{if(!driver.setItem)return;await asyncCall(driver.setItem,relativeKey,serializeRaw(value),opts)}driver.watch||onChange("update",key)},async removeItem(key,opts={}){"boolean"==typeof opts&&(opts={removeMeta:opts}),key=normalizeKey(key);const{relativeKey,driver}=getMount(key);driver.removeItem&&(await asyncCall(driver.removeItem,relativeKey,opts),(opts.removeMeta||opts.removeMata)&&await asyncCall(driver.removeItem,relativeKey+"$",opts),driver.watch||onChange("remove",key))},async getMeta(key,opts={}){"boolean"==typeof opts&&(opts={nativeOnly:opts}),key=normalizeKey(key);const{relativeKey,driver}=getMount(key),meta=Object.create(null);if(driver.getMeta&&Object.assign(meta,await asyncCall(driver.getMeta,relativeKey,opts)),!opts.nativeOnly){const value=await asyncCall(driver.getItem,relativeKey+"$",opts).then(value_=>destr(value_));value&&"object"==typeof value&&("string"==typeof value.atime&&(value.atime=new Date(value.atime)),"string"==typeof value.mtime&&(value.mtime=new Date(value.mtime)),Object.assign(meta,value))}return meta},setMeta(key,value,opts={}){return this.setItem(key+"$",value,opts)},removeMeta(key,opts={}){return this.removeItem(key+"$",opts)},async getKeys(base,opts={}){base=unstorage_zVDD2mZo_normalizeBaseKey(base);const mounts=getMounts(base,!0);let maskedMounts=[];const allKeys=[];let allMountsSupportMaxDepth=!0;for(const mount of mounts){mount.driver.flags?.maxDepth||(allMountsSupportMaxDepth=!1);const rawKeys=await asyncCall(mount.driver.getKeys,mount.relativeBase,opts);for(const key of rawKeys){const fullKey=mount.mountpoint+normalizeKey(key);maskedMounts.some(p=>fullKey.startsWith(p))||allKeys.push(fullKey)}maskedMounts=[mount.mountpoint,...maskedMounts.filter(p=>!p.startsWith(mount.mountpoint))]}const shouldFilterByDepth=void 0!==opts.maxDepth&&!allMountsSupportMaxDepth;return allKeys.filter(key=>(!shouldFilterByDepth||function filterKeyByDepth(key,depth){if(void 0===depth)return!0;let substrCount=0,index=key.indexOf(":");for(;index>-1;)substrCount++,index=key.indexOf(":",index+1);return substrCount<=depth}(key,opts.maxDepth))&&function filterKeyByBase(key,base){return base?key.startsWith(base)&&"$"!==key[key.length-1]:"$"!==key[key.length-1]}(key,base))},async clear(base,opts={}){base=unstorage_zVDD2mZo_normalizeBaseKey(base),await Promise.all(getMounts(base,!1).map(async m=>{if(m.driver.clear)return asyncCall(m.driver.clear,m.relativeBase,opts);if(m.driver.removeItem){const keys=await m.driver.getKeys(m.relativeBase||"",opts);return Promise.all(keys.map(key=>m.driver.removeItem(key,opts)))}}))},async dispose(){await Promise.all(Object.values(context.mounts).map(driver=>dispose(driver)))},watch:async callback=>(await(async()=>{if(!context.watching){context.watching=!0;for(const mountpoint in context.mounts)context.unwatch[mountpoint]=await watch(context.mounts[mountpoint],onChange,mountpoint)}})(),context.watchListeners.push(callback),async()=>{context.watchListeners=context.watchListeners.filter(listener=>listener!==callback),0===context.watchListeners.length&&await stopWatch()}),async unwatch(){context.watchListeners=[],await stopWatch()},mount(base,driver){if((base=unstorage_zVDD2mZo_normalizeBaseKey(base))&&context.mounts[base])throw new Error(`already mounted at ${base}`);return base&&(context.mountpoints.push(base),context.mountpoints.sort((a,b)=>b.length-a.length)),context.mounts[base]=driver,context.watching&&Promise.resolve(watch(driver,onChange,base)).then(unwatcher=>{context.unwatch[base]=unwatcher}).catch(dist_console.error),storage},async unmount(base,_dispose=!0){(base=unstorage_zVDD2mZo_normalizeBaseKey(base))&&context.mounts[base]&&(context.watching&&base in context.unwatch&&(context.unwatch[base]?.(),delete context.unwatch[base]),_dispose&&await dispose(context.mounts[base]),context.mountpoints=context.mountpoints.filter(key=>key!==base),delete context.mounts[base])},getMount(key=""){key=normalizeKey(key)+":";const m=getMount(key);return{driver:m.driver,base:m.base}},getMounts(base="",opts={}){base=normalizeKey(base);return getMounts(base,opts.parents).map(m=>({driver:m.driver,base:m.mountpoint}))},keys:(base,opts={})=>storage.getKeys(base,opts),get:(key,opts={})=>storage.getItem(key,opts),set:(key,value,opts={})=>storage.setItem(key,value,opts),has:(key,opts={})=>storage.hasItem(key,opts),del:(key,opts={})=>storage.removeItem(key,opts),remove:(key,opts={})=>storage.removeItem(key,opts)};return storage}function watch(driver,onChange,base){return driver.watch?driver.watch((event,key)=>onChange(event,base+key)):()=>{}}async function dispose(driver){"function"==typeof driver.dispose&&await asyncCall(driver.dispose)}function promisifyRequest(request){return new Promise((resolve,reject)=>{request.oncomplete=request.onsuccess=()=>resolve(request.result),request.onabort=request.onerror=()=>reject(request.error)})}function createStore(dbName,storeName){let dbp;return(txMode,callback)=>(()=>{if(dbp)return dbp;const request=indexedDB.open(dbName);return request.onupgradeneeded=()=>request.result.createObjectStore(storeName),dbp=promisifyRequest(request),dbp.then(db=>{db.onclose=()=>dbp=void 0},()=>{}),dbp})().then(db=>callback(db.transaction(storeName,txMode).objectStore(storeName)))}let defaultGetStoreFunc;function defaultGetStore(){return defaultGetStoreFunc||(defaultGetStoreFunc=createStore("keyval-store","keyval")),defaultGetStoreFunc}function get(key,customStore=defaultGetStore()){return customStore("readonly",store=>promisifyRequest(store.get(key)))}function eachCursor(store,callback){return store.openCursor().onsuccess=function(){this.result&&(callback(this.result),this.result.continue())},promisifyRequest(store.transaction)}var esm=__webpack_require__("./node_modules/@walletconnect/safe-json/dist/esm/index.js");var z=(i={})=>{const t=i.base&&i.base.length>0?`${i.base}:`:"",e=s=>t+s;let n;return i.dbName&&i.storeName&&(n=createStore(i.dbName,i.storeName)),{name:"idb-keyval",options:i,hasItem:async s=>!(typeof await get(e(s),n)>"u"),getItem:async s=>await get(e(s),n)??null,setItem:(s,a)=>function set(key,value,customStore=defaultGetStore()){return customStore("readwrite",store=>(store.put(value,key),promisifyRequest(store.transaction)))}(e(s),a,n),removeItem:s=>function del(key,customStore=defaultGetStore()){return customStore("readwrite",store=>(store.delete(key),promisifyRequest(store.transaction)))}(e(s),n),getKeys:()=>function keys(customStore=defaultGetStore()){return customStore("readonly",store=>{if(store.getAllKeys)return promisifyRequest(store.getAllKeys());const items=[];return eachCursor(store,cursor=>items.push(cursor.key)).then(()=>items)})}(n),clear:()=>function clear(customStore=defaultGetStore()){return customStore("readwrite",store=>(store.clear(),promisifyRequest(store.transaction)))}(n)}};class _{constructor(){this.indexedDb=createStorage({driver:z({dbName:"WALLET_CONNECT_V2_INDEXED_DB",storeName:"keyvaluestorage"})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const e=await this.indexedDb.getItem(t);if(null!==e)return e}async setItem(t,e){await this.indexedDb.setItem(t,(0,esm.h)(e))}async removeItem(t){await this.indexedDb.removeItem(t)}}var l=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof __webpack_require__.g<"u"?__webpack_require__.g:typeof self<"u"?self:{},c={exports:{}};function k(i){var t;return[i[0],(0,esm.j)(null!=(t=i[1])?t:"")]}!function(){let i;function t(){}i=t,i.prototype.getItem=function(e){return this.hasOwnProperty(e)?String(this[e]):null},i.prototype.setItem=function(e,n){this[e]=String(n)},i.prototype.removeItem=function(e){delete this[e]},i.prototype.clear=function(){const e=this;Object.keys(e).forEach(function(n){e[n]=void 0,delete e[n]})},i.prototype.key=function(e){return e=e||0,Object.keys(this)[e]},i.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof l<"u"&&l.localStorage?c.exports=l.localStorage:typeof window<"u"&&window.localStorage?c.exports=window.localStorage:c.exports=new t}();class K{constructor(){this.localStorage=c.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(k)}async getItem(t){const e=this.localStorage.getItem(t);if(null!==e)return(0,esm.j)(e)}async setItem(t,e){this.localStorage.setItem(t,(0,esm.h)(e))}async removeItem(t){this.localStorage.removeItem(t)}}const j=async(i,t)=>{t.length&&t.forEach(async e=>{await i.removeItem(e)})};class h{constructor(){this.initialized=!1,this.setInitialized=e=>{this.storage=e,this.initialized=!0};const t=new K;this.storage=t;try{(async(i,t,e)=>{const n="wc_storage_version",s=await t.getItem(n);if(s&&s>=1)return void e(t);const a=await i.getKeys();if(!a.length)return void e(t);const m=[];for(;a.length;){const r=a.shift();if(!r)continue;const o=r.toLowerCase();if(o.includes("wc@")||o.includes("walletconnect")||o.includes("wc_")||o.includes("wallet_connect")){const f=await i.getItem(r);await t.setItem(r,f),m.push(r)}}await t.setItem(n,1),e(t),j(i,m)})(t,new _,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,e){return await this.initialize(),this.storage.setItem(t,e)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const e=setInterval(()=>{this.initialized&&(clearInterval(e),t())},20)})}}var index_es=__webpack_require__("./node_modules/@walletconnect/logger/dist/index.es.js"),a=Object.defineProperty,index_es_c=(e,s,r)=>((e,s,r)=>s in e?a(e,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[s]=r)(e,"symbol"!=typeof s?s+"":s,r);class index_es_h extends IEvents{constructor(s){super(),this.opts=s,index_es_c(this,"protocol","wc"),index_es_c(this,"version",2)}}var p=Object.defineProperty,v=(e,s,r)=>((e,s,r)=>s in e?p(e,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[s]=r)(e,"symbol"!=typeof s?s+"":s,r);class I extends IEvents{constructor(s,r){super(),this.core=s,this.logger=r,v(this,"records",new Map)}}class index_es_y{constructor(s,r){this.logger=s,this.core=r}}class m extends IEvents{constructor(s,r){super(),this.relayer=s,this.logger=r}}class d extends IEvents{constructor(s){super()}}class f{constructor(s,r,t,q){this.core=s,this.logger=r,this.name=t}}Object.defineProperty;class P extends IEvents{constructor(s,r){super(),this.relayer=s,this.logger=r}}class S extends IEvents{constructor(s,r){super(),this.core=s,this.logger=r}}class M{constructor(s,r,t){this.core=s,this.logger=r,this.store=t}}class index_es_O{constructor(s,r){this.projectId=s,this.logger=r}}class R{constructor(s,r,t){this.core=s,this.logger=r,this.telemetryEnabled=t}}var T=Object.defineProperty,i=(e,s,r)=>((e,s,r)=>s in e?T(e,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[s]=r)(e,"symbol"!=typeof s?s+"":s,r);events_default();class J{constructor(s){this.opts=s,i(this,"protocol","wc"),i(this,"version",2)}}events.EventEmitter;class V{constructor(s){this.client=s}}var dist_index_es=__webpack_require__("./node_modules/@walletconnect/relay-auth/dist/index.es.js"),utils_dist_index_es=__webpack_require__("./node_modules/@walletconnect/utils/dist/index.es.js"),src=__webpack_require__("./node_modules/uint8arrays/esm/src/index.js");const PARSE_ERROR="PARSE_ERROR",INVALID_REQUEST="INVALID_REQUEST",METHOD_NOT_FOUND="METHOD_NOT_FOUND",INVALID_PARAMS="INVALID_PARAMS",INTERNAL_ERROR="INTERNAL_ERROR",SERVER_ERROR="SERVER_ERROR",RESERVED_ERROR_CODES=[-32700,-32600,-32601,-32602,-32603],constants_STANDARD_ERROR_MAP={[PARSE_ERROR]:{code:-32700,message:"Parse error"},[INVALID_REQUEST]:{code:-32600,message:"Invalid Request"},[METHOD_NOT_FOUND]:{code:-32601,message:"Method not found"},[INVALID_PARAMS]:{code:-32602,message:"Invalid params"},[INTERNAL_ERROR]:{code:-32603,message:"Internal error"},[SERVER_ERROR]:{code:-32e3,message:"Server error"}};function isReservedErrorCode(code){return RESERVED_ERROR_CODES.includes(code)}function getError(type){return Object.keys(constants_STANDARD_ERROR_MAP).includes(type)?constants_STANDARD_ERROR_MAP[type]:constants_STANDARD_ERROR_MAP.SERVER_ERROR}function getErrorByCode(code){const match=Object.values(constants_STANDARD_ERROR_MAP).find(e=>e.code===code);return match||constants_STANDARD_ERROR_MAP.SERVER_ERROR}function parseConnectionError(e,url,type){return e.message.includes("getaddrinfo ENOTFOUND")||e.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${type} RPC url at ${url}`):e}var dist_cjs=__webpack_require__("./node_modules/@walletconnect/environment/dist/cjs/index.js");function payloadId(entropy=3){return Date.now()*Math.pow(10,entropy)+Math.floor(Math.random()*Math.pow(10,entropy))}function getBigIntRpcId(entropy=6){return BigInt(payloadId(entropy))}function formatJsonRpcRequest(method,params,id){return{id:id||payloadId(),jsonrpc:"2.0",method,params}}function formatJsonRpcResult(id,result){return{id,jsonrpc:"2.0",result}}function formatJsonRpcError(id,error,data){return{id,jsonrpc:"2.0",error:formatErrorMessage(error,data)}}function formatErrorMessage(error,data){return void 0===error?getError("INTERNAL_ERROR"):("string"==typeof error&&(error=Object.assign(Object.assign({},getError("SERVER_ERROR")),{message:error})),void 0!==data&&(error.data=data),isReservedErrorCode(error.code)&&(error=getErrorByCode(error.code)),error)}class e{}class index_es_n extends e{constructor(){super()}}class index_es_r extends index_es_n{constructor(c){super()}}function matchRegexProtocol(url,regex){const protocol=function getUrlProtocol(url){const matches=url.match(new RegExp(/^\w+:/,"gi"));if(matches&&matches.length)return matches[0]}(url);return void 0!==protocol&&new RegExp(regex).test(protocol)}function isHttpUrl(url){return matchRegexProtocol(url,"^https?:")}function isWsUrl(url){return matchRegexProtocol(url,"^wss?:")}function isJsonRpcPayload(payload){return"object"==typeof payload&&"id"in payload&&"jsonrpc"in payload&&"2.0"===payload.jsonrpc}function isJsonRpcRequest(payload){return isJsonRpcPayload(payload)&&"method"in payload}function isJsonRpcResponse(payload){return isJsonRpcPayload(payload)&&(isJsonRpcResult(payload)||isJsonRpcError(payload))}function isJsonRpcResult(payload){return"result"in payload}function isJsonRpcError(payload){return"error"in payload}class index_es_o extends index_es_r{constructor(t){super(t),this.events=new events.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,e){this.events.on(t,e)}once(t,e){this.events.once(t,e)}off(t,e){this.events.off(t,e)}removeListener(t,e){this.events.removeListener(t,e)}async request(t,e){return this.requestStrict(formatJsonRpcRequest(t.method,t.params||[],t.id||getBigIntRpcId().toString()),e)}async requestStrict(t,e){return new Promise(async(i,s)=>{if(!this.connection.connected)try{await this.open()}catch(n){s(n)}this.events.on(`${t.id}`,n=>{isJsonRpcError(n)?s(n.error):i(n.result)});try{await this.connection.send(t,e)}catch(n){s(n)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),isJsonRpcResponse(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&3e3===t.code&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),"string"==typeof t&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const index_es_d=r=>r.split("?")[0],index_es_b=typeof WebSocket<"u"?WebSocket:typeof __webpack_require__.g<"u"&&typeof __webpack_require__.g.WebSocket<"u"?__webpack_require__.g.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:__webpack_require__("./node_modules/@walletconnect/jsonrpc-ws-connection/node_modules/ws/browser.js");class index_es_f{constructor(e){if(this.url=e,this.events=new events.EventEmitter,this.registering=!1,!isWsUrl(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,t)=>{typeof this.socket>"u"?t(new Error("Connection already closed")):(this.socket.onclose=n=>{this.onClose(n),e()},this.socket.close())})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send((0,esm.h)(e))}catch(t){this.onError(e.id,t)}}register(e=this.url){if(!isWsUrl(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((n,s)=>{this.events.once("register_error",o=>{this.resetMaxListeners(),s(o)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,n)=>{const s=(0,dist_cjs.isReactNative)()?void 0:{rejectUnauthorized:(url=e,!new RegExp("wss?://localhost(:d{2,5})?").test(url))},o=new index_es_b(e,[],s);var url;typeof WebSocket<"u"||typeof __webpack_require__.g<"u"&&typeof __webpack_require__.g.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u"?o.onerror=i=>{const a=i;n(this.emitError(a.error))}:o.on("error",i=>{n(this.emitError(i))}),o.onopen=()=>{this.onOpen(o),t(o)}})}onOpen(e){e.onmessage=t=>this.onPayload(t),e.onclose=t=>this.onClose(t),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const t="string"==typeof e.data?(0,esm.j)(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const n=this.parseError(t),o=formatJsonRpcError(e,n.message||n.toString());this.events.emit("payload",o)}parseError(e,t=this.url){return parseConnectionError(e,index_es_d(t),"WS")}resetMaxListeners(){this.events.getMaxListeners()>10&&this.events.setMaxListeners(10)}emitError(e){const t=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${index_es_d(this.url)}`));return this.events.emit("register_error",t),t}}var window_getters_dist_cjs=__webpack_require__("./node_modules/@walletconnect/window-getters/dist/cjs/index.js"),index_es_Buffer=__webpack_require__("./node_modules/buffer/index.js").Buffer,index_es_console=__webpack_require__("./node_modules/console-browserify/index.js"),process=__webpack_require__("./node_modules/process/browser.js");const pe="core",W=`wc@2:${pe}:`,It_logger="error",Tt={database:":memory:"},Me="client_ed25519_seed",Pt=cjs.ONE_DAY,xt=cjs.SIX_HOURS,Ke="wss://relay.walletconnect.org",dist_index_es_C_message="relayer_message",dist_index_es_C_message_ack="relayer_message_ack",dist_index_es_C_connect="relayer_connect",dist_index_es_C_disconnect="relayer_disconnect",dist_index_es_C_error="relayer_error",dist_index_es_C_connection_stalled="relayer_connection_stalled",dist_index_es_C_publish="relayer_publish",index_es_M_payload="payload",index_es_M_connect="connect",index_es_M_disconnect="disconnect",index_es_M_error="error",Pe="2.21.8",ee={link_mode:"link_mode",relay:"relay"},ye_inbound="inbound",ye_outbound="outbound",Be="WALLETCONNECT_LINK_MODE_APPS",U_created="subscription_created",U_deleted="subscription_deleted",U_sync="subscription_sync",U_resubscribed="subscription_resubscribed",oe=(cjs.FIVE_SECONDS,{wc_pairingDelete:{req:{ttl:cjs.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:cjs.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:cjs.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:cjs.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:cjs.ONE_DAY,prompt:!1,tag:0},res:{ttl:cjs.ONE_DAY,prompt:!1,tag:0}}}),ae_create="pairing_create",ae_expire="pairing_expire",ae_delete="pairing_delete",ae_ping="pairing_ping",index_es_V_created="history_created",index_es_V_updated="history_updated",index_es_V_deleted="history_deleted",index_es_V_sync="history_sync",q_created="expirer_created",q_deleted="expirer_deleted",q_expired="expirer_expired",q_sync="expirer_sync",Jt="https://verify.walletconnect.org",be=Jt,Xt=`${be}/v3`,Zt=["https://verify.walletconnect.com",Jt],Y_pairing_started="pairing_started",Y_pairing_uri_validation_success="pairing_uri_validation_success",Y_pairing_uri_not_expired="pairing_uri_not_expired",Y_store_new_pairing="store_new_pairing",Y_subscribing_pairing_topic="subscribing_pairing_topic",Y_subscribe_pairing_topic_success="subscribe_pairing_topic_success",Y_existing_pairing="existing_pairing",Y_pairing_not_expired="pairing_not_expired",Y_emit_inactive_pairing="emit_inactive_pairing",Y_emit_session_proposal="emit_session_proposal",X_no_internet_connection="no_internet_connection",X_malformed_pairing_uri="malformed_pairing_uri",X_active_pairing_already_exists="active_pairing_already_exists",X_subscribe_pairing_topic_failure="subscribe_pairing_topic_failure",X_pairing_expired="pairing_expired",X_proposal_listener_not_found="proposal_listener_not_found",rr_session_approve_started="session_approve_started",rr_session_namespaces_validation_success="session_namespaces_validation_success",rr_subscribing_session_topic="subscribing_session_topic",rr_subscribe_session_topic_success="subscribe_session_topic_success",rr_session_approve_publish_success="session_approve_publish_success",rr_store_session="store_session",nr_no_internet_connection="no_internet_connection",nr_proposal_expired="proposal_expired",nr_subscribe_session_topic_failure="subscribe_session_topic_failure",nr_session_approve_namespace_validation_failure="session_approve_namespace_validation_failure",nr_proposal_not_found="proposal_not_found",or_authenticated_session_approve_started="authenticated_session_approve_started",or_create_authenticated_session_topic="create_authenticated_session_topic",or_cacaos_verified="cacaos_verified",or_store_authenticated_session="store_authenticated_session",or_subscribing_authenticated_session_topic="subscribing_authenticated_session_topic",or_subscribe_authenticated_session_topic_success="subscribe_authenticated_session_topic_success",or_publishing_authenticated_session_approve="publishing_authenticated_session_approve",ar_no_internet_connection="no_internet_connection",ar_invalid_cacao="invalid_cacao",ar_subscribe_authenticated_session_topic_failure="subscribe_authenticated_session_topic_failure",ar_authenticated_session_approve_publish_failure="authenticated_session_approve_publish_failure",ar_authenticated_session_pending_request_not_found="authenticated_session_pending_request_not_found";var hr=function cr(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var n=r.charAt(s),o=n.charCodeAt(0);if(255!==t[o])throw new TypeError(n+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),h=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function y(u){if("string"!=typeof u)throw new TypeError("Expected String");if(0===u.length)return new Uint8Array;var m=0;if(" "!==u[m]){for(var D=0,_=0;u[m]===c;)D++,m++;for(var E=(u.length-m)*h+1>>>0,L=new Uint8Array(E);u[m];){var I=t[u.charCodeAt(m)];if(255===I)return;for(var k=0,T=E-1;(0!==I||k<_)&&-1!==T;T--,k++)I+=a*L[T]>>>0,L[T]=I%256>>>0,I=I/256>>>0;if(0!==I)throw new Error("Non-zero carry");_=k,m++}if(" "!==u[m]){for(var S=E-_;S!==E&&0===L[S];)S++;for(var O=new Uint8Array(D+(E-S)),te=D;S!==E;)O[te++]=L[S++];return O}}}return{encode:function p(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===u.length)return"";for(var m=0,D=0,_=0,E=u.length;_!==E&&0===u[_];)_++,m++;for(var L=(E-_)*l+1>>>0,I=new Uint8Array(L);_!==E;){for(var k=u[_],T=0,S=L-1;(0!==k||T<D)&&-1!==S;S--,T++)k+=256*I[S]>>>0,I[S]=k%a>>>0,k=k/a>>>0;if(0!==k)throw new Error("Non-zero carry");D=T,_++}for(var O=L-D;O!==L&&0===I[O];)O++;for(var te=c.repeat(m);O<L;++O)te+=r.charAt(I[O]);return te},decodeUnsafe:y,decode:function w(u){var m=y(u);if(m)return m;throw new Error(`Non-${e} character`)}}},lr=hr;const ni=r=>{if(r instanceof Uint8Array&&"Uint8Array"===r.constructor.name)return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};class gr{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class pr{constructor(e,t,i){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return oi(this,e)}}class yr{constructor(e){this.decoders=e}or(e){return oi(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const oi=(r,e)=>new yr({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class br{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new gr(e,t,i),this.decoder=new pr(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Se=({name:r,prefix:e,encode:t,decode:i})=>new br(r,e,t,i),me=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=lr(t,e);return Se({prefix:r,name:e,encode:i,decode:n=>ni(s(n))})},A=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>Se({prefix:e,name:r,encode:s=>((r,e,t)=>{const i="="===e[e.length-1],s=(1<<t)-1;let n="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,n+=e[s&a>>o];if(o&&(n+=e[s&a<<t-o]),i)for(;n.length*t&7;)n+="=";return n})(s,i,t),decode:s=>((r,e,t,i)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let n=r.length;for(;"="===r[n-1];)--n;const o=new Uint8Array(n*t/8|0);let a=0,c=0,h=0;for(let l=0;l<n;++l){const p=s[r[l]];if(void 0===p)throw new SyntaxError(`Non-${i} character`);c=c<<t|p,a+=t,a>=8&&(a-=8,o[h++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(s,i,t,r)}),Dr=Se({prefix:"\0",name:"identity",encode:r=>(r=>(new TextDecoder).decode(r))(r),decode:r=>(r=>(new TextEncoder).encode(r))(r)});var vr=Object.freeze({__proto__:null,identity:Dr});const wr=A({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var _r=Object.freeze({__proto__:null,base2:wr});const Er=A({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Ir=Object.freeze({__proto__:null,base8:Er});const Tr=me({prefix:"9",name:"base10",alphabet:"0123456789"});var Cr=Object.freeze({__proto__:null,base10:Tr});const Pr=A({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Sr=A({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Or=Object.freeze({__proto__:null,base16:Pr,base16upper:Sr});const Rr=A({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Ar=A({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),xr=A({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Nr=A({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),$r=A({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),zr=A({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Lr=A({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),kr=A({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),jr=A({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Ur=Object.freeze({__proto__:null,base32:Rr,base32upper:Ar,base32pad:xr,base32padupper:Nr,base32hex:$r,base32hexupper:zr,base32hexpad:Lr,base32hexpadupper:kr,base32z:jr});const Fr=me({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Mr=me({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Kr=Object.freeze({__proto__:null,base36:Fr,base36upper:Mr});const Br=me({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Vr=me({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var qr=Object.freeze({__proto__:null,base58btc:Br,base58flickr:Vr});const Gr=A({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Wr=A({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Hr=A({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Yr=A({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Jr=Object.freeze({__proto__:null,base64:Gr,base64pad:Wr,base64url:Hr,base64urlpad:Yr});const ai=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Xr=ai.reduce((r,e,t)=>(r[t]=e,r),[]),Zr=ai.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);const tn=Se({prefix:"🚀",name:"base256emoji",encode:function Qr(r){return r.reduce((e,t)=>e+=Xr[t],"")},decode:function en(r){const e=[];for(const t of r){const i=Zr[t.codePointAt(0)];if(void 0===i)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}});var sn=Object.freeze({__proto__:null,base256emoji:tn}),rn=function hi(r,e,t){e=e||[];for(var i=t=t||0;r>=an;)e[t++]=255&r|ci,r/=128;for(;r&on;)e[t++]=255&r|ci,r>>>=7;return e[t]=0|r,hi.bytes=t-i+1,e},ci=128,on=-128,an=Math.pow(2,31);var cn=function Ve(r,i){var o,t=0,s=(i=i||0,0),n=i,a=r.length;do{if(n>=a)throw Ve.bytes=0,new RangeError("Could not decode varint");o=r[n++],t+=s<28?(o&li)<<s:(o&li)*Math.pow(2,s),s+=7}while(o>=hn);return Ve.bytes=n-i,t},hn=128,li=127;var ln=Math.pow(2,7),un=Math.pow(2,14),dn=Math.pow(2,21),gn=Math.pow(2,28),pn=Math.pow(2,35),yn=Math.pow(2,42),bn=Math.pow(2,49),mn=Math.pow(2,56),fn=Math.pow(2,63),vn={encode:rn,decode:cn,encodingLength:function(r){return r<ln?1:r<un?2:r<dn?3:r<gn?4:r<pn?5:r<yn?6:r<bn?7:r<mn?8:r<fn?9:10}},ui=vn;const di=(r,e,t=0)=>(ui.encode(r,e,t),e),gi=r=>ui.encodingLength(r),qe=(r,e)=>{const t=e.byteLength,i=gi(r),s=i+gi(t),n=new Uint8Array(s+t);return di(r,n,0),di(t,n,i),n.set(e,s),new wn(r,t,e,n)};class wn{constructor(e,t,i,s){this.code=e,this.size=t,this.digest=i,this.bytes=s}}const pi=({name:r,code:e,encode:t})=>new _n(r,e,t);class _n{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?qe(this.code,t):t.then(i=>qe(this.code,i))}throw Error("Unknown type, must be binary type")}}const yi=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),En=pi({name:"sha2-256",code:18,encode:yi("SHA-256")}),In=pi({name:"sha2-512",code:19,encode:yi("SHA-512")});Object.freeze({__proto__:null,sha256:En,sha512:In});const mi=ni,Sn={code:0,name:"identity",encode:mi,digest:r=>qe(0,mi(r))};Object.freeze({__proto__:null,identity:Sn});new TextEncoder,new TextDecoder;const fi={...vr,..._r,...Ir,...Cr,...Or,...Ur,...Kr,...qr,...Jr,...sn};function Di(r){return null!=globalThis.Buffer?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function vi(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const wi=vi("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>(new TextEncoder).encode(r.substring(1))),Ge=vi("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{const e=function Rn(r=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?Di(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}((r=r.substring(1)).length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),An={utf8:wi,"utf-8":wi,hex:fi.base16,latin1:Ge,ascii:Ge,binary:Ge,...fi};var Nn=Object.defineProperty,index_es_J=(r,e,t)=>((r,e,t)=>e in r?Nn(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class _i{constructor(e,t){this.core=e,this.logger=t,index_es_J(this,"keychain",new Map),index_es_J(this,"name","keychain"),index_es_J(this,"version","0.3"),index_es_J(this,"initialized",!1),index_es_J(this,"storagePrefix",W),index_es_J(this,"init",async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}}),index_es_J(this,"has",i=>(this.isInitialized(),this.keychain.has(i))),index_es_J(this,"set",async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()}),index_es_J(this,"get",i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>"u"){const{message:n}=(0,utils_dist_index_es.GuA)("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return s}),index_es_J(this,"del",async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()}),this.core=e,this.logger=(0,index_es.U5)(t,this.name)}get context(){return(0,index_es.oI)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,(0,utils_dist_index_es.h0Y)(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?(0,utils_dist_index_es.PUk)(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=(0,utils_dist_index_es.GuA)("NOT_INITIALIZED",this.name);throw new Error(e)}}}var zn=Object.defineProperty,dist_index_es_x=(r,e,t)=>((r,e,t)=>e in r?zn(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class Ei{constructor(e,t,i){this.core=e,this.logger=t,dist_index_es_x(this,"name","crypto"),dist_index_es_x(this,"keychain"),dist_index_es_x(this,"randomSessionIdentifier",(0,utils_dist_index_es.two)()),dist_index_es_x(this,"initialized",!1),dist_index_es_x(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),dist_index_es_x(this,"hasKeys",s=>(this.isInitialized(),this.keychain.has(s))),dist_index_es_x(this,"getClientId",async()=>{this.isInitialized();const s=await this.getClientSeed(),n=dist_index_es.TZ(s);return dist_index_es.UF(n.publicKey)}),dist_index_es_x(this,"generateKeyPair",()=>{this.isInitialized();const s=(0,utils_dist_index_es.TZl)();return this.setPrivateKey(s.publicKey,s.privateKey)}),dist_index_es_x(this,"signJWT",async s=>{this.isInitialized();const n=await this.getClientSeed(),o=dist_index_es.TZ(n),a=this.randomSessionIdentifier,c=Pt;return await dist_index_es.FA(a,s,c,o)}),dist_index_es_x(this,"generateSharedKey",(s,n,o)=>{this.isInitialized();const a=this.getPrivateKey(s),c=(0,utils_dist_index_es.ovp)(a,n);return this.setSymKey(c,o)}),dist_index_es_x(this,"setSymKey",async(s,n)=>{this.isInitialized();const o=n||(0,utils_dist_index_es.EN$)(s);return await this.keychain.set(o,s),o}),dist_index_es_x(this,"deleteKeyPair",async s=>{this.isInitialized(),await this.keychain.del(s)}),dist_index_es_x(this,"deleteSymKey",async s=>{this.isInitialized(),await this.keychain.del(s)}),dist_index_es_x(this,"encode",async(s,n,o)=>{this.isInitialized();const a=(0,utils_dist_index_es.AwN)(o),c=(0,esm.h)(n);if((0,utils_dist_index_es.ps1)(a))return(0,utils_dist_index_es.Tw2)(c,o?.encoding);if((0,utils_dist_index_es.V7m)(a)){const y=a.senderPublicKey,w=a.receiverPublicKey;s=await this.generateSharedKey(y,w)}const h=this.getSymKey(s),{type:l,senderPublicKey:p}=a;return(0,utils_dist_index_es.wa2)({type:l,symKey:h,message:c,senderPublicKey:p,encoding:o?.encoding})}),dist_index_es_x(this,"decode",async(s,n,o)=>{this.isInitialized();const a=(0,utils_dist_index_es.C5G)(n,o);if((0,utils_dist_index_es.ps1)(a)){const c=(0,utils_dist_index_es.F$L)(n,o?.encoding);return(0,esm.j)(c)}if((0,utils_dist_index_es.V7m)(a)){const c=a.receiverPublicKey,h=a.senderPublicKey;s=await this.generateSharedKey(c,h)}try{const c=this.getSymKey(s),h=(0,utils_dist_index_es.YcA)({symKey:c,encoded:n,encoding:o?.encoding});return(0,esm.j)(h)}catch(c){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),dist_index_es_x(this,"getPayloadType",(s,n=utils_dist_index_es.EWt)=>{const o=(0,utils_dist_index_es.iui)({encoded:s,encoding:n});return(0,utils_dist_index_es.x0t)(o.type)}),dist_index_es_x(this,"getPayloadSenderPublicKey",(s,n=utils_dist_index_es.EWt)=>{const o=(0,utils_dist_index_es.iui)({encoded:s,encoding:n});return o.senderPublicKey?(0,src.dI)(o.senderPublicKey,utils_dist_index_es.bEt):void 0}),this.core=e,this.logger=(0,index_es.U5)(t,this.name),this.keychain=i||new _i(this.core,this.logger)}get context(){return(0,index_es.oI)(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Me)}catch{e=(0,utils_dist_index_es.two)(),await this.keychain.set(Me,e)}return function xn(r,e="utf8"){const t=An[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return"utf8"!==e&&"utf-8"!==e||null==globalThis.Buffer||null==globalThis.Buffer.from?t.decoder.decode(`${t.prefix}${r}`):Di(globalThis.Buffer.from(r,"utf-8"))}(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=(0,utils_dist_index_es.GuA)("NOT_INITIALIZED",this.name);throw new Error(e)}}}var kn=Object.defineProperty,jn=Object.defineProperties,Un=Object.getOwnPropertyDescriptors,Ii=Object.getOwnPropertySymbols,Fn=Object.prototype.hasOwnProperty,Mn=Object.prototype.propertyIsEnumerable,We=(r,e,t)=>e in r?kn(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,dist_index_es_K=(r,e,t)=>We(r,"symbol"!=typeof e?e+"":e,t);class Ti extends index_es_y{constructor(e,t){super(e,t),this.logger=e,this.core=t,dist_index_es_K(this,"messages",new Map),dist_index_es_K(this,"messagesWithoutClientAck",new Map),dist_index_es_K(this,"name","messages"),dist_index_es_K(this,"version","0.3"),dist_index_es_K(this,"initialized",!1),dist_index_es_K(this,"storagePrefix",W),dist_index_es_K(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i);const s=await this.getRelayerMessagesWithoutClientAck();typeof s<"u"&&(this.messagesWithoutClientAck=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}}),dist_index_es_K(this,"set",async(i,s,n)=>{this.isInitialized();const o=(0,utils_dist_index_es.ALl)(s);let a=this.messages.get(i);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=s,this.messages.set(i,a),n===ye_inbound){const c=this.messagesWithoutClientAck.get(i)||{};this.messagesWithoutClientAck.set(i,((r,e)=>jn(r,Un(e)))(((r,e)=>{for(var t in e||(e={}))Fn.call(e,t)&&We(r,t,e[t]);if(Ii)for(var t of Ii(e))Mn.call(e,t)&&We(r,t,e[t]);return r})({},c),{[o]:s}))}return await this.persist(),o}),dist_index_es_K(this,"get",i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>"u"&&(s={}),s}),dist_index_es_K(this,"getWithoutAck",i=>{this.isInitialized();const s={};for(const n of i){const o=this.messagesWithoutClientAck.get(n)||{};s[n]=Object.values(o)}return s}),dist_index_es_K(this,"has",(i,s)=>{this.isInitialized();return typeof this.get(i)[(0,utils_dist_index_es.ALl)(s)]<"u"}),dist_index_es_K(this,"ack",async(i,s)=>{this.isInitialized();const n=this.messagesWithoutClientAck.get(i);if(typeof n>"u")return;delete n[(0,utils_dist_index_es.ALl)(s)],0===Object.keys(n).length?this.messagesWithoutClientAck.delete(i):this.messagesWithoutClientAck.set(i,n),await this.persist()}),dist_index_es_K(this,"del",async i=>{this.isInitialized(),this.messages.delete(i),this.messagesWithoutClientAck.delete(i),await this.persist()}),this.logger=(0,index_es.U5)(e,this.name),this.core=t}get context(){return(0,index_es.oI)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,(0,utils_dist_index_es.h0Y)(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,(0,utils_dist_index_es.h0Y)(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?(0,utils_dist_index_es.PUk)(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?(0,utils_dist_index_es.PUk)(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=(0,utils_dist_index_es.GuA)("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Vn=Object.defineProperty,qn=Object.defineProperties,Gn=Object.getOwnPropertyDescriptors,Ci=Object.getOwnPropertySymbols,Wn=Object.prototype.hasOwnProperty,Hn=Object.prototype.propertyIsEnumerable,He=(r,e,t)=>e in r?Vn(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ce=(r,e)=>{for(var t in e||(e={}))Wn.call(e,t)&&He(r,t,e[t]);if(Ci)for(var t of Ci(e))Hn.call(e,t)&&He(r,t,e[t]);return r},Pi=(r,e)=>qn(r,Gn(e)),G=(r,e,t)=>He(r,"symbol"!=typeof e?e+"":e,t);class Yn extends m{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,G(this,"events",new events.EventEmitter),G(this,"name","publisher"),G(this,"queue",new Map),G(this,"publishTimeout",(0,cjs.toMiliseconds)(cjs.ONE_MINUTE)),G(this,"initialPublishTimeout",(0,cjs.toMiliseconds)(15*cjs.ONE_SECOND)),G(this,"needsTransportRestart",!1),G(this,"publish",async(i,s,n)=>{var o,a,c,h,l;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:n}});const p=n?.ttl||xt,y=n?.prompt||!1,w=n?.tag||0,u=n?.id||getBigIntRpcId().toString(),m=(0,utils_dist_index_es.aa1)((0,utils_dist_index_es.n6V)().protocol),D={id:u,method:n?.publishMethod||m.publish,params:ce({topic:i,message:s,ttl:p,prompt:y,tag:w,attestation:n?.attestation},n?.tvf&&{tvf:n.tvf})},_=`Failed to publish payload, please try again. id:${u} tag:${w}`;try{(0,utils_dist_index_es.b07)(null==(o=D.params)?void 0:o.prompt)&&(null==(a=D.params)||delete a.prompt),(0,utils_dist_index_es.b07)(null==(c=D.params)?void 0:c.tag)&&(null==(h=D.params)||delete h.tag);const E=new Promise(async L=>{const I=({id:T})=>{var S;(null==(S=D.id)?void 0:S.toString())===T.toString()&&(this.removeRequestFromQueue(T),this.relayer.events.removeListener(dist_index_es_C_publish,I),L())};this.relayer.events.on(dist_index_es_C_publish,I);const k=(0,utils_dist_index_es.K3g)(new Promise((T,S)=>{this.rpcPublish(D,n).then(T).catch(O=>{this.logger.warn(O,O?.message),S(O)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${u} tag:${w}`);try{await k,this.events.removeListener(dist_index_es_C_publish,I)}catch(T){this.queue.set(u,{request:D,opts:n,attempt:1}),this.logger.warn(T,T?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:u,topic:i,message:s,opts:n}}),await(0,utils_dist_index_es.K3g)(E,this.publishTimeout,_)}catch(E){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(E),null!=(l=n?.internal)&&l.throwOnFailedPublish)throw E}finally{this.queue.delete(u)}}),G(this,"publishCustom",async i=>{var s,n,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:i});const{payload:h,opts:l={}}=i,{attestation:p,tvf:y,publishMethod:w,prompt:u,tag:m,ttl:D=cjs.FIVE_MINUTES}=l,_=l.id||getBigIntRpcId().toString(),E=(0,utils_dist_index_es.aa1)((0,utils_dist_index_es.n6V)().protocol),L=w||E.publish,I={id:_,method:L,params:ce(Pi(ce({},h),{ttl:D,prompt:u,tag:m,attestation:p}),y)},k=`Failed to publish custom payload, please try again. id:${_} tag:${m}`;try{(0,utils_dist_index_es.b07)(null==(s=I.params)?void 0:s.prompt)&&(null==(n=I.params)||delete n.prompt),(0,utils_dist_index_es.b07)(null==(o=I.params)?void 0:o.tag)&&(null==(a=I.params)||delete a.tag);const T=new Promise(async S=>{const O=({id:Z})=>{var _e;(null==(_e=I.id)?void 0:_e.toString())===Z.toString()&&(this.removeRequestFromQueue(Z),this.relayer.events.removeListener(dist_index_es_C_publish,O),S())};this.relayer.events.on(dist_index_es_C_publish,O);const te=(0,utils_dist_index_es.K3g)(new Promise((Z,_e)=>{this.rpcPublish(I,l).then(Z).catch(Ee=>{this.logger.warn(Ee,Ee?.message),_e(Ee)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${L} id:${_} tag:${m}`);try{await te,this.events.removeListener(dist_index_es_C_publish,O)}catch(Z){this.queue.set(_,{request:I,opts:l,attempt:1}),this.logger.warn(Z,Z?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:_,payload:h,opts:l}}),await(0,utils_dist_index_es.K3g)(T,this.publishTimeout,k)}catch(T){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(T),null!=(c=l?.internal)&&c.throwOnFailedPublish)throw T}finally{this.queue.delete(_)}}),G(this,"on",(i,s)=>{this.events.on(i,s)}),G(this,"once",(i,s)=>{this.events.once(i,s)}),G(this,"off",(i,s)=>{this.events.off(i,s)}),G(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.relayer=e,this.logger=(0,index_es.U5)(t,this.name),this.registerEventListeners()}get context(){return(0,index_es.oI)(this.logger)}async rpcPublish(e,t){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});const i=await this.relayer.request(e);return this.relayer.events.emit(dist_index_es_C_publish,ce(ce({},e),t)),this.logger.debug("Successfully Published Payload"),i}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,t)=>{var i;const s=e.attempt+1;this.queue.set(t,Pi(ce({},e),{attempt:s})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${null==(i=e.request.params)?void 0:i.tag}, attempt: ${s}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(r_pulse,()=>{if(this.needsTransportRestart)return this.needsTransportRestart=!1,void this.relayer.events.emit(dist_index_es_C_connection_stalled);this.checkQueue()}),this.relayer.on(dist_index_es_C_message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var Jn=Object.defineProperty,he=(r,e,t)=>((r,e,t)=>e in r?Jn(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class Zn{constructor(){he(this,"map",new Map),he(this,"set",(e,t)=>{const i=this.get(e);this.exists(e,t)||this.map.set(e,[...i,t])}),he(this,"get",e=>this.map.get(e)||[]),he(this,"exists",(e,t)=>this.get(e).includes(t)),he(this,"delete",(e,t)=>{if(typeof t>"u")return void this.map.delete(e);if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,t))return;const s=i.filter(n=>n!==t);s.length?this.map.set(e,s):this.map.delete(e)}),he(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var Qn=Object.defineProperty,eo=Object.defineProperties,to=Object.getOwnPropertyDescriptors,Si=Object.getOwnPropertySymbols,io=Object.prototype.hasOwnProperty,so=Object.prototype.propertyIsEnumerable,Ye=(r,e,t)=>e in r?Qn(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,fe=(r,e)=>{for(var t in e||(e={}))io.call(e,t)&&Ye(r,t,e[t]);if(Si)for(var t of Si(e))so.call(e,t)&&Ye(r,t,e[t]);return r},Je=(r,e)=>eo(r,to(e)),dist_index_es_f=(r,e,t)=>Ye(r,"symbol"!=typeof e?e+"":e,t);class Oi extends P{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,dist_index_es_f(this,"subscriptions",new Map),dist_index_es_f(this,"topicMap",new Zn),dist_index_es_f(this,"events",new events.EventEmitter),dist_index_es_f(this,"name","subscription"),dist_index_es_f(this,"version","0.3"),dist_index_es_f(this,"pending",new Map),dist_index_es_f(this,"cached",[]),dist_index_es_f(this,"initialized",!1),dist_index_es_f(this,"storagePrefix",W),dist_index_es_f(this,"subscribeTimeout",(0,cjs.toMiliseconds)(cjs.ONE_MINUTE)),dist_index_es_f(this,"initialSubscribeTimeout",(0,cjs.toMiliseconds)(15*cjs.ONE_SECOND)),dist_index_es_f(this,"clientId"),dist_index_es_f(this,"batchSubscribeTopicsLimit",500),dist_index_es_f(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),dist_index_es_f(this,"subscribe",async(i,s)=>{var n;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}});try{const o=(0,utils_dist_index_es.n6V)(s),a={topic:i,relay:o,transportType:s?.transportType};null!=(n=s?.internal)&&n.skipSubscribe||this.pending.set(i,a);const c=await this.rpcSubscribe(i,o,s);return"string"==typeof c&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),dist_index_es_f(this,"unsubscribe",async(i,s)=>{this.isInitialized(),typeof s?.id<"u"?await this.unsubscribeById(i,s.id,s):await this.unsubscribeByTopic(i,s)}),dist_index_es_f(this,"isSubscribed",i=>new Promise(s=>{s(this.topicMap.topics.includes(i))})),dist_index_es_f(this,"isKnownTopic",i=>new Promise(s=>{s(this.topicMap.topics.includes(i)||this.pending.has(i)||this.cached.some(n=>n.topic===i))})),dist_index_es_f(this,"on",(i,s)=>{this.events.on(i,s)}),dist_index_es_f(this,"once",(i,s)=>{this.events.once(i,s)}),dist_index_es_f(this,"off",(i,s)=>{this.events.off(i,s)}),dist_index_es_f(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),dist_index_es_f(this,"start",async()=>{await this.onConnect()}),dist_index_es_f(this,"stop",async()=>{await this.onDisconnect()}),dist_index_es_f(this,"restart",async()=>{await this.restore(),await this.onRestart()}),dist_index_es_f(this,"checkPending",async()=>{if(!(0!==this.pending.size||this.initialized&&this.relayer.connected))return;const i=[];this.pending.forEach(s=>{i.push(s)}),await this.batchSubscribe(i)}),dist_index_es_f(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(r_pulse,async()=>{await this.checkPending()}),this.events.on(U_created,async i=>{const s=U_created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()}),this.events.on(U_deleted,async i=>{const s=U_deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()})}),this.relayer=e,this.logger=(0,index_es.U5)(t,this.name),this.clientId=""}get context(){return(0,index_es.oI)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,t){let i=!1;try{i=this.getSubscription(e).topic===t}catch{}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){const i=this.topicMap.get(e);await Promise.all(i.map(async s=>await this.unsubscribeById(e,s,t)))}async unsubscribeById(e,t,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}});try{const s=(0,utils_dist_index_es.n6V)(i);await this.restartToComplete({topic:e,id:t,relay:s}),await this.rpcUnsubscribe(e,t,s);const n=(0,utils_dist_index_es.Hjj)("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,t,i){var s,n;const o=await this.getSubscriptionId(e);if(null!=(s=i?.internal)&&s.skipSubscribe)return o;(!i||i?.transportType===ee.relay)&&await this.restartToComplete({topic:e,id:e,relay:t});const a={method:(0,utils_dist_index_es.aa1)(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});const c=null==(n=i?.internal)?void 0:n.throwOnFailedPublish;try{if(i?.transportType===ee.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(p=>this.logger.warn(p))},(0,cjs.toMiliseconds)(cjs.ONE_SECOND)),o;const h=new Promise(async p=>{const y=w=>{w.topic===e&&(this.events.removeListener(U_created,y),p(w.id))};this.events.on(U_created,y);try{const w=await(0,utils_dist_index_es.K3g)(new Promise((u,m)=>{this.relayer.request(a).catch(D=>{this.logger.warn(D,D?.message),m(D)}).then(u)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(U_created,y),p(w)}catch{}}),l=await(0,utils_dist_index_es.K3g)(h,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!l&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return l?o:null}catch(h){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(dist_index_es_C_connection_stalled),c)throw h}return null}async rpcBatchSubscribe(e){if(!e.length)return;const t=e[0].relay,i={method:(0,utils_dist_index_es.aa1)(t.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await(0,utils_dist_index_es.K3g)(new Promise(s=>{this.relayer.request(i).catch(n=>this.logger.warn(n)).then(s)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(dist_index_es_C_connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const t=e[0].relay,i={method:(0,utils_dist_index_es.aa1)(t.protocol).batchFetchMessages,params:{topics:e.map(n=>n.topic)}};let s;this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{s=await await(0,utils_dist_index_es.K3g)(new Promise((n,o)=>{this.relayer.request(i).catch(a=>{this.logger.warn(a),o(a)}).then(n)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(dist_index_es_C_connection_stalled)}return s}rpcUnsubscribe(e,t,i){const s={method:(0,utils_dist_index_es.aa1)(i.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,t){this.setSubscription(e,Je(fe({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(t=>{this.setSubscription(t.id,fe({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(e,t,i){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,fe({},t)),this.topicMap.set(t.topic,e),this.events.emit(U_created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:i}=(0,utils_dist_index_es.GuA)("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(U_deleted,Je(fe({},i),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(U_sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<t;i++){const s=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(U_resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(t=>{var i;return t.topic===(null==(i=this.subscriptions.get(t.id))?void 0:i.topic)})){const{message:t}=(0,utils_dist_index_es.GuA)("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async t=>Je(fe({},t),{id:await this.getSubscriptionId(t.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const t=await this.rpcBatchFetchMessages(e);t&&t.messages&&(await(0,utils_dist_index_es.yy4)((0,cjs.toMiliseconds)(cjs.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(t.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=(0,utils_dist_index_es.GuA)("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return(0,utils_dist_index_es.ALl)(e+await this.getClientId())}}var ro=Object.defineProperty,Ri=Object.getOwnPropertySymbols,no=Object.prototype.hasOwnProperty,oo=Object.prototype.propertyIsEnumerable,Xe=(r,e,t)=>e in r?ro(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ai=(r,e)=>{for(var t in e||(e={}))no.call(e,t)&&Xe(r,t,e[t]);if(Ri)for(var t of Ri(e))oo.call(e,t)&&Xe(r,t,e[t]);return r},index_es_g=(r,e,t)=>Xe(r,"symbol"!=typeof e?e+"":e,t);class xi extends d{constructor(e){super(e),index_es_g(this,"protocol","wc"),index_es_g(this,"version",2),index_es_g(this,"core"),index_es_g(this,"logger"),index_es_g(this,"events",new events.EventEmitter),index_es_g(this,"provider"),index_es_g(this,"messages"),index_es_g(this,"subscriber"),index_es_g(this,"publisher"),index_es_g(this,"name","relayer"),index_es_g(this,"transportExplicitlyClosed",!1),index_es_g(this,"initialized",!1),index_es_g(this,"connectionAttemptInProgress",!1),index_es_g(this,"relayUrl"),index_es_g(this,"projectId"),index_es_g(this,"packageName"),index_es_g(this,"bundleId"),index_es_g(this,"hasExperiencedNetworkDisruption",!1),index_es_g(this,"pingTimeout"),index_es_g(this,"heartBeatTimeout",(0,cjs.toMiliseconds)(cjs.THIRTY_SECONDS+cjs.FIVE_SECONDS)),index_es_g(this,"reconnectTimeout"),index_es_g(this,"connectPromise"),index_es_g(this,"reconnectInProgress",!1),index_es_g(this,"requestsInFlight",[]),index_es_g(this,"connectTimeout",(0,cjs.toMiliseconds)(15*cjs.ONE_SECOND)),index_es_g(this,"request",async t=>{var i,s;this.logger.debug("Publishing Request Payload");const n=t.id||getBigIntRpcId().toString();await this.toEstablishConnection();try{this.logger.trace({id:n,method:t.method,topic:null==(i=t.params)?void 0:i.topic},"relayer.request - publishing...");const o=`${n}:${(null==(s=t.params)?void 0:s.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(t);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${n}`),o}}),index_es_g(this,"resetPingTimeout",()=>{(0,utils_dist_index_es.Lln)()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var t,i,s,n;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),null==(n=null==(s=null==(i=null==(t=this.provider)?void 0:t.connection)?void 0:i.socket)?void 0:s.terminate)||n.call(s)}catch(o){this.logger.warn(o,o?.message)}},this.heartBeatTimeout))}),index_es_g(this,"onPayloadHandler",t=>{this.onProviderPayload(t),this.resetPingTimeout()}),index_es_g(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected 🛜"),this.startPingTimeout(),this.events.emit(dist_index_es_C_connect)}),index_es_g(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected 🛑"),this.requestsInFlight=[],this.onProviderDisconnect()}),index_es_g(this,"onProviderErrorHandler",t=>{this.logger.fatal(`Fatal socket error: ${t.message}`),this.events.emit(dist_index_es_C_error,t),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),index_es_g(this,"registerProviderListeners",()=>{this.provider.on(index_es_M_payload,this.onPayloadHandler),this.provider.on(index_es_M_connect,this.onConnectHandler),this.provider.on(index_es_M_disconnect,this.onDisconnectHandler),this.provider.on(index_es_M_error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&"string"!=typeof e.logger?(0,index_es.U5)(e.logger,this.name):(0,index_es.h6)((0,index_es.iP)({level:e.logger||"error"})),this.messages=new Ti(this.logger,e.core),this.subscriber=new Oi(this,this.logger),this.publisher=new Yn(this,this.logger),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||Ke,(0,utils_dist_index_es.m01)()?this.packageName=(0,utils_dist_index_es.R7U)():(0,utils_dist_index_es.aRZ)()&&(this.bundleId=(0,utils_dist_index_es.R7U)()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e?.message))}get context(){return(0,index_es.oI)(this.logger)}get connected(){var e,t,i;return 1===(null==(i=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:i.readyState)||!1}get connecting(){var e,t,i;return 0===(null==(i=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:i.readyState)||void 0!==this.connectPromise||!1}async publish(e,t,i){this.isInitialized(),await this.publisher.publish(e,t,i),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now(),transportType:ee.relay},ye_outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,t){var i,s,n;this.isInitialized(),(null==t||!t.transportType||"relay"===t?.transportType)&&await this.toEstablishConnection();const o=typeof(null==(i=t?.internal)?void 0:i.throwOnFailedPublish)>"u"||(null==(s=t?.internal)?void 0:s.throwOnFailedPublish);let c,a=(null==(n=this.subscriber.topicMap.get(e))?void 0:n[0])||"";const h=l=>{l.topic===e&&(this.subscriber.off(U_created,h),c())};return await Promise.all([new Promise(l=>{c=l,this.subscriber.on(U_created,h)}),new Promise(async(l,p)=>{a=await this.subscriber.subscribe(e,Ai({internal:{throwOnFailedPublish:o}},t)).catch(y=>{o&&p(y)})||a,l()})]),a}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await(0,utils_dist_index_es.K3g)(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(this.subscriber.hasAnyTopics){if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(t,i)=>{await this.connect(e).then(t).catch(i).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}else this.logger.info("Starting WS connection skipped because the client has no topics to work with.")}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await(0,utils_dist_index_es.sc7)())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(0===e?.length)return void this.logger.trace("Batch message events is empty. Ignoring...");const t=e.sort((i,s)=>i.publishedAt-s.publishedAt);this.logger.debug(`Batch of ${t.length} message events sorted`);for(const i of t)try{await this.onMessageEvent(i)}catch(s){this.logger.warn(s,"Error while processing batch message event: "+s?.message)}this.logger.trace(`Batch of ${t.length} message events processed`)}async onLinkMessageEvent(e,t){const{topic:i}=e;if(!t.sessionExists){const n={topic:i,expiry:(0,utils_dist_index_es.Xw0)(cjs.FIVE_MINUTES),relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(i,n)}this.events.emit(dist_index_es_C_message,e),await this.recordMessageEvent(e,ye_inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let t=1;for(;t<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${t}...`),await this.createProvider(),await new Promise(async(i,s)=>{const n=()=>{s(new Error("Connection interrupted while trying to connect"))};this.provider.once(index_es_M_disconnect,n),await(0,utils_dist_index_es.K3g)(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{s(o)}).finally(()=>{this.provider.off(index_es_M_disconnect,n),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{s(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(index_es_M_disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(index_es_M_disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,i()})}catch(i){await this.subscriber.stop();const s=i;this.logger.warn({},s.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${t}`);break}await new Promise(i=>setTimeout(i,(0,cjs.toMiliseconds)(1*t))),t++}}startPingTimeout(){var e,t,i,s,n;if((0,utils_dist_index_es.Lln)())try{null!=(t=null==(e=this.provider)?void 0:e.connection)&&t.socket&&(null==(n=null==(s=null==(i=this.provider)?void 0:i.connection)?void 0:s.socket)||n.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new index_es_o(new index_es_f((0,utils_dist_index_es.jUZ)({sdkVersion:Pe,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,t){const{topic:i,message:s}=e;await this.messages.set(i,s,t)}async shouldIgnoreMessageEvent(e){const{topic:t,message:i}=e;if(!i||0===i.length)return this.logger.warn(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isKnownTopic(t))return this.logger.warn(`Ignoring message for unknown topic ${t}`),!0;const s=this.messages.has(t,i);return s&&this.logger.warn(`Ignoring duplicate message: ${i}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),isJsonRpcRequest(e)){if(!e.method.endsWith("_subscription"))return;const t=e.params,{topic:i,message:s,publishedAt:n,attestation:o}=t.data,a={topic:i,message:s,publishedAt:n,transportType:ee.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Ai({type:"event",event:t.id},a)),this.events.emit(t.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else isJsonRpcResponse(e)&&this.events.emit(dist_index_es_C_message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,ye_inbound),this.events.emit(dist_index_es_C_message,e))}async acknowledgePayload(e){const t=formatJsonRpcResult(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(index_es_M_payload,this.onPayloadHandler),this.provider.off(index_es_M_connect,this.onConnectHandler),this.provider.off(index_es_M_disconnect,this.onDisconnectHandler),this.provider.off(index_es_M_error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await(0,utils_dist_index_es.sc7)();(0,utils_dist_index_es.uym)(async t=>{e!==t&&(e=t,t?await this.transportOpen().catch(i=>this.logger.error(i,i?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(r_pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&(0,utils_dist_index_es.sKr)())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(t){this.logger.warn(t,t?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(dist_index_es_C_disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},(0,cjs.toMiliseconds)(.1)))))}isInitialized(){if(!this.initialized){const{message:e}=(0,utils_dist_index_es.GuA)("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise)return void await this.connectPromise;await this.connect()}}}function Ni(r){return Object.getOwnPropertySymbols(r).filter(e=>Object.prototype.propertyIsEnumerable.call(r,e))}function $i(r){return null==r?void 0===r?"[object Undefined]":"[object Null]":Object.prototype.toString.call(r)}const zi="[object Arguments]",Ze="[object Object]";function No(){}function Li(r){if(!r||"object"!=typeof r)return!1;const e=Object.getPrototypeOf(r);return(null===e||e===Object.prototype||null===Object.getPrototypeOf(e))&&"[object Object]"===Object.prototype.toString.call(r)}function De(r,e,t,i,s,n,o){const a=o(r,e,t,i,s,n);if(void 0!==a)return a;if(typeof r==typeof e)switch(typeof r){case"bigint":case"string":case"boolean":case"symbol":case"undefined":case"function":return r===e;case"number":return r===e||Object.is(r,e);case"object":return ve(r,e,n,o)}return ve(r,e,n,o)}function ve(r,e,t,i){if(Object.is(r,e))return!0;let s=$i(r),n=$i(e);if(s===zi&&(s=Ze),n===zi&&(n=Ze),s!==n)return!1;switch(s){case"[object String]":return r.toString()===e.toString();case"[object Number]":return function ao(r,e){return r===e||Number.isNaN(r)&&Number.isNaN(e)}(r.valueOf(),e.valueOf());case"[object Boolean]":case"[object Date]":case"[object Symbol]":return Object.is(r.valueOf(),e.valueOf());case"[object RegExp]":return r.source===e.source&&r.flags===e.flags;case"[object Function]":return r===e}const o=(t=t??new Map).get(r),a=t.get(e);if(null!=o&&null!=a)return o===e;t.set(r,e),t.set(e,r);try{switch(s){case"[object Map]":if(r.size!==e.size)return!1;for(const[c,h]of r.entries())if(!e.has(c)||!De(h,e.get(c),c,r,e,t,i))return!1;return!0;case"[object Set]":{if(r.size!==e.size)return!1;const c=Array.from(r.values()),h=Array.from(e.values());for(let l=0;l<c.length;l++){const p=c[l],y=h.findIndex(w=>De(p,w,void 0,r,e,t,i));if(-1===y)return!1;h.splice(y,1)}return!0}case"[object Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":case"[object BigUint64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object BigInt64Array]":case"[object Float32Array]":case"[object Float64Array]":if(typeof index_es_Buffer<"u"&&index_es_Buffer.isBuffer(r)!==index_es_Buffer.isBuffer(e)||r.length!==e.length)return!1;for(let c=0;c<r.length;c++)if(!De(r[c],e[c],c,r,e,t,i))return!1;return!0;case"[object ArrayBuffer]":return r.byteLength===e.byteLength&&ve(new Uint8Array(r),new Uint8Array(e),t,i);case"[object DataView]":return r.byteLength===e.byteLength&&r.byteOffset===e.byteOffset&&ve(new Uint8Array(r),new Uint8Array(e),t,i);case"[object Error]":return r.name===e.name&&r.message===e.message;case Ze:{if(!(ve(r.constructor,e.constructor,t,i)||Li(r)&&Li(e)))return!1;const h=[...Object.keys(r),...Ni(r)],l=[...Object.keys(e),...Ni(e)];if(h.length!==l.length)return!1;for(let p=0;p<h.length;p++){const y=h[p],w=r[y];if(!Object.hasOwn(e,y))return!1;if(!De(w,e[y],y,r,e,t,i))return!1}return!0}default:return!1}}finally{t.delete(r),t.delete(e)}}function zo(r,e){return function $o(r,e,t){return De(r,e,void 0,void 0,void 0,void 0,t)}(r,e,No)}var Lo=Object.defineProperty,ki=Object.getOwnPropertySymbols,ko=Object.prototype.hasOwnProperty,jo=Object.prototype.propertyIsEnumerable,Qe=(r,e,t)=>e in r?Lo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ji=(r,e)=>{for(var t in e||(e={}))ko.call(e,t)&&Qe(r,t,e[t]);if(ki)for(var t of ki(e))jo.call(e,t)&&Qe(r,t,e[t]);return r},F=(r,e,t)=>Qe(r,"symbol"!=typeof e?e+"":e,t);class Ui extends f{constructor(e,t,i,s=W,n=void 0){super(e,t,i,s),this.core=e,this.logger=t,this.name=i,F(this,"map",new Map),F(this,"version","0.3"),F(this,"cached",[]),F(this,"initialized",!1),F(this,"getKey"),F(this,"storagePrefix",W),F(this,"recentlyDeleted",[]),F(this,"recentlyDeletedLimit",200),F(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&null!==o&&!(0,utils_dist_index_es.b07)(o)?this.map.set(this.getKey(o),o):(0,utils_dist_index_es.CTo)(o)?this.map.set(o.id,o):(0,utils_dist_index_es.mr0)(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),F(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),F(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),F(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>zo(a[c],o[c]))):this.values)),F(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=ji(ji({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),F(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=(0,index_es.U5)(t,this.name),this.storagePrefix=s,this.getKey=n}get context(){return(0,index_es.oI)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){const{message:s}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}const{message:i}=(0,utils_dist_index_es.GuA)("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:t}=(0,utils_dist_index_es.GuA)("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=(0,utils_dist_index_es.GuA)("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Uo=Object.defineProperty,dist_index_es_d=(r,e,t)=>((r,e,t)=>e in r?Uo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class Fi{constructor(e,t){this.core=e,this.logger=t,dist_index_es_d(this,"name","pairing"),dist_index_es_d(this,"version","0.3"),dist_index_es_d(this,"events",new(events_default())),dist_index_es_d(this,"pairings"),dist_index_es_d(this,"initialized",!1),dist_index_es_d(this,"storagePrefix",W),dist_index_es_d(this,"ignoredPayloadTypes",[utils_dist_index_es.Lp_]),dist_index_es_d(this,"registeredMethods",[]),dist_index_es_d(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),dist_index_es_d(this,"register",({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]}),dist_index_es_d(this,"create",async i=>{this.isInitialized();const s=(0,utils_dist_index_es.two)(),n=await this.core.crypto.setSymKey(s),o=(0,utils_dist_index_es.Xw0)(cjs.FIVE_MINUTES),a={protocol:"irn"},c={topic:n,expiry:o,relay:a,active:!1,methods:i?.methods},h=(0,utils_dist_index_es.QJh)({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:s,relay:a,expiryTimestamp:o,methods:i?.methods});return this.events.emit(ae_create,c),this.core.expirer.set(n,o),await this.pairings.set(n,c),await this.core.relayer.subscribe(n,{transportType:i?.transportType,internal:i?.internal}),{topic:n,uri:h}}),dist_index_es_d(this,"pair",async i=>{this.isInitialized();const s=this.core.eventClient.createEvent({properties:{topic:i?.uri,trace:[Y_pairing_started]}});this.isValidPair(i,s);const{topic:n,symKey:o,relay:a,expiryTimestamp:c,methods:h}=(0,utils_dist_index_es.wYp)(i.uri);let l;if(s.props.properties.topic=n,s.addTrace(Y_pairing_uri_validation_success),s.addTrace(Y_pairing_uri_not_expired),this.pairings.keys.includes(n)){if(l=this.pairings.get(n),s.addTrace(Y_existing_pairing),l.active)throw s.setError(X_active_pairing_already_exists),new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);s.addTrace(Y_pairing_not_expired)}const p=c||(0,utils_dist_index_es.Xw0)(cjs.FIVE_MINUTES),y={topic:n,relay:a,expiry:p,active:!1,methods:h};this.core.expirer.set(n,p),await this.pairings.set(n,y),s.addTrace(Y_store_new_pairing),i.activatePairing&&await this.activate({topic:n}),this.events.emit(ae_create,y),s.addTrace(Y_emit_inactive_pairing),this.core.crypto.keychain.has(n)||await this.core.crypto.setSymKey(o,n),s.addTrace(Y_subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{s.setError(X_no_internet_connection)}try{await this.core.relayer.subscribe(n,{relay:a})}catch(w){throw s.setError(X_subscribe_pairing_topic_failure),w}return s.addTrace(Y_subscribe_pairing_topic_success),y}),dist_index_es_d(this,"activate",async({topic:i})=>{this.isInitialized();const s=(0,utils_dist_index_es.Xw0)(cjs.FIVE_MINUTES);this.core.expirer.set(i,s),await this.pairings.update(i,{active:!0,expiry:s})}),dist_index_es_d(this,"ping",async i=>{this.isInitialized(),await this.isValidPing(i),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:s}=i;if(this.pairings.keys.includes(s)){const n=await this.sendRequest(s,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=(0,utils_dist_index_es.Wx8)();this.events.once((0,utils_dist_index_es.hEn)("pairing_ping",n),({error:h})=>{h?c(h):a()}),await o()}}),dist_index_es_d(this,"updateExpiry",async({topic:i,expiry:s})=>{this.isInitialized(),await this.pairings.update(i,{expiry:s})}),dist_index_es_d(this,"updateMetadata",async({topic:i,metadata:s})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:s})}),dist_index_es_d(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),dist_index_es_d(this,"disconnect",async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",(0,utils_dist_index_es.Hjj)("USER_DISCONNECTED")),await this.deletePairing(s))}),dist_index_es_d(this,"formatUriFromPairing",i=>{this.isInitialized();const{topic:s,relay:n,expiry:o,methods:a}=i,c=this.core.crypto.keychain.get(s);return(0,utils_dist_index_es.QJh)({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:c,relay:n,expiryTimestamp:o,methods:a})}),dist_index_es_d(this,"sendRequest",async(i,s,n)=>{const o=formatJsonRpcRequest(s,n),a=await this.core.crypto.encode(i,o),c=oe[s].req;return this.core.history.set(i,o),this.core.relayer.publish(i,a,c),o.id}),dist_index_es_d(this,"sendResult",async(i,s,n)=>{const o=formatJsonRpcResult(i,n),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,i)).request.method,h=oe[c].res;await this.core.relayer.publish(s,a,h),await this.core.history.resolve(o)}),dist_index_es_d(this,"sendError",async(i,s,n)=>{const o=formatJsonRpcError(i,n),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,i)).request.method,h=oe[c]?oe[c].res:oe.unregistered_method.res;await this.core.relayer.publish(s,a,h),await this.core.history.resolve(o)}),dist_index_es_d(this,"deletePairing",async(i,s)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,(0,utils_dist_index_es.Hjj)("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),s?Promise.resolve():this.core.expirer.del(i)])}),dist_index_es_d(this,"cleanup",async()=>{const i=this.pairings.getAll().filter(s=>(0,utils_dist_index_es._dF)(s.expiry));await Promise.all(i.map(s=>this.deletePairing(s.topic)))}),dist_index_es_d(this,"onRelayEventRequest",async i=>{const{topic:s,payload:n}=i;switch(n.method){case"wc_pairingPing":return await this.onPairingPingRequest(s,n);case"wc_pairingDelete":return await this.onPairingDeleteRequest(s,n);default:return await this.onUnknownRpcMethodRequest(s,n)}}),dist_index_es_d(this,"onRelayEventResponse",async i=>{const{topic:s,payload:n}=i,o=(await this.core.history.get(s,n.id)).request.method;return"wc_pairingPing"===o?this.onPairingPingResponse(s,n):this.onUnknownRpcMethodResponse(o)}),dist_index_es_d(this,"onPairingPingRequest",async(i,s)=>{const{id:n}=s;try{this.isValidPing({topic:i}),await this.sendResult(n,i,!0),this.events.emit(ae_ping,{id:n,topic:i})}catch(o){await this.sendError(n,i,o),this.logger.error(o)}}),dist_index_es_d(this,"onPairingPingResponse",(i,s)=>{const{id:n}=s;setTimeout(()=>{isJsonRpcResult(s)?this.events.emit((0,utils_dist_index_es.hEn)("pairing_ping",n),{}):isJsonRpcError(s)&&this.events.emit((0,utils_dist_index_es.hEn)("pairing_ping",n),{error:s.error})},500)}),dist_index_es_d(this,"onPairingDeleteRequest",async(i,s)=>{const{id:n}=s;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(ae_delete,{id:n,topic:i})}catch(o){await this.sendError(n,i,o),this.logger.error(o)}}),dist_index_es_d(this,"onUnknownRpcMethodRequest",async(i,s)=>{const{id:n,method:o}=s;try{if(this.registeredMethods.includes(o))return;const a=(0,utils_dist_index_es.Hjj)("WC_METHOD_UNSUPPORTED",o);await this.sendError(n,i,a),this.logger.error(a)}catch(a){await this.sendError(n,i,a),this.logger.error(a)}}),dist_index_es_d(this,"onUnknownRpcMethodResponse",i=>{this.registeredMethods.includes(i)||this.logger.error((0,utils_dist_index_es.Hjj)("WC_METHOD_UNSUPPORTED",i))}),dist_index_es_d(this,"isValidPair",(i,s)=>{var n;if(!(0,utils_dist_index_es.TeY)(i)){const{message:a}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`pair() params: ${i}`);throw s.setError(X_malformed_pairing_uri),new Error(a)}if(!(0,utils_dist_index_es.AYU)(i.uri)){const{message:a}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw s.setError(X_malformed_pairing_uri),new Error(a)}const o=(0,utils_dist_index_es.wYp)(i?.uri);if(null==(n=o?.relay)||!n.protocol){const{message:a}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID","pair() uri#relay-protocol");throw s.setError(X_malformed_pairing_uri),new Error(a)}if(null==o||!o.symKey){const{message:a}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID","pair() uri#symKey");throw s.setError(X_malformed_pairing_uri),new Error(a)}if(null!=o&&o.expiryTimestamp&&(0,cjs.toMiliseconds)(o?.expiryTimestamp)<Date.now()){s.setError(X_pairing_expired);const{message:a}=(0,utils_dist_index_es.GuA)("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),dist_index_es_d(this,"isValidPing",async i=>{if(!(0,utils_dist_index_es.TeY)(i)){const{message:n}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)}),dist_index_es_d(this,"isValidDisconnect",async i=>{if(!(0,utils_dist_index_es.TeY)(i)){const{message:n}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)}),dist_index_es_d(this,"isValidPairingTopic",async i=>{if(!(0,utils_dist_index_es.Qhg)(i,!1)){const{message:s}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(s)}if(!this.pairings.keys.includes(i)){const{message:s}=(0,utils_dist_index_es.GuA)("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(s)}if((0,utils_dist_index_es._dF)(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:s}=(0,utils_dist_index_es.GuA)("EXPIRED",`pairing topic: ${i}`);throw new Error(s)}}),this.core=e,this.logger=(0,index_es.U5)(t,this.name),this.pairings=new Ui(this.core,this.logger,this.name,this.storagePrefix)}get context(){return(0,index_es.oI)(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=(0,utils_dist_index_es.GuA)("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(dist_index_es_C_message,async e=>{const{topic:t,message:i,transportType:s}=e;if(this.pairings.keys.includes(t)&&s!==ee.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))try{const n=await this.core.crypto.decode(t,i);isJsonRpcRequest(n)?(this.core.history.set(t,n),await this.onRelayEventRequest({topic:t,payload:n})):isJsonRpcResponse(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:t,payload:n}),this.core.history.delete(t,n.id)),await this.core.relayer.messages.ack(t,i)}catch(n){this.logger.error(n)}})}registerExpirerEvents(){this.core.expirer.on(q_expired,async e=>{const{topic:t}=(0,utils_dist_index_es.c82)(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(ae_expire,{topic:t}))})}}var Mo=Object.defineProperty,index_es_N=(r,e,t)=>((r,e,t)=>e in r?Mo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class Mi extends I{constructor(e,t){super(e,t),this.core=e,this.logger=t,index_es_N(this,"records",new Map),index_es_N(this,"events",new events.EventEmitter),index_es_N(this,"name","history"),index_es_N(this,"version","0.3"),index_es_N(this,"cached",[]),index_es_N(this,"initialized",!1),index_es_N(this,"storagePrefix",W),index_es_N(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),index_es_N(this,"set",(i,s,n)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:s,chainId:n}),this.records.has(s.id))return;const o={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:n,expiry:(0,utils_dist_index_es.Xw0)(cjs.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(index_es_V_created,o)}),index_es_N(this,"resolve",async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const s=await this.getRecord(i.id);typeof s.response>"u"&&(s.response=isJsonRpcError(i)?{error:i.error}:{result:i.result},this.records.set(s.id,s),this.persist(),this.events.emit(index_es_V_updated,s))}),index_es_N(this,"get",async(i,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:s}),await this.getRecord(s))),index_es_N(this,"delete",(i,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(n=>{if(n.topic===i){if(typeof s<"u"&&n.id!==s)return;this.records.delete(n.id),this.events.emit(index_es_V_deleted,n)}}),this.persist()}),index_es_N(this,"exists",async(i,s)=>(this.isInitialized(),!!this.records.has(s)&&(await this.getRecord(s)).topic===i)),index_es_N(this,"on",(i,s)=>{this.events.on(i,s)}),index_es_N(this,"once",(i,s)=>{this.events.once(i,s)}),index_es_N(this,"off",(i,s)=>{this.events.off(i,s)}),index_es_N(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=(0,index_es.U5)(t,this.name)}get context(){return(0,index_es.oI)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const i={topic:t.topic,request:formatJsonRpcRequest(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:i}=(0,utils_dist_index_es.GuA)("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(index_es_V_sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:t}=(0,utils_dist_index_es.GuA)("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(index_es_V_created,e=>{const t=index_es_V_created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(index_es_V_updated,e=>{const t=index_es_V_updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(index_es_V_deleted,e=>{const t=index_es_V_deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.core.heartbeat.on(r_pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(t=>{(0,cjs.toMiliseconds)(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.records.delete(t.id),this.events.emit(index_es_V_deleted,t,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=(0,utils_dist_index_es.GuA)("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Bo=Object.defineProperty,index_es_z=(r,e,t)=>((r,e,t)=>e in r?Bo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class Ki extends S{constructor(e,t){super(e,t),this.core=e,this.logger=t,index_es_z(this,"expirations",new Map),index_es_z(this,"events",new events.EventEmitter),index_es_z(this,"name","expirer"),index_es_z(this,"version","0.3"),index_es_z(this,"cached",[]),index_es_z(this,"initialized",!1),index_es_z(this,"storagePrefix",W),index_es_z(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),index_es_z(this,"has",i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<"u"}catch{return!1}}),index_es_z(this,"set",(i,s)=>{this.isInitialized();const n=this.formatTarget(i),o={target:n,expiry:s};this.expirations.set(n,o),this.checkExpiry(n,o),this.events.emit(q_created,{target:n,expiration:o})}),index_es_z(this,"get",i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)}),index_es_z(this,"del",i=>{if(this.isInitialized(),this.has(i)){const s=this.formatTarget(i),n=this.getExpiration(s);this.expirations.delete(s),this.events.emit(q_deleted,{target:s,expiration:n})}}),index_es_z(this,"on",(i,s)=>{this.events.on(i,s)}),index_es_z(this,"once",(i,s)=>{this.events.once(i,s)}),index_es_z(this,"off",(i,s)=>{this.events.off(i,s)}),index_es_z(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=(0,index_es.U5)(t,this.name)}get context(){return(0,index_es.oI)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if("string"==typeof e)return(0,utils_dist_index_es.ADD)(e);if("number"==typeof e)return(0,utils_dist_index_es.gOF)(e);const{message:t}=(0,utils_dist_index_es.GuA)("UNKNOWN_TYPE","Target type: "+typeof e);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(q_sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:t}=(0,utils_dist_index_es.GuA)("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:i}=(0,utils_dist_index_es.GuA)("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(i),new Error(i)}return t}checkExpiry(e,t){const{expiry:i}=t;(0,cjs.toMiliseconds)(i)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(q_expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(r_pulse,()=>this.checkExpirations()),this.events.on(q_created,e=>{const t=q_created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(q_expired,e=>{const t=q_expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(q_deleted,e=>{const t=q_deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=(0,utils_dist_index_es.GuA)("NOT_INITIALIZED",this.name);throw new Error(e)}}}var qo=Object.defineProperty,index_es_P=(r,e,t)=>((r,e,t)=>e in r?qo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class Bi extends M{constructor(e,t,i){super(e,t,i),this.core=e,this.logger=t,this.store=i,index_es_P(this,"name","verify-api"),index_es_P(this,"abortController"),index_es_P(this,"isDevEnv"),index_es_P(this,"verifyUrlV3",Xt),index_es_P(this,"storagePrefix",W),index_es_P(this,"version",2),index_es_P(this,"publicKey"),index_es_P(this,"fetchPromise"),index_es_P(this,"init",async()=>{var s;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&(0,cjs.toMiliseconds)(null==(s=this.publicKey)?void 0:s.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),index_es_P(this,"register",async s=>{if(!(0,utils_dist_index_es.BdH)()||this.isDevEnv)return;const n=window.location.origin,{id:o,decryptedId:a}=s,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${n}&id=${o}&decryptedId=${a}`;try{const h=(0,window_getters_dist_cjs.getDocument)(),l=this.startAbortTimer(5*cjs.ONE_SECOND),p=await new Promise((y,w)=>{const u=()=>{window.removeEventListener("message",D),h.body.removeChild(m),w("attestation aborted")};this.abortController.signal.addEventListener("abort",u);const m=h.createElement("iframe");m.src=c,m.style.display="none",m.addEventListener("error",u,{signal:this.abortController.signal});const D=_=>{if(_.data&&"string"==typeof _.data)try{const E=JSON.parse(_.data);if("verify_attestation"===E.type){if((0,dist_index_es.Cq)(E.attestation).payload.id!==o)return;clearInterval(l),h.body.removeChild(m),this.abortController.signal.removeEventListener("abort",u),window.removeEventListener("message",D),y(null===E.attestation?"":E.attestation)}}catch(E){this.logger.warn(E)}};h.body.appendChild(m),window.addEventListener("message",D,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",p),p}catch(h){this.logger.warn(h)}return""}),index_es_P(this,"resolve",async s=>{if(this.isDevEnv)return"";const{attestationId:n,hash:o,encryptedId:a}=s;if(""===n)return void this.logger.debug("resolve: attestationId is empty, skipping");if(n){if((0,dist_index_es.Cq)(n).payload.id!==a)return;const h=await this.isValidJwtAttestation(n);if(h)return h.isVerified?h:void this.logger.warn("resolve: jwt attestation: origin url not verified")}if(!o)return;const c=this.getVerifyUrl(s?.verifyUrl);return this.fetchAttestation(o,c)}),index_es_P(this,"fetchAttestation",async(s,n)=>{this.logger.debug(`resolving attestation: ${s} from url: ${n}`);const o=this.startAbortTimer(5*cjs.ONE_SECOND),a=await fetch(`${n}/attestation/${s}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),200===a.status?await a.json():void 0}),index_es_P(this,"getVerifyUrl",s=>{let n=s||be;return Zt.includes(n)||(this.logger.info(`verify url: ${n}, not included in trusted list, assigning default: ${be}`),n=be),n}),index_es_P(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const s=this.startAbortTimer(cjs.FIVE_SECONDS),n=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(s),await n.json()}catch(s){this.logger.warn(s)}}),index_es_P(this,"persistPublicKey",async s=>{this.logger.debug("persisting public key to local storage",s),await this.store.setItem(this.storeKey,s),this.publicKey=s}),index_es_P(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),index_es_P(this,"isValidJwtAttestation",async s=>{const n=await this.getPublicKey();try{if(n)return this.validateAttestation(s,n)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(s,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),index_es_P(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),index_es_P(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async n=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),n(o))});const s=await this.fetchPromise;return this.fetchPromise=void 0,s}),index_es_P(this,"validateAttestation",(s,n)=>{const o=(0,utils_dist_index_es.U0i)(s,n.publicKey),a={hasExpired:(0,cjs.toMiliseconds)(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=(0,index_es.U5)(t,this.name),this.abortController=new AbortController,this.isDevEnv=(0,utils_dist_index_es.w8K)(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return(0,index_es.oI)(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,cjs.toMiliseconds)(e))}}var Wo=Object.defineProperty,Vi=(r,e,t)=>((r,e,t)=>e in r?Wo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class qi extends index_es_O{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,Vi(this,"context","echo"),Vi(this,"registerDeviceToken",async i=>{const{clientId:s,token:n,notificationType:o,enableEncrypted:a=!1}=i,c=`https://echo.walletconnect.com/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:s,type:o,token:n,always_raw:a})})}),this.logger=(0,index_es.U5)(t,this.context)}}var Yo=Object.defineProperty,Gi=Object.getOwnPropertySymbols,Jo=Object.prototype.hasOwnProperty,Xo=Object.prototype.propertyIsEnumerable,et=(r,e,t)=>e in r?Yo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,we=(r,e)=>{for(var t in e||(e={}))Jo.call(e,t)&&et(r,t,e[t]);if(Gi)for(var t of Gi(e))Xo.call(e,t)&&et(r,t,e[t]);return r},index_es_R=(r,e,t)=>et(r,"symbol"!=typeof e?e+"":e,t);class Wi extends R{constructor(e,t,i=!0){super(e,t,i),this.core=e,this.logger=t,index_es_R(this,"context","event-client"),index_es_R(this,"storagePrefix",W),index_es_R(this,"storageVersion",.1),index_es_R(this,"events",new Map),index_es_R(this,"shouldPersist",!1),index_es_R(this,"init",async()=>{if(!(0,utils_dist_index_es.w8K)())try{const s={eventId:(0,utils_dist_index_es.gZm)(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:(0,utils_dist_index_es.ojD)(this.core.relayer.protocol,this.core.relayer.version,Pe)}}};await this.sendEvent([s])}catch(s){this.logger.warn(s)}}),index_es_R(this,"createEvent",s=>{const{event:n="ERROR",type:o="",properties:{topic:a,trace:c}}=s,h=(0,utils_dist_index_es.gZm)(),l=this.core.projectId||"",p=Date.now(),y=we({eventId:h,timestamp:p,props:{event:n,type:o,properties:{topic:a,trace:c}},bundleId:l,domain:this.getAppDomain()},this.setMethods(h));return this.telemetryEnabled&&(this.events.set(h,y),this.shouldPersist=!0),y}),index_es_R(this,"getEvent",s=>{const{eventId:n,topic:o}=s;if(n)return this.events.get(n);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);return a?we(we({},a),this.setMethods(a.eventId)):void 0}),index_es_R(this,"deleteEvent",s=>{const{eventId:n}=s;this.events.delete(n),this.shouldPersist=!0}),index_es_R(this,"setEventListeners",()=>{this.core.heartbeat.on(r_pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(s=>{(0,cjs.fromMiliseconds)(Date.now())-(0,cjs.fromMiliseconds)(s.timestamp)>86400&&(this.events.delete(s.eventId),this.shouldPersist=!0)})})}),index_es_R(this,"setMethods",s=>({addTrace:n=>this.addTrace(s,n),setError:n=>this.setError(s,n)})),index_es_R(this,"addTrace",(s,n)=>{const o=this.events.get(s);o&&(o.props.properties.trace.push(n),this.events.set(s,o),this.shouldPersist=!0)}),index_es_R(this,"setError",(s,n)=>{const o=this.events.get(s);o&&(o.props.type=n,o.timestamp=Date.now(),this.events.set(s,o),this.shouldPersist=!0)}),index_es_R(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),index_es_R(this,"restore",async()=>{try{const s=await this.core.storage.getItem(this.storageKey)||[];if(!s.length)return;s.forEach(n=>{this.events.set(n.eventId,we(we({},n),this.setMethods(n.eventId)))})}catch(s){this.logger.warn(s)}}),index_es_R(this,"submit",async()=>{if(!this.telemetryEnabled||0===this.events.size)return;const s=[];for(const[n,o]of this.events)o.props.type&&s.push(o);if(0!==s.length)try{if((await this.sendEvent(s)).ok)for(const n of s)this.events.delete(n.eventId),this.shouldPersist=!0}catch(n){this.logger.warn(n)}}),index_es_R(this,"sendEvent",async s=>{const n=this.getAppDomain()?"":"&sp=desktop";return await fetch(`https://pulse.walletconnect.org/batch?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Pe}${n}`,{method:"POST",body:JSON.stringify(s)})}),index_es_R(this,"getAppDomain",()=>(0,utils_dist_index_es.lFF)().url),this.logger=(0,index_es.U5)(t,this.context),this.telemetryEnabled=i,i?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var Zo=Object.defineProperty,Hi=Object.getOwnPropertySymbols,Qo=Object.prototype.hasOwnProperty,ea=Object.prototype.propertyIsEnumerable,tt=(r,e,t)=>e in r?Zo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Yi=(r,e)=>{for(var t in e||(e={}))Qo.call(e,t)&&tt(r,t,e[t]);if(Hi)for(var t of Hi(e))ea.call(e,t)&&tt(r,t,e[t]);return r},dist_index_es_v=(r,e,t)=>tt(r,"symbol"!=typeof e?e+"":e,t);class Oe extends index_es_h{constructor(e){var t;super(e),dist_index_es_v(this,"protocol","wc"),dist_index_es_v(this,"version",2),dist_index_es_v(this,"name",pe),dist_index_es_v(this,"relayUrl"),dist_index_es_v(this,"projectId"),dist_index_es_v(this,"customStoragePrefix"),dist_index_es_v(this,"events",new events.EventEmitter),dist_index_es_v(this,"logger"),dist_index_es_v(this,"heartbeat"),dist_index_es_v(this,"relayer"),dist_index_es_v(this,"crypto"),dist_index_es_v(this,"storage"),dist_index_es_v(this,"history"),dist_index_es_v(this,"expirer"),dist_index_es_v(this,"pairing"),dist_index_es_v(this,"verify"),dist_index_es_v(this,"echoClient"),dist_index_es_v(this,"linkModeSupportedApps"),dist_index_es_v(this,"eventClient"),dist_index_es_v(this,"initialized",!1),dist_index_es_v(this,"logChunkController"),dist_index_es_v(this,"on",(a,c)=>this.events.on(a,c)),dist_index_es_v(this,"once",(a,c)=>this.events.once(a,c)),dist_index_es_v(this,"off",(a,c)=>this.events.off(a,c)),dist_index_es_v(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),dist_index_es_v(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:h})=>{if(!a||!c)return;const l={topic:a,message:c,publishedAt:Date.now(),transportType:ee.link_mode};this.relayer.onLinkMessageEvent(l,{sessionExists:h})});const i=this.getGlobalCore(e?.customStoragePrefix);if(i)try{return this.customStoragePrefix=i.customStoragePrefix,this.logger=i.logger,this.heartbeat=i.heartbeat,this.crypto=i.crypto,this.history=i.history,this.expirer=i.expirer,this.storage=i.storage,this.relayer=i.relayer,this.pairing=i.pairing,this.verify=i.verify,this.echoClient=i.echoClient,this.linkModeSupportedApps=i.linkModeSupportedApps,this.eventClient=i.eventClient,this.initialized=i.initialized,this.logChunkController=i.logChunkController,i}catch(a){index_es_console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||Ke,this.customStoragePrefix=null!=e&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const s=(0,index_es.iP)({level:"string"==typeof e?.logger&&e.logger?e.logger:It_logger,name:pe}),{logger:n,chunkLoggerController:o}=(0,index_es.D5)({opts:s,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,null!=(t=this.logChunkController)&&t.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;null!=(a=this.logChunkController)&&a.downloadLogsBlobInBrowser&&(null==(c=this.logChunkController)||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=(0,index_es.U5)(n,this.name),this.heartbeat=new index_es_i,this.crypto=new Ei(this,this.logger,e?.keychain),this.history=new Mi(this,this.logger),this.expirer=new Ki(this,this.logger),this.storage=null!=e&&e.storage?e.storage:new h(Yi(Yi({},Tt),e?.storageOptions)),this.relayer=new xi({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Fi(this,this.logger),this.verify=new Bi(this,this.logger,this.storage),this.echoClient=new qi(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new Wi(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const t=new Oe(e);await t.initialize();const i=await t.crypto.getClientId();return await t.storage.setItem("WALLETCONNECT_CLIENT_ID",i),t}get context(){return(0,index_es.oI)(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return null==(e=this.logChunkController)?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(Be,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(Be)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const t=`_walletConnectCore_${e}`,i=`${t}_count`;return globalThis[i]=(globalThis[i]||0)+1,globalThis[i]>1&&index_es_console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[i]} times.`),globalThis[t]}catch(t){return void index_es_console.warn("Failed to get global WalletConnect core",t)}}setGlobalCore(e){var t;try{if(this.isGlobalCoreDisabled())return;const i=`_walletConnectCore_${(null==(t=e.opts)?void 0:t.customStoragePrefix)||""}`;globalThis[i]=e}catch(i){index_es_console.warn("Failed to set global WalletConnect core",i)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&"true"===process.env.DISABLE_GLOBAL_CORE}catch{return!0}}}const ta=Oe;var dist_index_es_console=__webpack_require__("./node_modules/console-browserify/index.js");const index_es_me_name="client",index_es_me_logger="error",Le="WALLETCONNECT_DEEPLINK_CHOICE",B=cjs.SEVEN_DAYS,dist_index_es_P={wc_sessionPropose:{req:{ttl:cjs.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:cjs.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:cjs.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:cjs.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:cjs.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:cjs.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:cjs.ONE_DAY,prompt:!1,tag:1104},res:{ttl:cjs.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:cjs.ONE_DAY,prompt:!1,tag:1106},res:{ttl:cjs.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:cjs.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:cjs.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:cjs.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:cjs.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:cjs.ONE_DAY,prompt:!1,tag:1112},res:{ttl:cjs.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:cjs.ONE_DAY,prompt:!1,tag:1114},res:{ttl:cjs.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:cjs.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:cjs.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:cjs.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:cjs.FIVE_MINUTES,prompt:!1,tag:1119}}},_e={min:cjs.FIVE_MINUTES,max:cjs.SEVEN_DAYS},dist_index_es_M_idle="IDLE",dist_index_es_M_active="ACTIVE",yt={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},mt=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],le="wc@1.5:auth:",index_es_pe=`${le}:PUB_KEY`;var Os=Object.defineProperty,bs=Object.defineProperties,As=Object.getOwnPropertyDescriptors,vt=Object.getOwnPropertySymbols,xs=Object.prototype.hasOwnProperty,Vs=Object.prototype.propertyIsEnumerable,$e=(E,o,t)=>o in E?Os(E,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):E[o]=t,dist_index_es_R=(E,o)=>{for(var t in o||(o={}))xs.call(o,t)&&$e(E,t,o[t]);if(vt)for(var t of vt(o))Vs.call(o,t)&&$e(E,t,o[t]);return E},dist_index_es_O=(E,o)=>bs(E,As(o)),dist_index_es_c=(E,o,t)=>$e(E,"symbol"!=typeof o?o+"":o,t);class Cs extends V{constructor(o){super(o),dist_index_es_c(this,"name","engine"),dist_index_es_c(this,"events",new(events_default())),dist_index_es_c(this,"initialized",!1),dist_index_es_c(this,"requestQueue",{state:dist_index_es_M_idle,queue:[]}),dist_index_es_c(this,"sessionRequestQueue",{state:dist_index_es_M_idle,queue:[]}),dist_index_es_c(this,"emittedSessionRequests",new utils_dist_index_es.ZbZ({limit:500})),dist_index_es_c(this,"requestQueueDelay",cjs.ONE_SECOND),dist_index_es_c(this,"expectedPairingMethodMap",new Map),dist_index_es_c(this,"recentlyDeletedMap",new Map),dist_index_es_c(this,"recentlyDeletedLimit",200),dist_index_es_c(this,"relayMessageCache",[]),dist_index_es_c(this,"pendingSessions",new Map),dist_index_es_c(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(dist_index_es_P)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,cjs.toMiliseconds)(this.requestQueueDelay)))}),dist_index_es_c(this,"connect",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const e=dist_index_es_O(dist_index_es_R({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});await this.isValidConnect(e),e.optionalNamespaces=(0,utils_dist_index_es.XEe)(e.requiredNamespaces,e.optionalNamespaces),e.requiredNamespaces={};const{pairingTopic:s,requiredNamespaces:i,optionalNamespaces:r,sessionProperties:n,scopedProperties:a,relays:l}=e;let h,p=s,u=!1;try{if(p){const T=this.client.core.pairing.pairings.get(p);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),u=T.active}}catch(T){throw this.client.logger.error(`connect() -> pairing.get(${p}) failed`),T}if(!p||!u){const{topic:T,uri:$}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});p=T,h=$}if(!p){const{message:T}=(0,utils_dist_index_es.GuA)("NO_MATCHING_KEY",`connect() pairing topic: ${p}`);throw new Error(T)}const d=await this.client.core.crypto.generateKeyPair(),y=dist_index_es_P.wc_sessionPropose.req.ttl||cjs.FIVE_MINUTES,w=(0,utils_dist_index_es.Xw0)(y),m=dist_index_es_O(dist_index_es_R(dist_index_es_R({requiredNamespaces:i,optionalNamespaces:r,relays:l??[{protocol:"irn"}],proposer:{publicKey:d,metadata:this.client.metadata},expiryTimestamp:w,pairingTopic:p},n&&{sessionProperties:n}),a&&{scopedProperties:a}),{id:payloadId()}),S=(0,utils_dist_index_es.hEn)("session_connect",m.id),{reject:_,resolve:b,done:C}=(0,utils_dist_index_es.Wx8)(y,"Proposal expired"),I=({id:T})=>{T===m.id&&(this.client.events.off("proposal_expire",I),this.pendingSessions.delete(m.id),this.events.emit(S,{error:{message:"Proposal expired",code:0}}))};return this.client.events.on("proposal_expire",I),this.events.once(S,({error:T,session:$})=>{this.client.events.off("proposal_expire",I),T?_(T):$&&b($)}),await this.sendProposeSession({proposal:m,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:m.id}}}),await this.setProposal(m.id,m),{uri:h,approval:C}}),dist_index_es_c(this,"pair",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(t)}catch(e){throw this.client.logger.error("pair() failed"),e}}),dist_index_es_c(this,"approve",async t=>{var e,s,i;const r=this.client.core.eventClient.createEvent({properties:{topic:null==(e=t?.id)?void 0:e.toString(),trace:[rr_session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(N){throw r.setError(nr_no_internet_connection),N}try{await this.isValidProposalId(t?.id)}catch(N){throw this.client.logger.error(`approve() -> proposal.get(${t?.id}) failed`),r.setError(nr_proposal_not_found),N}try{await this.isValidApprove(t)}catch(N){throw this.client.logger.error("approve() -> isValidApprove() failed"),r.setError(nr_session_approve_namespace_validation_failure),N}const{id:n,relayProtocol:a,namespaces:l,sessionProperties:p,scopedProperties:h,sessionConfig:u}=t,d=this.client.proposal.get(n);this.client.core.eventClient.deleteEvent({eventId:r.eventId});const{pairingTopic:y,proposer:w,requiredNamespaces:m,optionalNamespaces:S}=d;let _=null==(s=this.client.core.eventClient)?void 0:s.getEvent({topic:y});_||(_=null==(i=this.client.core.eventClient)?void 0:i.createEvent({type:rr_session_approve_started,properties:{topic:y,trace:[rr_session_approve_started,rr_session_namespaces_validation_success]}}));const b=await this.client.core.crypto.generateKeyPair(),C=w.publicKey,I=await this.client.core.crypto.generateSharedKey(b,C),T=dist_index_es_R(dist_index_es_R(dist_index_es_R({relay:{protocol:a??"irn"},namespaces:l,controller:{publicKey:b,metadata:this.client.metadata},expiry:(0,utils_dist_index_es.Xw0)(B)},p&&{sessionProperties:p}),h&&{scopedProperties:h}),u&&{sessionConfig:u}),$=ee.relay;_.addTrace(rr_subscribing_session_topic);try{await this.client.core.relayer.subscribe(I,{transportType:$,internal:{skipSubscribe:!0}})}catch(N){throw _.setError(nr_subscribe_session_topic_failure),N}_.addTrace(rr_subscribe_session_topic_success);const Ee=dist_index_es_O(dist_index_es_R({},T),{topic:I,requiredNamespaces:m,optionalNamespaces:S,pairingTopic:y,acknowledged:!1,self:T.controller,peer:{publicKey:w.publicKey,metadata:w.metadata},controller:b,transportType:ee.relay});await this.client.session.set(I,Ee),_.addTrace(rr_store_session);try{await this.sendApproveSession({sessionTopic:I,proposal:d,pairingProposalResponse:{relay:{protocol:a??"irn"},responderPublicKey:b},sessionSettleRequest:T,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:n}}}),_.addTrace(rr_session_approve_publish_success)}catch(N){throw this.client.logger.error(N),this.client.session.delete(I,(0,utils_dist_index_es.Hjj)("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(I),N}return this.client.core.eventClient.deleteEvent({eventId:_.eventId}),await this.client.core.pairing.updateMetadata({topic:y,metadata:w.metadata}),await this.deleteProposal(n),await this.client.core.pairing.activate({topic:y}),await this.setExpiry(I,(0,utils_dist_index_es.Xw0)(B)),{topic:I,acknowledged:()=>Promise.resolve(this.client.session.get(I))}}),dist_index_es_c(this,"reject",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(t)}catch(r){throw this.client.logger.error("reject() -> isValidReject() failed"),r}const{id:e,reason:s}=t;let i;try{i=this.client.proposal.get(e).pairingTopic}catch(r){throw this.client.logger.error(`reject() -> proposal.get(${e}) failed`),r}i&&await this.sendError({id:e,topic:i,error:s,rpcOpts:dist_index_es_P.wc_sessionPropose.reject}),await this.deleteProposal(e)}),dist_index_es_c(this,"update",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(t)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:e,namespaces:s}=t,{done:i,resolve:r,reject:n}=(0,utils_dist_index_es.Wx8)(),a=payloadId(),l=getBigIntRpcId().toString(),p=this.client.session.get(e).namespaces;return this.events.once((0,utils_dist_index_es.hEn)("session_update",a),({error:h})=>{h?n(h):r()}),await this.client.session.update(e,{namespaces:s}),await this.sendRequest({topic:e,method:"wc_sessionUpdate",params:{namespaces:s},throwOnFailedPublish:!0,clientRpcId:a,relayRpcId:l}).catch(h=>{this.client.logger.error(h),this.client.session.update(e,{namespaces:p}),n(h)}),{acknowledged:i}}),dist_index_es_c(this,"extend",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(t)}catch(a){throw this.client.logger.error("extend() -> isValidExtend() failed"),a}const{topic:e}=t,s=payloadId(),{done:i,resolve:r,reject:n}=(0,utils_dist_index_es.Wx8)();return this.events.once((0,utils_dist_index_es.hEn)("session_extend",s),({error:a})=>{a?n(a):r()}),await this.setExpiry(e,(0,utils_dist_index_es.Xw0)(B)),this.sendRequest({topic:e,method:"wc_sessionExtend",params:{},clientRpcId:s,throwOnFailedPublish:!0}).catch(a=>{n(a)}),{acknowledged:i}}),dist_index_es_c(this,"request",async t=>{this.isInitialized();try{await this.isValidRequest(t)}catch(m){throw this.client.logger.error("request() -> isValidRequest() failed"),m}const{chainId:e,request:s,topic:i,expiry:r=dist_index_es_P.wc_sessionRequest.req.ttl}=t,n=this.client.session.get(i);n?.transportType===ee.relay&&await this.confirmOnlineStateOrThrow();const a=payloadId(),l=getBigIntRpcId().toString(),{done:p,resolve:h,reject:u}=(0,utils_dist_index_es.Wx8)(r,"Request expired. Please try again.");this.events.once((0,utils_dist_index_es.hEn)("session_request",a),({error:m,result:S})=>{m?u(m):h(S)});const d="wc_sessionRequest",y=this.getAppLinkIfEnabled(n.peer.metadata,n.transportType);if(y)return await this.sendRequest({clientRpcId:a,relayRpcId:l,topic:i,method:d,params:{request:dist_index_es_O(dist_index_es_R({},s),{expiryTimestamp:(0,utils_dist_index_es.Xw0)(r)}),chainId:e},expiry:r,throwOnFailedPublish:!0,appLink:y}).catch(m=>u(m)),this.client.events.emit("session_request_sent",{topic:i,request:s,chainId:e,id:a}),await p();const w={request:dist_index_es_O(dist_index_es_R({},s),{expiryTimestamp:(0,utils_dist_index_es.Xw0)(r)}),chainId:e};return await Promise.all([new Promise(async m=>{await this.sendRequest({clientRpcId:a,relayRpcId:l,topic:i,method:d,params:w,expiry:r,throwOnFailedPublish:!0,tvf:this.getTVFParams(a,w)}).catch(S=>u(S)),this.client.events.emit("session_request_sent",{topic:i,request:s,chainId:e,id:a}),m()}),new Promise(async m=>{var S;if(null==(S=n.sessionConfig)||!S.disableDeepLink){const _=await(0,utils_dist_index_es.jTh)(this.client.core.storage,Le);await(0,utils_dist_index_es.n3s)({id:a,topic:i,wcDeepLink:_})}m()}),p()]).then(m=>m[2])}),dist_index_es_c(this,"respond",async t=>{this.isInitialized(),await this.isValidRespond(t);const{topic:e,response:s}=t,{id:i}=s,r=this.client.session.get(e);r.transportType===ee.relay&&await this.confirmOnlineStateOrThrow();const n=this.getAppLinkIfEnabled(r.peer.metadata,r.transportType);isJsonRpcResult(s)?await this.sendResult({id:i,topic:e,result:s.result,throwOnFailedPublish:!0,appLink:n}):isJsonRpcError(s)&&await this.sendError({id:i,topic:e,error:s.error,appLink:n}),this.cleanupAfterResponse(t)}),dist_index_es_c(this,"ping",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(t)}catch(s){throw this.client.logger.error("ping() -> isValidPing() failed"),s}const{topic:e}=t;if(this.client.session.keys.includes(e)){const s=payloadId(),i=getBigIntRpcId().toString(),{done:r,resolve:n,reject:a}=(0,utils_dist_index_es.Wx8)();this.events.once((0,utils_dist_index_es.hEn)("session_ping",s),({error:l})=>{l?a(l):n()}),await Promise.all([this.sendRequest({topic:e,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:s,relayRpcId:i}),r()])}else this.client.core.pairing.pairings.keys.includes(e)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:e}))}),dist_index_es_c(this,"emit",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(t);const{topic:e,event:s,chainId:i}=t,r=getBigIntRpcId().toString(),n=payloadId();await this.sendRequest({topic:e,method:"wc_sessionEvent",params:{event:s,chainId:i},throwOnFailedPublish:!0,relayRpcId:r,clientRpcId:n})}),dist_index_es_c(this,"disconnect",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(t);const{topic:e}=t;if(this.client.session.keys.includes(e))await this.sendRequest({topic:e,method:"wc_sessionDelete",params:(0,utils_dist_index_es.Hjj)("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:e,emitEvent:!1});else{if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:s}=(0,utils_dist_index_es.GuA)("MISMATCHED_TOPIC",`Session or pairing topic not found: ${e}`);throw new Error(s)}await this.client.core.pairing.disconnect({topic:e})}}),dist_index_es_c(this,"find",t=>(this.isInitialized(),this.client.session.getAll().filter(e=>(0,utils_dist_index_es.HNf)(e,t)))),dist_index_es_c(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),dist_index_es_c(this,"authenticate",async(t,e)=>{var s;this.isInitialized(),this.isValidAuthenticate(t);const i=e&&this.client.core.linkModeSupportedApps.includes(e)&&(null==(s=this.client.metadata.redirect)?void 0:s.linkMode),r=i?ee.link_mode:ee.relay;r===ee.relay&&await this.confirmOnlineStateOrThrow();const{chains:n,statement:a="",uri:l,domain:p,nonce:h,type:u,exp:d,nbf:y,methods:w=[],expiry:m}=t,S=[...t.resources||[]],{topic:_,uri:b}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:r});this.client.logger.info({message:"Generated new pairing",pairing:{topic:_,uri:b}});const C=await this.client.core.crypto.generateKeyPair(),I=(0,utils_dist_index_es.EN$)(C);if(await Promise.all([this.client.auth.authKeys.set(index_es_pe,{responseTopic:I,publicKey:C}),this.client.auth.pairingTopics.set(I,{topic:I,pairingTopic:_})]),await this.client.core.relayer.subscribe(I,{transportType:r}),this.client.logger.info(`sending request to new pairing topic: ${_}`),w.length>0){const{namespace:A}=(0,utils_dist_index_es._Yb)(n[0]);let k=(0,utils_dist_index_es.e8_)(A,"request",w);(0,utils_dist_index_es.VBM)(S)&&(k=(0,utils_dist_index_es.hVC)(k,S.pop())),S.push(k)}const T=m&&m>dist_index_es_P.wc_sessionAuthenticate.req.ttl?m:dist_index_es_P.wc_sessionAuthenticate.req.ttl,$={authPayload:{type:u??"caip122",chains:n,statement:a,aud:l,domain:p,version:"1",nonce:h,iat:(new Date).toISOString(),exp:d,nbf:y,resources:S},requester:{publicKey:C,metadata:this.client.metadata},expiryTimestamp:(0,utils_dist_index_es.Xw0)(T)},N={requiredNamespaces:{},optionalNamespaces:{eip155:{chains:n,methods:[...new Set(["personal_sign",...w])],events:["chainChanged","accountsChanged"]}},relays:[{protocol:"irn"}],pairingTopic:_,proposer:{publicKey:C,metadata:this.client.metadata},expiryTimestamp:(0,utils_dist_index_es.Xw0)(dist_index_es_P.wc_sessionPropose.req.ttl),id:payloadId()},{done:Tt,resolve:Ue,reject:Se}=(0,utils_dist_index_es.Wx8)(T,"Request expired"),se=payloadId(),he=(0,utils_dist_index_es.hEn)("session_connect",N.id),Re=(0,utils_dist_index_es.hEn)("session_request",se),de=async({error:A,session:k})=>{this.events.off(Re,ve),A?Se(A):k&&Ue({session:k})},ve=async A=>{var k,Ge,je;if(await this.deletePendingAuthRequest(se,{message:"fulfilled",code:0}),A.error){const re=(0,utils_dist_index_es.Hjj)("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return A.error.code===re.code?void 0:(this.events.off(he,de),Se(A.error.message))}await this.deleteProposal(N.id),this.events.off(he,de);const{cacaos:Fe,responder:H}=A.result,Te=[],Qe=[];for(const re of Fe){await(0,utils_dist_index_es.IjX)({cacao:re,projectId:this.client.core.projectId})||(this.client.logger.error(re,"Signature verification failed"),Se((0,utils_dist_index_es.Hjj)("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:qe}=re,Pe=(0,utils_dist_index_es.VBM)(qe.resources),He=[(0,utils_dist_index_es.xkc)(qe.iss)],qt=(0,utils_dist_index_es.q_h)(qe.iss);if(Pe){const Ne=(0,utils_dist_index_es.sc_)(Pe),Pt=(0,utils_dist_index_es.WWN)(Pe);Te.push(...Ne),He.push(...Pt)}for(const Ne of He)Qe.push(`${Ne}:${qt}`)}const ie=await this.client.core.crypto.generateSharedKey(C,H.publicKey);let ue;Te.length>0&&(ue={topic:ie,acknowledged:!0,self:{publicKey:C,metadata:this.client.metadata},peer:H,controller:H.publicKey,expiry:(0,utils_dist_index_es.Xw0)(B),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:_,namespaces:(0,utils_dist_index_es.Van)([...new Set(Te)],[...new Set(Qe)]),transportType:r},await this.client.core.relayer.subscribe(ie,{transportType:r}),await this.client.session.set(ie,ue),_&&await this.client.core.pairing.updateMetadata({topic:_,metadata:H.metadata}),ue=this.client.session.get(ie)),null!=(k=this.client.metadata.redirect)&&k.linkMode&&null!=(Ge=H.metadata.redirect)&&Ge.linkMode&&null!=(je=H.metadata.redirect)&&je.universal&&e&&(this.client.core.addLinkModeSupportedApp(H.metadata.redirect.universal),this.client.session.update(ie,{transportType:ee.link_mode})),Ue({auths:Fe,session:ue})};let Ie;this.events.once(he,de),this.events.once(Re,ve);try{if(i){const A=formatJsonRpcRequest("wc_sessionAuthenticate",$,se);this.client.core.history.set(_,A);const k=await this.client.core.crypto.encode("",A,{type:utils_dist_index_es.EHS,encoding:utils_dist_index_es.Pa8});Ie=(0,utils_dist_index_es.$Bq)(e,_,k)}else await Promise.all([this.sendRequest({topic:_,method:"wc_sessionAuthenticate",params:$,expiry:t.expiry,throwOnFailedPublish:!0,clientRpcId:se}),this.sendRequest({topic:_,method:"wc_sessionPropose",params:N,expiry:dist_index_es_P.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:N.id})])}catch(A){throw this.events.off(he,de),this.events.off(Re,ve),A}return await this.setProposal(N.id,N),await this.setAuthRequest(se,{request:dist_index_es_O(dist_index_es_R({},$),{verifyContext:{}}),pairingTopic:_,transportType:r}),{uri:Ie??b,response:Tt}}),dist_index_es_c(this,"approveSessionAuthenticate",async t=>{const{id:e,auths:s}=t,i=this.client.core.eventClient.createEvent({properties:{topic:e.toString(),trace:[or_authenticated_session_approve_started]}});try{this.isInitialized()}catch(m){throw i.setError(ar_no_internet_connection),m}const r=this.getPendingAuthRequest(e);if(!r)throw i.setError(ar_authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${e}`);const n=r.transportType||ee.relay;n===ee.relay&&await this.confirmOnlineStateOrThrow();const a=r.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),p=(0,utils_dist_index_es.EN$)(a),h={type:utils_dist_index_es.Lp_,receiverPublicKey:a,senderPublicKey:l},u=[],d=[];for(const m of s){if(!await(0,utils_dist_index_es.IjX)({cacao:m,projectId:this.client.core.projectId})){i.setError(ar_invalid_cacao);const I=(0,utils_dist_index_es.Hjj)("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:e,topic:p,error:I,encodeOpts:h}),new Error(I.message)}i.addTrace(or_cacaos_verified);const{p:S}=m,_=(0,utils_dist_index_es.VBM)(S.resources),b=[(0,utils_dist_index_es.xkc)(S.iss)],C=(0,utils_dist_index_es.q_h)(S.iss);if(_){const I=(0,utils_dist_index_es.sc_)(_),T=(0,utils_dist_index_es.WWN)(_);u.push(...I),b.push(...T)}for(const I of b)d.push(`${I}:${C}`)}const y=await this.client.core.crypto.generateSharedKey(l,a);let w;if(i.addTrace(or_create_authenticated_session_topic),u?.length>0){w={topic:y,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:a,metadata:r.requester.metadata},controller:a,expiry:(0,utils_dist_index_es.Xw0)(B),authentication:s,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:r.pairingTopic,namespaces:(0,utils_dist_index_es.Van)([...new Set(u)],[...new Set(d)]),transportType:n},i.addTrace(or_subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(y,{transportType:n})}catch(m){throw i.setError(ar_subscribe_authenticated_session_topic_failure),m}i.addTrace(or_subscribe_authenticated_session_topic_success),await this.client.session.set(y,w),i.addTrace(or_store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:r.pairingTopic,metadata:r.requester.metadata})}i.addTrace(or_publishing_authenticated_session_approve);try{await this.sendResult({topic:p,id:e,result:{cacaos:s,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(r.requester.metadata,n)})}catch(m){throw i.setError(ar_authenticated_session_approve_publish_failure),m}return await this.client.auth.requests.delete(e,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:r.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:i.eventId}),{session:w}}),dist_index_es_c(this,"rejectSessionAuthenticate",async t=>{this.isInitialized();const{id:e,reason:s}=t,i=this.getPendingAuthRequest(e);if(!i)throw new Error(`Could not find pending auth request with id ${e}`);i.transportType===ee.relay&&await this.confirmOnlineStateOrThrow();const r=i.requester.publicKey,n=await this.client.core.crypto.generateKeyPair(),a=(0,utils_dist_index_es.EN$)(r),l={type:utils_dist_index_es.Lp_,receiverPublicKey:r,senderPublicKey:n};await this.sendError({id:e,topic:a,error:s,encodeOpts:l,rpcOpts:dist_index_es_P.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(i.requester.metadata,i.transportType)}),await this.client.auth.requests.delete(e,{message:"rejected",code:0}),await this.deleteProposal(e)}),dist_index_es_c(this,"formatAuthMessage",t=>{this.isInitialized();const{request:e,iss:s}=t;return(0,utils_dist_index_es.hwK)(e,s)}),dist_index_es_c(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(0!==this.relayMessageCache.length)for(;this.relayMessageCache.length>0;)try{const t=this.relayMessageCache.shift();t&&await this.onRelayMessage(t)}catch(t){this.client.logger.error(t)}},50)}),dist_index_es_c(this,"cleanupDuplicatePairings",async t=>{if(t.pairingTopic)try{const e=this.client.core.pairing.pairings.get(t.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(i=>{var r,n;return(null==(r=i.peerMetadata)?void 0:r.url)&&(null==(n=i.peerMetadata)?void 0:n.url)===t.peer.metadata.url&&i.topic&&i.topic!==e.topic});if(0===s.length)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(i=>this.client.core.pairing.disconnect({topic:i.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(e){this.client.logger.error(e)}}),dist_index_es_c(this,"deleteSession",async t=>{var e;const{topic:s,expirerHasDeleted:i=!1,emitEvent:r=!0,id:n=0}=t,{self:a}=this.client.session.get(s);await this.client.core.relayer.unsubscribe(s),await this.client.session.delete(s,(0,utils_dist_index_es.Hjj)("USER_DISCONNECTED")),this.addToRecentlyDeleted(s,"session"),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(s)&&await this.client.core.crypto.deleteSymKey(s),i||this.client.core.expirer.del(s),this.client.core.storage.removeItem(Le).catch(l=>this.client.logger.warn(l)),this.getPendingSessionRequests().forEach(l=>{l.topic===s&&this.deletePendingSessionRequest(l.id,(0,utils_dist_index_es.Hjj)("USER_DISCONNECTED"))}),s===(null==(e=this.sessionRequestQueue.queue[0])?void 0:e.topic)&&(this.sessionRequestQueue.state=dist_index_es_M_idle),r&&this.client.events.emit("session_delete",{id:n,topic:s})}),dist_index_es_c(this,"deleteProposal",async(t,e)=>{if(e)try{const s=this.client.proposal.get(t),i=this.client.core.eventClient.getEvent({topic:s.pairingTopic});i?.setError(nr_proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(t,(0,utils_dist_index_es.Hjj)("USER_DISCONNECTED")),e?Promise.resolve():this.client.core.expirer.del(t)]),this.addToRecentlyDeleted(t,"proposal")}),dist_index_es_c(this,"deletePendingSessionRequest",async(t,e,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,e),s?Promise.resolve():this.client.core.expirer.del(t)]),this.addToRecentlyDeleted(t,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(i=>i.id!==t),s&&(this.sessionRequestQueue.state=dist_index_es_M_idle,this.client.events.emit("session_request_expire",{id:t}))}),dist_index_es_c(this,"deletePendingAuthRequest",async(t,e,s=!1)=>{await Promise.all([this.client.auth.requests.delete(t,e),s?Promise.resolve():this.client.core.expirer.del(t)])}),dist_index_es_c(this,"setExpiry",async(t,e)=>{this.client.session.keys.includes(t)&&(this.client.core.expirer.set(t,e),await this.client.session.update(t,{expiry:e}))}),dist_index_es_c(this,"setProposal",async(t,e)=>{this.client.core.expirer.set(t,(0,utils_dist_index_es.Xw0)(dist_index_es_P.wc_sessionPropose.req.ttl)),await this.client.proposal.set(t,e)}),dist_index_es_c(this,"setAuthRequest",async(t,e)=>{const{request:s,pairingTopic:i,transportType:r=ee.relay}=e;this.client.core.expirer.set(t,s.expiryTimestamp),await this.client.auth.requests.set(t,{authPayload:s.authPayload,requester:s.requester,expiryTimestamp:s.expiryTimestamp,id:t,pairingTopic:i,verifyContext:s.verifyContext,transportType:r})}),dist_index_es_c(this,"setPendingSessionRequest",async t=>{const{id:e,topic:s,params:i,verifyContext:r}=t,n=i.request.expiryTimestamp||(0,utils_dist_index_es.Xw0)(dist_index_es_P.wc_sessionRequest.req.ttl);this.client.core.expirer.set(e,n),await this.client.pendingRequest.set(e,{id:e,topic:s,params:i,verifyContext:r})}),dist_index_es_c(this,"sendRequest",async t=>{const{topic:e,method:s,params:i,expiry:r,relayRpcId:n,clientRpcId:a,throwOnFailedPublish:l,appLink:p,tvf:h,publishOpts:u={}}=t,d=formatJsonRpcRequest(s,i,a);let y;const w=!!p;try{const _=w?utils_dist_index_es.Pa8:utils_dist_index_es.EWt;y=await this.client.core.crypto.encode(e,d,{encoding:_})}catch(_){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${e} failed`),_}let m;if(mt.includes(s)){const _=(0,utils_dist_index_es.ALl)(JSON.stringify(d)),b=(0,utils_dist_index_es.ALl)(y);m=await this.client.core.verify.register({id:b,decryptedId:_})}const S=dist_index_es_R(dist_index_es_R({},dist_index_es_P[s].req),u);if(S.attestation=m,r&&(S.ttl=r),n&&(S.id=n),this.client.core.history.set(e,d),w){const _=(0,utils_dist_index_es.$Bq)(p,e,y);await __webpack_require__.g.Linking.openURL(_,this.client.name)}else S.tvf=dist_index_es_O(dist_index_es_R({},h),{correlationId:d.id}),l?(S.internal=dist_index_es_O(dist_index_es_R({},S.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(e,y,S)):this.client.core.relayer.publish(e,y,S).catch(_=>this.client.logger.error(_));return d.id}),dist_index_es_c(this,"sendProposeSession",async t=>{const{proposal:e,publishOpts:s}=t,i=formatJsonRpcRequest("wc_sessionPropose",e,e.id);this.client.core.history.set(e.pairingTopic,i);const r=await this.client.core.crypto.encode(e.pairingTopic,i,{encoding:utils_dist_index_es.EWt}),n=(0,utils_dist_index_es.ALl)(JSON.stringify(i)),a=(0,utils_dist_index_es.ALl)(r),l=await this.client.core.verify.register({id:a,decryptedId:n});await this.client.core.relayer.publishCustom({payload:{pairingTopic:e.pairingTopic,sessionProposal:r},opts:dist_index_es_O(dist_index_es_R({},s),{publishMethod:"wc_proposeSession",attestation:l})})}),dist_index_es_c(this,"sendApproveSession",async t=>{const{sessionTopic:e,pairingProposalResponse:s,proposal:i,sessionSettleRequest:r,publishOpts:n}=t,a=formatJsonRpcResult(i.id,s),l=await this.client.core.crypto.encode(i.pairingTopic,a,{encoding:utils_dist_index_es.EWt}),p=formatJsonRpcRequest("wc_sessionSettle",r,n?.id),h=await this.client.core.crypto.encode(e,p,{encoding:utils_dist_index_es.EWt});this.client.core.history.set(e,p),await this.client.core.relayer.publishCustom({payload:{sessionTopic:e,pairingTopic:i.pairingTopic,sessionProposalResponse:l,sessionSettlementRequest:h},opts:dist_index_es_O(dist_index_es_R({},n),{publishMethod:"wc_approveSession"})})}),dist_index_es_c(this,"sendResult",async t=>{const{id:e,topic:s,result:i,throwOnFailedPublish:r,encodeOpts:n,appLink:a}=t,l=formatJsonRpcResult(e,i);let p;const h=a&&typeof(null==__webpack_require__.g?void 0:__webpack_require__.g.Linking)<"u";try{const y=h?utils_dist_index_es.Pa8:utils_dist_index_es.EWt;p=await this.client.core.crypto.encode(s,l,dist_index_es_O(dist_index_es_R({},n||{}),{encoding:y}))}catch(y){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${s} failed`),y}let u,d;try{u=await this.client.core.history.get(s,e);const y=u.request;try{d=this.getTVFParams(e,y.params,i)}catch(w){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${w?.message}`)}}catch(y){throw this.client.logger.error(`sendResult() -> history.get(${s}, ${e}) failed`),y}if(h){const y=(0,utils_dist_index_es.$Bq)(a,s,p);await __webpack_require__.g.Linking.openURL(y,this.client.name)}else{const y=u.request.method,w=dist_index_es_P[y].res;w.tvf=dist_index_es_O(dist_index_es_R({},d),{correlationId:e}),r?(w.internal=dist_index_es_O(dist_index_es_R({},w.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,p,w)):this.client.core.relayer.publish(s,p,w).catch(m=>this.client.logger.error(m))}await this.client.core.history.resolve(l)}),dist_index_es_c(this,"sendError",async t=>{const{id:e,topic:s,error:i,encodeOpts:r,rpcOpts:n,appLink:a}=t,l=formatJsonRpcError(e,i);let p;const h=a&&typeof(null==__webpack_require__.g?void 0:__webpack_require__.g.Linking)<"u";try{const d=h?utils_dist_index_es.Pa8:utils_dist_index_es.EWt;p=await this.client.core.crypto.encode(s,l,dist_index_es_O(dist_index_es_R({},r||{}),{encoding:d}))}catch(d){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${s} failed`),d}let u;try{u=await this.client.core.history.get(s,e)}catch(d){throw this.client.logger.error(`sendError() -> history.get(${s}, ${e}) failed`),d}if(h){const d=(0,utils_dist_index_es.$Bq)(a,s,p);await __webpack_require__.g.Linking.openURL(d,this.client.name)}else{const d=u.request.method,y=n||dist_index_es_P[d].res;this.client.core.relayer.publish(s,p,y)}await this.client.core.history.resolve(l)}),dist_index_es_c(this,"cleanup",async()=>{const t=[],e=[];this.client.session.getAll().forEach(s=>{let i=!1;(0,utils_dist_index_es._dF)(s.expiry)&&(i=!0),this.client.core.crypto.keychain.has(s.topic)||(i=!0),i&&t.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{(0,utils_dist_index_es._dF)(s.expiryTimestamp)&&e.push(s.id)}),await Promise.all([...t.map(s=>this.deleteSession({topic:s})),...e.map(s=>this.deleteProposal(s))])}),dist_index_es_c(this,"onProviderMessageEvent",async t=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(t):await this.onRelayMessage(t)}),dist_index_es_c(this,"onRelayEventRequest",async t=>{this.requestQueue.queue.push(t),await this.processRequestsQueue()}),dist_index_es_c(this,"processRequestsQueue",async()=>{if(this.requestQueue.state!==dist_index_es_M_active){for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=dist_index_es_M_active;const t=this.requestQueue.queue.shift();if(t)try{await this.processRequest(t)}catch(e){this.client.logger.warn(e)}}this.requestQueue.state=dist_index_es_M_idle}else this.client.logger.info("Request queue already active, skipping...")}),dist_index_es_c(this,"processRequest",async t=>{const{topic:e,payload:s,attestation:i,transportType:r,encryptedId:n}=t,a=s.method;if(!this.shouldIgnorePairingRequest({topic:e,requestMethod:a}))switch(a){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:e,payload:s,attestation:i,encryptedId:n});case"wc_sessionSettle":return await this.onSessionSettleRequest(e,s);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(e,s);case"wc_sessionExtend":return await this.onSessionExtendRequest(e,s);case"wc_sessionPing":return await this.onSessionPingRequest(e,s);case"wc_sessionDelete":return await this.onSessionDeleteRequest(e,s);case"wc_sessionRequest":return await this.onSessionRequest({topic:e,payload:s,attestation:i,encryptedId:n,transportType:r});case"wc_sessionEvent":return await this.onSessionEventRequest(e,s);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:e,payload:s,attestation:i,encryptedId:n,transportType:r});default:return this.client.logger.info(`Unsupported request method ${a}`)}}),dist_index_es_c(this,"onRelayEventResponse",async t=>{const{topic:e,payload:s,transportType:i}=t,r=(await this.client.core.history.get(e,s.id)).request.method;switch(r){case"wc_sessionPropose":return this.onSessionProposeResponse(e,s,i);case"wc_sessionSettle":return this.onSessionSettleResponse(e,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(e,s);case"wc_sessionExtend":return this.onSessionExtendResponse(e,s);case"wc_sessionPing":return this.onSessionPingResponse(e,s);case"wc_sessionRequest":return this.onSessionRequestResponse(e,s);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(e,s);default:return this.client.logger.info(`Unsupported response method ${r}`)}}),dist_index_es_c(this,"onRelayEventUnknownPayload",t=>{const{topic:e}=t,{message:s}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`Decoded payload on topic ${e} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)}),dist_index_es_c(this,"shouldIgnorePairingRequest",t=>{const{topic:e,requestMethod:s}=t,i=this.expectedPairingMethodMap.get(e);return!(!i||i.includes(s))&&!!(i.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),dist_index_es_c(this,"onSessionProposeRequest",async t=>{const{topic:e,payload:s,attestation:i,encryptedId:r}=t,{params:n,id:a}=s;try{const l=this.client.core.eventClient.getEvent({topic:e});0===this.client.events.listenerCount("session_proposal")&&(dist_index_es_console.warn("No listener for session_proposal event"),l?.setError(X_proposal_listener_not_found)),this.isValidConnect(dist_index_es_R({},s.params));const p=n.expiryTimestamp||(0,utils_dist_index_es.Xw0)(dist_index_es_P.wc_sessionPropose.req.ttl),h=dist_index_es_R({id:a,pairingTopic:e,expiryTimestamp:p,attestation:i,encryptedId:r},n);await this.setProposal(a,h);const u=await this.getVerifyContext({attestationId:i,hash:(0,utils_dist_index_es.ALl)(JSON.stringify(s)),encryptedId:r,metadata:h.proposer.metadata});l?.addTrace(Y_emit_session_proposal),this.client.events.emit("session_proposal",{id:a,params:h,verifyContext:u})}catch(l){await this.sendError({id:a,topic:e,error:l,rpcOpts:dist_index_es_P.wc_sessionPropose.autoReject}),this.client.logger.error(l)}}),dist_index_es_c(this,"onSessionProposeResponse",async(t,e,s)=>{const{id:i}=e;if(isJsonRpcResult(e)){const{result:r}=e;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:r});const n=this.client.proposal.get(i);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:n});const a=n.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:a});const l=r.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const p=await this.client.core.crypto.generateSharedKey(a,l);this.pendingSessions.set(i,{sessionTopic:p,pairingTopic:t,proposalId:i,publicKey:a});const h=await this.client.core.relayer.subscribe(p,{transportType:s});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:t})}else if(isJsonRpcError(e)){await this.deleteProposal(i);const r=(0,utils_dist_index_es.hEn)("session_connect",i);if(0===this.events.listenerCount(r))throw new Error(`emitting ${r} without any listeners, 954`);this.events.emit(r,{error:e.error})}}),dist_index_es_c(this,"onSessionSettleRequest",async(t,e)=>{const{id:s,params:i}=e;try{this.isValidSessionSettleRequest(i);const{relay:r,controller:n,expiry:a,namespaces:l,sessionProperties:p,scopedProperties:h,sessionConfig:u}=e.params,d=[...this.pendingSessions.values()].find(m=>m.sessionTopic===t);if(!d)return this.client.logger.error(`Pending session not found for topic ${t}`);const y=this.client.proposal.get(d.proposalId),w=dist_index_es_O(dist_index_es_R(dist_index_es_R(dist_index_es_R({topic:t,relay:r,expiry:a,namespaces:l,acknowledged:!0,pairingTopic:d.pairingTopic,requiredNamespaces:y.requiredNamespaces,optionalNamespaces:y.optionalNamespaces,controller:n.publicKey,self:{publicKey:d.publicKey,metadata:this.client.metadata},peer:{publicKey:n.publicKey,metadata:n.metadata}},p&&{sessionProperties:p}),h&&{scopedProperties:h}),u&&{sessionConfig:u}),{transportType:ee.relay});await this.client.session.set(w.topic,w),await this.setExpiry(w.topic,w.expiry),await this.client.core.pairing.updateMetadata({topic:d.pairingTopic,metadata:w.peer.metadata}),this.client.events.emit("session_connect",{session:w}),this.events.emit((0,utils_dist_index_es.hEn)("session_connect",d.proposalId),{session:w}),this.pendingSessions.delete(d.proposalId),this.deleteProposal(d.proposalId,!1),this.cleanupDuplicatePairings(w),await this.sendResult({id:e.id,topic:t,result:!0})}catch(r){await this.sendError({id:s,topic:t,error:r}),this.client.logger.error(r)}}),dist_index_es_c(this,"onSessionSettleResponse",async(t,e)=>{const{id:s}=e;isJsonRpcResult(e)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit((0,utils_dist_index_es.hEn)("session_approve",s),{})):isJsonRpcError(e)&&(await this.client.session.delete(t,(0,utils_dist_index_es.Hjj)("USER_DISCONNECTED")),this.events.emit((0,utils_dist_index_es.hEn)("session_approve",s),{error:e.error}))}),dist_index_es_c(this,"onSessionUpdateRequest",async(t,e)=>{const{params:s,id:i}=e;try{const r=`${t}_session_update`,n=utils_dist_index_es.nyL.get(r);if(n&&this.isRequestOutOfSync(n,i))return this.client.logger.warn(`Discarding out of sync request - ${i}`),void this.sendError({id:i,topic:t,error:(0,utils_dist_index_es.Hjj)("INVALID_UPDATE_REQUEST")});this.isValidUpdate(dist_index_es_R({topic:t},s));try{utils_dist_index_es.nyL.set(r,i),await this.client.session.update(t,{namespaces:s.namespaces}),await this.sendResult({id:i,topic:t,result:!0})}catch(a){throw utils_dist_index_es.nyL.delete(r),a}this.client.events.emit("session_update",{id:i,topic:t,params:s})}catch(r){await this.sendError({id:i,topic:t,error:r}),this.client.logger.error(r)}}),dist_index_es_c(this,"isRequestOutOfSync",(t,e)=>e.toString().slice(0,-3)<t.toString().slice(0,-3)),dist_index_es_c(this,"onSessionUpdateResponse",(t,e)=>{const{id:s}=e,i=(0,utils_dist_index_es.hEn)("session_update",s);if(0===this.events.listenerCount(i))throw new Error(`emitting ${i} without any listeners`);isJsonRpcResult(e)?this.events.emit((0,utils_dist_index_es.hEn)("session_update",s),{}):isJsonRpcError(e)&&this.events.emit((0,utils_dist_index_es.hEn)("session_update",s),{error:e.error})}),dist_index_es_c(this,"onSessionExtendRequest",async(t,e)=>{const{id:s}=e;try{this.isValidExtend({topic:t}),await this.setExpiry(t,(0,utils_dist_index_es.Xw0)(B)),await this.sendResult({id:s,topic:t,result:!0}),this.client.events.emit("session_extend",{id:s,topic:t})}catch(i){await this.sendError({id:s,topic:t,error:i}),this.client.logger.error(i)}}),dist_index_es_c(this,"onSessionExtendResponse",(t,e)=>{const{id:s}=e,i=(0,utils_dist_index_es.hEn)("session_extend",s);if(0===this.events.listenerCount(i))throw new Error(`emitting ${i} without any listeners`);isJsonRpcResult(e)?this.events.emit((0,utils_dist_index_es.hEn)("session_extend",s),{}):isJsonRpcError(e)&&this.events.emit((0,utils_dist_index_es.hEn)("session_extend",s),{error:e.error})}),dist_index_es_c(this,"onSessionPingRequest",async(t,e)=>{const{id:s}=e;try{this.isValidPing({topic:t}),await this.sendResult({id:s,topic:t,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:s,topic:t})}catch(i){await this.sendError({id:s,topic:t,error:i}),this.client.logger.error(i)}}),dist_index_es_c(this,"onSessionPingResponse",(t,e)=>{const{id:s}=e,i=(0,utils_dist_index_es.hEn)("session_ping",s);setTimeout(()=>{if(0===this.events.listenerCount(i))throw new Error(`emitting ${i} without any listeners 2176`);isJsonRpcResult(e)?this.events.emit((0,utils_dist_index_es.hEn)("session_ping",s),{}):isJsonRpcError(e)&&this.events.emit((0,utils_dist_index_es.hEn)("session_ping",s),{error:e.error})},500)}),dist_index_es_c(this,"onSessionDeleteRequest",async(t,e)=>{const{id:s}=e;try{this.isValidDisconnect({topic:t,reason:e.params}),await Promise.all([new Promise(i=>{this.client.core.relayer.once(dist_index_es_C_publish,async()=>{i(await this.deleteSession({topic:t,id:s}))})}),this.sendResult({id:s,topic:t,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:t,error:(0,utils_dist_index_es.Hjj)("USER_DISCONNECTED")})]).catch(i=>this.client.logger.error(i))}catch(i){this.client.logger.error(i)}}),dist_index_es_c(this,"onSessionRequest",async t=>{var e,s,i;const{topic:r,payload:n,attestation:a,encryptedId:l,transportType:p}=t,{id:h,params:u}=n;try{await this.isValidRequest(dist_index_es_R({topic:r},u));const d=this.client.session.get(r),w={id:h,topic:r,params:u,verifyContext:await this.getVerifyContext({attestationId:a,hash:(0,utils_dist_index_es.ALl)(JSON.stringify(formatJsonRpcRequest("wc_sessionRequest",u,h))),encryptedId:l,metadata:d.peer.metadata,transportType:p})};await this.setPendingSessionRequest(w),p===ee.link_mode&&null!=(e=d.peer.metadata.redirect)&&e.universal&&this.client.core.addLinkModeSupportedApp(null==(s=d.peer.metadata.redirect)?void 0:s.universal),null!=(i=this.client.signConfig)&&i.disableRequestQueue?this.emitSessionRequest(w):(this.addSessionRequestToSessionRequestQueue(w),this.processSessionRequestQueue())}catch(d){await this.sendError({id:h,topic:r,error:d}),this.client.logger.error(d)}}),dist_index_es_c(this,"onSessionRequestResponse",(t,e)=>{const{id:s}=e,i=(0,utils_dist_index_es.hEn)("session_request",s);if(0===this.events.listenerCount(i))throw new Error(`emitting ${i} without any listeners`);isJsonRpcResult(e)?this.events.emit((0,utils_dist_index_es.hEn)("session_request",s),{result:e.result}):isJsonRpcError(e)&&this.events.emit((0,utils_dist_index_es.hEn)("session_request",s),{error:e.error})}),dist_index_es_c(this,"onSessionEventRequest",async(t,e)=>{const{id:s,params:i}=e;try{const r=`${t}_session_event_${i.event.name}`,n=utils_dist_index_es.nyL.get(r);if(n&&this.isRequestOutOfSync(n,s))return void this.client.logger.info(`Discarding out of sync request - ${s}`);this.isValidEmit(dist_index_es_R({topic:t},i)),this.client.events.emit("session_event",{id:s,topic:t,params:i}),utils_dist_index_es.nyL.set(r,s)}catch(r){await this.sendError({id:s,topic:t,error:r}),this.client.logger.error(r)}}),dist_index_es_c(this,"onSessionAuthenticateResponse",(t,e)=>{const{id:s}=e;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:t,payload:e}),isJsonRpcResult(e)?this.events.emit((0,utils_dist_index_es.hEn)("session_request",s),{result:e.result}):isJsonRpcError(e)&&this.events.emit((0,utils_dist_index_es.hEn)("session_request",s),{error:e.error})}),dist_index_es_c(this,"onSessionAuthenticateRequest",async t=>{var e;const{topic:s,payload:i,attestation:r,encryptedId:n,transportType:a}=t;try{const{requester:l,authPayload:p,expiryTimestamp:h}=i.params,u=await this.getVerifyContext({attestationId:r,hash:(0,utils_dist_index_es.ALl)(JSON.stringify(i)),encryptedId:n,metadata:l.metadata,transportType:a}),d={requester:l,pairingTopic:s,id:i.id,authPayload:p,verifyContext:u,expiryTimestamp:h};await this.setAuthRequest(i.id,{request:d,pairingTopic:s,transportType:a}),a===ee.link_mode&&null!=(e=l.metadata.redirect)&&e.universal&&this.client.core.addLinkModeSupportedApp(l.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:s,params:i.params,id:i.id,verifyContext:u})}catch(l){this.client.logger.error(l);const p=i.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),u=this.getAppLinkIfEnabled(i.params.requester.metadata,a),d={type:utils_dist_index_es.Lp_,receiverPublicKey:p,senderPublicKey:h};await this.sendError({id:i.id,topic:s,error:l,encodeOpts:d,rpcOpts:dist_index_es_P.wc_sessionAuthenticate.autoReject,appLink:u})}}),dist_index_es_c(this,"addSessionRequestToSessionRequestQueue",t=>{this.sessionRequestQueue.queue.push(t)}),dist_index_es_c(this,"cleanupAfterResponse",t=>{this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=dist_index_es_M_idle,this.processSessionRequestQueue()},(0,cjs.toMiliseconds)(this.requestQueueDelay))}),dist_index_es_c(this,"cleanupPendingSentRequestsForTopic",({topic:t,error:e})=>{const s=this.client.core.history.pending;s.length>0&&s.filter(i=>i.topic===t&&"wc_sessionRequest"===i.request.method).forEach(i=>{const r=i.request.id,n=(0,utils_dist_index_es.hEn)("session_request",r);if(0===this.events.listenerCount(n))throw new Error(`emitting ${n} without any listeners`);this.events.emit((0,utils_dist_index_es.hEn)("session_request",i.request.id),{error:e})})}),dist_index_es_c(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===dist_index_es_M_active)return void this.client.logger.info("session request queue is already active.");const t=this.sessionRequestQueue.queue[0];if(t)try{this.emitSessionRequest(t)}catch(e){this.client.logger.error(e)}else this.client.logger.info("session request queue is empty.")}),dist_index_es_c(this,"emitSessionRequest",t=>{this.emittedSessionRequests.has(t.id)?this.client.logger.warn({id:t.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${t.id}`):(this.sessionRequestQueue.state=dist_index_es_M_active,this.emittedSessionRequests.add(t.id),this.client.events.emit("session_request",t))}),dist_index_es_c(this,"onPairingCreated",t=>{if(t.methods&&this.expectedPairingMethodMap.set(t.topic,t.methods),t.active)return;const e=this.client.proposal.getAll().find(s=>s.pairingTopic===t.topic);e&&this.onSessionProposeRequest({topic:t.topic,payload:formatJsonRpcRequest("wc_sessionPropose",dist_index_es_O(dist_index_es_R({},e),{requiredNamespaces:e.requiredNamespaces,optionalNamespaces:e.optionalNamespaces,relays:e.relays,proposer:e.proposer,sessionProperties:e.sessionProperties,scopedProperties:e.scopedProperties}),e.id),attestation:e.attestation,encryptedId:e.encryptedId})}),dist_index_es_c(this,"isValidConnect",async t=>{if(!(0,utils_dist_index_es.TeY)(t)){const{message:l}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(l)}const{pairingTopic:e,requiredNamespaces:s,optionalNamespaces:i,sessionProperties:r,scopedProperties:n,relays:a}=t;if((0,utils_dist_index_es.b07)(e)||await this.isValidPairingTopic(e),!(0,utils_dist_index_es.V9G)(a,!0)){const{message:l}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`connect() relays: ${a}`);throw new Error(l)}if(!(0,utils_dist_index_es.b07)(s)&&0!==(0,utils_dist_index_es.aF0)(s)){const l="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?dist_index_es_console.warn(l):this.client.logger.warn(l),this.validateNamespaces(s,"requiredNamespaces")}if(!(0,utils_dist_index_es.b07)(i)&&0!==(0,utils_dist_index_es.aF0)(i)&&this.validateNamespaces(i,"optionalNamespaces"),(0,utils_dist_index_es.b07)(r)||this.validateSessionProps(r,"sessionProperties"),!(0,utils_dist_index_es.b07)(n)){this.validateSessionProps(n,"scopedProperties");const l=Object.keys(s||{}).concat(Object.keys(i||{}));if(!Object.keys(n).every(p=>l.includes(p.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(n)}, required/optional namespaces: ${JSON.stringify(l)}`)}}),dist_index_es_c(this,"validateNamespaces",(t,e)=>{const s=(0,utils_dist_index_es.esh)(t,"connect()",e);if(s)throw new Error(s.message)}),dist_index_es_c(this,"isValidApprove",async t=>{if(!(0,utils_dist_index_es.TeY)(t))throw new Error((0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:e,namespaces:s,relayProtocol:i,sessionProperties:r,scopedProperties:n}=t;this.checkRecentlyDeleted(e),await this.isValidProposalId(e);const a=this.client.proposal.get(e),l=(0,utils_dist_index_es.FiO)(s,"approve()");if(l)throw new Error(l.message);const p=(0,utils_dist_index_es.XqR)(a.requiredNamespaces,s,"approve()");if(p)throw new Error(p.message);if(!(0,utils_dist_index_es.Qhg)(i,!0)){const{message:h}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`approve() relayProtocol: ${i}`);throw new Error(h)}if((0,utils_dist_index_es.b07)(r)||this.validateSessionProps(r,"sessionProperties"),!(0,utils_dist_index_es.b07)(n)){this.validateSessionProps(n,"scopedProperties");const h=new Set(Object.keys(s));if(!Object.keys(n).every(u=>h.has(u.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(n)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),dist_index_es_c(this,"isValidReject",async t=>{if(!(0,utils_dist_index_es.TeY)(t)){const{message:i}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(i)}const{id:e,reason:s}=t;if(this.checkRecentlyDeleted(e),await this.isValidProposalId(e),!(0,utils_dist_index_es.X3c)(s)){const{message:i}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(i)}}),dist_index_es_c(this,"isValidSessionSettleRequest",t=>{if(!(0,utils_dist_index_es.TeY)(t)){const{message:l}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(l)}const{relay:e,controller:s,namespaces:i,expiry:r}=t;if(!(0,utils_dist_index_es.kuU)(e)){const{message:l}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const n=(0,utils_dist_index_es.tk0)(s,"onSessionSettleRequest()");if(n)throw new Error(n.message);const a=(0,utils_dist_index_es.FiO)(i,"onSessionSettleRequest()");if(a)throw new Error(a.message);if((0,utils_dist_index_es._dF)(r)){const{message:l}=(0,utils_dist_index_es.GuA)("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),dist_index_es_c(this,"isValidUpdate",async t=>{if(!(0,utils_dist_index_es.TeY)(t)){const{message:a}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(a)}const{topic:e,namespaces:s}=t;this.checkRecentlyDeleted(e),await this.isValidSessionTopic(e);const i=this.client.session.get(e),r=(0,utils_dist_index_es.FiO)(s,"update()");if(r)throw new Error(r.message);const n=(0,utils_dist_index_es.XqR)(i.requiredNamespaces,s,"update()");if(n)throw new Error(n.message)}),dist_index_es_c(this,"isValidExtend",async t=>{if(!(0,utils_dist_index_es.TeY)(t)){const{message:s}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(s)}const{topic:e}=t;this.checkRecentlyDeleted(e),await this.isValidSessionTopic(e)}),dist_index_es_c(this,"isValidRequest",async t=>{if(!(0,utils_dist_index_es.TeY)(t)){const{message:a}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(a)}const{topic:e,request:s,chainId:i,expiry:r}=t;this.checkRecentlyDeleted(e),await this.isValidSessionTopic(e);const{namespaces:n}=this.client.session.get(e);if(!(0,utils_dist_index_es.tLy)(n,i)){const{message:a}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`request() chainId: ${i}`);throw new Error(a)}if(!(0,utils_dist_index_es.iV1)(s)){const{message:a}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(a)}if(!(0,utils_dist_index_es.oKp)(n,i,s.method)){const{message:a}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(a)}if(r&&!(0,utils_dist_index_es.Hbs)(r,_e)){const{message:a}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`request() expiry: ${r}. Expiry must be a number (in seconds) between ${_e.min} and ${_e.max}`);throw new Error(a)}}),dist_index_es_c(this,"isValidRespond",async t=>{var e;if(!(0,utils_dist_index_es.TeY)(t)){const{message:r}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(r)}const{topic:s,response:i}=t;try{await this.isValidSessionTopic(s)}catch(r){throw null!=(e=t?.response)&&e.id&&this.cleanupAfterResponse(t),r}if(!(0,utils_dist_index_es.M8n)(i)){const{message:r}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(i)}`);throw new Error(r)}}),dist_index_es_c(this,"isValidPing",async t=>{if(!(0,utils_dist_index_es.TeY)(t)){const{message:s}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(s)}const{topic:e}=t;await this.isValidSessionOrPairingTopic(e)}),dist_index_es_c(this,"isValidEmit",async t=>{if(!(0,utils_dist_index_es.TeY)(t)){const{message:n}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(n)}const{topic:e,event:s,chainId:i}=t;await this.isValidSessionTopic(e);const{namespaces:r}=this.client.session.get(e);if(!(0,utils_dist_index_es.tLy)(r,i)){const{message:n}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`emit() chainId: ${i}`);throw new Error(n)}if(!(0,utils_dist_index_es.FR8)(s)){const{message:n}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(n)}if(!(0,utils_dist_index_es.z2N)(r,i,s.name)){const{message:n}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(n)}}),dist_index_es_c(this,"isValidDisconnect",async t=>{if(!(0,utils_dist_index_es.TeY)(t)){const{message:s}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(s)}const{topic:e}=t;await this.isValidSessionOrPairingTopic(e)}),dist_index_es_c(this,"isValidAuthenticate",t=>{const{chains:e,uri:s,domain:i,nonce:r}=t;if(!Array.isArray(e)||0===e.length)throw new Error("chains is required and must be a non-empty array");if(!(0,utils_dist_index_es.Qhg)(s,!1))throw new Error("uri is required parameter");if(!(0,utils_dist_index_es.Qhg)(i,!1))throw new Error("domain is required parameter");if(!(0,utils_dist_index_es.Qhg)(r,!1))throw new Error("nonce is required parameter");if([...new Set(e.map(a=>(0,utils_dist_index_es._Yb)(a).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:n}=(0,utils_dist_index_es._Yb)(e[0]);if("eip155"!==n)throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),dist_index_es_c(this,"getVerifyContext",async t=>{const{attestationId:e,hash:s,encryptedId:i,metadata:r,transportType:n}=t,a={verified:{verifyUrl:r.verifyUrl||be,validation:"UNKNOWN",origin:r.url||""}};try{if(n===ee.link_mode){const p=this.getAppLinkIfEnabled(r,n);return a.verified.validation=p&&new URL(p).origin===new URL(r.url).origin?"VALID":"INVALID",a}const l=await this.client.core.verify.resolve({attestationId:e,hash:s,encryptedId:i,verifyUrl:r.verifyUrl});l&&(a.verified.origin=l.origin,a.verified.isScam=l.isScam,a.verified.validation=l.origin===new URL(r.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.warn(l)}return this.client.logger.debug(`Verify context: ${JSON.stringify(a)}`),a}),dist_index_es_c(this,"validateSessionProps",(t,e)=>{Object.values(t).forEach((s,i)=>{if(null==s){const{message:r}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`${e} must contain an existing value for each key. Received: ${s} for key ${Object.keys(t)[i]}`);throw new Error(r)}})}),dist_index_es_c(this,"getPendingAuthRequest",t=>{const e=this.client.auth.requests.get(t);return"object"==typeof e?e:void 0}),dist_index_es_c(this,"addToRecentlyDeleted",(t,e)=>{if(this.recentlyDeletedMap.set(t,e),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let s=0;const i=this.recentlyDeletedLimit/2;for(const r of this.recentlyDeletedMap.keys()){if(s++>=i)break;this.recentlyDeletedMap.delete(r)}}}),dist_index_es_c(this,"checkRecentlyDeleted",t=>{const e=this.recentlyDeletedMap.get(t);if(e){const{message:s}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`Record was recently deleted - ${e}: ${t}`);throw new Error(s)}}),dist_index_es_c(this,"isLinkModeEnabled",(t,e)=>{var s,i,r,n,a,l,p,h,u;return!(!t||e!==ee.link_mode)&&(!0===(null==(i=null==(s=this.client.metadata)?void 0:s.redirect)?void 0:i.linkMode)&&void 0!==(null==(n=null==(r=this.client.metadata)?void 0:r.redirect)?void 0:n.universal)&&""!==(null==(l=null==(a=this.client.metadata)?void 0:a.redirect)?void 0:l.universal)&&void 0!==(null==(p=t?.redirect)?void 0:p.universal)&&""!==(null==(h=t?.redirect)?void 0:h.universal)&&!0===(null==(u=t?.redirect)?void 0:u.linkMode)&&this.client.core.linkModeSupportedApps.includes(t.redirect.universal)&&typeof(null==__webpack_require__.g?void 0:__webpack_require__.g.Linking)<"u")}),dist_index_es_c(this,"getAppLinkIfEnabled",(t,e)=>{var s;return this.isLinkModeEnabled(t,e)?null==(s=t?.redirect)?void 0:s.universal:void 0}),dist_index_es_c(this,"handleLinkModeMessage",({url:t})=>{if(!t||!t.includes("wc_ev")||!t.includes("topic"))return;const e=(0,utils_dist_index_es.$hI)(t,"topic")||"",s=decodeURIComponent((0,utils_dist_index_es.$hI)(t,"wc_ev")||""),i=this.client.session.keys.includes(e);i&&this.client.session.update(e,{transportType:ee.link_mode}),this.client.core.dispatchEnvelope({topic:e,message:s,sessionExists:i})}),dist_index_es_c(this,"registerLinkModeListeners",async()=>{var t;if((0,utils_dist_index_es.w8K)()||(0,utils_dist_index_es.lVv)()&&null!=(t=this.client.metadata.redirect)&&t.linkMode){const e=null==__webpack_require__.g?void 0:__webpack_require__.g.Linking;if(typeof e<"u"){e.addEventListener("url",this.handleLinkModeMessage,this.client.name);const s=await e.getInitialURL();s&&setTimeout(()=>{this.handleLinkModeMessage({url:s})},50)}}}),dist_index_es_c(this,"getTVFParams",(t,e,s)=>{var i,r,n;if(null==(i=e.request)||!i.method)return{};const a={correlationId:t,rpcMethods:[e.request.method],chainId:e.chainId};try{const l=this.extractTxHashesFromResult(e.request,s);a.txHashes=l,a.contractAddresses=this.isValidContractData(e.request.params)?[null==(n=null==(r=e.request.params)?void 0:r[0])?void 0:n.to]:[]}catch(l){this.client.logger.warn("Error getting TVF params",l)}return a}),dist_index_es_c(this,"isValidContractData",t=>{var e;if(!t)return!1;try{const s=t?.data||(null==(e=t?.[0])?void 0:e.data);if(!s.startsWith("0x"))return!1;const i=s.slice(2);return!!/^[0-9a-fA-F]*$/.test(i)&&i.length%2==0}catch{}return!1}),dist_index_es_c(this,"extractTxHashesFromResult",(t,e)=>{var s;try{if(!e)return[];const i=t.method,r=yt[i];if("sui_signTransaction"===i)return[(0,utils_dist_index_es.mXn)(e.transactionBytes)];if("near_signTransaction"===i)return[(0,utils_dist_index_es.KLX)(e)];if("near_signTransactions"===i)return e.map(a=>(0,utils_dist_index_es.KLX)(a));if("xrpl_signTransactionFor"===i||"xrpl_signTransaction"===i)return[null==(s=e.tx_json)?void 0:s.hash];if("polkadot_signTransaction"===i)return[(0,utils_dist_index_es.muJ)({transaction:t.params.transactionPayload,signature:e.signature})];if("algo_signTxn"===i)return(0,utils_dist_index_es.OP1)(e)?e.map(a=>(0,utils_dist_index_es.QV1)(a)):[(0,utils_dist_index_es.QV1)(e)];if("cosmos_signDirect"===i)return[(0,utils_dist_index_es.nYL)(e)];if("string"==typeof e)return[e];const n=e[r.key];if((0,utils_dist_index_es.OP1)(n))return"solana_signAllTransactions"===i?n.map(a=>(0,utils_dist_index_es.PAk)(a)):n;if("string"==typeof n)return[n]}catch(i){this.client.logger.warn("Error extracting tx hashes from result",i)}return[]})}async processPendingMessageEvents(){try{const o=this.client.session.keys,t=this.client.core.relayer.messages.getWithoutAck(o);for(const[e,s]of Object.entries(t))for(const i of s)try{await this.onProviderMessageEvent({topic:e,message:i,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${e}, message: ${i}`)}}catch(o){this.client.logger.warn("processPendingMessageEvents failed",o)}}isInitialized(){if(!this.initialized){const{message:o}=(0,utils_dist_index_es.GuA)("NOT_INITIALIZED",this.name);throw new Error(o)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(dist_index_es_C_message,o=>{this.onProviderMessageEvent(o)})}async onRelayMessage(o){const{topic:t,message:e,attestation:s,transportType:i}=o,{publicKey:r}=this.client.auth.authKeys.keys.includes(index_es_pe)?this.client.auth.authKeys.get(index_es_pe):{responseTopic:void 0,publicKey:void 0};try{const n=await this.client.core.crypto.decode(t,e,{receiverPublicKey:r,encoding:i===ee.link_mode?utils_dist_index_es.Pa8:utils_dist_index_es.EWt});isJsonRpcRequest(n)?(this.client.core.history.set(t,n),await this.onRelayEventRequest({topic:t,payload:n,attestation:s,transportType:i,encryptedId:(0,utils_dist_index_es.ALl)(e)})):isJsonRpcResponse(n)?(await this.client.core.history.resolve(n),await this.onRelayEventResponse({topic:t,payload:n,transportType:i}),this.client.core.history.delete(t,n.id)):await this.onRelayEventUnknownPayload({topic:t,payload:n,transportType:i}),await this.client.core.relayer.messages.ack(t,e)}catch(n){this.client.logger.error(n)}}registerExpirerEvents(){this.client.core.expirer.on(q_expired,async o=>{const{topic:t,id:e}=(0,utils_dist_index_es.c82)(o.target);return e&&this.client.pendingRequest.keys.includes(e)?await this.deletePendingSessionRequest(e,(0,utils_dist_index_es.GuA)("EXPIRED"),!0):e&&this.client.auth.requests.keys.includes(e)?await this.deletePendingAuthRequest(e,(0,utils_dist_index_es.GuA)("EXPIRED"),!0):void(t?this.client.session.keys.includes(t)&&(await this.deleteSession({topic:t,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:t})):e&&(await this.deleteProposal(e,!0),this.client.events.emit("proposal_expire",{id:e})))})}registerPairingEvents(){this.client.core.pairing.events.on(ae_create,o=>this.onPairingCreated(o)),this.client.core.pairing.events.on(ae_delete,o=>{this.addToRecentlyDeleted(o.topic,"pairing")})}isValidPairingTopic(o){if(!(0,utils_dist_index_es.Qhg)(o,!1)){const{message:t}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`pairing topic should be a string: ${o}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(o)){const{message:t}=(0,utils_dist_index_es.GuA)("NO_MATCHING_KEY",`pairing topic doesn't exist: ${o}`);throw new Error(t)}if((0,utils_dist_index_es._dF)(this.client.core.pairing.pairings.get(o).expiry)){const{message:t}=(0,utils_dist_index_es.GuA)("EXPIRED",`pairing topic: ${o}`);throw new Error(t)}}async isValidSessionTopic(o){if(!(0,utils_dist_index_es.Qhg)(o,!1)){const{message:t}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`session topic should be a string: ${o}`);throw new Error(t)}if(this.checkRecentlyDeleted(o),!this.client.session.keys.includes(o)){const{message:t}=(0,utils_dist_index_es.GuA)("NO_MATCHING_KEY",`session topic doesn't exist: ${o}`);throw new Error(t)}if((0,utils_dist_index_es._dF)(this.client.session.get(o).expiry)){await this.deleteSession({topic:o});const{message:t}=(0,utils_dist_index_es.GuA)("EXPIRED",`session topic: ${o}`);throw new Error(t)}if(!this.client.core.crypto.keychain.has(o)){const{message:t}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`session topic does not exist in keychain: ${o}`);throw await this.deleteSession({topic:o}),new Error(t)}}async isValidSessionOrPairingTopic(o){if(this.checkRecentlyDeleted(o),this.client.session.keys.includes(o))await this.isValidSessionTopic(o);else{if(!this.client.core.pairing.pairings.keys.includes(o)){if((0,utils_dist_index_es.Qhg)(o,!1)){const{message:t}=(0,utils_dist_index_es.GuA)("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${o}`);throw new Error(t)}{const{message:t}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`session or pairing topic should be a string: ${o}`);throw new Error(t)}}this.isValidPairingTopic(o)}}async isValidProposalId(o){if(!(0,utils_dist_index_es.Alu)(o)){const{message:t}=(0,utils_dist_index_es.GuA)("MISSING_OR_INVALID",`proposal id should be a number: ${o}`);throw new Error(t)}if(!this.client.proposal.keys.includes(o)){const{message:t}=(0,utils_dist_index_es.GuA)("NO_MATCHING_KEY",`proposal id doesn't exist: ${o}`);throw new Error(t)}if((0,utils_dist_index_es._dF)(this.client.proposal.get(o).expiryTimestamp)){await this.deleteProposal(o);const{message:t}=(0,utils_dist_index_es.GuA)("EXPIRED",`proposal id: ${o}`);throw new Error(t)}}}class ks extends Ui{constructor(o,t){super(o,t,"proposal","wc@2:client:"),this.core=o,this.logger=t}}class index_es_It extends Ui{constructor(o,t){super(o,t,"session","wc@2:client:"),this.core=o,this.logger=t}}class Ds extends Ui{constructor(o,t){super(o,t,"request","wc@2:client:",e=>e.id),this.core=o,this.logger=t}}class Ls extends Ui{constructor(o,t){super(o,t,"authKeys",le,()=>index_es_pe),this.core=o,this.logger=t}}class Ms extends Ui{constructor(o,t){super(o,t,"pairingTopics",le),this.core=o,this.logger=t}}class $s extends Ui{constructor(o,t){super(o,t,"requests",le,e=>e.id),this.core=o,this.logger=t}}var Ks=Object.defineProperty,index_es_Ke=(E,o,t)=>((E,o,t)=>o in E?Ks(E,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):E[o]=t)(E,"symbol"!=typeof o?o+"":o,t);class Gs{constructor(o,t){this.core=o,this.logger=t,index_es_Ke(this,"authKeys"),index_es_Ke(this,"pairingTopics"),index_es_Ke(this,"requests"),this.authKeys=new Ls(this.core,this.logger),this.pairingTopics=new Ms(this.core,this.logger),this.requests=new $s(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var js=Object.defineProperty,sign_client_dist_index_es_f=(E,o,t)=>((E,o,t)=>o in E?js(E,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):E[o]=t)(E,"symbol"!=typeof o?o+"":o,t);class index_es_fe extends J{constructor(o){super(o),sign_client_dist_index_es_f(this,"protocol","wc"),sign_client_dist_index_es_f(this,"version",2),sign_client_dist_index_es_f(this,"name",index_es_me_name),sign_client_dist_index_es_f(this,"metadata"),sign_client_dist_index_es_f(this,"core"),sign_client_dist_index_es_f(this,"logger"),sign_client_dist_index_es_f(this,"events",new events.EventEmitter),sign_client_dist_index_es_f(this,"engine"),sign_client_dist_index_es_f(this,"session"),sign_client_dist_index_es_f(this,"proposal"),sign_client_dist_index_es_f(this,"pendingRequest"),sign_client_dist_index_es_f(this,"auth"),sign_client_dist_index_es_f(this,"signConfig"),sign_client_dist_index_es_f(this,"on",(e,s)=>this.events.on(e,s)),sign_client_dist_index_es_f(this,"once",(e,s)=>this.events.once(e,s)),sign_client_dist_index_es_f(this,"off",(e,s)=>this.events.off(e,s)),sign_client_dist_index_es_f(this,"removeListener",(e,s)=>this.events.removeListener(e,s)),sign_client_dist_index_es_f(this,"removeAllListeners",e=>this.events.removeAllListeners(e)),sign_client_dist_index_es_f(this,"connect",async e=>{try{return await this.engine.connect(e)}catch(s){throw this.logger.error(s.message),s}}),sign_client_dist_index_es_f(this,"pair",async e=>{try{return await this.engine.pair(e)}catch(s){throw this.logger.error(s.message),s}}),sign_client_dist_index_es_f(this,"approve",async e=>{try{return await this.engine.approve(e)}catch(s){throw this.logger.error(s.message),s}}),sign_client_dist_index_es_f(this,"reject",async e=>{try{return await this.engine.reject(e)}catch(s){throw this.logger.error(s.message),s}}),sign_client_dist_index_es_f(this,"update",async e=>{try{return await this.engine.update(e)}catch(s){throw this.logger.error(s.message),s}}),sign_client_dist_index_es_f(this,"extend",async e=>{try{return await this.engine.extend(e)}catch(s){throw this.logger.error(s.message),s}}),sign_client_dist_index_es_f(this,"request",async e=>{try{return await this.engine.request(e)}catch(s){throw this.logger.error(s.message),s}}),sign_client_dist_index_es_f(this,"respond",async e=>{try{return await this.engine.respond(e)}catch(s){throw this.logger.error(s.message),s}}),sign_client_dist_index_es_f(this,"ping",async e=>{try{return await this.engine.ping(e)}catch(s){throw this.logger.error(s.message),s}}),sign_client_dist_index_es_f(this,"emit",async e=>{try{return await this.engine.emit(e)}catch(s){throw this.logger.error(s.message),s}}),sign_client_dist_index_es_f(this,"disconnect",async e=>{try{return await this.engine.disconnect(e)}catch(s){throw this.logger.error(s.message),s}}),sign_client_dist_index_es_f(this,"find",e=>{try{return this.engine.find(e)}catch(s){throw this.logger.error(s.message),s}}),sign_client_dist_index_es_f(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(e){throw this.logger.error(e.message),e}}),sign_client_dist_index_es_f(this,"authenticate",async(e,s)=>{try{return await this.engine.authenticate(e,s)}catch(i){throw this.logger.error(i.message),i}}),sign_client_dist_index_es_f(this,"formatAuthMessage",e=>{try{return this.engine.formatAuthMessage(e)}catch(s){throw this.logger.error(s.message),s}}),sign_client_dist_index_es_f(this,"approveSessionAuthenticate",async e=>{try{return await this.engine.approveSessionAuthenticate(e)}catch(s){throw this.logger.error(s.message),s}}),sign_client_dist_index_es_f(this,"rejectSessionAuthenticate",async e=>{try{return await this.engine.rejectSessionAuthenticate(e)}catch(s){throw this.logger.error(s.message),s}}),this.name=o?.name||index_es_me_name,this.metadata=(0,utils_dist_index_es.Ds_)(o?.metadata),this.signConfig=o?.signConfig;const t=typeof o?.logger<"u"&&"string"!=typeof o?.logger?o.logger:(0,index_es.h6)((0,index_es.iP)({level:o?.logger||index_es_me_logger}));this.core=o?.core||new ta(o),this.logger=(0,index_es.U5)(t,this.name),this.session=new index_es_It(this.core,this.logger),this.proposal=new ks(this.core,this.logger),this.pendingRequest=new Ds(this.core,this.logger),this.engine=new Cs(this),this.auth=new Gs(this.core,this.logger)}static async init(o){const t=new index_es_fe(o);return await t.initialize(),t}get context(){return(0,index_es.oI)(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(o){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(o.message),o}}}var browser_ponyfill=__webpack_require__("./node_modules/cross-fetch/dist/browser-ponyfill.js"),browser_ponyfill_default=__webpack_require__.n(browser_ponyfill),jsonrpc_http_connection_dist_index_es_P=Object.defineProperty,dist_index_es_w=Object.defineProperties,dist_index_es_E=Object.getOwnPropertyDescriptors,jsonrpc_http_connection_dist_index_es_c=Object.getOwnPropertySymbols,L=Object.prototype.hasOwnProperty,jsonrpc_http_connection_dist_index_es_O=Object.prototype.propertyIsEnumerable,index_es_l=(r,t,e)=>t in r?jsonrpc_http_connection_dist_index_es_P(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,index_es_p=(r,t)=>{for(var e in t||(t={}))L.call(t,e)&&index_es_l(r,e,t[e]);if(jsonrpc_http_connection_dist_index_es_c)for(var e of jsonrpc_http_connection_dist_index_es_c(t))jsonrpc_http_connection_dist_index_es_O.call(t,e)&&index_es_l(r,e,t[e]);return r},jsonrpc_http_connection_dist_index_es_v=(r,t)=>dist_index_es_w(r,dist_index_es_E(t));const jsonrpc_http_connection_dist_index_es_d={headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST"};class jsonrpc_http_connection_dist_index_es_f{constructor(t,e=!1){if(this.url=t,this.disableProviderPing=e,this.events=new events.EventEmitter,this.isAvailable=!1,this.registering=!1,!isHttpUrl(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);this.url=t,this.disableProviderPing=e}get connected(){return this.isAvailable}get connecting(){return this.registering}on(t,e){this.events.on(t,e)}once(t,e){this.events.once(t,e)}off(t,e){this.events.off(t,e)}removeListener(t,e){this.events.removeListener(t,e)}async open(t=this.url){await this.register(t)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(t){this.isAvailable||await this.register();try{const e=(0,esm.h)(t),s=await(await browser_ponyfill_default()(this.url,jsonrpc_http_connection_dist_index_es_v(index_es_p({},jsonrpc_http_connection_dist_index_es_d),{body:e}))).json();this.onPayload({data:s})}catch(e){this.onError(t.id,e)}}async register(t=this.url){if(!isHttpUrl(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);if(this.registering){const e=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=e||this.events.listenerCount("open")>=e)&&this.events.setMaxListeners(e+1),new Promise((s,i)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),i(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return i(new Error("HTTP connection is missing or invalid"));s()})})}this.url=t,this.registering=!0;try{if(!this.disableProviderPing){const e=(0,esm.h)({id:1,jsonrpc:"2.0",method:"test",params:[]});await browser_ponyfill_default()(t,jsonrpc_http_connection_dist_index_es_v(index_es_p({},jsonrpc_http_connection_dist_index_es_d),{body:e}))}this.onOpen()}catch(e){const s=this.parseError(e);throw this.events.emit("register_error",s),this.onClose(),s}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(t){if(typeof t.data>"u")return;const e="string"==typeof t.data?(0,esm.j)(t.data):t.data;this.events.emit("payload",e)}onError(t,e){const s=this.parseError(e),n=formatJsonRpcError(t,s.message||s.toString());this.events.emit("payload",n)}parseError(t,e=this.url){return parseConnectionError(t,e,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>10&&this.events.setMaxListeners(10)}}var dist_index_es_Buffer=__webpack_require__("./node_modules/buffer/index.js").Buffer,universal_provider_dist_index_es_console=__webpack_require__("./node_modules/console-browserify/index.js");const de="https://rpc.walletconnect.org/v1/",ue="generic",index_es_Ye=`${de}bundler`,index_es_m_DEFAULT_CHAIN_CHANGED="default_chain_changed";function universal_provider_dist_index_es_K(s){return null==s||"object"!=typeof s&&"function"!=typeof s}function index_es_le(s){return Object.getOwnPropertySymbols(s).filter(e=>Object.prototype.propertyIsEnumerable.call(s,e))}function dist_index_es_fe(s){return null==s?void 0===s?"[object Undefined]":"[object Null]":Object.prototype.toString.call(s)}const ge="[object Boolean]",Te="[object Date]",st="[object Array]",it="[object ArrayBuffer]",rt="[object Object]",nt="[object DataView]",at="[object Uint8Array]",ct="[object Uint8ClampedArray]",ot="[object Uint16Array]",ht="[object Uint32Array]",pt="[object Int8Array]",lt="[object Float32Array]";function dist_index_es_V(s){return ArrayBuffer.isView(s)&&!(s instanceof DataView)}function universal_provider_dist_index_es_O(s,e,t,i=new Map,n=void 0){const a=n?.(s,e,t,i);if(null!=a)return a;if(universal_provider_dist_index_es_K(s))return s;if(i.has(s))return i.get(s);if(Array.isArray(s)){const r=new Array(s.length);i.set(s,r);for(let c=0;c<s.length;c++)r[c]=universal_provider_dist_index_es_O(s[c],c,t,i,n);return Object.hasOwn(s,"index")&&(r.index=s.index),Object.hasOwn(s,"input")&&(r.input=s.input),r}if(s instanceof Date)return new Date(s.getTime());if(s instanceof RegExp){const r=new RegExp(s.source,s.flags);return r.lastIndex=s.lastIndex,r}if(s instanceof Map){const r=new Map;i.set(s,r);for(const[c,o]of s)r.set(c,universal_provider_dist_index_es_O(o,c,t,i,n));return r}if(s instanceof Set){const r=new Set;i.set(s,r);for(const c of s)r.add(universal_provider_dist_index_es_O(c,void 0,t,i,n));return r}if(typeof dist_index_es_Buffer<"u"&&dist_index_es_Buffer.isBuffer(s))return s.subarray();if(dist_index_es_V(s)){const r=new(Object.getPrototypeOf(s).constructor)(s.length);i.set(s,r);for(let c=0;c<s.length;c++)r[c]=universal_provider_dist_index_es_O(s[c],c,t,i,n);return r}if(s instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&s instanceof SharedArrayBuffer)return s.slice(0);if(s instanceof DataView){const r=new DataView(s.buffer.slice(0),s.byteOffset,s.byteLength);return i.set(s,r),dist_index_es_y(r,s,t,i,n),r}if(typeof File<"u"&&s instanceof File){const r=new File([s],s.name,{type:s.type});return i.set(s,r),dist_index_es_y(r,s,t,i,n),r}if(s instanceof Blob){const r=new Blob([s],{type:s.type});return i.set(s,r),dist_index_es_y(r,s,t,i,n),r}if(s instanceof Error){const r=new s.constructor;return i.set(s,r),r.message=s.message,r.name=s.name,r.stack=s.stack,r.cause=s.cause,dist_index_es_y(r,s,t,i,n),r}if("object"==typeof s&&function index_es_vt(s){switch(dist_index_es_fe(s)){case"[object Arguments]":case st:case it:case nt:case ge:case Te:case lt:case"[object Float64Array]":case pt:case"[object Int16Array]":case"[object Int32Array]":case"[object Map]":case"[object Number]":case rt:case"[object RegExp]":case"[object Set]":case"[object String]":case"[object Symbol]":case at:case ct:case ot:case ht:return!0;default:return!1}}(s)){const r=Object.create(Object.getPrototypeOf(s));return i.set(s,r),dist_index_es_y(r,s,t,i,n),r}return s}function dist_index_es_y(s,e,t=s,i,n){const a=[...Object.keys(e),...index_es_le(e)];for(let r=0;r<a.length;r++){const c=a[r],o=Object.getOwnPropertyDescriptor(s,c);(null==o||o.writable)&&(s[c]=universal_provider_dist_index_es_O(e[c],c,t,i,n))}}function index_es_gt(s,e){return function index_es_mt(s,e){return universal_provider_dist_index_es_O(s,void 0,s,new Map,e)}(s,(t,i,n,a)=>{const r=e?.(t,i,n,a);if(null!=r)return r;if("object"==typeof s)switch(Object.prototype.toString.call(s)){case"[object Number]":case"[object String]":case ge:{const c=new s.constructor(s?.valueOf());return dist_index_es_y(c,s),c}case"[object Arguments]":{const c={};return dist_index_es_y(c,s),c.length=s.length,c[Symbol.iterator]=s[Symbol.iterator],c}default:return}})}function dist_index_es_we(s){return index_es_gt(s)}function index_es_ye(s){return null!==s&&"object"==typeof s&&"[object Arguments]"===dist_index_es_fe(s)}function index_es_be(s){return"object"==typeof s&&null!==s}function index_es_Pt(){}function index_es_wt(s){return dist_index_es_V(s)}function index_es_yt(s){if("object"!=typeof s||null==s)return!1;if(null===Object.getPrototypeOf(s))return!0;if("[object Object]"!==Object.prototype.toString.call(s)){const t=s[Symbol.toStringTag];return!(null==t||!Object.getOwnPropertyDescriptor(s,Symbol.toStringTag)?.writable)&&s.toString()===`[object ${t}]`}let e=s;for(;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(s)===e}function index_es_L(s,e,t,i){if(universal_provider_dist_index_es_K(s)&&(s=Object(s)),null==e||"object"!=typeof e)return s;if(i.has(e))return function bt(s){if(universal_provider_dist_index_es_K(s))return s;if(Array.isArray(s)||dist_index_es_V(s)||s instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&s instanceof SharedArrayBuffer)return s.slice(0);const e=Object.getPrototypeOf(s),t=e.constructor;if(s instanceof Date||s instanceof Map||s instanceof Set)return new t(s);if(s instanceof RegExp){const i=new t(s);return i.lastIndex=s.lastIndex,i}if(s instanceof DataView)return new t(s.buffer.slice(0));if(s instanceof Error){const i=new t(s.message);return i.stack=s.stack,i.name=s.name,i.cause=s.cause,i}if(typeof File<"u"&&s instanceof File)return new t([s],s.name,{type:s.type,lastModified:s.lastModified});if("object"==typeof s){const i=Object.create(e);return Object.assign(i,s)}return s}(i.get(e));if(i.set(e,s),Array.isArray(e)){e=e.slice();for(let a=0;a<e.length;a++)e[a]=e[a]??void 0}const n=[...Object.keys(e),...index_es_le(e)];for(let a=0;a<n.length;a++){const r=n[a];let c=e[r],o=s[r];if(index_es_ye(c)&&(c={...c}),index_es_ye(o)&&(o={...o}),typeof dist_index_es_Buffer<"u"&&dist_index_es_Buffer.isBuffer(c)&&(c=dist_index_es_we(c)),Array.isArray(c))if("object"==typeof o&&null!=o){const u=[],p=Reflect.ownKeys(o);for(let w=0;w<p.length;w++){const l=p[w];u[l]=o[l]}o=u}else o=[];const d=t(o,c,r,s,e,i);null!=d?s[r]=d:Array.isArray(c)||index_es_be(o)&&index_es_be(c)?s[r]=index_es_L(o,c,t,i):null==o&&index_es_yt(c)?s[r]=index_es_L({},c,t,i):null==o&&index_es_wt(c)?s[r]=dist_index_es_we(c):(void 0===o||void 0!==c)&&(s[r]=c)}return s}function index_es_$t(s,...e){return function dist_index_es_It(s,...e){const t=e.slice(0,-1),i=e[e.length-1];let n=s;for(let a=0;a<t.length;a++)n=index_es_L(n,t[a],i,new Map);return n}(s,...e,index_es_Pt)}var index_es_Ot=Object.defineProperty,index_es_Ct=Object.defineProperties,index_es_At=Object.getOwnPropertyDescriptors,Ie=Object.getOwnPropertySymbols,index_es_Et=Object.prototype.hasOwnProperty,index_es_Ht=Object.prototype.propertyIsEnumerable,index_es_$e=(s,e,t)=>e in s?index_es_Ot(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,universal_provider_dist_index_es_M=(s,e)=>{for(var t in e||(e={}))index_es_Et.call(e,t)&&index_es_$e(s,t,e[t]);if(Ie)for(var t of Ie(e))index_es_Ht.call(e,t)&&index_es_$e(s,t,e[t]);return s},dist_index_es_St=(s,e)=>index_es_Ct(s,index_es_At(e));function universal_provider_dist_index_es_f(s,e,t){var i;const n=(0,utils_dist_index_es._Yb)(s);return(null==(i=e.rpcMap)?void 0:i[n.reference])||`${de}?chainId=${n.namespace}:${n.reference}&projectId=${t}`}function dist_index_es_b(s){return s.includes(":")?s.split(":")[1]:s}function index_es_Oe(s){return s.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function index_es_Ce(s){return Object.fromEntries(Object.entries(s).filter(([e,t])=>{var i,n;return(null==(i=t?.chains)?void 0:i.length)&&(null==(n=t?.chains)?void 0:n.length)>0}))}function index_es_B(s={},e={}){return index_es_$t(index_es_Ce(Ae(s)),index_es_Ce(Ae(e)))}function Ae(s){var e,t,i,n,a;const r={};if(!(0,utils_dist_index_es.aF0)(s))return r;for(const[c,o]of Object.entries(s)){const d=(0,utils_dist_index_es.nWe)(c)?[c]:o.chains,u=o.methods||[],p=o.events||[],w=o.rpcMap||{},l=(0,utils_dist_index_es.kob)(c);r[l]=dist_index_es_St(universal_provider_dist_index_es_M(universal_provider_dist_index_es_M({},r[l]),o),{chains:(0,utils_dist_index_es.TRk)(d,null==(e=r[l])?void 0:e.chains),methods:(0,utils_dist_index_es.TRk)(u,null==(t=r[l])?void 0:t.methods),events:(0,utils_dist_index_es.TRk)(p,null==(i=r[l])?void 0:i.events)}),((0,utils_dist_index_es.aF0)(w)||(0,utils_dist_index_es.aF0)((null==(n=r[l])?void 0:n.rpcMap)||{}))&&(r[l].rpcMap=universal_provider_dist_index_es_M(universal_provider_dist_index_es_M({},w),null==(a=r[l])?void 0:a.rpcMap))}return r}function Ee(s){return s.includes(":")?s.split(":")[2]:s}function index_es_He(s){const e={};for(const[t,i]of Object.entries(s)){const n=i.methods||[],a=i.events||[],r=i.accounts||[],c=(0,utils_dist_index_es.nWe)(t)?[t]:i.chains?i.chains:index_es_Oe(i.accounts);e[t]={chains:c,methods:n,events:a,accounts:r}}return e}function index_es_Y(s){return"number"==typeof s?s:s.includes("0x")?parseInt(s,16):(s=s.includes(":")?s.split(":")[1]:s,isNaN(Number(s))?s:Number(s))}const index_es_Se={},universal_provider_dist_index_es_h=s=>index_es_Se[s],index_es_X=(s,e)=>{index_es_Se[s]=e};var Dt=Object.defineProperty,Ne=Object.getOwnPropertySymbols,index_es_jt=Object.prototype.hasOwnProperty,dist_index_es_Rt=Object.prototype.propertyIsEnumerable,index_es_qe=(s,e,t)=>e in s?Dt(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,dist_index_es_De=(s,e)=>{for(var t in e||(e={}))index_es_jt.call(e,t)&&index_es_qe(s,t,e[t]);if(Ne)for(var t of Ne(e))dist_index_es_Rt.call(e,t)&&index_es_qe(s,t,e[t]);return s};const index_es_t=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],index_es_Ft=s=>s&&s.startsWith("0x")?BigInt(s).toString(10):s,Q=s=>s&&s.startsWith("0x")?s:`0x${BigInt(s).toString(16)}`,index_es_Re=s=>Object.keys(s).filter(e=>index_es_t.includes(e)).reduce((e,t)=>(e[t]=index_es_Ut(s[t]),e),{}),index_es_Ut=s=>"string"==typeof s&&function index_es_qt(s){try{const e=JSON.parse(s);return"object"==typeof e&&null!==e&&!Array.isArray(e)}catch{return!1}}(s)?JSON.parse(s):s;var index_es_Lt=Object.defineProperty,index_es_Bt=(s,e,t)=>((s,e,t)=>e in s?index_es_Lt(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t)(s,"symbol"!=typeof e?e+"":e,t);let Z;class index_es_re{constructor(e){index_es_Bt(this,"storage"),this.storage=e}async getItem(e){return await this.storage.getItem(e)}async setItem(e,t){return await this.storage.setItem(e,t)}async removeItem(e){return await this.storage.removeItem(e)}static getStorage(e){return Z||(Z=new index_es_re(e)),Z}}var index_es_Gt=Object.defineProperty,index_es_Jt=Object.defineProperties,index_es_zt=Object.getOwnPropertyDescriptors,index_es_e=Object.getOwnPropertySymbols,index_es_kt=Object.prototype.hasOwnProperty,index_es_Wt=Object.prototype.propertyIsEnumerable,index_es_Fe=(s,e,t)=>e in s?index_es_Gt(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;async function index_es_Yt(s,e){const t=(0,utils_dist_index_es._Yb)(s.result.capabilities.caip345.caip2),i=s.result.capabilities.caip345.transactionHashes,n=await Promise.allSettled(i.map(p=>async function index_es_Xt(s,e,t){return await t(parseInt(s)).request(formatJsonRpcRequest("eth_getTransactionReceipt",[e]))}(t.reference,p,e))),a=n.filter(p=>"fulfilled"===p.status).map(p=>p.value).filter(p=>p);n.filter(p=>"rejected"===p.status).forEach(p=>universal_provider_dist_index_es_console.warn("Failed to fetch transaction receipt:",p.reason));const r=!a.length||a.some(p=>!p),c=a.every(p=>"0x1"===p?.status),o=a.every(p=>"0x0"===p?.status),d=a.some(p=>"0x0"===p?.status);let u;return r?u=100:c?u=200:o?u=500:d&&(u=600),{id:s.result.id,version:s.request.version,atomic:s.request.atomicRequired,chainId:s.request.chainId,capabilities:s.result.capabilities,receipts:a,status:u}}async function index_es_Qt({sendCalls:s,storage:e}){const t=await e.getItem("call_status");await e.setItem("call_status",((s,e)=>index_es_Jt(s,index_es_zt(e)))(((s,e)=>{for(var t in e||(e={}))index_es_kt.call(e,t)&&index_es_Fe(s,t,e[t]);if(index_es_e)for(var t of index_es_e(e))index_es_Wt.call(e,t)&&index_es_Fe(s,t,e[t]);return s})({},t),{[s.result.id]:{request:s.request,result:s.result,expiry:(0,utils_dist_index_es.Xw0)(86400)}}))}async function index_es_Tt({resultId:s,storage:e}){const t=await e.getItem("call_status"),i=t?.[s];if(i&&!(0,utils_dist_index_es._dF)(i.expiry))return i;await async function index_es_Zt({resultId:s,storage:e}){const t=await e.getItem("call_status");if(t){delete t[s],await e.setItem("call_status",t);for(const i in t)(0,utils_dist_index_es._dF)(t[i].expiry)&&delete t[i];await e.setItem("call_status",t)}}({resultId:s,storage:e})}var es=Object.defineProperty,universal_provider_dist_index_es_C=(s,e,t)=>((s,e,t)=>e in s?es(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t)(s,"symbol"!=typeof e?e+"":e,t);class ss{constructor(e){universal_provider_dist_index_es_C(this,"name","polkadot"),universal_provider_dist_index_es_C(this,"client"),universal_provider_dist_index_es_C(this,"httpProviders"),universal_provider_dist_index_es_C(this,"events"),universal_provider_dist_index_es_C(this,"namespace"),universal_provider_dist_index_es_C(this,"chainId"),this.namespace=e.namespace,this.events=universal_provider_dist_index_es_h("events"),this.client=universal_provider_dist_index_es_h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(index_es_m_DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e&&e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const n=dist_index_es_b(t);e[n]=this.createHttpProvider(n,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||universal_provider_dist_index_es_f(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new index_es_o(new jsonrpc_http_connection_dist_index_es_f(i,universal_provider_dist_index_es_h("disableProviderPing")))}}var is=Object.defineProperty,rs=Object.defineProperties,ns=Object.getOwnPropertyDescriptors,index_es_Ue=Object.getOwnPropertySymbols,as=Object.prototype.hasOwnProperty,cs=Object.prototype.propertyIsEnumerable,dist_index_es_T=(s,e,t)=>e in s?is(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,index_es_ee=(s,e)=>{for(var t in e||(e={}))as.call(e,t)&&dist_index_es_T(s,t,e[t]);if(index_es_Ue)for(var t of index_es_Ue(e))cs.call(e,t)&&dist_index_es_T(s,t,e[t]);return s},te=(s,e)=>rs(s,ns(e)),index_es_I=(s,e,t)=>dist_index_es_T(s,"symbol"!=typeof e?e+"":e,t);class os{constructor(e){index_es_I(this,"name","eip155"),index_es_I(this,"client"),index_es_I(this,"chainId"),index_es_I(this,"namespace"),index_es_I(this,"httpProviders"),index_es_I(this,"events"),index_es_I(this,"storage"),this.namespace=e.namespace,this.events=universal_provider_dist_index_es_h("events"),this.client=universal_provider_dist_index_es_h("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=index_es_re.getStorage(this.client.core.storage)}async request(e){switch(e.request.method){case"eth_requestAccounts":case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e);case"wallet_sendCalls":return await this.sendCalls(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t),this.chainId=parseInt(e),this.events.emit(index_es_m_DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){const i=t||universal_provider_dist_index_es_f(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new index_es_o(new jsonrpc_http_connection_dist_index_es_f(i,universal_provider_dist_index_es_h("disableProviderPing")))}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const n=parseInt(dist_index_es_b(t));e[n]=this.createHttpProvider(n,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(e){const t=e||this.chainId;return this.httpProviders[t]||(this.httpProviders=te(index_es_ee({},this.httpProviders),{[t]:this.createHttpProvider(t)}),this.httpProviders[t])}async handleSwitchChain(e){var t,i;let n=e.request.params?null==(t=e.request.params[0])?void 0:t.chainId:"0x0";n=n.startsWith("0x")?n:`0x${n}`;const a=parseInt(n,16);if(this.isChainApproved(a))this.setDefaultChain(`${a}`);else{if(!this.namespace.methods.includes("wallet_switchEthereumChain"))throw new Error(`Failed to switch to chain 'eip155:${a}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:n}]},chainId:null==(i=this.namespace.chains)?void 0:i[0]}),this.setDefaultChain(`${a}`)}return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var t,i,n,a,r;const c=null==(i=null==(t=e.request)?void 0:t.params)?void 0:i[0],o=(null==(a=null==(n=e.request)?void 0:n.params)?void 0:a[1])||[];if(!c)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const d=this.client.session.get(e.topic),u=(null==(r=d?.sessionProperties)?void 0:r.capabilities)||{},p=`${c}${o.join(",")}`,w=u?.[p];if(w)return w;let l;try{l=((s,e,t)=>{const{sessionProperties:i={},scopedProperties:n={}}=s,a={};if(!(0,utils_dist_index_es.aF0)(n)&&!(0,utils_dist_index_es.aF0)(i))return;const r=index_es_Re(i);for(const c of t){const o=index_es_Ft(c);if(!o)continue;a[Q(o)]=r;const d=n?.[`eip155:${o}`];if(d){const u=d?.[`eip155:${o}:${e}`];a[Q(o)]=dist_index_es_De(dist_index_es_De({},a[Q(o)]),index_es_Re(u||d))}}for(const[c,o]of Object.entries(a))0===Object.keys(o).length&&delete a[c];return Object.keys(a).length>0?a:void 0})(d,c,o)}catch(z){universal_provider_dist_index_es_console.warn("Failed to extract capabilities from session",z)}if(l)return l;const ne=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:te(index_es_ee({},d.sessionProperties||{}),{capabilities:te(index_es_ee({},u||{}),{[p]:ne})})})}catch(z){universal_provider_dist_index_es_console.warn("Failed to update session with capabilities",z)}return ne}async getCallStatus(e){var t,i,n;const a=this.client.session.get(e.topic),r=null==(t=a.sessionProperties)?void 0:t.bundler_name;if(r){const d=this.getBundlerUrl(e.chainId,r);try{return await this.getUserOperationReceipt(d,e)}catch(u){universal_provider_dist_index_es_console.warn("Failed to fetch call status from bundler",u,d)}}const c=null==(i=a.sessionProperties)?void 0:i.bundler_url;if(c)try{return await this.getUserOperationReceipt(c,e)}catch(d){universal_provider_dist_index_es_console.warn("Failed to fetch call status from custom bundler",d,c)}const o=await index_es_Tt({resultId:null==(n=e.request.params)?void 0:n[0],storage:this.storage});if(o)try{return await index_es_Yt(o,this.getHttpProvider.bind(this))}catch(d){universal_provider_dist_index_es_console.warn("Failed to fetch call status from stored send calls",d,o)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,t){var i;const n=new URL(e),a=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(formatJsonRpcRequest("eth_getUserOperationReceipt",[null==(i=t.request.params)?void 0:i[0]]))});if(!a.ok)throw new Error(`Failed to fetch user operation receipt - ${a.status}`);return await a.json()}getBundlerUrl(e,t){return`${index_es_Ye}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${t}`}async sendCalls(e){var t,i,n;const a=await this.client.request(e),r=null==(t=e.request.params)?void 0:t[0],c=a?.id,o=a?.capabilities||{},d=null==(i=o?.caip345)?void 0:i.caip2,u=null==(n=o?.caip345)?void 0:n.transactionHashes;return!c||!d||!(null!=u&&u.length)||await index_es_Qt({sendCalls:{request:r,result:a},storage:this.storage}),a}}var hs=Object.defineProperty,index_es_A=(s,e,t)=>((s,e,t)=>e in s?hs(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t)(s,"symbol"!=typeof e?e+"":e,t);class ds{constructor(e){index_es_A(this,"name","solana"),index_es_A(this,"client"),index_es_A(this,"httpProviders"),index_es_A(this,"events"),index_es_A(this,"namespace"),index_es_A(this,"chainId"),this.namespace=e.namespace,this.events=universal_provider_dist_index_es_h("events"),this.client=universal_provider_dist_index_es_h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(index_es_m_DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const n=dist_index_es_b(t);e[n]=this.createHttpProvider(n,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||universal_provider_dist_index_es_f(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new index_es_o(new jsonrpc_http_connection_dist_index_es_f(i,universal_provider_dist_index_es_h("disableProviderPing")))}}var us=Object.defineProperty,universal_provider_dist_index_es_E=(s,e,t)=>((s,e,t)=>e in s?us(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t)(s,"symbol"!=typeof e?e+"":e,t);class fs{constructor(e){universal_provider_dist_index_es_E(this,"name","cosmos"),universal_provider_dist_index_es_E(this,"client"),universal_provider_dist_index_es_E(this,"httpProviders"),universal_provider_dist_index_es_E(this,"events"),universal_provider_dist_index_es_E(this,"namespace"),universal_provider_dist_index_es_E(this,"chainId"),this.namespace=e.namespace,this.events=universal_provider_dist_index_es_h("events"),this.client=universal_provider_dist_index_es_h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(index_es_m_DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const n=dist_index_es_b(t);e[n]=this.createHttpProvider(n,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||universal_provider_dist_index_es_f(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new index_es_o(new jsonrpc_http_connection_dist_index_es_f(i,universal_provider_dist_index_es_h("disableProviderPing")))}}var index_es_ms=Object.defineProperty,index_es_H=(s,e,t)=>((s,e,t)=>e in s?index_es_ms(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t)(s,"symbol"!=typeof e?e+"":e,t);class gs{constructor(e){index_es_H(this,"name","algorand"),index_es_H(this,"client"),index_es_H(this,"httpProviders"),index_es_H(this,"events"),index_es_H(this,"namespace"),index_es_H(this,"chainId"),this.namespace=e.namespace,this.events=universal_provider_dist_index_es_h("events"),this.client=universal_provider_dist_index_es_h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){const i=t||universal_provider_dist_index_es_f(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.chainId=e,this.events.emit(index_es_m_DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||universal_provider_dist_index_es_f(e,this.namespace,this.client.core.projectId);return typeof i>"u"?void 0:new index_es_o(new jsonrpc_http_connection_dist_index_es_f(i,universal_provider_dist_index_es_h("disableProviderPing")))}}var index_es_Ps=Object.defineProperty,index_es_S=(s,e,t)=>((s,e,t)=>e in s?index_es_Ps(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t)(s,"symbol"!=typeof e?e+"":e,t);class ys{constructor(e){index_es_S(this,"name","cip34"),index_es_S(this,"client"),index_es_S(this,"httpProviders"),index_es_S(this,"events"),index_es_S(this,"namespace"),index_es_S(this,"chainId"),this.namespace=e.namespace,this.events=universal_provider_dist_index_es_h("events"),this.client=universal_provider_dist_index_es_h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(index_es_m_DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{const i=this.getCardanoRPCUrl(t),n=dist_index_es_b(t);e[n]=this.createHttpProvider(n,i)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}getCardanoRPCUrl(e){const t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||this.getCardanoRPCUrl(e);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new index_es_o(new jsonrpc_http_connection_dist_index_es_f(i,universal_provider_dist_index_es_h("disableProviderPing")))}}var index_es_bs=Object.defineProperty,dist_index_es_N=(s,e,t)=>((s,e,t)=>e in s?index_es_bs(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t)(s,"symbol"!=typeof e?e+"":e,t);class index_es_$s{constructor(e){dist_index_es_N(this,"name","elrond"),dist_index_es_N(this,"client"),dist_index_es_N(this,"httpProviders"),dist_index_es_N(this,"events"),dist_index_es_N(this,"namespace"),dist_index_es_N(this,"chainId"),this.namespace=e.namespace,this.events=universal_provider_dist_index_es_h("events"),this.client=universal_provider_dist_index_es_h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(index_es_m_DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const n=dist_index_es_b(t);e[n]=this.createHttpProvider(n,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||universal_provider_dist_index_es_f(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new index_es_o(new jsonrpc_http_connection_dist_index_es_f(i,universal_provider_dist_index_es_h("disableProviderPing")))}}var index_es_Os=Object.defineProperty,index_es_q=(s,e,t)=>((s,e,t)=>e in s?index_es_Os(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t)(s,"symbol"!=typeof e?e+"":e,t);class index_es_As{constructor(e){index_es_q(this,"name","multiversx"),index_es_q(this,"client"),index_es_q(this,"httpProviders"),index_es_q(this,"events"),index_es_q(this,"namespace"),index_es_q(this,"chainId"),this.namespace=e.namespace,this.events=universal_provider_dist_index_es_h("events"),this.client=universal_provider_dist_index_es_h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(index_es_m_DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const n=dist_index_es_b(t);e[n]=this.createHttpProvider(n,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||universal_provider_dist_index_es_f(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new index_es_o(new jsonrpc_http_connection_dist_index_es_f(i,universal_provider_dist_index_es_h("disableProviderPing")))}}var Es=Object.defineProperty,index_es_D=(s,e,t)=>((s,e,t)=>e in s?Es(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t)(s,"symbol"!=typeof e?e+"":e,t);class Ss{constructor(e){index_es_D(this,"name","near"),index_es_D(this,"client"),index_es_D(this,"httpProviders"),index_es_D(this,"events"),index_es_D(this,"namespace"),index_es_D(this,"chainId"),this.namespace=e.namespace,this.events=universal_provider_dist_index_es_h("events"),this.client=universal_provider_dist_index_es_h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||universal_provider_dist_index_es_f(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(index_es_m_DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e&&e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||universal_provider_dist_index_es_f(e,this.namespace);return typeof i>"u"?void 0:new index_es_o(new jsonrpc_http_connection_dist_index_es_f(i,universal_provider_dist_index_es_h("disableProviderPing")))}}var index_es_Ns=Object.defineProperty,universal_provider_dist_index_es_j=(s,e,t)=>((s,e,t)=>e in s?index_es_Ns(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t)(s,"symbol"!=typeof e?e+"":e,t);class index_es_Ds{constructor(e){universal_provider_dist_index_es_j(this,"name","tezos"),universal_provider_dist_index_es_j(this,"client"),universal_provider_dist_index_es_j(this,"httpProviders"),universal_provider_dist_index_es_j(this,"events"),universal_provider_dist_index_es_j(this,"namespace"),universal_provider_dist_index_es_j(this,"chainId"),this.namespace=e.namespace,this.events=universal_provider_dist_index_es_h("events"),this.client=universal_provider_dist_index_es_h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||universal_provider_dist_index_es_f(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(index_es_m_DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e&&e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||universal_provider_dist_index_es_f(e,this.namespace);return typeof i>"u"?void 0:new index_es_o(new jsonrpc_http_connection_dist_index_es_f(i))}}var index_es_js=Object.defineProperty,universal_provider_dist_index_es_R=(s,e,t)=>((s,e,t)=>e in s?index_es_js(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t)(s,"symbol"!=typeof e?e+"":e,t);class _s{constructor(e){universal_provider_dist_index_es_R(this,"name",ue),universal_provider_dist_index_es_R(this,"client"),universal_provider_dist_index_es_R(this,"httpProviders"),universal_provider_dist_index_es_R(this,"events"),universal_provider_dist_index_es_R(this,"namespace"),universal_provider_dist_index_es_R(this,"chainId"),this.namespace=e.namespace,this.events=universal_provider_dist_index_es_h("events"),this.client=universal_provider_dist_index_es_h("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(index_es_m_DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getNamespaceName(){const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return(0,utils_dist_index_es._Yb)(e).namespace}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){var e,t;const i={};return null==(t=null==(e=this.namespace)?void 0:e.accounts)||t.forEach(n=>{const a=(0,utils_dist_index_es._Yb)(n);i[a.reference]=this.createHttpProvider(n)}),i}getHttpProvider(e){const t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||universal_provider_dist_index_es_f(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new index_es_o(new jsonrpc_http_connection_dist_index_es_f(i,universal_provider_dist_index_es_h("disableProviderPing")))}}var index_es_Fs=Object.defineProperty,index_es_Us=Object.defineProperties,index_es_xs=Object.getOwnPropertyDescriptors,xe=Object.getOwnPropertySymbols,index_es_Ls=Object.prototype.hasOwnProperty,index_es_Ms=Object.prototype.propertyIsEnumerable,se=(s,e,t)=>e in s?index_es_Fs(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,index_es_G=(s,e)=>{for(var t in e||(e={}))index_es_Ls.call(e,t)&&se(s,t,e[t]);if(xe)for(var t of xe(e))index_es_Ms.call(e,t)&&se(s,t,e[t]);return s},ie=(s,e)=>index_es_Us(s,index_es_xs(e)),universal_provider_dist_index_es_v=(s,e,t)=>se(s,"symbol"!=typeof e?e+"":e,t);class dist_index_es_J{constructor(e){universal_provider_dist_index_es_v(this,"client"),universal_provider_dist_index_es_v(this,"namespaces"),universal_provider_dist_index_es_v(this,"optionalNamespaces"),universal_provider_dist_index_es_v(this,"sessionProperties"),universal_provider_dist_index_es_v(this,"scopedProperties"),universal_provider_dist_index_es_v(this,"events",new(events_default())),universal_provider_dist_index_es_v(this,"rpcProviders",{}),universal_provider_dist_index_es_v(this,"session"),universal_provider_dist_index_es_v(this,"providerOpts"),universal_provider_dist_index_es_v(this,"logger"),universal_provider_dist_index_es_v(this,"uri"),universal_provider_dist_index_es_v(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof e?.logger<"u"&&"string"!=typeof e?.logger?e.logger:(0,index_es.h6)((0,index_es.iP)({level:e?.logger||"error"})),this.disableProviderPing=e?.disableProviderPing||!1}static async init(e){const t=new dist_index_es_J(e);return await t.initialize(),t}async request(e,t,i){const[n,a]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:index_es_G({},e),chainId:`${n}:${a}`,topic:this.session.topic,expiry:i})}sendAsync(e,t,i,n){const a=(new Date).getTime();this.request(e,i,n).then(r=>t(null,formatJsonRpcResult(a,r))).catch(r=>t(r,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:null==(e=this.session)?void 0:e.topic,reason:(0,utils_dist_index_es.Hjj)("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,t){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:i,response:n}=await this.client.authenticate(e,t);i&&(this.uri=i,this.events.emit("display_uri",i));const a=await n();if(this.session=a.session,this.session){const r=index_es_He(this.session.namespaces);this.namespaces=index_es_B(this.namespaces,r),await this.persist("namespaces",this.namespaces),this.onConnect()}return a}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){const{uri:t,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});t&&(this.uri=t,this.events.emit("display_uri",t));const n=await i();this.session=n;const a=index_es_He(n.namespaces);return this.namespaces=index_es_B(this.namespaces,a),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;const[i,n]=this.validateChain(e);this.getProvider(i).setDefaultChain(n,t)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){try{this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(!(0,utils_dist_index_es.OP1)(t))return;for(const i of t)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}catch(t){this.logger.warn("Failed to cleanup pending pairings",t)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,t;if(this.client=this.providerOpts.client||await index_es_fe.init({core:this.providerOpts.core,logger:this.providerOpts.logger||"error",relayUrl:this.providerOpts.relayUrl||"wss://relay.walletconnect.org",projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(i){throw this.logger.error("Failed to get session",i),new Error(`The provided session: ${null==(t=null==(e=this.providerOpts)?void 0:e.session)?void 0:t.topic} doesn't exist in the Sign client`)}else{const i=this.client.session.getAll();this.session=i[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(t=>(0,utils_dist_index_es.kob)(t)))];index_es_X("client",this.client),index_es_X("events",this.events),index_es_X("disableProviderPing",this.disableProviderPing),e.forEach(t=>{if(!this.session)return;const i=function index_es_Nt(s,e){const t=Object.keys(e.namespaces).filter(n=>n.includes(s));if(!t.length)return[];const i=[];return t.forEach(n=>{const a=e.namespaces[n].accounts;i.push(...a)}),i}(t,this.session);if(0===i?.length)return;const n=index_es_Oe(i),a=index_es_B(this.namespaces,this.optionalNamespaces),r=ie(index_es_G({},a[t]),{accounts:i,chains:n});switch(t){case"eip155":this.rpcProviders[t]=new os({namespace:r});break;case"algorand":this.rpcProviders[t]=new gs({namespace:r});break;case"solana":this.rpcProviders[t]=new ds({namespace:r});break;case"cosmos":this.rpcProviders[t]=new fs({namespace:r});break;case"polkadot":this.rpcProviders[t]=new ss({namespace:r});break;case"cip34":this.rpcProviders[t]=new ys({namespace:r});break;case"elrond":this.rpcProviders[t]=new index_es_$s({namespace:r});break;case"multiversx":this.rpcProviders[t]=new index_es_As({namespace:r});break;case"near":this.rpcProviders[t]=new Ss({namespace:r});break;case"tezos":this.rpcProviders[t]=new index_es_Ds({namespace:r});break;default:this.rpcProviders[t]=new _s({namespace:r})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var t;const{topic:i}=e;i===(null==(t=this.session)?void 0:t.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var t;const{params:i,topic:n}=e;if(n!==(null==(t=this.session)?void 0:t.topic))return;const{event:a}=i;if("accountsChanged"===a.name){const r=a.data;r&&(0,utils_dist_index_es.OP1)(r)&&this.events.emit("accountsChanged",r.map(Ee))}else if("chainChanged"===a.name){const r=i.chainId,c=i.event.data,o=(0,utils_dist_index_es.kob)(r),d=index_es_Y(r)!==index_es_Y(c)?`${o}:${index_es_Y(c)}`:r;this.onChainChanged(d)}else this.events.emit(a.name,a.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var i,n;if(e!==(null==(i=this.session)?void 0:i.topic))return;const{namespaces:a}=t,r=null==(n=this.client)?void 0:n.session.get(e);this.session=ie(index_es_G({},r),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{var t;e.topic===(null==(t=this.session)?void 0:t.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",ie(index_es_G({},(0,utils_dist_index_es.Hjj)("USER_DISCONNECTED")),{data:e.topic})))}),this.on(index_es_m_DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[ue]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace(null==(t=this.session)?void 0:t.namespaces[e])})}setNamespaces(e){const{namespaces:t={},optionalNamespaces:i={},sessionProperties:n,scopedProperties:a}=e;this.optionalNamespaces=index_es_B(t,i),this.sessionProperties=n,this.scopedProperties=a}validateChain(e){const[t,i]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,i];if(t&&!Object.keys(this.namespaces||{}).map(r=>(0,utils_dist_index_es.kob)(r)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&i)return[t,i];const n=(0,utils_dist_index_es.kob)(Object.keys(this.namespaces)[0]);return[n,this.rpcProviders[n].getDefaultChain()]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged(e,t=!1){if(!this.namespaces)return;const[i,n]=this.validateChain(e);if(!n)return;this.updateNamespaceChain(i,n);const a=this.getProvider(i).getDefaultChain();t?(this.events.emit("chainChanged",n),this.emitAccountsChangedOnChainChange({namespace:i,previousChainId:a,newChainId:e})):this.getProvider(i).setDefaultChain(n),await this.persist("namespaces",this.namespaces)}emitAccountsChangedOnChainChange({namespace:e,previousChainId:t,newChainId:i}){var n,a;try{if(t===i)return;const r=null==(a=null==(n=this.session)?void 0:n.namespaces[e])?void 0:a.accounts;if(!r)return;const c=r.filter(o=>o.includes(`${i}:`)).map(Ee);if(!(0,utils_dist_index_es.OP1)(c))return;this.events.emit("accountsChanged",c)}catch(r){this.logger.warn("Failed to emit accountsChanged on chain change",r)}}updateNamespaceChain(e,t){if(!this.namespaces)return;const i=this.namespaces[e]?e:`${e}:${t}`,n={chains:[],methods:[],events:[],defaultChain:t};this.namespaces[i]?this.namespaces[i]&&(this.namespaces[i].defaultChain=t):this.namespaces[i]=n}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,t){var i;const n=(null==(i=this.session)?void 0:i.topic)||"";await this.client.core.storage.setItem(`wc@2:universal_provider:/${e}${n}`,t)}async getFromStore(e){var t;const i=(null==(t=this.session)?void 0:t.topic)||"";return await this.client.core.storage.getItem(`wc@2:universal_provider:/${e}${i}`)}async deleteFromStore(e){var t;const i=(null==(t=this.session)?void 0:t.topic)||"";await this.client.core.storage.removeItem(`wc@2:universal_provider:/${e}${i}`)}async cleanupStorage(){var e;try{if((null==(e=this.client)?void 0:e.session.length)>0)return;const t=await this.client.core.storage.getKeys();for(const i of t)i.startsWith("wc@2:universal_provider:")&&await this.client.core.storage.removeItem(i)}catch(t){this.logger.warn("Failed to cleanup storage",t)}}}const Bs=dist_index_es_J},"./node_modules/@walletconnect/utils/dist/index.es.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{bEt:()=>tt,EWt:()=>Qt,Pa8:()=>De,ZbZ:()=>gi,nyL:()=>Ha,Lp_:()=>ee,EHS:()=>ge,Van:()=>ga,muJ:()=>Ka,Xw0:()=>ii,Wx8:()=>ei,e8_:()=>Ef,K3g:()=>ni,x0t:()=>Vt,F$L:()=>Yc,YcA:()=>Zc,ovp:()=>Kc,iui:()=>Me,Tw2:()=>Wc,wa2:()=>Gc,hEn:()=>ci,PAk:()=>sf,gOF:()=>oi,hwK:()=>qr,jUZ:()=>zs,ADD:()=>ri,ojD:()=>cr,QJh:()=>oa,TZl:()=>Vc,two:()=>qc,Zz7:()=>_s,QV1:()=>af,R7U:()=>qs,lFF:()=>sr,WWN:()=>Af,jTh:()=>ui,q_h:()=>dn,GuA:()=>Et,$Bq:()=>sa,sc_:()=>If,xkc:()=>Vr,KLX:()=>cf,VBM:()=>Oe,aa1:()=>na,n6V:()=>ea,Hjj:()=>Kt,$hI:()=>li,nYL:()=>uf,mXn:()=>ff,n3s:()=>ai,EN$:()=>Fc,ALl:()=>zc,m01:()=>Ms,sKr:()=>Pa,BdH:()=>zt,nWe:()=>Pn,XqR:()=>cs,_dF:()=>fi,aRZ:()=>Vs,Lln:()=>Ye,sc7:()=>ja,CTo:()=>wa,lVv:()=>Bt,HNf:()=>ya,mr0:()=>xa,w8K:()=>hi,V7m:()=>Jc,ps1:()=>Qc,b07:()=>kt,OP1:()=>me,tk0:()=>va,X3c:()=>Sa,FR8:()=>Ua,Alu:()=>Ia,FiO:()=>is,tLy:()=>_a,z2N:()=>Ra,oKp:()=>Ta,aF0:()=>Ve,TeY:()=>Aa,kuU:()=>fs,V9G:()=>Ba,iV1:()=>Na,Hbs:()=>La,esh:()=>Ea,M8n:()=>Oa,Qhg:()=>it,AYU:()=>ma,h0Y:()=>Ys,TRk:()=>ct,hVC:()=>Bf,XEe:()=>ba,PUk:()=>Xs,_Yb:()=>Fe,c82:()=>si,kob:()=>Yo,wYp:()=>ra,Ds_:()=>Ks,yy4:()=>pi,uym:()=>ka,gZm:()=>di,C5G:()=>Xc,AwN:()=>Ho,IjX:()=>yf,U0i:()=>ta});var process=__webpack_require__("./node_modules/process/browser.js"),__spreadArray=function(to,from,pack){if(pack||2===arguments.length)for(var ar,i=0,l=from.length;i<l;i++)!ar&&i in from||(ar||(ar=Array.prototype.slice.call(from,0,i)),ar[i]=from[i]);return to.concat(ar||Array.prototype.slice.call(from))},BrowserInfo=function BrowserInfo(name,version,os){this.name=name,this.version=version,this.os=os,this.type="browser"},NodeInfo=function NodeInfo(version){this.version=version,this.type="node",this.name="node",this.os=process.platform},SearchBotDeviceInfo=function SearchBotDeviceInfo(name,version,os,bot){this.name=name,this.version=version,this.os=os,this.bot=bot,this.type="bot-device"},BotInfo=function BotInfo(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},ReactNativeInfo=function ReactNativeInfo(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},SEARCHBOT_OS_REGEX=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,REQUIRED_VERSION_PARTS=3,userAgentRules=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],operatingSystemRules=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function detect(userAgent){return userAgent?parseUserAgent(userAgent):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new ReactNativeInfo:"undefined"!=typeof navigator?parseUserAgent(navigator.userAgent):function getNodeVersion(){return void 0!==process&&process.version?new NodeInfo(process.version.slice(1)):null}()}function matchUserAgent(ua){return""!==ua&&userAgentRules.reduce(function(matched,_a){var browser=_a[0],regex=_a[1];if(matched)return matched;var uaMatch=regex.exec(ua);return!!uaMatch&&[browser,uaMatch]},!1)}function parseUserAgent(ua){var matchedRule=matchUserAgent(ua);if(!matchedRule)return null;var name=matchedRule[0],match=matchedRule[1];if("searchbot"===name)return new BotInfo;var versionParts=match[1]&&match[1].split(".").join("_").split("_").slice(0,3);versionParts?versionParts.length<REQUIRED_VERSION_PARTS&&(versionParts=__spreadArray(__spreadArray([],versionParts,!0),function createVersionParts(count){for(var output=[],ii=0;ii<count;ii++)output.push("0");return output}(REQUIRED_VERSION_PARTS-versionParts.length),!0)):versionParts=[];var version=versionParts.join("."),os=function detectOS(ua){for(var ii=0,count=operatingSystemRules.length;ii<count;ii++){var _a=operatingSystemRules[ii],os=_a[0];if(_a[1].exec(ua))return os}return null}(ua),searchBotMatch=SEARCHBOT_OS_REGEX.exec(ua);return searchBotMatch&&searchBotMatch[1]?new SearchBotDeviceInfo(name,version,os,searchBotMatch[1]):new BrowserInfo(name,version,os)}var cjs=__webpack_require__("./node_modules/@walletconnect/time/dist/cjs/index.js"),dist_cjs=__webpack_require__("./node_modules/@walletconnect/window-getters/dist/cjs/index.js"),window_metadata_dist_cjs=__webpack_require__("./node_modules/@walletconnect/window-metadata/dist/cjs/index.js");let errorConfig={getDocsUrl:({docsBaseUrl,docsPath="",docsSlug})=>docsPath?`${docsBaseUrl??"https://viem.sh"}${docsPath}${docsSlug?`#${docsSlug}`:""}`:void 0,version:"viem@2.31.0"};class BaseError extends Error{constructor(shortMessage,args={}){const details=args.cause instanceof BaseError?args.cause.details:args.cause?.message?args.cause.message:args.details,docsPath=args.cause instanceof BaseError&&args.cause.docsPath||args.docsPath,docsUrl=errorConfig.getDocsUrl?.({...args,docsPath});super([shortMessage||"An error occurred.","",...args.metaMessages?[...args.metaMessages,""]:[],...docsUrl?[`Docs: ${docsUrl}`]:[],...details?[`Details: ${details}`]:[],...errorConfig.version?[`Version: ${errorConfig.version}`]:[]].join("\n"),args.cause?{cause:args.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=details,this.docsPath=docsPath,this.metaMessages=args.metaMessages,this.name=args.name??this.name,this.shortMessage=shortMessage,this.version="2.31.0"}walk(fn){return walk(this,fn)}}function walk(err,fn){return fn?.(err)?err:err&&"object"==typeof err&&"cause"in err&&void 0!==err.cause?walk(err.cause,fn):fn?null:err}function isHex(value,{strict=!0}={}){return!!value&&("string"==typeof value&&(strict?/^0x[0-9a-fA-F]*$/.test(value):value.startsWith("0x")))}class SizeExceedsPaddingSizeError extends BaseError{constructor({size,targetSize,type}){super(`${type.charAt(0).toUpperCase()}${type.slice(1).toLowerCase()} size (${size}) exceeds padding size (${targetSize}).`,{name:"SizeExceedsPaddingSizeError"})}}function pad(hexOrBytes,{dir,size=32}={}){return"string"==typeof hexOrBytes?function padHex(hex_,{dir,size=32}={}){if(null===size)return hex_;const hex=hex_.replace("0x","");if(hex.length>2*size)throw new SizeExceedsPaddingSizeError({size:Math.ceil(hex.length/2),targetSize:size,type:"hex"});return`0x${hex["right"===dir?"padEnd":"padStart"](2*size,"0")}`}(hexOrBytes,{dir,size}):function padBytes(bytes,{dir,size=32}={}){if(null===size)return bytes;if(bytes.length>size)throw new SizeExceedsPaddingSizeError({size:bytes.length,targetSize:size,type:"bytes"});const paddedBytes=new Uint8Array(size);for(let i=0;i<size;i++){const padEnd="right"===dir;paddedBytes[padEnd?i:size-i-1]=bytes[padEnd?i:bytes.length-i-1]}return paddedBytes}(hexOrBytes,{dir,size})}class IntegerOutOfRangeError extends BaseError{constructor({max,min,signed,size,value}){super(`Number "${value}" is not in safe ${size?`${8*size}-bit ${signed?"signed":"unsigned"} `:""}integer range ${max?`(${min} to ${max})`:`(above ${min})`}`,{name:"IntegerOutOfRangeError"})}}class SizeOverflowError extends BaseError{constructor({givenSize,maxSize}){super(`Size cannot exceed ${maxSize} bytes. Given size: ${givenSize} bytes.`,{name:"SizeOverflowError"})}}function size_size(value){return isHex(value,{strict:!1})?Math.ceil((value.length-2)/2):value.length}function assertSize(hexOrBytes,{size}){if(size_size(hexOrBytes)>size)throw new SizeOverflowError({givenSize:size_size(hexOrBytes),maxSize:size})}function hexToBigInt(hex,opts={}){const{signed}=opts;opts.size&&assertSize(hex,{size:opts.size});const value=BigInt(hex);if(!signed)return value;const size=(hex.length-2)/2;return value<=(1n<<8n*BigInt(size)-1n)-1n?value:value-BigInt(`0x${"f".padStart(2*size,"f")}`)-1n}function hexToNumber(hex,opts={}){return Number(hexToBigInt(hex,opts))}const hexes=Array.from({length:256},(_v,i)=>i.toString(16).padStart(2,"0"));function toHex(value,opts={}){return"number"==typeof value||"bigint"==typeof value?numberToHex(value,opts):"string"==typeof value?function stringToHex(value_,opts={}){const value=encoder.encode(value_);return bytesToHex(value,opts)}(value,opts):"boolean"==typeof value?function boolToHex(value,opts={}){const hex=`0x${Number(value)}`;if("number"==typeof opts.size)return assertSize(hex,{size:opts.size}),pad(hex,{size:opts.size});return hex}(value,opts):bytesToHex(value,opts)}function bytesToHex(value,opts={}){let string="";for(let i=0;i<value.length;i++)string+=hexes[value[i]];const hex=`0x${string}`;return"number"==typeof opts.size?(assertSize(hex,{size:opts.size}),pad(hex,{dir:"right",size:opts.size})):hex}function numberToHex(value_,opts={}){const{signed,size}=opts,value=BigInt(value_);let maxValue;size?maxValue=signed?(1n<<8n*BigInt(size)-1n)-1n:2n**(8n*BigInt(size))-1n:"number"==typeof value_&&(maxValue=BigInt(Number.MAX_SAFE_INTEGER));const minValue="bigint"==typeof maxValue&&signed?-maxValue-1n:0;if(maxValue&&value>maxValue||value<minValue){const suffix="bigint"==typeof value_?"n":"";throw new IntegerOutOfRangeError({max:maxValue?`${maxValue}${suffix}`:void 0,min:`${minValue}${suffix}`,signed,size,value:`${value_}${suffix}`})}const hex=`0x${(signed&&value<0?(1n<<BigInt(8*size))+BigInt(value):value).toString(16)}`;return size?pad(hex,{size}):hex}const encoder=new TextEncoder;const toBytes_encoder=new TextEncoder;function toBytes(value,opts={}){return"number"==typeof value||"bigint"==typeof value?function numberToBytes(value,opts){const hex=numberToHex(value,opts);return toBytes_hexToBytes(hex)}(value,opts):"boolean"==typeof value?function boolToBytes(value,opts={}){const bytes=new Uint8Array(1);if(bytes[0]=Number(value),"number"==typeof opts.size)return assertSize(bytes,{size:opts.size}),pad(bytes,{size:opts.size});return bytes}(value,opts):isHex(value)?toBytes_hexToBytes(value,opts):stringToBytes(value,opts)}const charCodeMap={zero:48,nine:57,A:65,F:70,a:97,f:102};function charCodeToBase16(char){return char>=charCodeMap.zero&&char<=charCodeMap.nine?char-charCodeMap.zero:char>=charCodeMap.A&&char<=charCodeMap.F?char-(charCodeMap.A-10):char>=charCodeMap.a&&char<=charCodeMap.f?char-(charCodeMap.a-10):void 0}function toBytes_hexToBytes(hex_,opts={}){let hex=hex_;opts.size&&(assertSize(hex,{size:opts.size}),hex=pad(hex,{dir:"right",size:opts.size}));let hexString=hex.slice(2);hexString.length%2&&(hexString=`0${hexString}`);const length=hexString.length/2,bytes=new Uint8Array(length);for(let index=0,j=0;index<length;index++){const nibbleLeft=charCodeToBase16(hexString.charCodeAt(j++)),nibbleRight=charCodeToBase16(hexString.charCodeAt(j++));if(void 0===nibbleLeft||void 0===nibbleRight)throw new BaseError(`Invalid byte sequence ("${hexString[j-2]}${hexString[j-1]}" in "${hexString}").`);bytes[index]=16*nibbleLeft+nibbleRight}return bytes}function stringToBytes(value,opts={}){const bytes=toBytes_encoder.encode(value);return"number"==typeof opts.size?(assertSize(bytes,{size:opts.size}),pad(bytes,{dir:"right",size:opts.size})):bytes}var sha3=__webpack_require__("./node_modules/@noble/hashes/esm/sha3.js");function keccak256(value,to_){const to=to_||"hex",bytes=(0,sha3.lY)(isHex(value,{strict:!1})?toBytes(value):value);return"bytes"===to?bytes:toHex(bytes)}class LruMap extends Map{constructor(size){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=size}get(key){const value=super.get(key);return super.has(key)&&void 0!==value&&(this.delete(key),super.set(key,value)),value}set(key,value){if(super.set(key,value),this.maxSize&&this.size>this.maxSize){const firstKey=this.keys().next().value;firstKey&&this.delete(firstKey)}return this}}const checksumAddressCache=new LruMap(8192);function checksumAddress(address_,chainId){if(checksumAddressCache.has(`${address_}.${chainId}`))return checksumAddressCache.get(`${address_}.${chainId}`);const hexAddress=chainId?`${chainId}${address_.toLowerCase()}`:address_.substring(2).toLowerCase(),hash=keccak256(stringToBytes(hexAddress),"bytes"),address=(chainId?hexAddress.substring(`${chainId}0x`.length):hexAddress).split("");for(let i=0;i<40;i+=2)hash[i>>1]>>4>=8&&address[i]&&(address[i]=address[i].toUpperCase()),(15&hash[i>>1])>=8&&address[i+1]&&(address[i+1]=address[i+1].toUpperCase());const result=`0x${address.join("")}`;return checksumAddressCache.set(`${address_}.${chainId}`,result),result}function toRecoveryBit(yParityOrV){if(0===yParityOrV||1===yParityOrV)return yParityOrV;if(27===yParityOrV)return 0;if(28===yParityOrV)return 1;throw new Error("Invalid yParityOrV value")}async function recoverAddress({hash,signature}){return function publicKeyToAddress(publicKey){return checksumAddress(`0x${keccak256(`0x${publicKey.substring(4)}`).substring(26)}`)}(await async function recoverPublicKey({hash,signature}){const hashHex=isHex(hash)?hash:toHex(hash),{secp256k1}=await __webpack_require__.e(5775).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@walletconnect/utils/node_modules/viem/node_modules/@noble/curves/esm/secp256k1.js"));return`0x${(()=>{if("object"==typeof signature&&"r"in signature&&"s"in signature){const{r,s,v,yParity}=signature,recoveryBit=toRecoveryBit(Number(yParity??v));return new secp256k1.Signature(hexToBigInt(r),hexToBigInt(s)).addRecoveryBit(recoveryBit)}const signatureHex=isHex(signature)?signature:toHex(signature);if(65!==size_size(signatureHex))throw new Error("invalid signature length");const recoveryBit=toRecoveryBit(hexToNumber(`0x${signatureHex.slice(130)}`));return secp256k1.Signature.fromCompact(signatureHex.substring(2,130)).addRecoveryBit(recoveryBit)})().recoverPublicKey(hashHex.substring(2)).toHex(!1)}`}({hash,signature}))}var esm=__webpack_require__("./node_modules/bs58/src/esm/index.js");function prettyByte(byte){return`${byte<0?"-":""}0x${Math.abs(byte).toString(16).padStart(2,"0")}`}class ExtData{constructor(type,data){this.type=type,this.data=data}}class DecodeError extends Error{constructor(message){super(message);const proto=Object.create(DecodeError.prototype);Object.setPrototypeOf(this,proto),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:DecodeError.name})}}function setInt64(view,offset,value){const high=Math.floor(value/4294967296),low=value;view.setUint32(offset,high),view.setUint32(offset+4,low)}function getInt64(view,offset){return 4294967296*view.getInt32(offset)+view.getUint32(offset+4)}const timestampExtension={type:-1,encode:function encodeTimestampExtension(object){if(object instanceof Date){return function encodeTimeSpecToTimestamp({sec,nsec}){if(sec>=0&&nsec>=0&&sec<=17179869183){if(0===nsec&&sec<=4294967295){const rv=new Uint8Array(4);return new DataView(rv.buffer).setUint32(0,sec),rv}{const secHigh=sec/4294967296,secLow=4294967295&sec,rv=new Uint8Array(8),view=new DataView(rv.buffer);return view.setUint32(0,nsec<<2|3&secHigh),view.setUint32(4,secLow),rv}}{const rv=new Uint8Array(12),view=new DataView(rv.buffer);return view.setUint32(0,nsec),setInt64(view,4,sec),rv}}(function encodeDateToTimeSpec(date){const msec=date.getTime(),sec=Math.floor(msec/1e3),nsec=1e6*(msec-1e3*sec),nsecInSec=Math.floor(nsec/1e9);return{sec:sec+nsecInSec,nsec:nsec-1e9*nsecInSec}}(object))}return null},decode:function decodeTimestampExtension(data){const timeSpec=function decodeTimestampToTimeSpec(data){const view=new DataView(data.buffer,data.byteOffset,data.byteLength);switch(data.byteLength){case 4:return{sec:view.getUint32(0),nsec:0};case 8:{const nsec30AndSecHigh2=view.getUint32(0);return{sec:4294967296*(3&nsec30AndSecHigh2)+view.getUint32(4),nsec:nsec30AndSecHigh2>>>2}}case 12:return{sec:getInt64(view,4),nsec:view.getUint32(0)};default:throw new DecodeError(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${data.length}`)}}(data);return new Date(1e3*timeSpec.sec+timeSpec.nsec/1e6)}};class ExtensionCodec{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(timestampExtension)}register({type,encode,decode}){if(type>=0)this.encoders[type]=encode,this.decoders[type]=decode;else{const index=-1-type;this.builtInEncoders[index]=encode,this.builtInDecoders[index]=decode}}tryToEncode(object,context){for(let i=0;i<this.builtInEncoders.length;i++){const encodeExt=this.builtInEncoders[i];if(null!=encodeExt){const data=encodeExt(object,context);if(null!=data){return new ExtData(-1-i,data)}}}for(let i=0;i<this.encoders.length;i++){const encodeExt=this.encoders[i];if(null!=encodeExt){const data=encodeExt(object,context);if(null!=data){return new ExtData(i,data)}}}return object instanceof ExtData?object:null}decode(data,type,context){const decodeExt=type<0?this.builtInDecoders[-1-type]:this.decoders[type];return decodeExt?decodeExt(data,type,context):new ExtData(type,data)}}ExtensionCodec.defaultCodec=new ExtensionCodec;const sharedTextEncoder=new TextEncoder;function utf8Encode(str,output,outputOffset){str.length>50?function utf8EncodeTE(str,output,outputOffset){sharedTextEncoder.encodeInto(str,output.subarray(outputOffset))}(str,output,outputOffset):function utf8EncodeJs(str,output,outputOffset){const strLength=str.length;let offset=outputOffset,pos=0;for(;pos<strLength;){let value=str.charCodeAt(pos++);if(4294967168&value){if(4294965248&value){if(value>=55296&&value<=56319&&pos<strLength){const extra=str.charCodeAt(pos);56320==(64512&extra)&&(++pos,value=((1023&value)<<10)+(1023&extra)+65536)}4294901760&value?(output[offset++]=value>>18&7|240,output[offset++]=value>>12&63|128,output[offset++]=value>>6&63|128):(output[offset++]=value>>12&15|224,output[offset++]=value>>6&63|128)}else output[offset++]=value>>6&31|192;output[offset++]=63&value|128}else output[offset++]=value}}(str,output,outputOffset)}function utf8DecodeJs(bytes,inputOffset,byteLength){let offset=inputOffset;const end=offset+byteLength,units=[];let result="";for(;offset<end;){const byte1=bytes[offset++];if(128&byte1)if(192==(224&byte1)){const byte2=63&bytes[offset++];units.push((31&byte1)<<6|byte2)}else if(224==(240&byte1)){const byte2=63&bytes[offset++],byte3=63&bytes[offset++];units.push((31&byte1)<<12|byte2<<6|byte3)}else if(240==(248&byte1)){let unit=(7&byte1)<<18|(63&bytes[offset++])<<12|(63&bytes[offset++])<<6|63&bytes[offset++];unit>65535&&(unit-=65536,units.push(unit>>>10&1023|55296),unit=56320|1023&unit),units.push(unit)}else units.push(byte1);else units.push(byte1);units.length>=4096&&(result+=String.fromCharCode(...units),units.length=0)}return units.length>0&&(result+=String.fromCharCode(...units)),result}const sharedTextDecoder=new TextDecoder;function utf8Decode(bytes,inputOffset,byteLength){return byteLength>200?function utf8DecodeTD(bytes,inputOffset,byteLength){const stringBytes=bytes.subarray(inputOffset,inputOffset+byteLength);return sharedTextDecoder.decode(stringBytes)}(bytes,inputOffset,byteLength):utf8DecodeJs(bytes,inputOffset,byteLength)}function ensureUint8Array(buffer){return buffer instanceof Uint8Array?buffer:ArrayBuffer.isView(buffer)?new Uint8Array(buffer.buffer,buffer.byteOffset,buffer.byteLength):function isArrayBufferLike(buffer){return buffer instanceof ArrayBuffer||"undefined"!=typeof SharedArrayBuffer&&buffer instanceof SharedArrayBuffer}(buffer)?new Uint8Array(buffer):Uint8Array.from(buffer)}const mapKeyConverter=key=>{if("string"==typeof key||"number"==typeof key)return key;throw new DecodeError("The type of key must be string or number but "+typeof key)};class StackPool{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(size){const state=this.getUninitializedStateFromPool();state.type="array",state.position=0,state.size=size,state.array=new Array(size)}pushMapState(size){const state=this.getUninitializedStateFromPool();state.type="map_key",state.readCount=0,state.size=size,state.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const partialState={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(partialState)}return this.stack[this.stackHeadPosition]}release(state){if(this.stack[this.stackHeadPosition]!==state)throw new Error("Invalid stack state. Released state is not on top of the stack.");if("array"===state.type){const partialState=state;partialState.size=0,partialState.array=void 0,partialState.position=0,partialState.type=void 0}if("map_key"===state.type||"map_value"===state.type){const partialState=state;partialState.size=0,partialState.map=void 0,partialState.readCount=0,partialState.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const EMPTY_VIEW=new DataView(new ArrayBuffer(0)),EMPTY_BYTES=new Uint8Array(EMPTY_VIEW.buffer);try{EMPTY_VIEW.getInt8(0)}catch(e){if(!(e instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const MORE_DATA=new RangeError("Insufficient data"),sharedCachedKeyDecoder=new class CachedKeyDecoder{constructor(maxKeyLength=16,maxLengthPerKey=16){this.hit=0,this.miss=0,this.maxKeyLength=maxKeyLength,this.maxLengthPerKey=maxLengthPerKey,this.caches=[];for(let i=0;i<this.maxKeyLength;i++)this.caches.push([])}canBeCached(byteLength){return byteLength>0&&byteLength<=this.maxKeyLength}find(bytes,inputOffset,byteLength){const records=this.caches[byteLength-1];FIND_CHUNK:for(const record of records){const recordBytes=record.bytes;for(let j=0;j<byteLength;j++)if(recordBytes[j]!==bytes[inputOffset+j])continue FIND_CHUNK;return record.str}return null}store(bytes,value){const records=this.caches[bytes.length-1],record={bytes,str:value};records.length>=this.maxLengthPerKey?records[Math.random()*records.length|0]=record:records.push(record)}decode(bytes,inputOffset,byteLength){const cachedValue=this.find(bytes,inputOffset,byteLength);if(null!=cachedValue)return this.hit++,cachedValue;this.miss++;const str=utf8DecodeJs(bytes,inputOffset,byteLength),slicedCopyOfBytes=Uint8Array.prototype.slice.call(bytes,inputOffset,inputOffset+byteLength);return this.store(slicedCopyOfBytes,str),str}};class Decoder_Decoder{constructor(options){this.totalPos=0,this.pos=0,this.view=EMPTY_VIEW,this.bytes=EMPTY_BYTES,this.headByte=-1,this.stack=new StackPool,this.entered=!1,this.extensionCodec=options?.extensionCodec??ExtensionCodec.defaultCodec,this.context=options?.context,this.useBigInt64=options?.useBigInt64??!1,this.rawStrings=options?.rawStrings??!1,this.maxStrLength=options?.maxStrLength??4294967295,this.maxBinLength=options?.maxBinLength??4294967295,this.maxArrayLength=options?.maxArrayLength??4294967295,this.maxMapLength=options?.maxMapLength??4294967295,this.maxExtLength=options?.maxExtLength??4294967295,this.keyDecoder=void 0!==options?.keyDecoder?options.keyDecoder:sharedCachedKeyDecoder,this.mapKeyConverter=options?.mapKeyConverter??mapKeyConverter}clone(){return new Decoder_Decoder({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=-1,this.stack.reset()}setBuffer(buffer){const bytes=ensureUint8Array(buffer);this.bytes=bytes,this.view=new DataView(bytes.buffer,bytes.byteOffset,bytes.byteLength),this.pos=0}appendBuffer(buffer){if(-1!==this.headByte||this.hasRemaining(1)){const remainingData=this.bytes.subarray(this.pos),newData=ensureUint8Array(buffer),newBuffer=new Uint8Array(remainingData.length+newData.length);newBuffer.set(remainingData),newBuffer.set(newData,remainingData.length),this.setBuffer(newBuffer)}else this.setBuffer(buffer)}hasRemaining(size){return this.view.byteLength-this.pos>=size}createExtraByteError(posToShow){const{view,pos}=this;return new RangeError(`Extra ${view.byteLength-pos} of ${view.byteLength} byte(s) found at buffer[${posToShow}]`)}decode(buffer){if(this.entered){return this.clone().decode(buffer)}try{this.entered=!0,this.reinitializeState(),this.setBuffer(buffer);const object=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return object}finally{this.entered=!1}}*decodeMulti(buffer){if(this.entered){const instance=this.clone();return void(yield*instance.decodeMulti(buffer))}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(buffer);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(stream){if(this.entered){return this.clone().decodeAsync(stream)}try{this.entered=!0;let object,decoded=!1;for await(const buffer of stream){if(decoded)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(buffer);try{object=this.doDecodeSync(),decoded=!0}catch(e){if(!(e instanceof RangeError))throw e}this.totalPos+=this.pos}if(decoded){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return object}const{headByte,pos,totalPos}=this;throw new RangeError(`Insufficient data in parsing ${prettyByte(headByte)} at ${totalPos} (${pos} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(stream){return this.decodeMultiAsync(stream,!0)}decodeStream(stream){return this.decodeMultiAsync(stream,!1)}async*decodeMultiAsync(stream,isArray){if(this.entered){const instance=this.clone();return void(yield*instance.decodeMultiAsync(stream,isArray))}try{this.entered=!0;let isArrayHeaderRequired=isArray,arrayItemsLeft=-1;for await(const buffer of stream){if(isArray&&0===arrayItemsLeft)throw this.createExtraByteError(this.totalPos);this.appendBuffer(buffer),isArrayHeaderRequired&&(arrayItemsLeft=this.readArraySize(),isArrayHeaderRequired=!1,this.complete());try{for(;yield this.doDecodeSync(),0!==--arrayItemsLeft;);}catch(e){if(!(e instanceof RangeError))throw e}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){DECODE:for(;;){const headByte=this.readHeadByte();let object;if(headByte>=224)object=headByte-256;else if(headByte<192)if(headByte<128)object=headByte;else if(headByte<144){const size=headByte-128;if(0!==size){this.pushMapState(size),this.complete();continue DECODE}object={}}else if(headByte<160){const size=headByte-144;if(0!==size){this.pushArrayState(size),this.complete();continue DECODE}object=[]}else{const byteLength=headByte-160;object=this.decodeString(byteLength,0)}else if(192===headByte)object=null;else if(194===headByte)object=!1;else if(195===headByte)object=!0;else if(202===headByte)object=this.readF32();else if(203===headByte)object=this.readF64();else if(204===headByte)object=this.readU8();else if(205===headByte)object=this.readU16();else if(206===headByte)object=this.readU32();else if(207===headByte)object=this.useBigInt64?this.readU64AsBigInt():this.readU64();else if(208===headByte)object=this.readI8();else if(209===headByte)object=this.readI16();else if(210===headByte)object=this.readI32();else if(211===headByte)object=this.useBigInt64?this.readI64AsBigInt():this.readI64();else if(217===headByte){const byteLength=this.lookU8();object=this.decodeString(byteLength,1)}else if(218===headByte){const byteLength=this.lookU16();object=this.decodeString(byteLength,2)}else if(219===headByte){const byteLength=this.lookU32();object=this.decodeString(byteLength,4)}else if(220===headByte){const size=this.readU16();if(0!==size){this.pushArrayState(size),this.complete();continue DECODE}object=[]}else if(221===headByte){const size=this.readU32();if(0!==size){this.pushArrayState(size),this.complete();continue DECODE}object=[]}else if(222===headByte){const size=this.readU16();if(0!==size){this.pushMapState(size),this.complete();continue DECODE}object={}}else if(223===headByte){const size=this.readU32();if(0!==size){this.pushMapState(size),this.complete();continue DECODE}object={}}else if(196===headByte){const size=this.lookU8();object=this.decodeBinary(size,1)}else if(197===headByte){const size=this.lookU16();object=this.decodeBinary(size,2)}else if(198===headByte){const size=this.lookU32();object=this.decodeBinary(size,4)}else if(212===headByte)object=this.decodeExtension(1,0);else if(213===headByte)object=this.decodeExtension(2,0);else if(214===headByte)object=this.decodeExtension(4,0);else if(215===headByte)object=this.decodeExtension(8,0);else if(216===headByte)object=this.decodeExtension(16,0);else if(199===headByte){const size=this.lookU8();object=this.decodeExtension(size,1)}else if(200===headByte){const size=this.lookU16();object=this.decodeExtension(size,2)}else{if(201!==headByte)throw new DecodeError(`Unrecognized type byte: ${prettyByte(headByte)}`);{const size=this.lookU32();object=this.decodeExtension(size,4)}}this.complete();const stack=this.stack;for(;stack.length>0;){const state=stack.top();if("array"===state.type){if(state.array[state.position]=object,state.position++,state.position!==state.size)continue DECODE;object=state.array,stack.release(state)}else{if("map_key"===state.type){if("__proto__"===object)throw new DecodeError("The key __proto__ is not allowed");state.key=this.mapKeyConverter(object),state.type="map_value";continue DECODE}if(state.map[state.key]=object,state.readCount++,state.readCount!==state.size){state.key=null,state.type="map_key";continue DECODE}object=state.map,stack.release(state)}}return object}}readHeadByte(){return-1===this.headByte&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=-1}readArraySize(){const headByte=this.readHeadByte();switch(headByte){case 220:return this.readU16();case 221:return this.readU32();default:if(headByte<160)return headByte-144;throw new DecodeError(`Unrecognized array type byte: ${prettyByte(headByte)}`)}}pushMapState(size){if(size>this.maxMapLength)throw new DecodeError(`Max length exceeded: map length (${size}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(size)}pushArrayState(size){if(size>this.maxArrayLength)throw new DecodeError(`Max length exceeded: array length (${size}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(size)}decodeString(byteLength,headerOffset){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(byteLength,headerOffset):this.decodeBinary(byteLength,headerOffset)}decodeUtf8String(byteLength,headerOffset){if(byteLength>this.maxStrLength)throw new DecodeError(`Max length exceeded: UTF-8 byte length (${byteLength}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+headerOffset+byteLength)throw MORE_DATA;const offset=this.pos+headerOffset;let object;return object=this.stateIsMapKey()&&this.keyDecoder?.canBeCached(byteLength)?this.keyDecoder.decode(this.bytes,offset,byteLength):utf8Decode(this.bytes,offset,byteLength),this.pos+=headerOffset+byteLength,object}stateIsMapKey(){if(this.stack.length>0){return"map_key"===this.stack.top().type}return!1}decodeBinary(byteLength,headOffset){if(byteLength>this.maxBinLength)throw new DecodeError(`Max length exceeded: bin length (${byteLength}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(byteLength+headOffset))throw MORE_DATA;const offset=this.pos+headOffset,object=this.bytes.subarray(offset,offset+byteLength);return this.pos+=headOffset+byteLength,object}decodeExtension(size,headOffset){if(size>this.maxExtLength)throw new DecodeError(`Max length exceeded: ext length (${size}) > maxExtLength (${this.maxExtLength})`);const extType=this.view.getInt8(this.pos+headOffset),data=this.decodeBinary(size,headOffset+1);return this.extensionCodec.decode(data,extType,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const value=this.view.getUint8(this.pos);return this.pos++,value}readI8(){const value=this.view.getInt8(this.pos);return this.pos++,value}readU16(){const value=this.view.getUint16(this.pos);return this.pos+=2,value}readI16(){const value=this.view.getInt16(this.pos);return this.pos+=2,value}readU32(){const value=this.view.getUint32(this.pos);return this.pos+=4,value}readI32(){const value=this.view.getInt32(this.pos);return this.pos+=4,value}readU64(){const value=function getUint64(view,offset){return 4294967296*view.getUint32(offset)+view.getUint32(offset+4)}(this.view,this.pos);return this.pos+=8,value}readI64(){const value=getInt64(this.view,this.pos);return this.pos+=8,value}readU64AsBigInt(){const value=this.view.getBigUint64(this.pos);return this.pos+=8,value}readI64AsBigInt(){const value=this.view.getBigInt64(this.pos);return this.pos+=8,value}readF32(){const value=this.view.getFloat32(this.pos);return this.pos+=4,value}readF64(){const value=this.view.getFloat64(this.pos);return this.pos+=8,value}}class Encoder{constructor(options){this.entered=!1,this.extensionCodec=options?.extensionCodec??ExtensionCodec.defaultCodec,this.context=options?.context,this.useBigInt64=options?.useBigInt64??!1,this.maxDepth=options?.maxDepth??100,this.initialBufferSize=options?.initialBufferSize??2048,this.sortKeys=options?.sortKeys??!1,this.forceFloat32=options?.forceFloat32??!1,this.ignoreUndefined=options?.ignoreUndefined??!1,this.forceIntegerToFloat=options?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new Encoder({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(object){if(this.entered){return this.clone().encodeSharedRef(object)}try{return this.entered=!0,this.reinitializeState(),this.doEncode(object,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(object){if(this.entered){return this.clone().encode(object)}try{return this.entered=!0,this.reinitializeState(),this.doEncode(object,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(object,depth){if(depth>this.maxDepth)throw new Error(`Too deep objects in depth ${depth}`);null==object?this.encodeNil():"boolean"==typeof object?this.encodeBoolean(object):"number"==typeof object?this.forceIntegerToFloat?this.encodeNumberAsFloat(object):this.encodeNumber(object):"string"==typeof object?this.encodeString(object):this.useBigInt64&&"bigint"==typeof object?this.encodeBigInt64(object):this.encodeObject(object,depth)}ensureBufferSizeToWrite(sizeToWrite){const requiredSize=this.pos+sizeToWrite;this.view.byteLength<requiredSize&&this.resizeBuffer(2*requiredSize)}resizeBuffer(newSize){const newBuffer=new ArrayBuffer(newSize),newBytes=new Uint8Array(newBuffer),newView=new DataView(newBuffer);newBytes.set(this.bytes),this.view=newView,this.bytes=newBytes}encodeNil(){this.writeU8(192)}encodeBoolean(object){!1===object?this.writeU8(194):this.writeU8(195)}encodeNumber(object){!this.forceIntegerToFloat&&Number.isSafeInteger(object)?object>=0?object<128?this.writeU8(object):object<256?(this.writeU8(204),this.writeU8(object)):object<65536?(this.writeU8(205),this.writeU16(object)):object<4294967296?(this.writeU8(206),this.writeU32(object)):this.useBigInt64?this.encodeNumberAsFloat(object):(this.writeU8(207),this.writeU64(object)):object>=-32?this.writeU8(224|object+32):object>=-128?(this.writeU8(208),this.writeI8(object)):object>=-32768?(this.writeU8(209),this.writeI16(object)):object>=-2147483648?(this.writeU8(210),this.writeI32(object)):this.useBigInt64?this.encodeNumberAsFloat(object):(this.writeU8(211),this.writeI64(object)):this.encodeNumberAsFloat(object)}encodeNumberAsFloat(object){this.forceFloat32?(this.writeU8(202),this.writeF32(object)):(this.writeU8(203),this.writeF64(object))}encodeBigInt64(object){object>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(object)):(this.writeU8(211),this.writeBigInt64(object))}writeStringHeader(byteLength){if(byteLength<32)this.writeU8(160+byteLength);else if(byteLength<256)this.writeU8(217),this.writeU8(byteLength);else if(byteLength<65536)this.writeU8(218),this.writeU16(byteLength);else{if(!(byteLength<4294967296))throw new Error(`Too long string: ${byteLength} bytes in UTF-8`);this.writeU8(219),this.writeU32(byteLength)}}encodeString(object){const byteLength=function utf8Count(str){const strLength=str.length;let byteLength=0,pos=0;for(;pos<strLength;){let value=str.charCodeAt(pos++);if(4294967168&value)if(4294965248&value){if(value>=55296&&value<=56319&&pos<strLength){const extra=str.charCodeAt(pos);56320==(64512&extra)&&(++pos,value=((1023&value)<<10)+(1023&extra)+65536)}byteLength+=4294901760&value?4:3}else byteLength+=2;else byteLength++}return byteLength}(object);this.ensureBufferSizeToWrite(5+byteLength),this.writeStringHeader(byteLength),utf8Encode(object,this.bytes,this.pos),this.pos+=byteLength}encodeObject(object,depth){const ext=this.extensionCodec.tryToEncode(object,this.context);if(null!=ext)this.encodeExtension(ext);else if(Array.isArray(object))this.encodeArray(object,depth);else if(ArrayBuffer.isView(object))this.encodeBinary(object);else{if("object"!=typeof object)throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(object)}`);this.encodeMap(object,depth)}}encodeBinary(object){const size=object.byteLength;if(size<256)this.writeU8(196),this.writeU8(size);else if(size<65536)this.writeU8(197),this.writeU16(size);else{if(!(size<4294967296))throw new Error(`Too large binary: ${size}`);this.writeU8(198),this.writeU32(size)}const bytes=ensureUint8Array(object);this.writeU8a(bytes)}encodeArray(object,depth){const size=object.length;if(size<16)this.writeU8(144+size);else if(size<65536)this.writeU8(220),this.writeU16(size);else{if(!(size<4294967296))throw new Error(`Too large array: ${size}`);this.writeU8(221),this.writeU32(size)}for(const item of object)this.doEncode(item,depth+1)}countWithoutUndefined(object,keys){let count=0;for(const key of keys)void 0!==object[key]&&count++;return count}encodeMap(object,depth){const keys=Object.keys(object);this.sortKeys&&keys.sort();const size=this.ignoreUndefined?this.countWithoutUndefined(object,keys):keys.length;if(size<16)this.writeU8(128+size);else if(size<65536)this.writeU8(222),this.writeU16(size);else{if(!(size<4294967296))throw new Error(`Too large map object: ${size}`);this.writeU8(223),this.writeU32(size)}for(const key of keys){const value=object[key];this.ignoreUndefined&&void 0===value||(this.encodeString(key),this.doEncode(value,depth+1))}}encodeExtension(ext){if("function"==typeof ext.data){const data=ext.data(this.pos+6),size=data.length;if(size>=4294967296)throw new Error(`Too large extension object: ${size}`);return this.writeU8(201),this.writeU32(size),this.writeI8(ext.type),void this.writeU8a(data)}const size=ext.data.length;if(1===size)this.writeU8(212);else if(2===size)this.writeU8(213);else if(4===size)this.writeU8(214);else if(8===size)this.writeU8(215);else if(16===size)this.writeU8(216);else if(size<256)this.writeU8(199),this.writeU8(size);else if(size<65536)this.writeU8(200),this.writeU16(size);else{if(!(size<4294967296))throw new Error(`Too large extension object: ${size}`);this.writeU8(201),this.writeU32(size)}this.writeI8(ext.type),this.writeU8a(ext.data)}writeU8(value){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,value),this.pos++}writeU8a(values){const size=values.length;this.ensureBufferSizeToWrite(size),this.bytes.set(values,this.pos),this.pos+=size}writeI8(value){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,value),this.pos++}writeU16(value){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,value),this.pos+=2}writeI16(value){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,value),this.pos+=2}writeU32(value){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,value),this.pos+=4}writeI32(value){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,value),this.pos+=4}writeF32(value){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,value),this.pos+=4}writeF64(value){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,value),this.pos+=8}writeU64(value){this.ensureBufferSizeToWrite(8),function setUint64(view,offset,value){const high=value/4294967296,low=value;view.setUint32(offset,high),view.setUint32(offset+4,low)}(this.view,this.pos,value),this.pos+=8}writeI64(value){this.ensureBufferSizeToWrite(8),setInt64(this.view,this.pos,value),this.pos+=8}writeBigUint64(value){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,value),this.pos+=8}writeBigInt64(value){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,value),this.pos+=8}}function isBytes(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function abytes(b,...lengths){if(!isBytes(b))throw new Error("Uint8Array expected");if(lengths.length>0&&!lengths.includes(b.length))throw new Error("Uint8Array expected of length "+lengths+", got length="+b.length)}function isArrayOf(isString,arr){return!!Array.isArray(arr)&&(0===arr.length||(isString?arr.every(item=>"string"==typeof item):arr.every(item=>Number.isSafeInteger(item))))}function afn(input){if("function"!=typeof input)throw new Error("function expected");return!0}function astr(label,input){if("string"!=typeof input)throw new Error(`${label}: string expected`);return!0}function anumber(n){if(!Number.isSafeInteger(n))throw new Error(`invalid integer: ${n}`)}function aArr(input){if(!Array.isArray(input))throw new Error("array expected")}function astrArr(label,input){if(!isArrayOf(!0,input))throw new Error(`${label}: array of strings expected`)}function anumArr(label,input){if(!isArrayOf(!1,input))throw new Error(`${label}: array of numbers expected`)}function chain(...args){const id=a=>a,wrap=(a,b)=>c=>a(b(c));return{encode:args.map(x=>x.encode).reduceRight(wrap,id),decode:args.map(x=>x.decode).reduce(wrap,id)}}function alphabet(letters){const lettersA="string"==typeof letters?letters.split(""):letters,len=lettersA.length;astrArr("alphabet",lettersA);const indexes=new Map(lettersA.map((l,i)=>[l,i]));return{encode:digits=>(aArr(digits),digits.map(i=>{if(!Number.isSafeInteger(i)||i<0||i>=len)throw new Error(`alphabet.encode: digit index outside alphabet "${i}". Allowed: ${letters}`);return lettersA[i]})),decode:input=>(aArr(input),input.map(letter=>{astr("alphabet.decode",letter);const i=indexes.get(letter);if(void 0===i)throw new Error(`Unknown letter: "${letter}". Allowed: ${letters}`);return i}))}}function join(separator=""){return astr("join",separator),{encode:from=>(astrArr("join.decode",from),from.join(separator)),decode:to=>(astr("join.decode",to),to.split(separator))}}function padding(bits,chr="="){return anumber(bits),astr("padding",chr),{encode(data){for(astrArr("padding.encode",data);data.length*bits%8;)data.push(chr);return data},decode(input){astrArr("padding.decode",input);let end=input.length;if(end*bits%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;end>0&&input[end-1]===chr;end--){if((end-1)*bits%8==0)throw new Error("padding: invalid, string has too much padding")}return input.slice(0,end)}}}function normalize(fn){return afn(fn),{encode:from=>from,decode:to=>fn(to)}}function convertRadix(data,from,to){if(from<2)throw new Error(`convertRadix: invalid from=${from}, base cannot be less than 2`);if(to<2)throw new Error(`convertRadix: invalid to=${to}, base cannot be less than 2`);if(aArr(data),!data.length)return[];let pos=0;const res=[],digits=Array.from(data,d=>{if(anumber(d),d<0||d>=from)throw new Error(`invalid integer: ${d}`);return d}),dlen=digits.length;for(;;){let carry=0,done=!0;for(let i=pos;i<dlen;i++){const digit=digits[i],fromCarry=from*carry,digitBase=fromCarry+digit;if(!Number.isSafeInteger(digitBase)||fromCarry/from!==carry||digitBase-digit!==fromCarry)throw new Error("convertRadix: carry overflow");const div=digitBase/to;carry=digitBase%to;const rounded=Math.floor(div);if(digits[i]=rounded,!Number.isSafeInteger(rounded)||rounded*to+carry!==digitBase)throw new Error("convertRadix: carry overflow");done&&(rounded?done=!1:pos=i)}if(res.push(carry),done)break}for(let i=0;i<data.length-1&&0===data[i];i++)res.push(0);return res.reverse()}const gcd=(a,b)=>0===b?a:gcd(b,a%b),radix2carry=(from,to)=>from+(to-gcd(from,to)),powers=(()=>{let res=[];for(let i=0;i<40;i++)res.push(2**i);return res})();function convertRadix2(data,from,to,padding){if(aArr(data),from<=0||from>32)throw new Error(`convertRadix2: wrong from=${from}`);if(to<=0||to>32)throw new Error(`convertRadix2: wrong to=${to}`);if(radix2carry(from,to)>32)throw new Error(`convertRadix2: carry overflow from=${from} to=${to} carryBits=${radix2carry(from,to)}`);let carry=0,pos=0;const max=powers[from],mask=powers[to]-1,res=[];for(const n of data){if(anumber(n),n>=max)throw new Error(`convertRadix2: invalid data word=${n} from=${from}`);if(carry=carry<<from|n,pos+from>32)throw new Error(`convertRadix2: carry overflow pos=${pos} from=${from}`);for(pos+=from;pos>=to;pos-=to)res.push((carry>>pos-to&mask)>>>0);const pow=powers[pos];if(void 0===pow)throw new Error("invalid carry");carry&=pow-1}if(carry=carry<<to-pos&mask,!padding&&pos>=from)throw new Error("Excess padding");if(!padding&&carry>0)throw new Error(`Non-zero padding: ${carry}`);return padding&&pos>0&&res.push(carry>>>0),res}function radix(num){anumber(num);return{encode:bytes=>{if(!isBytes(bytes))throw new Error("radix.encode input should be Uint8Array");return convertRadix(Array.from(bytes),256,num)},decode:digits=>(anumArr("radix.decode",digits),Uint8Array.from(convertRadix(digits,num,256)))}}function radix2(bits,revPadding=!1){if(anumber(bits),bits<=0||bits>32)throw new Error("radix2: bits should be in (0..32]");if(radix2carry(8,bits)>32||radix2carry(bits,8)>32)throw new Error("radix2: carry overflow");return{encode:bytes=>{if(!isBytes(bytes))throw new Error("radix2.encode input should be Uint8Array");return convertRadix2(Array.from(bytes),8,bits,!revPadding)},decode:digits=>(anumArr("radix2.decode",digits),Uint8Array.from(convertRadix2(digits,bits,8,revPadding)))}}function unsafeWrapper(fn){return afn(fn),function(...args){try{return fn.apply(null,args)}catch(e){}}}const base16=chain(radix2(4),alphabet("0123456789ABCDEF"),join("")),base32=chain(radix2(5),alphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),padding(5),join("")),hasBase64Builtin=(chain(radix2(5),alphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),join("")),chain(radix2(5),alphabet("0123456789ABCDEFGHIJKLMNOPQRSTUV"),padding(5),join("")),chain(radix2(5),alphabet("0123456789ABCDEFGHIJKLMNOPQRSTUV"),join("")),chain(radix2(5),alphabet("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),join(""),normalize(s=>s.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),(()=>"function"==typeof Uint8Array.from([]).toBase64&&"function"==typeof Uint8Array.fromBase64)()),decodeBase64Builtin=(s,isUrl)=>{astr("base64",s);const re=isUrl?/^[A-Za-z0-9=_-]+$/:/^[A-Za-z0-9=+/]+$/,alphabet=isUrl?"base64url":"base64";if(s.length>0&&!re.test(s))throw new Error("invalid base64");return Uint8Array.fromBase64(s,{alphabet,lastChunkHandling:"strict"})},base64=hasBase64Builtin?{encode:b=>(abytes(b),b.toBase64()),decode:s=>decodeBase64Builtin(s,!1)}:chain(radix2(6),alphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),padding(6),join("")),base64url=(chain(radix2(6),alphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),join("")),hasBase64Builtin?{encode:b=>(abytes(b),b.toBase64({alphabet:"base64url"})),decode:s=>decodeBase64Builtin(s,!0)}:chain(radix2(6),alphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),padding(6),join(""))),genBase58=(chain(radix2(6),alphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),join("")),abc=>chain(radix(58),alphabet(abc),join(""))),base58=genBase58("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),XMR_BLOCK_LEN=(genBase58("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),genBase58("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz"),[0,2,3,5,6,7,9,10,11]),base58xmr={encode(data){let res="";for(let i=0;i<data.length;i+=8){const block=data.subarray(i,i+8);res+=base58.encode(block).padStart(XMR_BLOCK_LEN[block.length],"1")}return res},decode(str){let res=[];for(let i=0;i<str.length;i+=11){const slice=str.slice(i,i+11),blockLen=XMR_BLOCK_LEN.indexOf(slice.length),block=base58.decode(slice);for(let j=0;j<block.length-blockLen;j++)if(0!==block[j])throw new Error("base58xmr: wrong padding");res=res.concat(Array.from(block.slice(block.length-blockLen)))}return Uint8Array.from(res)}},BECH_ALPHABET=chain(alphabet("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),join("")),POLYMOD_GENERATORS=[996825010,642813549,513874426,1027748829,705979059];function bech32Polymod(pre){const b=pre>>25;let chk=(33554431&pre)<<5;for(let i=0;i<POLYMOD_GENERATORS.length;i++)1==(b>>i&1)&&(chk^=POLYMOD_GENERATORS[i]);return chk}function bechChecksum(prefix,words,encodingConst=1){const len=prefix.length;let chk=1;for(let i=0;i<len;i++){const c=prefix.charCodeAt(i);if(c<33||c>126)throw new Error(`Invalid prefix (${prefix})`);chk=bech32Polymod(chk)^c>>5}chk=bech32Polymod(chk);for(let i=0;i<len;i++)chk=bech32Polymod(chk)^31&prefix.charCodeAt(i);for(let v of words)chk=bech32Polymod(chk)^v;for(let i=0;i<6;i++)chk=bech32Polymod(chk);return chk^=encodingConst,BECH_ALPHABET.encode(convertRadix2([chk%powers[30]],30,5,!1))}function genBech32(encoding){const ENCODING_CONST="bech32"===encoding?1:734539939,_words=radix2(5),fromWords=_words.decode,toWords=_words.encode,fromWordsUnsafe=unsafeWrapper(fromWords);function encode(prefix,words,limit=90){astr("bech32.encode prefix",prefix),isBytes(words)&&(words=Array.from(words)),anumArr("bech32.encode",words);const plen=prefix.length;if(0===plen)throw new TypeError(`Invalid prefix length ${plen}`);const actualLength=plen+7+words.length;if(!1!==limit&&actualLength>limit)throw new TypeError(`Length ${actualLength} exceeds limit ${limit}`);const lowered=prefix.toLowerCase(),sum=bechChecksum(lowered,words,ENCODING_CONST);return`${lowered}1${BECH_ALPHABET.encode(words)}${sum}`}function decode(str,limit=90){astr("bech32.decode input",str);const slen=str.length;if(slen<8||!1!==limit&&slen>limit)throw new TypeError(`invalid string length: ${slen} (${str}). Expected (8..${limit})`);const lowered=str.toLowerCase();if(str!==lowered&&str!==str.toUpperCase())throw new Error("String must be lowercase or uppercase");const sepIndex=lowered.lastIndexOf("1");if(0===sepIndex||-1===sepIndex)throw new Error('Letter "1" must be present between prefix and data only');const prefix=lowered.slice(0,sepIndex),data=lowered.slice(sepIndex+1);if(data.length<6)throw new Error("Data must be at least 6 characters long");const words=BECH_ALPHABET.decode(data).slice(0,-6),sum=bechChecksum(prefix,words,ENCODING_CONST);if(!data.endsWith(sum))throw new Error(`Invalid checksum in ${str}: expected "${sum}"`);return{prefix,words}}return{encode,decode,encodeFromBytes:function encodeFromBytes(prefix,bytes){return encode(prefix,toWords(bytes))},decodeToBytes:function decodeToBytes(str){const{prefix,words}=decode(str,!1);return{prefix,words,bytes:fromWords(words)}},decodeUnsafe:unsafeWrapper(decode),fromWords,fromWordsUnsafe,toWords}}genBech32("bech32"),genBech32("bech32m");const utf8={encode:data=>(new TextDecoder).decode(data),decode:str=>(new TextEncoder).encode(str)};(()=>"function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex)()||chain(radix2(4),alphabet("0123456789abcdef"),join(""),normalize(s=>{if("string"!=typeof s||s.length%2!=0)throw new TypeError(`hex.decode: expected string, got ${typeof s} with length ${s.length}`);return s.toLowerCase()}));var index_es=__webpack_require__("./node_modules/@walletconnect/relay-auth/dist/index.es.js"),src=__webpack_require__("./node_modules/uint8arrays/esm/src/index.js"),dist_index_es=__webpack_require__("./node_modules/@walletconnect/relay-api/dist/index.es.js"),blakejs=__webpack_require__("./node_modules/blakejs/index.js"),index_es_process=__webpack_require__("./node_modules/process/browser.js"),console=__webpack_require__("./node_modules/console-browserify/index.js"),Buffer=__webpack_require__("./node_modules/buffer/index.js").Buffer;const xe=":";function Fe(t){const[e,n]=t.split(xe);return{namespace:e,reference:n}}function _s(t,e=[]){const n=[];return Object.keys(t).forEach(r=>{if(e.length&&!e.includes(r))return;const o=t[r];n.push(...o.accounts)}),n}function ve(t,e){return t.includes(":")?[t]:e.chains||[]}var $s=Object.defineProperty,Cs=Object.defineProperties,Ls=Object.getOwnPropertyDescriptors,Jn=Object.getOwnPropertySymbols,js=Object.prototype.hasOwnProperty,ks=Object.prototype.propertyIsEnumerable,Ze=(t,e,n)=>e in t?$s(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Qn=(t,e)=>{for(var n in e||(e={}))js.call(e,n)&&Ze(t,n,e[n]);if(Jn)for(var n of Jn(e))ks.call(e,n)&&Ze(t,n,e[n]);return t},Ps=(t,e)=>Cs(t,Ls(e)),tr=(t,e,n)=>Ze(t,"symbol"!=typeof e?e+"":e,n);const er="ReactNative",J={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},rr="js";function Ye(){return typeof index_es_process<"u"&&typeof index_es_process.versions<"u"&&typeof index_es_process.versions.node<"u"}function Bt(){return!(0,dist_cjs.getDocument)()&&!!(0,dist_cjs.getNavigator)()&&navigator.product===er}function Ms(){return Bt()&&typeof __webpack_require__.g<"u"&&typeof(null==__webpack_require__.g?void 0:__webpack_require__.g.Platform)<"u"&&"android"===(null==__webpack_require__.g?void 0:__webpack_require__.g.Platform.OS)}function Vs(){return Bt()&&typeof __webpack_require__.g<"u"&&typeof(null==__webpack_require__.g?void 0:__webpack_require__.g.Platform)<"u"&&"ios"===(null==__webpack_require__.g?void 0:__webpack_require__.g.Platform.OS)}function zt(){return!Ye()&&!!(0,dist_cjs.getNavigator)()&&!!(0,dist_cjs.getDocument)()}function Pt(){return Bt()?J.reactNative:Ye()?J.node:zt()?J.browser:J.unknown}function qs(){var t;try{return Bt()&&typeof __webpack_require__.g<"u"&&typeof(null==__webpack_require__.g?void 0:__webpack_require__.g.Application)<"u"?null==(t=__webpack_require__.g.Application)?void 0:t.applicationId:void 0}catch{return}}function Ks(t){var e,n;const r=sr();try{return null!=t&&t.url&&r.url&&new URL(t.url).host!==new URL(r.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${r.url}. This is probably unintended and can lead to issues.`),t.url=r.url),null!=(e=t?.icons)&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(o=>""!==o)),Ps(Qn(Qn({},r),t),{url:t?.url||r.url,name:t?.name||r.name,description:t?.description||r.description,icons:null!=(n=t?.icons)&&n.length&&t.icons.length>0?t.icons:r.icons})}catch(o){return console.warn("Error populating app metadata",o),t||r}}function sr(){return(0,window_metadata_dist_cjs.g)()||{name:"",description:"",url:"",icons:[""]}}function cr(t,e,n){const r=function ir(){if(Pt()===J.reactNative&&typeof __webpack_require__.g<"u"&&typeof(null==__webpack_require__.g?void 0:__webpack_require__.g.Platform)<"u"){const{OS:n,Version:r}=__webpack_require__.g.Platform;return[n,r].join("-")}const t=detect();if(null===t)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return"browser"===t.type?[e,t.name,t.version].join("-"):[e,t.version].join("-")}(),o=function fr(){var t;const e=Pt();return e===J.browser?[e,(null==(t=(0,dist_cjs.getLocation)())?void 0:t.host)||"unknown"].join(":"):e}();return[[t,e].join("-"),[rr,n].join("-"),r,o].join("/")}function zs({protocol:t,version:e,relayUrl:n,sdkVersion:r,auth:o,projectId:s,useOnCloseEvent:i,bundleId:f,packageName:a}){const l=n.split("?"),u={auth:o,ua:cr(t,e,r),projectId:s,useOnCloseEvent:i||void 0,packageName:a||void 0,bundleId:f||void 0},h=function or(t,e){const n=new URLSearchParams(t);for(const r of Object.keys(e).sort())if(e.hasOwnProperty(r)){const o=e[r];void 0!==o&&n.set(r,o)}return n.toString()}(l[1]||"",u);return l[0]+"?"+h}function It(t,e){return t.filter(n=>e.includes(n)).length===t.length}function Ys(t){return Object.fromEntries(t.entries())}function Xs(t){return new Map(Object.entries(t))}function ei(t=cjs.FIVE_MINUTES,e){const n=(0,cjs.toMiliseconds)(t||cjs.FIVE_MINUTES);let r,o,s,i;return{resolve:f=>{s&&r&&(clearTimeout(s),r(f),i=Promise.resolve(f))},reject:f=>{s&&o&&(clearTimeout(s),o(f))},done:()=>new Promise((f,a)=>{if(i)return f(i);s=setTimeout(()=>{const l=new Error(e);i=Promise.reject(l),a(l)},n),r=f,o=a})}}function ni(t,e,n){return new Promise(async(r,o)=>{const s=setTimeout(()=>o(new Error(n)),e);try{r(await t)}catch(i){o(i)}clearTimeout(s)})}function Xe(t,e){if("string"==typeof e&&e.startsWith(`${t}:`))return e;if("topic"===t.toLowerCase()){if("string"!=typeof e)throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}if("id"===t.toLowerCase()){if("number"!=typeof e)throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function ri(t){return Xe("topic",t)}function oi(t){return Xe("id",t)}function si(t){const[e,n]=t.split(":"),r={id:void 0,topic:void 0};if("topic"===e&&"string"==typeof n)r.topic=n;else{if("id"!==e||!Number.isInteger(Number(n)))throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${n}`);r.id=Number(n)}return r}function ii(t,e){return(0,cjs.fromMiliseconds)((e||Date.now())+(0,cjs.toMiliseconds)(t))}function fi(t){return Date.now()>=(0,cjs.toMiliseconds)(t)}function ci(t,e){return`${t}${e?`:${e}`:""}`}function ct(t=[],e=[]){return[...new Set([...t,...e])]}async function ai({id:t,topic:e,wcDeepLink:n}){var r;try{if(!n)return;const o="string"==typeof n?JSON.parse(n):n,s=o?.href;if("string"!=typeof s)return;const i=function dr(t,e,n){const r=`requestId=${e}&sessionTopic=${n}`;t.endsWith("/")&&(t=t.slice(0,-1));let o=`${t}`;if(t.startsWith("https://t.me")){o=`${o}${t.includes("?")?"&startapp=":"?startapp="}${function br(t,e=!1){const n=Buffer.from(t).toString("base64");return e?n.replace(/[=]/g,""):n}(r,!0)}`}else o=`${o}/wc?${r}`;return o}(s,t,e),f=Pt();if(f===J.browser){if(null==(r=(0,dist_cjs.getDocument)())||!r.hasFocus())return void console.warn("Document does not have focus, skipping deeplink.");!function hr(t){let e="_self";!function gr(){try{return window.self!==window.top}catch{return!1}}()?(function pr(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"):e="_top",window.open(t,e,"noreferrer noopener")}(i)}else f===J.reactNative&&typeof(null==__webpack_require__.g?void 0:__webpack_require__.g.Linking)<"u"&&await __webpack_require__.g.Linking.openURL(i)}catch(o){console.error(o)}}async function ui(t,e){let n="";try{if(zt()&&(n=localStorage.getItem(e),n))return n;n=await t.getItem(e)}catch(r){console.error(r)}return n}function li(t,e){if(!t.includes(e))return null;const n=t.split(/([&,?,=])/),r=n.indexOf(e);return n[r+2]}function di(){return typeof crypto<"u"&&null!=crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}function hi(){return typeof index_es_process<"u"&&"true"===index_es_process.env.IS_VITEST}function Qe(t){return Buffer.from(t,"base64").toString("utf-8")}function pi(t){return new Promise(e=>setTimeout(e,t))}class gi{constructor({limit:e}){tr(this,"limit"),tr(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const n=this.set.values().next().value;n&&this.set.delete(n)}this.set.add(e)}}has(e){return this.set.has(e)}}const Be=BigInt(2**32-1),yr=BigInt(32);function mr(t,e=!1){return e?{h:Number(t&Be),l:Number(t>>yr&Be)}:{h:0|Number(t>>yr&Be),l:0|Number(t&Be)}}function wr(t,e=!1){const n=t.length;let r=new Uint32Array(n),o=new Uint32Array(n);for(let s=0;s<n;s++){const{h:i,l:f}=mr(t[s],e);[r[s],o[s]]=[i,f]}return[r,o]}const xr=(t,e,n)=>t>>>n,vr=(t,e,n)=>t<<32-n|e>>>n,At=(t,e,n)=>t>>>n|e<<32-n,St=(t,e,n)=>t<<32-n|e>>>n,se=(t,e,n)=>t<<64-n|e>>>n-32,ie=(t,e,n)=>t>>>n-32|e<<64-n,bi=(t,e)=>e,yi=(t,e)=>t;function dt(t,e,n,r){const o=(e>>>0)+(r>>>0);return{h:t+n+(o/2**32|0)|0,l:0|o}}const tn=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),en=(t,e,n,r)=>e+n+r+(t/2**32|0)|0,Ei=(t,e,n,r)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0),Bi=(t,e,n,r,o)=>e+n+r+o+(t/2**32|0)|0,Ii=(t,e,n,r,o)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0)+(o>>>0),Ai=(t,e,n,r,o,s)=>e+n+r+o+s+(t/2**32|0)|0,Gt="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function nn(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&"Uint8Array"===t.constructor.name}function mt(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function at(t,...e){if(!nn(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function rn(t){if("function"!=typeof t||"function"!=typeof t.create)throw new Error("Hash should be wrapped by utils.createHasher");mt(t.outputLen),mt(t.blockLen)}function Nt(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function on(t,e){at(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function fe(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function ut(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function sn(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function gt(t,e){return t<<32-e|t>>>e}const Er=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0];function Br(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const wt=Er?t=>t:t=>Br(t);const Ot=Er?t=>t:function Si(t){for(let e=0;e<t.length;e++)t[e]=Br(t[e]);return t},Ir="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,Ni=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function ce(t){if(at(t),Ir)return t.toHex();let e="";for(let n=0;n<t.length;n++)e+=Ni[t[n]];return e}const xt__0=48,xt__9=57,xt_A=65,xt_F=70,xt_a=97,xt_f=102;function Ar(t){return t>=xt__0&&t<=xt__9?t-xt__0:t>=xt_A&&t<=xt_F?t-(xt_A-10):t>=xt_a&&t<=xt_f?t-(xt_a-10):void 0}function fn(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);if(Ir)return Uint8Array.fromHex(t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let o=0,s=0;o<n;o++,s+=2){const i=Ar(t.charCodeAt(s)),f=Ar(t.charCodeAt(s+1));if(void 0===i||void 0===f){const a=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+a+'" at index '+s)}r[o]=16*i+f}return r}function ht(t){return"string"==typeof t&&(t=function Oi(t){if("string"!=typeof t)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(t))}(t)),at(t),t}function Ht(...t){let e=0;for(let r=0;r<t.length;r++){const o=t[r];at(o),e+=o.length}const n=new Uint8Array(e);for(let r=0,o=0;r<t.length;r++){const s=t[r];n.set(s,o),o+=s.length}return n}class Ie{}function ae(t){const e=r=>t().update(ht(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function Zt(t=32){if(Gt&&"function"==typeof Gt.getRandomValues)return Gt.getRandomValues(new Uint8Array(t));if(Gt&&"function"==typeof Gt.randomBytes)return Uint8Array.from(Gt.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const _i=BigInt(0),ue=BigInt(1),Ti=BigInt(2),Ri=BigInt(7),$i=BigInt(256),Ci=BigInt(113),Sr=[],Nr=[],Or=[];for(let t=0,e=ue,n=1,r=0;t<24;t++){[n,r]=[r,(2*n+3*r)%5],Sr.push(2*(5*r+n)),Nr.push((t+1)*(t+2)/2%64);let o=_i;for(let s=0;s<7;s++)e=(e<<ue^(e>>Ri)*Ci)%$i,e&Ti&&(o^=ue<<(ue<<BigInt(s))-ue);Or.push(o)}const Ur=wr(Or,!0),Li=Ur[0],ji=Ur[1],_r=(t,e,n)=>n>32?((t,e,n)=>e<<n-32|t>>>64-n)(t,e,n):((t,e,n)=>t<<n|e>>>32-n)(t,e,n),Tr=(t,e,n)=>n>32?((t,e,n)=>t<<n-32|e>>>64-n)(t,e,n):((t,e,n)=>e<<n|t>>>32-n)(t,e,n);class qn extends Ie{constructor(e,n,r,o=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=n,this.outputLen=r,this.enableXOF=o,this.rounds=s,mt(r),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=fe(this.state)}clone(){return this._cloneInto()}keccak(){Ot(this.state32),function ki(t,e=24){const n=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let i=0;i<10;i++)n[i]=t[i]^t[i+10]^t[i+20]^t[i+30]^t[i+40];for(let i=0;i<10;i+=2){const f=(i+8)%10,a=(i+2)%10,l=n[a],c=n[a+1],u=_r(l,c,1)^n[f],h=Tr(l,c,1)^n[f+1];for(let g=0;g<50;g+=10)t[i+g]^=u,t[i+g+1]^=h}let o=t[2],s=t[3];for(let i=0;i<24;i++){const f=Nr[i],a=_r(o,s,f),l=Tr(o,s,f),c=Sr[i];o=t[c],s=t[c+1],t[c]=a,t[c+1]=l}for(let i=0;i<50;i+=10){for(let f=0;f<10;f++)n[f]=t[i+f];for(let f=0;f<10;f++)t[i+f]^=~n[(f+2)%10]&n[(f+4)%10]}t[0]^=Li[r],t[1]^=ji[r]}ut(n)}(this.state32,this.rounds),Ot(this.state32),this.posOut=0,this.pos=0}update(e){Nt(this),at(e=ht(e));const{blockLen:n,state:r}=this,o=e.length;for(let s=0;s<o;){const i=Math.min(n-this.pos,o-s);for(let f=0;f<i;f++)r[this.pos++]^=e[s++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:n,pos:r,blockLen:o}=this;e[r]^=n,!!(128&n)&&r===o-1&&this.keccak(),e[o-1]^=128,this.keccak()}writeInto(e){Nt(this,!1),at(e),this.finish();const n=this.state,{blockLen:r}=this;for(let o=0,s=e.length;o<s;){this.posOut>=r&&this.keccak();const i=Math.min(r-this.posOut,s-o);e.set(n.subarray(this.posOut,this.posOut+i),o),this.posOut+=i,o+=i}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return mt(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(on(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,ut(this.state)}_cloneInto(e){const{blockLen:n,suffix:r,outputLen:o,rounds:s,enableXOF:i}=this;return e||(e=new qn(n,r,o,i,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=r,e.outputLen=o,e.enableXOF=i,e.destroyed=this.destroyed,e}}const Hi=(t=1,e=136,n=32,ae(()=>new qn(e,t,n)));var t,e,n;function Mi(t,e,n){return t&e^~t&n}function Vi(t,e,n){return t&e^t&n^e&n}class Rr extends Ie{constructor(e,n,r,o){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=o,this.buffer=new Uint8Array(e),this.view=sn(this.buffer)}update(e){Nt(this),at(e=ht(e));const{view:n,buffer:r,blockLen:o}=this,s=e.length;for(let i=0;i<s;){const f=Math.min(o-this.pos,s-i);if(f===o){const a=sn(e);for(;o<=s-i;i+=o)this.process(a,i);continue}r.set(e.subarray(i,i+f),this.pos),this.pos+=f,i+=f,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Nt(this),on(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:o,isLE:s}=this;let{pos:i}=this;n[i++]=128,ut(this.buffer.subarray(i)),this.padOffset>o-i&&(this.process(r,0),i=0);for(let u=i;u<o;u++)n[u]=0;(function Di(t,e,n,r){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,n,r);const o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),f=Number(n&s),a=r?4:0,l=r?0:4;t.setUint32(e+a,i,r),t.setUint32(e+l,f,r)})(r,o-8,BigInt(8*this.length),s),this.process(r,0);const f=sn(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=a/4,c=this.get();if(l>c.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)f.setUint32(4*u,c[u],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:o,finished:s,destroyed:i,pos:f}=this;return e.destroyed=i,e.finished=s,e.length=o,e.pos=f,o%n&&e.buffer.set(r),e}clone(){return this._cloneInto()}}const Ut=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),W=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Y=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),qi=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),_t=new Uint32Array(64);class Ki extends Rr{constructor(e=32){super(64,e,8,!1),this.A=0|Ut[0],this.B=0|Ut[1],this.C=0|Ut[2],this.D=0|Ut[3],this.E=0|Ut[4],this.F=0|Ut[5],this.G=0|Ut[6],this.H=0|Ut[7]}get(){const{A:e,B:n,C:r,D:o,E:s,F:i,G:f,H:a}=this;return[e,n,r,o,s,i,f,a]}set(e,n,r,o,s,i,f,a){this.A=0|e,this.B=0|n,this.C=0|r,this.D=0|o,this.E=0|s,this.F=0|i,this.G=0|f,this.H=0|a}process(e,n){for(let u=0;u<16;u++,n+=4)_t[u]=e.getUint32(n,!1);for(let u=16;u<64;u++){const h=_t[u-15],g=_t[u-2],w=gt(h,7)^gt(h,18)^h>>>3,y=gt(g,17)^gt(g,19)^g>>>10;_t[u]=y+_t[u-7]+w+_t[u-16]|0}let{A:r,B:o,C:s,D:i,E:f,F:a,G:l,H:c}=this;for(let u=0;u<64;u++){const g=c+(gt(f,6)^gt(f,11)^gt(f,25))+Mi(f,a,l)+qi[u]+_t[u]|0,y=(gt(r,2)^gt(r,13)^gt(r,22))+Vi(r,o,s)|0;c=l,l=a,a=f,f=i+g|0,i=s,s=o,o=r,r=g+y|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,f=f+this.E|0,a=a+this.F|0,l=l+this.G|0,c=c+this.H|0,this.set(r,o,s,i,f,a,l,c)}roundClean(){ut(_t)}destroy(){this.set(0,0,0,0,0,0,0,0),ut(this.buffer)}}const $r=wr(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),Fi=$r[0],zi=$r[1],Tt=new Uint32Array(80),Rt=new Uint32Array(80);class cn extends Rr{constructor(e=64){super(128,e,16,!1),this.Ah=0|Y[0],this.Al=0|Y[1],this.Bh=0|Y[2],this.Bl=0|Y[3],this.Ch=0|Y[4],this.Cl=0|Y[5],this.Dh=0|Y[6],this.Dl=0|Y[7],this.Eh=0|Y[8],this.El=0|Y[9],this.Fh=0|Y[10],this.Fl=0|Y[11],this.Gh=0|Y[12],this.Gl=0|Y[13],this.Hh=0|Y[14],this.Hl=0|Y[15]}get(){const{Ah:e,Al:n,Bh:r,Bl:o,Ch:s,Cl:i,Dh:f,Dl:a,Eh:l,El:c,Fh:u,Fl:h,Gh:g,Gl:w,Hh:y,Hl:x}=this;return[e,n,r,o,s,i,f,a,l,c,u,h,g,w,y,x]}set(e,n,r,o,s,i,f,a,l,c,u,h,g,w,y,x){this.Ah=0|e,this.Al=0|n,this.Bh=0|r,this.Bl=0|o,this.Ch=0|s,this.Cl=0|i,this.Dh=0|f,this.Dl=0|a,this.Eh=0|l,this.El=0|c,this.Fh=0|u,this.Fl=0|h,this.Gh=0|g,this.Gl=0|w,this.Hh=0|y,this.Hl=0|x}process(e,n){for(let L=0;L<16;L++,n+=4)Tt[L]=e.getUint32(n),Rt[L]=e.getUint32(n+=4);for(let L=16;L<80;L++){const V=0|Tt[L-15],_=0|Rt[L-15],k=At(V,_,1)^At(V,_,8)^xr(V,0,7),j=St(V,_,1)^St(V,_,8)^vr(V,_,7),$=0|Tt[L-2],d=0|Rt[L-2],m=At($,d,19)^se($,d,61)^xr($,0,6),p=St($,d,19)^ie($,d,61)^vr($,d,6),b=Ei(j,p,Rt[L-7],Rt[L-16]),v=Bi(b,k,m,Tt[L-7],Tt[L-16]);Tt[L]=0|v,Rt[L]=0|b}let{Ah:r,Al:o,Bh:s,Bl:i,Ch:f,Cl:a,Dh:l,Dl:c,Eh:u,El:h,Fh:g,Fl:w,Gh:y,Gl:x,Hh:R,Hl:M}=this;for(let L=0;L<80;L++){const V=At(u,h,14)^At(u,h,18)^se(u,h,41),_=St(u,h,14)^St(u,h,18)^ie(u,h,41),k=u&g^~u&y,$=Ii(M,_,h&w^~h&x,zi[L],Rt[L]),d=Ai($,R,V,k,Fi[L],Tt[L]),m=0|$,p=At(r,o,28)^se(r,o,34)^se(r,o,39),b=St(r,o,28)^ie(r,o,34)^ie(r,o,39),v=r&s^r&f^s&f,B=o&i^o&a^i&a;R=0|y,M=0|x,y=0|g,x=0|w,g=0|u,w=0|h,({h:u,l:h}=dt(0|l,0|c,0|d,0|m)),l=0|f,c=0|a,f=0|s,a=0|i,s=0|r,i=0|o;const E=tn(m,b,B);r=en(E,d,p,v),o=0|E}({h:r,l:o}=dt(0|this.Ah,0|this.Al,0|r,0|o)),({h:s,l:i}=dt(0|this.Bh,0|this.Bl,0|s,0|i)),({h:f,l:a}=dt(0|this.Ch,0|this.Cl,0|f,0|a)),({h:l,l:c}=dt(0|this.Dh,0|this.Dl,0|l,0|c)),({h:u,l:h}=dt(0|this.Eh,0|this.El,0|u,0|h)),({h:g,l:w}=dt(0|this.Fh,0|this.Fl,0|g,0|w)),({h:y,l:x}=dt(0|this.Gh,0|this.Gl,0|y,0|x)),({h:R,l:M}=dt(0|this.Hh,0|this.Hl,0|R,0|M)),this.set(r,o,s,i,f,a,l,c,u,h,g,w,y,x,R,M)}roundClean(){ut(Tt,Rt)}destroy(){ut(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class Gi extends cn{constructor(){super(48),this.Ah=0|W[0],this.Al=0|W[1],this.Bh=0|W[2],this.Bl=0|W[3],this.Ch=0|W[4],this.Cl=0|W[5],this.Dh=0|W[6],this.Dl=0|W[7],this.Eh=0|W[8],this.El=0|W[9],this.Fh=0|W[10],this.Fl=0|W[11],this.Gh=0|W[12],this.Gl=0|W[13],this.Hh=0|W[14],this.Hl=0|W[15]}}const X=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class Zi extends cn{constructor(){super(32),this.Ah=0|X[0],this.Al=0|X[1],this.Bh=0|X[2],this.Bl=0|X[3],this.Ch=0|X[4],this.Cl=0|X[5],this.Dh=0|X[6],this.Dl=0|X[7],this.Eh=0|X[8],this.El=0|X[9],this.Fh=0|X[10],this.Fl=0|X[11],this.Gh=0|X[12],this.Gl=0|X[13],this.Hh=0|X[14],this.Hl=0|X[15]}}const Ae=ae(()=>new Ki),Wi=ae(()=>new cn),Yi=ae(()=>new Gi),Xi=ae(()=>new Zi),Ji=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),F=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),N=new Uint32Array(32);function $t(t,e,n,r,o,s){const i=o[s],f=o[s+1];let a=N[2*t],l=N[2*t+1],c=N[2*e],u=N[2*e+1],h=N[2*n],g=N[2*n+1],w=N[2*r],y=N[2*r+1],x=tn(a,c,i);l=en(x,l,u,f),a=0|x,({Dh:y,Dl:w}={Dh:y^l,Dl:w^a}),({Dh:y,Dl:w}={Dh:bi(0,w),Dl:yi(y)}),({h:g,l:h}=dt(g,h,y,w)),({Bh:u,Bl:c}={Bh:u^g,Bl:c^h}),({Bh:u,Bl:c}={Bh:At(u,c,24),Bl:St(u,c,24)}),N[2*t]=a,N[2*t+1]=l,N[2*e]=c,N[2*e+1]=u,N[2*n]=h,N[2*n+1]=g,N[2*r]=w,N[2*r+1]=y}function Ct(t,e,n,r,o,s){const i=o[s],f=o[s+1];let a=N[2*t],l=N[2*t+1],c=N[2*e],u=N[2*e+1],h=N[2*n],g=N[2*n+1],w=N[2*r],y=N[2*r+1],x=tn(a,c,i);l=en(x,l,u,f),a=0|x,({Dh:y,Dl:w}={Dh:y^l,Dl:w^a}),({Dh:y,Dl:w}={Dh:At(y,w,16),Dl:St(y,w,16)}),({h:g,l:h}=dt(g,h,y,w)),({Bh:u,Bl:c}={Bh:u^g,Bl:c^h}),({Bh:u,Bl:c}={Bh:se(u,c,63),Bl:ie(u,c,63)}),N[2*t]=a,N[2*t+1]=l,N[2*e]=c,N[2*e+1]=u,N[2*n]=h,N[2*n+1]=g,N[2*r]=w,N[2*r+1]=y}class tf extends Ie{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,mt(e),mt(n),this.blockLen=e,this.outputLen=n,this.buffer=new Uint8Array(e),this.buffer32=fe(this.buffer)}update(e){Nt(this),at(e=ht(e));const{blockLen:n,buffer:r,buffer32:o}=this,s=e.length,i=e.byteOffset,f=e.buffer;for(let a=0;a<s;){this.pos===n&&(Ot(o),this.compress(o,0,!1),Ot(o),this.pos=0);const l=Math.min(n-this.pos,s-a),c=i+a;if(l===n&&!(c%4)&&a+l<s){const u=new Uint32Array(f,c,Math.floor((s-a)/4));Ot(u);for(let h=0;a+n<s;h+=o.length,a+=n)this.length+=n,this.compress(u,h,!1);Ot(u);continue}r.set(e.subarray(a,a+l),this.pos),this.pos+=l,this.length+=l,a+=l}return this}digestInto(e){Nt(this),on(e,this);const{pos:n,buffer32:r}=this;this.finished=!0,ut(this.buffer.subarray(n)),Ot(r),this.compress(r,0,!0),Ot(r);const o=fe(e);this.get().forEach((s,i)=>o[i]=wt(s))}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){const{buffer:n,length:r,finished:o,destroyed:s,outputLen:i,pos:f}=this;return e||(e=new this.constructor({dkLen:i})),e.set(...this.get()),e.buffer.set(n),e.destroyed=s,e.finished=o,e.length=r,e.pos=f,e.outputLen=i,e}clone(){return this._cloneInto()}}class ef extends tf{constructor(e={}){const n=void 0===e.dkLen?64:e.dkLen;super(128,n),this.v0l=0|F[0],this.v0h=0|F[1],this.v1l=0|F[2],this.v1h=0|F[3],this.v2l=0|F[4],this.v2h=0|F[5],this.v3l=0|F[6],this.v3h=0|F[7],this.v4l=0|F[8],this.v4h=0|F[9],this.v5l=0|F[10],this.v5h=0|F[11],this.v6l=0|F[12],this.v6h=0|F[13],this.v7l=0|F[14],this.v7h=0|F[15],function Qi(t,e={},n,r,o){if(mt(n),t<0||t>n)throw new Error("outputLen bigger than keyLen");const{key:s,salt:i,personalization:f}=e;if(void 0!==s&&(s.length<1||s.length>n))throw new Error("key length must be undefined or 1.."+n);if(void 0!==i&&i.length!==r)throw new Error("salt must be undefined or "+r);if(void 0!==f&&f.length!==o)throw new Error("personalization must be undefined or "+o)}(n,e,64,16,16);let{key:r,personalization:o,salt:s}=e,i=0;if(void 0!==r&&(r=ht(r),i=r.length),this.v0l^=this.outputLen|i<<8|65536|1<<24,void 0!==s){s=ht(s);const f=fe(s);this.v4l^=wt(f[0]),this.v4h^=wt(f[1]),this.v5l^=wt(f[2]),this.v5h^=wt(f[3])}if(void 0!==o){o=ht(o);const f=fe(o);this.v6l^=wt(f[0]),this.v6h^=wt(f[1]),this.v7l^=wt(f[2]),this.v7h^=wt(f[3])}if(void 0!==r){const f=new Uint8Array(this.blockLen);f.set(r),this.update(f)}}get(){let{v0l:e,v0h:n,v1l:r,v1h:o,v2l:s,v2h:i,v3l:f,v3h:a,v4l:l,v4h:c,v5l:u,v5h:h,v6l:g,v6h:w,v7l:y,v7h:x}=this;return[e,n,r,o,s,i,f,a,l,c,u,h,g,w,y,x]}set(e,n,r,o,s,i,f,a,l,c,u,h,g,w,y,x){this.v0l=0|e,this.v0h=0|n,this.v1l=0|r,this.v1h=0|o,this.v2l=0|s,this.v2h=0|i,this.v3l=0|f,this.v3h=0|a,this.v4l=0|l,this.v4h=0|c,this.v5l=0|u,this.v5h=0|h,this.v6l=0|g,this.v6h=0|w,this.v7l=0|y,this.v7h=0|x}compress(e,n,r){this.get().forEach((a,l)=>N[l]=a),N.set(F,16);let{h:o,l:s}=mr(BigInt(this.length));N[24]=F[8]^s,N[25]=F[9]^o,r&&(N[28]=~N[28],N[29]=~N[29]);let i=0;const f=Ji;for(let a=0;a<12;a++)$t(0,4,8,12,e,n+2*f[i++]),Ct(0,4,8,12,e,n+2*f[i++]),$t(1,5,9,13,e,n+2*f[i++]),Ct(1,5,9,13,e,n+2*f[i++]),$t(2,6,10,14,e,n+2*f[i++]),Ct(2,6,10,14,e,n+2*f[i++]),$t(3,7,11,15,e,n+2*f[i++]),Ct(3,7,11,15,e,n+2*f[i++]),$t(0,5,10,15,e,n+2*f[i++]),Ct(0,5,10,15,e,n+2*f[i++]),$t(1,6,11,12,e,n+2*f[i++]),Ct(1,6,11,12,e,n+2*f[i++]),$t(2,7,8,13,e,n+2*f[i++]),Ct(2,7,8,13,e,n+2*f[i++]),$t(3,4,9,14,e,n+2*f[i++]),Ct(3,4,9,14,e,n+2*f[i++]);this.v0l^=N[0]^N[16],this.v0h^=N[1]^N[17],this.v1l^=N[2]^N[18],this.v1h^=N[3]^N[19],this.v2l^=N[4]^N[20],this.v2h^=N[5]^N[21],this.v3l^=N[6]^N[22],this.v3h^=N[7]^N[23],this.v4l^=N[8]^N[24],this.v4h^=N[9]^N[25],this.v5l^=N[10]^N[26],this.v5h^=N[11]^N[27],this.v6l^=N[12]^N[28],this.v6h^=N[13]^N[29],this.v7l^=N[14]^N[30],this.v7h^=N[15]^N[31],ut(N)}destroy(){this.destroyed=!0,ut(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const nf=function Ui(t){const e=(r,o)=>t(o).update(ht(r)).digest(),n=t({});return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e}(t=>new ef(t)),rf="https://rpc.walletconnect.org/v1";function an(t){const e=`Ethereum Signed Message:\n${t.length}`,n=(new TextEncoder).encode(e+t);return"0x"+Buffer.from(Hi(n)).toString("hex")}async function Cr(t,e,n,r,o,s){switch(n.t){case"eip191":return await async function Lr(t,e,n){return(await recoverAddress({hash:an(e),signature:n})).toLowerCase()===t.toLowerCase()}(t,e,n.s);case"eip1271":return await async function jr(t,e,n,r,o,s){const i=Fe(r);if(!i.namespace||!i.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${r}`);try{const f="0x1626ba7e",a="0000000000000000000000000000000000000000000000000000000000000040",l=n.substring(2),c=(l.length/2).toString(16).padStart(64,"0"),h=f+(e.startsWith("0x")?e:an(e)).substring(2)+a+c+l,g=await fetch(`${s||rf}/?chainId=${r}&projectId=${o}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:of(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:h},"latest"]})}),{result:w}=await g.json();return!!w&&w.slice(0,f.length).toLowerCase()===f.toLowerCase()}catch(f){return console.error("isValidEip1271Signature: ",f),!1}}(t,e,n.s,r,o,s);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${n.t}`)}}function of(){return Date.now()+Math.floor(1e3*Math.random())}function sf(t){const e=atob(t),n=new Uint8Array(e.length);for(let i=0;i<e.length;i++)n[i]=e.charCodeAt(i);const r=n[0];if(0===r)throw new Error("No signatures found");const o=1+64*r;if(n.length<o)throw new Error("Transaction data too short for claimed signature count");if(n.length<100)throw new Error("Transaction too short");const s=Buffer.from(t,"base64").slice(1,65);return esm.A.encode(s)}function ff(t){const e=new Uint8Array(Buffer.from(t,"base64")),n=Array.from("TransactionData::").map(s=>s.charCodeAt(0)),r=new Uint8Array(n.length+e.length);r.set(n),r.set(e,n.length);const o=nf(r,{dkLen:32});return esm.A.encode(o)}function cf(t){const e=new Uint8Array(Ae(function kr(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if("object"==typeof t&&null!=t&&t.data)return new Uint8Array(Object.values(t.data));if("object"==typeof t&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}(t)));return esm.A.encode(e)}function af(t){const n=function decode(buffer,options){return new Decoder_Decoder(options).decode(buffer)}(Buffer.from(t,"base64")).txn;if(!n)throw new Error("Invalid signed transaction: missing 'txn' field");const r=function encode(value,options){return new Encoder(options).encodeSharedRef(value)}(n),o=Buffer.from("TX"),s=Buffer.concat([o,Buffer.from(r)]),i=Xi(s);return base32.encode(i).replace(/=+$/,"")}function un(t){const e=[];let n=BigInt(t);for(;n>=BigInt(128);)e.push(Number(n&BigInt(127)|BigInt(128))),n>>=BigInt(7);return e.push(Number(n)),Buffer.from(e)}function uf(t){const e=Buffer.from(t.signed.bodyBytes,"base64"),n=Buffer.from(t.signed.authInfoBytes,"base64"),r=Buffer.from(t.signature.signature,"base64"),o=[];o.push(Buffer.from([10])),o.push(un(e.length)),o.push(e),o.push(Buffer.from([18])),o.push(un(n.length)),o.push(n),o.push(Buffer.from([26])),o.push(un(r.length)),o.push(r);const s=Buffer.concat(o),i=Ae(s);return Buffer.from(i).toString("hex").toUpperCase()}var lf=Object.defineProperty,df=Object.defineProperties,hf=Object.getOwnPropertyDescriptors,Pr=Object.getOwnPropertySymbols,pf=Object.prototype.hasOwnProperty,gf=Object.prototype.propertyIsEnumerable,Hr=(t,e,n)=>e in t?lf(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ln=(t,e)=>{for(var n in e||(e={}))pf.call(e,n)&&Hr(t,n,e[n]);if(Pr)for(var n of Pr(e))gf.call(e,n)&&Hr(t,n,e[n]);return t},Dr=(t,e)=>df(t,hf(e));const Se=t=>t?.split(":"),Vr=t=>{const e=t&&Se(t);if(e)return e[2]+":"+e[3]},dn=t=>{const e=t&&Se(t);if(e)return e.pop()};async function yf(t){const{cacao:e,projectId:n}=t,{s:r,p:o}=e,s=qr(o,o.iss),i=dn(o.iss);return await Cr(i,s,r,Vr(o.iss),n)}const qr=(t,e)=>{const n=`${t.domain} wants you to sign in with your Ethereum account:`,r=dn(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let o=t.statement||void 0;const s=`URI: ${t.aud||t.uri}`,i=`Version: ${t.version}`,f=`Chain ID: ${(t=>{const e=t&&Se(t);if(e)return t.includes("did:pkh:")?e[3]:e[1]})(e)}`,a=`Nonce: ${t.nonce}`,l=`Issued At: ${t.iat}`,c=t.exp?`Expiration Time: ${t.exp}`:void 0,u=t.nbf?`Not Before: ${t.nbf}`:void 0,h=t.requestId?`Request ID: ${t.requestId}`:void 0,g=t.resources?`Resources:${t.resources.map(y=>`\n- ${y}`).join("")}`:void 0,w=Oe(t.resources);if(w){o=gn(o,Lt(w))}return[n,r,"",o,"",s,i,f,a,l,c,u,h,g].filter(y=>null!=y).join("\n")};function bt(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(null==e||!e.length)throw new Error("No resources found in `att` property");e.forEach(n=>{const r=t.att[n];if(Array.isArray(r))throw new Error(`Resource must be an object: ${n}`);if("object"!=typeof r)throw new Error(`Resource must be an object: ${n}`);if(!Object.keys(r).length)throw new Error(`Resource object is empty: ${n}`);Object.keys(r).forEach(o=>{const s=r[o];if(!Array.isArray(s))throw new Error(`Ability limits ${o} must be an array of objects, found: ${s}`);if(!s.length)throw new Error(`Value of ${o} is empty array, must be an array with objects`);s.forEach(i=>{if("object"!=typeof i)throw new Error(`Ability limits (${o}) must be an array of objects, found: ${i}`)})})})}function hn(t,e,n={}){e=e?.sort((o,s)=>o.localeCompare(s));const r=e.map(o=>({[`${t}/${o}`]:[n]}));return Object.assign({},...r)}function Ne(t){return bt(t),`urn:recap:${function Gr(t){return Buffer.from(JSON.stringify(t)).toString("base64")}(t).replace(/=/g,"")}`}function Lt(t){const e=function Zr(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}(t.replace("urn:recap:",""));return bt(e),e}function Ef(t,e,n){const r=function Wr(t,e,n,r={}){return n?.sort((o,s)=>o.localeCompare(s)),{att:{[t]:hn(e,n,r)}}}(t,e,n);return Ne(r)}function pn(t){return t&&t.includes("urn:recap:")}function Bf(t,e){const o=function Xr(t,e){bt(t),bt(e);const n=Object.keys(t.att).concat(Object.keys(e.att)).sort((o,s)=>o.localeCompare(s)),r={att:{}};return n.forEach(o=>{var s,i;Object.keys((null==(s=t.att)?void 0:s[o])||{}).concat(Object.keys((null==(i=e.att)?void 0:i[o])||{})).sort((f,a)=>f.localeCompare(a)).forEach(f=>{var a,l;r.att[o]=Dr(ln({},r.att[o]),{[f]:(null==(a=t.att[o])?void 0:a[f])||(null==(l=e.att[o])?void 0:l[f])})})}),r}(Lt(t),Lt(e));return Ne(o)}function gn(t="",e){bt(e);const n="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(n))return t;const r=[];let o=0;Object.keys(e.att).forEach(f=>{const a=Object.keys(e.att[f]).map(u=>({ability:u.split("/")[0],action:u.split("/")[1]}));a.sort((u,h)=>u.action.localeCompare(h.action));const l={};a.forEach(u=>{l[u.ability]||(l[u.ability]=[]),l[u.ability].push(u.action)});const c=Object.keys(l).map(u=>(o++,`(${o}) '${u}': '${l[u].join("', '")}' for '${f}'.`));r.push(c.join(", ").replace(".,","."))});return`${t?t+" ":""}${`${n}${r.join(" ")}`}`}function If(t){var e;const n=Lt(t);bt(n);const r=null==(e=n.att)?void 0:e.eip155;return r?Object.keys(r).map(o=>o.split("/")[1]):[]}function Af(t){const e=Lt(t);bt(e);const n=[];return Object.values(e.att).forEach(r=>{Object.values(r).forEach(o=>{var s;null!=(s=o?.[0])&&s.chains&&n.push(o[0].chains)})}),[...new Set(n.flat())]}function Oe(t){if(!t)return;const e=t?.[t.length-1];return pn(e)?e:void 0}function Qr(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&"Uint8Array"===t.constructor.name}function bn(t){if("boolean"!=typeof t)throw new Error(`boolean expected, not ${t}`)}function yn(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function nt(t,...e){if(!Qr(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function to(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function jt(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Wt(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}const Of=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0];function mn(t){if("string"==typeof t)t=function Uf(t){if("string"!=typeof t)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(t))}(t);else{if(!Qr(t))throw new Error("Uint8Array expected, got "+typeof t);t=wn(t)}return t}function eo(t,e,n=!0){if(void 0===e)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(n&&!function Cf(t){return t.byteOffset%4==0}(e))throw new Error("invalid output, must be aligned");return e}function no(t,e,n,r){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,n,r);const o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),f=Number(n&s),a=r?4:0,l=r?0:4;t.setUint32(e+a,i,r),t.setUint32(e+l,f,r)}function $f(t,e,n){bn(n);const r=new Uint8Array(16),o=function Nf(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}(r);return no(o,0,BigInt(e),n),no(o,8,BigInt(t),n),r}function wn(t){return Uint8Array.from(t)}const ro=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),Lf=ro("expand 16-byte k"),jf=ro("expand 32-byte k"),kf=jt(Lf),Pf=jt(jf);function D(t,e){return t<<e|t>>>32-e}function xn(t){return t.byteOffset%4==0}const oo=2**32-1,so=new Uint32Array;const G=(t,e)=>255&t[e++]|(255&t[e++])<<8;class Vf{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,nt(e=mn(e),32);const n=G(e,0),r=G(e,2),o=G(e,4),s=G(e,6),i=G(e,8),f=G(e,10),a=G(e,12),l=G(e,14);this.r[0]=8191&n,this.r[1]=8191&(n>>>13|r<<3),this.r[2]=7939&(r>>>10|o<<6),this.r[3]=8191&(o>>>7|s<<9),this.r[4]=255&(s>>>4|i<<12),this.r[5]=i>>>1&8190,this.r[6]=8191&(i>>>14|f<<2),this.r[7]=8065&(f>>>11|a<<5),this.r[8]=8191&(a>>>8|l<<8),this.r[9]=l>>>5&127;for(let c=0;c<8;c++)this.pad[c]=G(e,16+2*c)}process(e,n,r=!1){const o=r?0:2048,{h:s,r:i}=this,f=i[0],a=i[1],l=i[2],c=i[3],u=i[4],h=i[5],g=i[6],w=i[7],y=i[8],x=i[9],R=G(e,n+0),M=G(e,n+2),L=G(e,n+4),V=G(e,n+6),_=G(e,n+8),k=G(e,n+10),j=G(e,n+12),$=G(e,n+14);let d=s[0]+(8191&R),m=s[1]+(8191&(R>>>13|M<<3)),p=s[2]+(8191&(M>>>10|L<<6)),b=s[3]+(8191&(L>>>7|V<<9)),v=s[4]+(8191&(V>>>4|_<<12)),B=s[5]+(_>>>1&8191),E=s[6]+(8191&(_>>>14|k<<2)),I=s[7]+(8191&(k>>>11|j<<5)),S=s[8]+(8191&(j>>>8|$<<8)),O=s[9]+($>>>5|o),A=0,T=A+d*f+m*(5*x)+p*(5*y)+b*(5*w)+v*(5*g);A=T>>>13,T&=8191,T+=B*(5*h)+E*(5*u)+I*(5*c)+S*(5*l)+O*(5*a),A+=T>>>13,T&=8191;let U=A+d*a+m*f+p*(5*x)+b*(5*y)+v*(5*w);A=U>>>13,U&=8191,U+=B*(5*g)+E*(5*h)+I*(5*u)+S*(5*c)+O*(5*l),A+=U>>>13,U&=8191;let C=A+d*l+m*a+p*f+b*(5*x)+v*(5*y);A=C>>>13,C&=8191,C+=B*(5*w)+E*(5*g)+I*(5*h)+S*(5*u)+O*(5*c),A+=C>>>13,C&=8191;let H=A+d*c+m*l+p*a+b*f+v*(5*x);A=H>>>13,H&=8191,H+=B*(5*y)+E*(5*w)+I*(5*g)+S*(5*h)+O*(5*u),A+=H>>>13,H&=8191;let q=A+d*u+m*c+p*l+b*a+v*f;A=q>>>13,q&=8191,q+=B*(5*x)+E*(5*y)+I*(5*w)+S*(5*g)+O*(5*h),A+=q>>>13,q&=8191;let P=A+d*h+m*u+p*c+b*l+v*a;A=P>>>13,P&=8191,P+=B*f+E*(5*x)+I*(5*y)+S*(5*w)+O*(5*g),A+=P>>>13,P&=8191;let K=A+d*g+m*h+p*u+b*c+v*l;A=K>>>13,K&=8191,K+=B*a+E*f+I*(5*x)+S*(5*y)+O*(5*w),A+=K>>>13,K&=8191;let et=A+d*w+m*g+p*h+b*u+v*c;A=et>>>13,et&=8191,et+=B*l+E*a+I*f+S*(5*x)+O*(5*y),A+=et>>>13,et&=8191;let Z=A+d*y+m*w+p*g+b*h+v*u;A=Z>>>13,Z&=8191,Z+=B*c+E*l+I*a+S*f+O*(5*x),A+=Z>>>13,Z&=8191;let z=A+d*x+m*y+p*w+b*g+v*h;A=z>>>13,z&=8191,z+=B*u+E*c+I*l+S*a+O*f,A+=z>>>13,z&=8191,A=(A<<2)+A|0,A=A+T|0,T=8191&A,A>>>=13,U+=A,s[0]=T,s[1]=U,s[2]=C,s[3]=H,s[4]=q,s[5]=P,s[6]=K,s[7]=et,s[8]=Z,s[9]=z}finalize(){const{h:e,pad:n}=this,r=new Uint16Array(10);let o=e[1]>>>13;e[1]&=8191;for(let f=2;f<10;f++)e[f]+=o,o=e[f]>>>13,e[f]&=8191;e[0]+=5*o,o=e[0]>>>13,e[0]&=8191,e[1]+=o,o=e[1]>>>13,e[1]&=8191,e[2]+=o,r[0]=e[0]+5,o=r[0]>>>13,r[0]&=8191;for(let f=1;f<10;f++)r[f]=e[f]+o,o=r[f]>>>13,r[f]&=8191;r[9]-=8192;let s=(1^o)-1;for(let f=0;f<10;f++)r[f]&=s;s=~s;for(let f=0;f<10;f++)e[f]=e[f]&s|r[f];e[0]=65535&(e[0]|e[1]<<13),e[1]=65535&(e[1]>>>3|e[2]<<10),e[2]=65535&(e[2]>>>6|e[3]<<7),e[3]=65535&(e[3]>>>9|e[4]<<4),e[4]=65535&(e[4]>>>12|e[5]<<1|e[6]<<14),e[5]=65535&(e[6]>>>2|e[7]<<11),e[6]=65535&(e[7]>>>5|e[8]<<8),e[7]=65535&(e[8]>>>8|e[9]<<5);let i=e[0]+n[0];e[0]=65535&i;for(let f=1;f<8;f++)i=(e[f]+n[f]|0)+(i>>>16)|0,e[f]=65535&i;Wt(r)}update(e){to(this),nt(e=mn(e));const{buffer:n,blockLen:r}=this,o=e.length;for(let s=0;s<o;){const i=Math.min(r-this.pos,o-s);if(i!==r)n.set(e.subarray(s,s+i),this.pos),this.pos+=i,s+=i,this.pos===r&&(this.process(n,0,!1),this.pos=0);else for(;r<=o-s;s+=r)this.process(e,s)}return this}destroy(){Wt(this.h,this.r,this.buffer,this.pad)}digestInto(e){to(this),function Sf(t,e){nt(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}(e,this),this.finished=!0;const{buffer:n,h:r}=this;let{pos:o}=this;if(o){for(n[o++]=1;o<16;o++)n[o]=0;this.process(n,0,!0)}this.finalize();let s=0;for(let i=0;i<8;i++)e[s++]=r[i]>>>0,e[s++]=r[i]>>>8;return e}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}}const Kf=function qf(t){const e=(r,o)=>t(o).update(mn(r)).digest(),n=t(new Uint8Array(32));return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e}(t=>new Vf(t));const zf=function Mf(t,e){const{allowShortKeys:n,extendNonceFn:r,counterLength:o,counterRight:s,rounds:i}=function _f(t,e){if(null==e||"object"!=typeof e)throw new Error("options must be defined");return Object.assign(t,e)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if("function"!=typeof t)throw new Error("core must be a function");return yn(o),yn(i),bn(s),bn(n),(f,a,l,c,u=0)=>{nt(f),nt(a),nt(l);const h=l.length;if(void 0===c&&(c=new Uint8Array(h)),nt(c),yn(u),u<0||u>=oo)throw new Error("arx: counter overflow");if(c.length<h)throw new Error(`arx: output (${c.length}) is shorter than data (${h})`);const g=[];let y,x,w=f.length;if(32===w)g.push(y=wn(f)),x=Pf;else{if(16!==w||!n)throw new Error(`arx: invalid 32-byte key, got length=${w}`);y=new Uint8Array(32),y.set(f),y.set(f,16),x=kf,g.push(y)}xn(a)||g.push(a=wn(a));const R=jt(y);if(r){if(24!==a.length)throw new Error("arx: extended nonce must be 24 bytes");r(x,R,jt(a.subarray(0,16)),R),a=a.subarray(16)}const M=16-o;if(M!==a.length)throw new Error(`arx: nonce must be ${M} or 16 bytes`);if(12!==M){const V=new Uint8Array(12);V.set(a,s?0:12-a.length),a=V,g.push(a)}const L=jt(a);return function Df(t,e,n,r,o,s,i,f){const a=o.length,l=new Uint8Array(64),c=jt(l),u=xn(o)&&xn(s),h=u?jt(o):so,g=u?jt(s):so;for(let w=0;w<a;i++){if(t(e,n,r,c,i,f),i>=oo)throw new Error("arx: counter overflow");const y=Math.min(64,a-w);if(u&&64===y){const x=w/4;if(w%4!=0)throw new Error("arx: invalid block position");for(let M,R=0;R<16;R++)M=x+R,g[M]=h[M]^c[R];w+=64;continue}for(let R,x=0;x<y;x++)R=w+x,s[R]=o[R]^l[x];w+=y}}(t,x,R,L,l,c,u,i),Wt(...g),c}}(function Ff(t,e,n,r,o,s=20){let i=t[0],f=t[1],a=t[2],l=t[3],c=e[0],u=e[1],h=e[2],g=e[3],w=e[4],y=e[5],x=e[6],R=e[7],M=o,L=n[0],V=n[1],_=n[2],k=i,j=f,$=a,d=l,m=c,p=u,b=h,v=g,B=w,E=y,I=x,S=R,O=M,A=L,T=V,U=_;for(let H=0;H<s;H+=2)k=k+m|0,O=D(O^k,16),B=B+O|0,m=D(m^B,12),k=k+m|0,O=D(O^k,8),B=B+O|0,m=D(m^B,7),j=j+p|0,A=D(A^j,16),E=E+A|0,p=D(p^E,12),j=j+p|0,A=D(A^j,8),E=E+A|0,p=D(p^E,7),$=$+b|0,T=D(T^$,16),I=I+T|0,b=D(b^I,12),$=$+b|0,T=D(T^$,8),I=I+T|0,b=D(b^I,7),d=d+v|0,U=D(U^d,16),S=S+U|0,v=D(v^S,12),d=d+v|0,U=D(U^d,8),S=S+U|0,v=D(v^S,7),k=k+p|0,U=D(U^k,16),I=I+U|0,p=D(p^I,12),k=k+p|0,U=D(U^k,8),I=I+U|0,p=D(p^I,7),j=j+b|0,O=D(O^j,16),S=S+O|0,b=D(b^S,12),j=j+b|0,O=D(O^j,8),S=S+O|0,b=D(b^S,7),$=$+v|0,A=D(A^$,16),B=B+A|0,v=D(v^B,12),$=$+v|0,A=D(A^$,8),B=B+A|0,v=D(v^B,7),d=d+m|0,T=D(T^d,16),E=E+T|0,m=D(m^E,12),d=d+m|0,T=D(T^d,8),E=E+T|0,m=D(m^E,7);let C=0;r[C++]=i+k|0,r[C++]=f+j|0,r[C++]=a+$|0,r[C++]=l+d|0,r[C++]=c+m|0,r[C++]=u+p|0,r[C++]=h+b|0,r[C++]=g+v|0,r[C++]=w+B|0,r[C++]=y+E|0,r[C++]=x+I|0,r[C++]=R+S|0,r[C++]=M+O|0,r[C++]=L+A|0,r[C++]=V+T|0,r[C++]=_+U|0},{counterRight:!1,counterLength:4,allowShortKeys:!1}),Gf=new Uint8Array(16),io=(t,e)=>{t.update(e);const n=e.length%16;n&&t.update(Gf.subarray(n))},Zf=new Uint8Array(32);function fo(t,e,n,r,o){const s=t(e,n,Zf),i=Kf.create(s);o&&io(i,o),io(i,r);const f=$f(r.length,o?o.length:0,!0);i.update(f);const a=i.digest();return Wt(s,f),a}const co=((t,e)=>{function n(r,...o){if(nt(r),!Of)throw new Error("Non little-endian hardware is not yet supported");if(void 0!==t.nonceLength){const c=o[0];if(!c)throw new Error("nonce / iv required");t.varSizeNonce?nt(c):nt(c,t.nonceLength)}const s=t.tagLength;s&&void 0!==o[1]&&nt(o[1]);const i=e(r,...o),f=(c,u)=>{if(void 0!==u){if(2!==c)throw new Error("cipher output not supported");nt(u)}};let a=!1;return{encrypt(c,u){if(a)throw new Error("cannot encrypt() twice with same key + nonce");return a=!0,nt(c),f(i.encrypt.length,u),i.encrypt(c,u)},decrypt(c,u){if(nt(c),s&&c.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return f(i.decrypt.length,u),i.decrypt(c,u)}}}return Object.assign(n,t),n})({blockSize:64,nonceLength:12,tagLength:16},(t=>(e,n,r)=>({encrypt(s,i){const f=s.length;(i=eo(f+16,i,!1)).set(s);const a=i.subarray(0,-16);t(e,n,a,a,1);const l=fo(t,e,n,a,r);return i.set(l,f),Wt(l),i},decrypt(s,i){i=eo(s.length-16,i,!1);const f=s.subarray(0,-16),a=s.subarray(-16),l=fo(t,e,n,f,r);if(!function Tf(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return 0===n}(a,l))throw new Error("invalid tag");return i.set(s.subarray(0,-16)),t(e,n,i,i,1),Wt(l),i}}))(zf));class ao extends Ie{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,rn(e);const r=ht(n);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,s=new Uint8Array(o);s.set(r.length>o?e.create().update(r).digest():r);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=e.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),ut(s)}update(e){return Nt(this),this.iHash.update(e),this}digestInto(e){Nt(this),at(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:o,destroyed:s,blockLen:i,outputLen:f}=this;return e.finished=o,e.destroyed=s,e.blockLen=i,e.outputLen=f,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const _e=(t,e,n)=>new ao(t,e).update(n).digest();_e.create=(t,e)=>new ao(t,e);const vn=Uint8Array.from([0]),uo=Uint8Array.of();const Jf=(t,e,n,r,o)=>function Xf(t,e,n,r=32){rn(t),mt(r);const o=t.outputLen;if(r>255*o)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(r/o);void 0===n&&(n=uo);const i=new Uint8Array(s*o),f=_e.create(t,e),a=f._cloneInto(),l=new Uint8Array(f.outputLen);for(let c=0;c<s;c++)vn[0]=c+1,a.update(0===c?uo:l).update(n).update(vn).digestInto(l),i.set(l,o*c),f._cloneInto(a);return f.destroy(),a.destroy(),ut(l,vn),i.slice(0,r)}(t,function Yf(t,e,n){return rn(t),void 0===n&&(n=new Uint8Array(t.outputLen)),_e(t,ht(n),ht(e))}(t,e,n),r,o),Te=Ae,En=BigInt(0),Bn=BigInt(1);function Re(t,e){if("boolean"!=typeof e)throw new Error(t+" boolean expected, got "+e)}function $e(t){const e=t.toString(16);return 1&e.length?"0"+e:e}function lo(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);return""===t?En:BigInt("0x"+t)}function Ce(t){return lo(ce(t))}function Le(t){return at(t),lo(ce(Uint8Array.from(t).reverse()))}function In(t,e){return fn(t.toString(16).padStart(2*e,"0"))}function An(t,e){return In(t,e).reverse()}function rt(t,e,n){let r;if("string"==typeof e)try{r=fn(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else{if(!nn(e))throw new Error(t+" must be hex string or Uint8Array");r=Uint8Array.from(e)}const o=r.length;if("number"==typeof n&&o!==n)throw new Error(t+" of length "+n+" expected, got "+o);return r}const Sn=t=>"bigint"==typeof t&&En<=t;function Nn(t,e,n,r){if(!function Qf(t,e,n){return Sn(t)&&Sn(e)&&Sn(n)&&e<=t&&t<n}(e,n,r))throw new Error("expected valid "+t+": "+n+" <= n < "+r+", got "+e)}const je=t=>(Bn<<BigInt(t))-Bn;function ke(t,e,n={}){if(!t||"object"!=typeof t)throw new Error("expected valid options object");function r(o,s,i){const f=t[o];if(i&&void 0===f)return;const a=typeof f;if(a!==s||null===f)throw new Error(`param "${o}" is invalid: expected ${s}, got ${a}`)}Object.entries(e).forEach(([o,s])=>r(o,s,!1)),Object.entries(n).forEach(([o,s])=>r(o,s,!0))}function ho(t){const e=new WeakMap;return(n,...r)=>{const o=e.get(n);if(void 0!==o)return o;const s=t(n,...r);return e.set(n,s),s}}const ot=BigInt(0),Q=BigInt(1),Dt=BigInt(2),nc=BigInt(3),po=BigInt(4),go=BigInt(5),bo=BigInt(8);function lt(t,e){const n=t%e;return n>=ot?n:e+n}function pt(t,e,n){let r=t;for(;e-- >ot;)r*=r,r%=n;return r}function yo(t,e){if(t===ot)throw new Error("invert: expected non-zero number");if(e<=ot)throw new Error("invert: expected positive modulus, got "+e);let n=lt(t,e),r=e,o=ot,s=Q;for(;n!==ot;){const a=r%n,l=o-s*(r/n);r=n,n=a,o=s,s=l}if(r!==Q)throw new Error("invert: does not exist");return lt(o,e)}function mo(t,e){const n=(t.ORDER+Q)/po,r=t.pow(e,n);if(!t.eql(t.sqr(r),e))throw new Error("Cannot find square root");return r}function rc(t,e){const n=(t.ORDER-go)/bo,r=t.mul(e,Dt),o=t.pow(r,n),s=t.mul(e,o),i=t.mul(t.mul(s,Dt),o),f=t.mul(s,t.sub(i,t.ONE));if(!t.eql(t.sqr(f),e))throw new Error("Cannot find square root");return f}function sc(t){return t%po===nc?mo:t%bo===go?rc:function oc(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-Q,n=0;for(;e%Dt===ot;)e/=Dt,n++;let r=Dt;const o=Yt(t);for(;1===xo(o,r);)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(1===n)return mo;let s=o.pow(r,e);const i=(e+Q)/Dt;return function(a,l){if(a.is0(l))return l;if(1!==xo(a,l))throw new Error("Cannot find square root");let c=n,u=a.mul(a.ONE,s),h=a.pow(l,e),g=a.pow(l,i);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let w=1,y=a.sqr(h);for(;!a.eql(y,a.ONE);)if(w++,y=a.sqr(y),w===c)throw new Error("Cannot find square root");const x=Q<<BigInt(c-w-1),R=a.pow(u,x);c=w,u=a.sqr(R),h=a.mul(h,u),g=a.mul(g,R)}return g}}(t)}const ic=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function wo(t,e,n=!1){const r=new Array(e.length).fill(n?t.ZERO:void 0),o=e.reduce((i,f,a)=>t.is0(f)?i:(r[a]=i,t.mul(i,f)),t.ONE),s=t.inv(o);return e.reduceRight((i,f,a)=>t.is0(f)?i:(r[a]=t.mul(i,r[a]),t.mul(i,f)),s),r}function xo(t,e){const n=(t.ORDER-Q)/Dt,r=t.pow(e,n),o=t.eql(r,t.ONE),s=t.eql(r,t.ZERO),i=t.eql(r,t.neg(t.ONE));if(!o&&!s&&!i)throw new Error("invalid Legendre symbol result");return o?1:s?0:-1}function Yt(t,e,n=!1,r={}){if(t<=ot)throw new Error("invalid field: expected ORDER > 0, got "+t);let o,s;if("object"==typeof e&&null!=e){if(r.sqrt||n)throw new Error("cannot specify opts in two arguments");const c=e;c.BITS&&(o=c.BITS),c.sqrt&&(s=c.sqrt),"boolean"==typeof c.isLE&&(n=c.isLE)}else"number"==typeof e&&(o=e),r.sqrt&&(s=r.sqrt);const{nBitLength:i,nByteLength:f}=function ac(t,e){void 0!==e&&mt(e);const n=void 0!==e?e:t.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}(t,o);if(f>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let a;const l=Object.freeze({ORDER:t,isLE:n,BITS:i,BYTES:f,MASK:je(i),ZERO:ot,ONE:Q,create:c=>lt(c,t),isValid:c=>{if("bigint"!=typeof c)throw new Error("invalid field element: expected bigint, got "+typeof c);return ot<=c&&c<t},is0:c=>c===ot,isValidNot0:c=>!l.is0(c)&&l.isValid(c),isOdd:c=>(c&Q)===Q,neg:c=>lt(-c,t),eql:(c,u)=>c===u,sqr:c=>lt(c*c,t),add:(c,u)=>lt(c+u,t),sub:(c,u)=>lt(c-u,t),mul:(c,u)=>lt(c*u,t),pow:(c,u)=>function cc(t,e,n){if(n<ot)throw new Error("invalid exponent, negatives unsupported");if(n===ot)return t.ONE;if(n===Q)return e;let r=t.ONE,o=e;for(;n>ot;)n&Q&&(r=t.mul(r,o)),o=t.sqr(o),n>>=Q;return r}(l,c,u),div:(c,u)=>lt(c*yo(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>yo(c,t),sqrt:s||(c=>(a||(a=sc(t)),a(l,c))),toBytes:c=>n?An(c,f):In(c,f),fromBytes:c=>{if(c.length!==f)throw new Error("Field.fromBytes: expected "+f+" bytes, got "+c.length);return n?Le(c):Ce(c)},invertBatch:c=>wo(l,c),cmov:(c,u,h)=>h?u:c});return Object.freeze(l)}function vo(t){if("bigint"!=typeof t)throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Eo(t){const e=vo(t);return e+Math.ceil(e/2)}const Xt=BigInt(0),Mt=BigInt(1);function le(t,e){const n=e.negate();return t?n:e}function Bo(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function On(t,e){Bo(t,e);const o=2**t;return{windows:Math.ceil(e/t)+1,windowSize:2**(t-1),mask:je(t),maxNumber:o,shiftBy:BigInt(t)}}function Io(t,e,n){const{windowSize:r,mask:o,maxNumber:s,shiftBy:i}=n;let f=Number(t&o),a=t>>i;f>r&&(f-=s,a+=Mt);const l=e*r;return{nextN:a,offset:l+Math.abs(f)-1,isZero:0===f,isNeg:f<0,isNegF:e%2!=0,offsetF:l}}const Un=new WeakMap,Ao=new WeakMap;function _n(t){return Ao.get(t)||1}function So(t){if(t!==Xt)throw new Error("invalid wNAF")}function bc(t,e,n,r){(function dc(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,r)=>{if(!(n instanceof e))throw new Error("invalid point at index "+r)})})(n,t),function hc(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,r)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+r)})}(r,e);const o=n.length,s=r.length;if(o!==s)throw new Error("arrays of points and scalars must have equal length");const i=t.ZERO,f=function tc(t){let e;for(e=0;t>En;t>>=Bn,e+=1);return e}(BigInt(o));let a=1;f>12?a=f-3:f>4?a=f-2:f>0&&(a=2);const l=je(a),c=new Array(Number(l)+1).fill(i);let h=i;for(let g=Math.floor((e.BITS-1)/a)*a;g>=0;g-=a){c.fill(i);for(let y=0;y<s;y++){const x=r[y],R=Number(x>>BigInt(g)&l);c[R]=c[R].add(n[y])}let w=i;for(let y=c.length-1,x=i;y>0;y--)x=x.add(c[y]),w=w.add(x);if(h=h.add(w),0!==g)for(let y=0;y<a;y++)h=h.double()}return h}function No(t,e){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return function fc(t){return ke(t,ic.reduce((r,o)=>(r[o]="function",r),{ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"})),t}(e),e}return Yt(t)}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const de=BigInt(0),Jt=BigInt(1),Pe=BigInt(2);function wc(t){const e=function mc(t){return ke(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}(t),{P:n,type:r,adjustScalarBytes:o,powPminus2:s,randomBytes:i}=e,f="x25519"===r;if(!f&&"x448"!==r)throw new Error("invalid type");const a=i||Zt,l=f?255:448,c=f?32:56,u=BigInt(f?9:5),h=BigInt(f?121665:39081),g=f?Pe**BigInt(254):Pe**BigInt(447),w=f?BigInt(8)*Pe**BigInt(251)-Jt:BigInt(4)*Pe**BigInt(445)-Jt,y=g+w+Jt,x=d=>lt(d,n),R=M(u);function M(d){return An(x(d),c)}function _(d,m){const p=function $(d,m){Nn("u",d,de,n),Nn("scalar",m,g,y);const p=m,b=d;let v=Jt,B=de,E=d,I=Jt,S=de;for(let A=BigInt(l-1);A>=de;A--){const T=p>>A&Jt;S^=T,({x_2:v,x_3:E}=j(S,v,E)),({x_2:B,x_3:I}=j(S,B,I)),S=T;const U=v+B,C=x(U*U),H=v-B,q=x(H*H),P=C-q,K=E+I,Z=x((E-I)*U),z=x(K*H),Ft=Z+z,yt=Z-z;E=x(Ft*Ft),I=x(b*x(yt*yt)),v=x(C*q),B=x(P*(C+x(h*P)))}({x_2:v,x_3:E}=j(S,v,E)),({x_2:B,x_3:I}=j(S,B,I));const O=s(B);return x(v*O)}(function L(d){const m=rt("u coordinate",d,c);return f&&(m[31]&=127),x(Le(m))}(m),function V(d){return Le(o(rt("scalar",d,c)))}(d));if(p===de)throw new Error("invalid private or public key received");return M(p)}function k(d){return _(d,R)}function j(d,m,p){const b=x(d*(m-p));return{x_2:m=x(m-b),x_3:p=x(p+b)}}return{scalarMult:_,scalarMultBase:k,getSharedSecret:(d,m)=>_(d,m),getPublicKey:d=>k(d),utils:{randomPrivateKey:()=>a(c)},GuBytes:R.slice()}}BigInt(0);const xc=BigInt(1),Oo=BigInt(2),vc=BigInt(3),Ec=BigInt(5),Bc=BigInt(8),Uo={p:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:Bc,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function Ac(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const Tn=(()=>{const t=Uo.p;return wc({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:n,b2:r}=function Ic(t){const e=BigInt(10),n=BigInt(20),r=BigInt(40),o=BigInt(80),s=Uo.p,f=t*t%s*t%s,a=pt(f,Oo,s)*f%s,l=pt(a,xc,s)*t%s,c=pt(l,Ec,s)*l%s,u=pt(c,e,s)*c%s,h=pt(u,n,s)*u%s,g=pt(h,r,s)*h%s,w=pt(g,o,s)*g%s,y=pt(w,o,s)*g%s,x=pt(y,e,s)*c%s;return{pow_p_5_8:pt(x,Oo,s)*t%s,b2:f}}(e);return lt(pt(n,vc,t)*r,t)},adjustScalarBytes:Ac})})();function _o(t){void 0!==t.lowS&&Re("lowS",t.lowS),void 0!==t.prehash&&Re("prehash",t.prehash)}class Sc extends Error{constructor(e=""){super(e)}}const vt={Err:Sc,_tlv:{encode:(t,e)=>{const{Err:n}=vt;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(1&e.length)throw new n("tlv.encode: unpadded data");const r=e.length/2,o=$e(r);if(o.length/2&128)throw new n("tlv.encode: long form length too big");const s=r>127?$e(o.length/2|128):"";return $e(t)+s+o+e},decode(t,e){const{Err:n}=vt;let r=0;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length<2||e[r++]!==t)throw new n("tlv.decode: wrong tlv");const o=e[r++];let i=0;if(!!(128&o)){const a=127&o;if(!a)throw new n("tlv.decode(long): indefinite length not supported");if(a>4)throw new n("tlv.decode(long): byte length is too big");const l=e.subarray(r,r+a);if(l.length!==a)throw new n("tlv.decode: length bytes not complete");if(0===l[0])throw new n("tlv.decode(long): zero leftmost byte");for(const c of l)i=i<<8|c;if(r+=a,i<128)throw new n("tlv.decode(long): not minimal encoding")}else i=o;const f=e.subarray(r,r+i);if(f.length!==i)throw new n("tlv.decode: wrong value length");return{v:f,l:e.subarray(r+i)}}},_int:{encode(t){const{Err:e}=vt;if(t<he)throw new e("integer: negative integers are not allowed");let n=$e(t);if(8&Number.parseInt(n[0],16)&&(n="00"+n),1&n.length)throw new e("unexpected DER parsing assertion: unpadded hex");return n},decode(t){const{Err:e}=vt;if(128&t[0])throw new e("invalid signature integer: negative");if(0===t[0]&&!(128&t[1]))throw new e("invalid signature integer: unnecessary leading zero");return Ce(t)}},toSig(t){const{Err:e,_int:n,_tlv:r}=vt,o=rt("signature",t),{v:s,l:i}=r.decode(48,o);if(i.length)throw new e("invalid signature: left bytes after parsing");const{v:f,l:a}=r.decode(2,s),{v:l,l:c}=r.decode(2,a);if(c.length)throw new e("invalid signature: left bytes after parsing");return{r:n.decode(f),s:n.decode(l)}},hexFromSig(t){const{_tlv:e,_int:n}=vt,s=e.encode(2,n.encode(t.r))+e.encode(2,n.encode(t.s));return e.encode(48,s)}},he=BigInt(0),pe=BigInt(1),Nc=BigInt(2),He=BigInt(3),Oc=BigInt(4);function To(t,e,n){const{BYTES:r}=t;return function o(s){let i;if("bigint"==typeof s)i=s;else{let f=rt("private key",s);if(e){if(!e.includes(2*f.length))throw new Error("invalid private key");const a=new Uint8Array(r);a.set(f,a.length-f.length),f=a}try{i=t.fromBytes(f)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof s}`)}}if(n&&(i=t.create(i)),!t.isValidNot0(i))throw new Error("invalid private key: out of range [1..N-1]");return i}}function _c(t,e={}){const{Fp:n,Fn:r}=function yc(t,e,n={}){if(!e||"object"!=typeof e)throw new Error(`expected valid ${t} CURVE object`);for(const f of["p","n","h"]){const a=e[f];if(!("bigint"==typeof a&&a>Xt))throw new Error(`CURVE.${f} must be positive bigint`)}const r=No(e.p,n.Fp),o=No(e.n,n.Fn),i=["Gx","Gy","a","weierstrass"===t?"b":"d"];for(const f of i)if(!r.isValid(e[f]))throw new Error(`CURVE.${f} must be valid field element of CURVE.Fp`);return{Fp:r,Fn:o}}("weierstrass",t,e),{h:o,n:s}=t;ke(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:i}=e;if(i&&(!n.is0(t.a)||"bigint"!=typeof i.beta||"function"!=typeof i.splitScalar))throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function');function f(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}const c=e.toBytes||function a($,d,m){const{x:p,y:b}=d.toAffine(),v=n.toBytes(p);if(Re("isCompressed",m),m){f();return Ht(Ro(!n.isOdd(b)),v)}return Ht(Uint8Array.of(4),v,n.toBytes(b))},u=e.fromBytes||function l($){at($);const d=n.BYTES,m=d+1,p=2*d+1,b=$.length,v=$[0],B=$.subarray(1);if(b!==m||2!==v&&3!==v){if(b===p&&4===v){const E=n.fromBytes(B.subarray(0*d,1*d)),I=n.fromBytes(B.subarray(1*d,2*d));if(!g(E,I))throw new Error("bad point: is not on curve");return{x:E,y:I}}throw new Error(`bad point: got length ${b}, expected compressed=${m} or uncompressed=${p}`)}{const E=n.fromBytes(B);if(!n.isValid(E))throw new Error("bad point: is not on curve, wrong x");const I=h(E);let S;try{S=n.sqrt(I)}catch(T){const U=T instanceof Error?": "+T.message:"";throw new Error("bad point: is not on curve, sqrt error"+U)}f();return!(1&~v)!==n.isOdd(S)&&(S=n.neg(S)),{x:E,y:S}}},h=function Uc(t,e,n){return function r(o){const s=t.sqr(o),i=t.mul(s,o);return t.add(t.add(i,t.mul(o,e)),n)}}(n,t.a,t.b);function g($,d){const m=n.sqr(d),p=h($);return n.eql(m,p)}if(!g(t.Gx,t.Gy))throw new Error("bad curve params: generator point");const w=n.mul(n.pow(t.a,He),Oc),y=n.mul(n.sqr(t.b),BigInt(27));if(n.is0(n.add(w,y)))throw new Error("bad curve params: a or b");function x($,d,m=!1){if(!n.isValid(d)||m&&n.is0(d))throw new Error(`bad point coordinate ${$}`);return d}function R($){if(!($ instanceof _))throw new Error("ProjectivePoint expected")}const M=ho(($,d)=>{const{px:m,py:p,pz:b}=$;if(n.eql(b,n.ONE))return{x:m,y:p};const v=$.is0();null==d&&(d=v?n.ONE:n.inv(b));const B=n.mul(m,d),E=n.mul(p,d),I=n.mul(b,d);if(v)return{x:n.ZERO,y:n.ZERO};if(!n.eql(I,n.ONE))throw new Error("invZ was invalid");return{x:B,y:E}}),L=ho($=>{if($.is0()){if(e.allowInfinityPoint&&!n.is0($.py))return;throw new Error("bad point: ZERO")}const{x:d,y:m}=$.toAffine();if(!n.isValid(d)||!n.isValid(m))throw new Error("bad point: x or y not field elements");if(!g(d,m))throw new Error("bad point: equation left != right");if(!$.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function V($,d,m,p,b){return m=new _(n.mul(m.px,$),m.py,m.pz),d=le(p,d),m=le(b,m),d.add(m)}class _{constructor(d,m,p){this.px=x("x",d),this.py=x("y",m,!0),this.pz=x("z",p),Object.freeze(this)}static fromAffine(d){const{x:m,y:p}=d||{};if(!d||!n.isValid(m)||!n.isValid(p))throw new Error("invalid affine point");if(d instanceof _)throw new Error("projective point not allowed");return n.is0(m)&&n.is0(p)?_.ZERO:new _(m,p,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(d){return function lc(t,e,n){const r="pz"===e?i=>i.pz:i=>i.ez,o=wo(t.Fp,n.map(r));return n.map((i,f)=>i.toAffine(o[f])).map(t.fromAffine)}(_,"pz",d)}static fromBytes(d){return at(d),_.fromHex(d)}static fromHex(d){const m=_.fromAffine(u(rt("pointHex",d)));return m.assertValidity(),m}static fromPrivateKey(d){const m=To(r,e.allowedPrivateKeyLengths,e.wrapPrivateKey);return _.BASE.multiply(m(d))}static msm(d,m){return bc(_,r,d,m)}precompute(d=8,m=!0){return j.setWindowSize(this,d),m||this.multiply(He),this}_setWindowSize(d){this.precompute(d)}assertValidity(){L(this)}hasEvenY(){const{y:d}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(d)}equals(d){R(d);const{px:m,py:p,pz:b}=this,{px:v,py:B,pz:E}=d,I=n.eql(n.mul(m,E),n.mul(v,b)),S=n.eql(n.mul(p,E),n.mul(B,b));return I&&S}negate(){return new _(this.px,n.neg(this.py),this.pz)}double(){const{a:d,b:m}=t,p=n.mul(m,He),{px:b,py:v,pz:B}=this;let E=n.ZERO,I=n.ZERO,S=n.ZERO,O=n.mul(b,b),A=n.mul(v,v),T=n.mul(B,B),U=n.mul(b,v);return U=n.add(U,U),S=n.mul(b,B),S=n.add(S,S),E=n.mul(d,S),I=n.mul(p,T),I=n.add(E,I),E=n.sub(A,I),I=n.add(A,I),I=n.mul(E,I),E=n.mul(U,E),S=n.mul(p,S),T=n.mul(d,T),U=n.sub(O,T),U=n.mul(d,U),U=n.add(U,S),S=n.add(O,O),O=n.add(S,O),O=n.add(O,T),O=n.mul(O,U),I=n.add(I,O),T=n.mul(v,B),T=n.add(T,T),O=n.mul(T,U),E=n.sub(E,O),S=n.mul(T,A),S=n.add(S,S),S=n.add(S,S),new _(E,I,S)}add(d){R(d);const{px:m,py:p,pz:b}=this,{px:v,py:B,pz:E}=d;let I=n.ZERO,S=n.ZERO,O=n.ZERO;const A=t.a,T=n.mul(t.b,He);let U=n.mul(m,v),C=n.mul(p,B),H=n.mul(b,E),q=n.add(m,p),P=n.add(v,B);q=n.mul(q,P),P=n.add(U,C),q=n.sub(q,P),P=n.add(m,b);let K=n.add(v,E);return P=n.mul(P,K),K=n.add(U,H),P=n.sub(P,K),K=n.add(p,b),I=n.add(B,E),K=n.mul(K,I),I=n.add(C,H),K=n.sub(K,I),O=n.mul(A,P),I=n.mul(T,H),O=n.add(I,O),I=n.sub(C,O),O=n.add(C,O),S=n.mul(I,O),C=n.add(U,U),C=n.add(C,U),H=n.mul(A,H),P=n.mul(T,P),C=n.add(C,H),H=n.sub(U,H),H=n.mul(A,H),P=n.add(P,H),U=n.mul(C,P),S=n.add(S,U),U=n.mul(K,P),I=n.mul(q,I),I=n.sub(I,U),U=n.mul(q,C),O=n.mul(K,O),O=n.add(O,U),new _(I,S,O)}subtract(d){return this.add(d.negate())}is0(){return this.equals(_.ZERO)}multiply(d){const{endo:m}=e;if(!r.isValidNot0(d))throw new Error("invalid scalar: out of range");let p,b;const v=B=>j.wNAFCached(this,B,_.normalizeZ);if(m){const{k1neg:B,k1:E,k2neg:I,k2:S}=m.splitScalar(d),{p:O,f:A}=v(E),{p:T,f:U}=v(S);b=A.add(U),p=V(m.beta,O,T,B,I)}else{const{p:B,f:E}=v(d);p=B,b=E}return _.normalizeZ([p,b])[0]}multiplyUnsafe(d){const{endo:m}=e,p=this;if(!r.isValid(d))throw new Error("invalid scalar: out of range");if(d===he||p.is0())return _.ZERO;if(d===pe)return p;if(j.hasPrecomputes(this))return this.multiply(d);if(m){const{k1neg:b,k1:v,k2neg:B,k2:E}=m.splitScalar(d),{p1:I,p2:S}=function gc(t,e,n,r){let o=e,s=t.ZERO,i=t.ZERO;for(;n>Xt||r>Xt;)n&Mt&&(s=s.add(o)),r&Mt&&(i=i.add(o)),o=o.double(),n>>=Mt,r>>=Mt;return{p1:s,p2:i}}(_,p,v,E);return V(m.beta,I,S,b,B)}return j.wNAFCachedUnsafe(p,d)}multiplyAndAddUnsafe(d,m,p){const b=this.multiplyUnsafe(m).add(d.multiplyUnsafe(p));return b.is0()?void 0:b}toAffine(d){return M(this,d)}isTorsionFree(){const{isTorsionFree:d}=e;return o===pe||(d?d(_,this):j.wNAFCachedUnsafe(this,s).is0())}clearCofactor(){const{clearCofactor:d}=e;return o===pe?this:d?d(_,this):this.multiplyUnsafe(o)}toBytes(d=!0){return Re("isCompressed",d),this.assertValidity(),c(_,this,d)}toRawBytes(d=!0){return this.toBytes(d)}toHex(d=!0){return ce(this.toBytes(d))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}_.BASE=new _(t.Gx,t.Gy,n.ONE),_.ZERO=new _(n.ZERO,n.ONE,n.ZERO),_.Fp=n,_.Fn=r;const k=r.BITS,j=function pc(t,e){return{constTimeNegate:le,hasPrecomputes:n=>1!==_n(n),unsafeLadder(n,r,o=t.ZERO){let s=n;for(;r>Xt;)r&Mt&&(o=o.add(s)),s=s.double(),r>>=Mt;return o},precomputeWindow(n,r){const{windows:o,windowSize:s}=On(r,e),i=[];let f=n,a=f;for(let l=0;l<o;l++){a=f,i.push(a);for(let c=1;c<s;c++)a=a.add(f),i.push(a);f=a.double()}return i},wNAF(n,r,o){let s=t.ZERO,i=t.BASE;const f=On(n,e);for(let a=0;a<f.windows;a++){const{nextN:l,offset:c,isZero:u,isNeg:h,isNegF:g,offsetF:w}=Io(o,a,f);o=l,u?i=i.add(le(g,r[w])):s=s.add(le(h,r[c]))}return So(o),{p:s,f:i}},wNAFUnsafe(n,r,o,s=t.ZERO){const i=On(n,e);for(let f=0;f<i.windows&&o!==Xt;f++){const{nextN:a,offset:l,isZero:c,isNeg:u}=Io(o,f,i);if(o=a,!c){const h=r[l];s=s.add(u?h.negate():h)}}return So(o),s},getPrecomputes(n,r,o){let s=Un.get(r);return s||(s=this.precomputeWindow(r,n),1!==n&&("function"==typeof o&&(s=o(s)),Un.set(r,s))),s},wNAFCached(n,r,o){const s=_n(n);return this.wNAF(s,this.getPrecomputes(s,n,o),r)},wNAFCachedUnsafe(n,r,o,s){const i=_n(n);return 1===i?this.unsafeLadder(n,r,s):this.wNAFUnsafe(i,this.getPrecomputes(i,n,o),r,s)},setWindowSize(n,r){Bo(r,e),Ao.set(n,r),Un.delete(n)}}}(_,e.endo?Math.ceil(k/2):k);return _}function Ro(t){return Uint8Array.of(t?2:3)}function Tc(t,e,n={}){ke(e,{hash:"function"},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const r=e.randomBytes||Zt,o=e.hmac||((p,...b)=>_e(e.hash,p,Ht(...b))),{Fp:s,Fn:i}=t,{ORDER:f,BITS:a}=i;function l(p){return p>f>>pe}function u(p,b){if(!i.isValidNot0(b))throw new Error(`invalid signature ${p}: out of range 1..CURVE.n`)}class h{constructor(b,v,B){u("r",b),u("s",v),this.r=b,this.s=v,null!=B&&(this.recovery=B),Object.freeze(this)}static fromCompact(b){const v=i.BYTES,B=rt("compactSignature",b,2*v);return new h(i.fromBytes(B.subarray(0,v)),i.fromBytes(B.subarray(v,2*v)))}static fromDER(b){const{r:v,s:B}=vt.toSig(rt("DER",b));return new h(v,B)}assertValidity(){}addRecoveryBit(b){return new h(this.r,this.s,b)}recoverPublicKey(b){const v=s.ORDER,{r:B,s:E,recovery:I}=this;if(null==I||![0,1,2,3].includes(I))throw new Error("recovery id invalid");if(f*Nc<v&&I>1)throw new Error("recovery id is ambiguous for h>1 curve");const O=2===I||3===I?B+f:B;if(!s.isValid(O))throw new Error("recovery id 2 or 3 invalid");const A=s.toBytes(O),T=t.fromHex(Ht(Ro(!(1&I)),A)),U=i.inv(O),C=L(rt("msgHash",b)),H=i.create(-C*U),q=i.create(E*U),P=t.BASE.multiplyUnsafe(H).add(T.multiplyUnsafe(q));if(P.is0())throw new Error("point at infinify");return P.assertValidity(),P}hasHighS(){return l(this.s)}normalizeS(){return this.hasHighS()?new h(this.r,i.neg(this.s),this.recovery):this}toBytes(b){if("compact"===b)return Ht(i.toBytes(this.r),i.toBytes(this.s));if("der"===b)return fn(vt.hexFromSig(this));throw new Error("invalid format")}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return ce(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return ce(this.toBytes("compact"))}}const g=To(i,n.allowedPrivateKeyLengths,n.wrapPrivateKey),w={isValidPrivateKey(p){try{return g(p),!0}catch{return!1}},normPrivateKeyToScalar:g,randomPrivateKey:()=>{const p=f;return function uc(t,e,n=!1){const r=t.length,o=vo(e),s=Eo(e);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);const f=lt(n?Le(t):Ce(t),e-Q)+Q;return n?An(f,o):In(f,o)}(r(Eo(p)),p)},precompute:(p=8,b=t.BASE)=>b.precompute(p,!1)};function x(p){if("bigint"==typeof p)return!1;if(p instanceof t)return!0;const v=rt("key",p).length,B=s.BYTES,E=B+1,I=2*B+1;return n.allowedPrivateKeyLengths||i.BYTES===E?void 0:v===E||v===I}const M=e.bits2int||function(p){if(p.length>8192)throw new Error("input is too large");const b=Ce(p),v=8*p.length-a;return v>0?b>>BigInt(v):b},L=e.bits2int_modN||function(p){return i.create(M(p))},V=je(a);function _(p){return Nn("num < 2^"+a,p,he,V),i.toBytes(p)}function k(p,b,v=j){if(["recovered","canonical"].some(q=>q in v))throw new Error("sign() legacy options not supported");const{hash:B}=e;let{lowS:E,prehash:I,extraEntropy:S}=v;null==E&&(E=!0),p=rt("msgHash",p),_o(v),I&&(p=rt("prehashed msgHash",B(p)));const O=L(p),A=g(b),T=[_(A),_(O)];if(null!=S&&!1!==S){const q=!0===S?r(s.BYTES):S;T.push(rt("extraEntropy",q))}const U=Ht(...T),C=O;return{seed:U,k2sig:function H(q){const P=M(q);if(!i.isValidNot0(P))return;const K=i.inv(P),et=t.BASE.multiply(P).toAffine(),Z=i.create(et.x);if(Z===he)return;const z=i.create(K*i.create(C+Z*A));if(z===he)return;let Ft=(et.x===Z?0:2)|Number(et.y&pe),yt=z;return E&&l(z)&&(yt=function c(p){return l(p)?i.neg(p):p}(z),Ft^=1),new h(Z,yt,Ft)}}}const j={lowS:e.lowS,prehash:!1},$={lowS:e.lowS,prehash:!1};return t.BASE.precompute(8),Object.freeze({getPublicKey:function y(p,b=!0){return t.fromPrivateKey(p).toBytes(b)},getSharedSecret:function R(p,b,v=!0){if(!0===x(p))throw new Error("first arg must be private key");if(!1===x(b))throw new Error("second arg must be public key");return t.fromHex(b).multiply(g(p)).toBytes(v)},sign:function d(p,b,v=j){const{seed:B,k2sig:E}=k(p,b,v);return function ec(t,e,n){if("number"!=typeof t||t<2)throw new Error("hashLen must be a number");if("number"!=typeof e||e<2)throw new Error("qByteLen must be a number");if("function"!=typeof n)throw new Error("hmacFn must be a function");const r=g=>new Uint8Array(g),o=g=>Uint8Array.of(g);let s=r(t),i=r(t),f=0;const a=()=>{s.fill(1),i.fill(0),f=0},l=(...g)=>n(i,s,...g),c=(g=r(0))=>{i=l(o(0),g),s=l(),0!==g.length&&(i=l(o(1),g),s=l())},u=()=>{if(f++>=1e3)throw new Error("drbg: tried 1000 values");let g=0;const w=[];for(;g<e;){s=l();const y=s.slice();w.push(y),g+=s.length}return Ht(...w)};return(g,w)=>{let y;for(a(),c(g);!(y=w(u()));)c();return a(),y}}(e.hash.outputLen,i.BYTES,o)(B,E)},verify:function m(p,b,v,B=$){const E=p;b=rt("msgHash",b),v=rt("publicKey",v),_o(B);const{lowS:I,prehash:S,format:O}=B;if("strict"in B)throw new Error("options.strict was renamed to lowS");if(void 0!==O&&!["compact","der","js"].includes(O))throw new Error('format must be "compact", "der" or "js"');const A="string"==typeof E||nn(E),T=!A&&!O&&"object"==typeof E&&null!==E&&"bigint"==typeof E.r&&"bigint"==typeof E.s;if(!A&&!T)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let U,C;try{if(T){if(void 0!==O&&"js"!==O)throw new Error("invalid format");U=new h(E.r,E.s)}if(A){try{"compact"!==O&&(U=h.fromDER(E))}catch(yt){if(!(yt instanceof vt.Err))throw yt}!U&&"der"!==O&&(U=h.fromCompact(E))}C=t.fromHex(v)}catch{return!1}if(!U||I&&U.hasHighS())return!1;S&&(b=e.hash(b));const{r:H,s:q}=U,P=L(b),K=i.inv(q),et=i.create(P*K),Z=i.create(H*K),z=t.BASE.multiplyUnsafe(et).add(C.multiplyUnsafe(Z));return!z.is0()&&i.create(z.x)===H},utils:w,Point:t,Signature:h})}function $c(t){const{CURVE:e,curveOpts:n}=function Rc(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy};return{CURVE:e,curveOpts:{Fp:t.Fp,Fn:Yt(e.n,t.nBitLength),allowedPrivateKeyLengths:t.allowedPrivateKeyLengths,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,wrapPrivateKey:t.wrapPrivateKey,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes}}}(t);return{CURVE:e,curveOpts:n,ecdsaOpts:{hash:t.hash,hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN}}}function Lc(t){const{CURVE:e,curveOpts:n,ecdsaOpts:r}=$c(t);return function Cc(t,e){return Object.assign({},e,{ProjectivePoint:e.Point,CURVE:t})}(t,Tc(_c(e,n),r,n))}function Rn(t,e){const n=r=>Lc({...t,hash:r});return{...n(e),create:n}}const $o={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},Co={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},Lo={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},jc=Yt($o.p),kc=Yt(Co.p),Pc=Yt(Lo.p),Hc=Rn({...$o,Fp:jc,lowS:!1},Ae);Rn({...Co,Fp:kc,lowS:!1},Yi),Rn({...Lo,Fp:Pc,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},Wi);const Dc=Hc,$n="base10",tt="base16",Qt="base64pad",De="base64url",te="utf8",Cn=0,ee=1,ge=2,Mc=0,jo=1,be=12,Ln=32;function Vc(){const t=Tn.utils.randomPrivateKey(),e=Tn.getPublicKey(t);return{privateKey:(0,src.dI)(t,tt),publicKey:(0,src.dI)(e,tt)}}function qc(){const t=Zt(Ln);return(0,src.dI)(t,tt)}function Kc(t,e){const n=Tn.getSharedSecret((0,src.sH)(t,tt),(0,src.sH)(e,tt)),r=Jf(Te,n,void 0,void 0,Ln);return(0,src.dI)(r,tt)}function Fc(t){const e=Te((0,src.sH)(t,tt));return(0,src.dI)(e,tt)}function zc(t){const e=Te((0,src.sH)(t,te));return(0,src.dI)(e,tt)}function jn(t){return(0,src.sH)(`${t}`,$n)}function Vt(t){return Number((0,src.dI)(t,$n))}function ko(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function Po(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),n=(4-e.length%4)%4;return e+"=".repeat(n)}function Gc(t){const e=jn(typeof t.type<"u"?t.type:Cn);if(Vt(e)===ee&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const n=typeof t.senderPublicKey<"u"?(0,src.sH)(t.senderPublicKey,tt):void 0,r=typeof t.iv<"u"?(0,src.sH)(t.iv,tt):Zt(be),o=(0,src.sH)(t.symKey,tt),i=kn({type:e,sealed:co(o,r).encrypt((0,src.sH)(t.message,te)),iv:r,senderPublicKey:n});return t.encoding===De?ko(i):i}function Zc(t){const e=(0,src.sH)(t.symKey,tt),{sealed:n,iv:r}=Me({encoded:t.encoded,encoding:t.encoding}),o=co(e,r).decrypt(n);if(null===o)throw new Error("Failed to decrypt");return(0,src.dI)(o,te)}function Wc(t,e){const n=jn(ge),r=Zt(be),s=kn({type:n,sealed:(0,src.sH)(t,te),iv:r});return e===De?ko(s):s}function Yc(t,e){const{sealed:n}=Me({encoded:t,encoding:e});return(0,src.dI)(n,te)}function kn(t){if(Vt(t.type)===ge)return(0,src.dI)((0,src.xW)([t.type,t.sealed]),Qt);if(Vt(t.type)===ee){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return(0,src.dI)((0,src.xW)([t.type,t.senderPublicKey,t.iv,t.sealed]),Qt)}return(0,src.dI)((0,src.xW)([t.type,t.iv,t.sealed]),Qt)}function Me(t){const e=(t.encoding||Qt)===De?Po(t.encoded):t.encoded,n=(0,src.sH)(e,Qt),r=n.slice(Mc,jo),o=jo;if(Vt(r)===ee){const a=o+Ln,l=a+be,c=n.slice(o,a),u=n.slice(a,l);return{type:r,sealed:n.slice(l),iv:u,senderPublicKey:c}}if(Vt(r)===ge){return{type:r,sealed:n.slice(o),iv:Zt(be)}}const s=o+be,i=n.slice(o,s);return{type:r,sealed:n.slice(s),iv:i}}function Xc(t,e){const n=Me({encoded:t,encoding:e?.encoding});return Ho({type:Vt(n.type),senderPublicKey:typeof n.senderPublicKey<"u"?(0,src.dI)(n.senderPublicKey,tt):void 0,receiverPublicKey:e?.receiverPublicKey})}function Ho(t){const e=t?.type||Cn;if(e===ee){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function Jc(t){return t.type===ee&&"string"==typeof t.senderPublicKey&&"string"==typeof t.receiverPublicKey}function Qc(t){return t.type===ge}function ta(t,e){const[n,r,o]=t.split("."),s=Buffer.from(Po(o),"base64");if(64!==s.length)throw new Error("Invalid signature length");const i=s.slice(0,32),f=s.slice(32,64),l=Te(`${n}.${r}`),c=function Do(t){const e=Buffer.from(t.x,"base64"),n=Buffer.from(t.y,"base64");return(0,src.xW)([new Uint8Array([4]),e,n])}(e);if(!Dc.verify((0,src.xW)([i,f]),l,c))throw new Error("Invalid signature");return(0,index_es.Cq)(t).payload}const Mo="irn";function ea(t){return t?.relay||{protocol:Mo}}function na(t){const e=dist_index_es.CG[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}function Vo(t,e="-"){const n={},r="relay"+e;return Object.keys(t).forEach(o=>{if(o.startsWith(r)){const s=o.replace(r,""),i=t[o];n[s]=i}}),n}function ra(t){if(!t.includes("wc:")){const l=Qe(t);null!=l&&l.includes("wc:")&&(t=l)}const e=(t=(t=t.includes("wc://")?t.replace("wc://",""):t).includes("wc:")?t.replace("wc:",""):t).indexOf(":"),n=-1!==t.indexOf("?")?t.indexOf("?"):void 0,r=t.substring(0,e),o=t.substring(e+1,n).split("@"),s=typeof n<"u"?t.substring(n):"",i=new URLSearchParams(s),f={};i.forEach((l,c)=>{f[c]=l});const a="string"==typeof f.methods?f.methods.split(","):void 0;return{protocol:r,topic:qo(o[0]),version:parseInt(o[1],10),symKey:f.symKey,relay:Vo(f),methods:a,expiryTimestamp:f.expiryTimestamp?parseInt(f.expiryTimestamp,10):void 0}}function qo(t){return t.startsWith("//")?t.substring(2):t}function oa(t){const e=new URLSearchParams,n=function Ko(t,e="-"){const r={};return Object.keys(t).forEach(o=>{const s=o,i="relay"+e+s;t[s]&&(r[i]=t[s])}),r}(t.relay);Object.keys(n).sort().forEach(o=>{e.set(o,n[o])}),e.set("symKey",t.symKey),t.expiryTimestamp&&e.set("expiryTimestamp",t.expiryTimestamp.toString()),t.methods&&e.set("methods",t.methods.join(","));const r=e.toString();return`${t.protocol}:${t.topic}@${t.version}?${r}`}function sa(t,e,n){return`${t}?wc_ev=${n}&topic=${e}`}var ia=Object.defineProperty,fa=Object.defineProperties,ca=Object.getOwnPropertyDescriptors,Fo=Object.getOwnPropertySymbols,aa=Object.prototype.hasOwnProperty,ua=Object.prototype.propertyIsEnumerable,zo=(t,e,n)=>e in t?ia(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,la=(t,e)=>{for(var n in e||(e={}))aa.call(e,n)&&zo(t,n,e[n]);if(Fo)for(var n of Fo(e))ua.call(e,n)&&zo(t,n,e[n]);return t},da=(t,e)=>fa(t,ca(e));function qt(t){const e=[];return t.forEach(n=>{const[r,o]=n.split(":");e.push(`${r}:${o}`)}),e}function Pn(t){return t.includes(":")}function Yo(t){return Pn(t)?t.split(":")[0]:t}function ye(t){var e,n,r;const o={};if(!Ve(t))return o;for(const[s,i]of Object.entries(t)){const f=Pn(s)?[s]:i.chains,a=i.methods||[],l=i.events||[],c=Yo(s);o[c]=da(la({},o[c]),{chains:ct(f,null==(e=o[c])?void 0:e.chains),methods:ct(a,null==(n=o[c])?void 0:n.methods),events:ct(l,null==(r=o[c])?void 0:r.events)})}return o}function ga(t,e){const n=function Xo(t){const e={};return t?.forEach(n=>{var r;const[o,s]=n.split(":");e[o]||(e[o]={accounts:[],chains:[],events:[],methods:[]}),e[o].accounts.push(n),null==(r=e[o].chains)||r.push(`${o}:${s}`)}),e}(e=e.map(r=>r.replace("did:pkh:","")));for(const[r,o]of Object.entries(n))o.methods?o.methods=ct(o.methods,t):o.methods=t,o.events=["chainChanged","accountsChanged"];return n}function ba(t,e){var n,r,o,s,i,f;const a=ye(t),l=ye(e),c={},u=Object.keys(a).concat(Object.keys(l));for(const h of u)c[h]={chains:ct(null==(n=a[h])?void 0:n.chains,null==(r=l[h])?void 0:r.chains),methods:ct(null==(o=a[h])?void 0:o.methods,null==(s=l[h])?void 0:s.methods),events:ct(null==(i=a[h])?void 0:i.events,null==(f=l[h])?void 0:f.events)};return c}const Jo={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Qo={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function Et(t,e){const{message:n,code:r}=Qo[t];return{message:e?`${n} ${e}`:n,code:r}}function Kt(t,e){const{message:n,code:r}=Jo[t];return{message:e?`${n} ${e}`:n,code:r}}function me(t,e){return!!Array.isArray(t)&&(!(typeof e<"u"&&t.length)||t.every(e))}function Ve(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function kt(t){return typeof t>"u"}function it(t,e){return!(!e||!kt(t))||"string"==typeof t&&!!t.trim().length}function qe(t,e){return!(!e||!kt(t))||"number"==typeof t&&!isNaN(t)}function ya(t,e){const{requiredNamespaces:n}=e,r=Object.keys(t.namespaces),o=Object.keys(n);let s=!0;return!!It(o,r)&&(r.forEach(i=>{const{accounts:f,methods:a,events:l}=t.namespaces[i],c=qt(f),u=n[i];It(ve(i,u),c)&&It(u.methods,a)&&It(u.events,l)||(s=!1)}),s)}function we(t){return!(!it(t,!1)||!t.includes(":"))&&2===t.split(":").length}function ma(t){function e(n){try{return typeof new URL(n)<"u"}catch{return!1}}try{if(it(t,!1)){if(e(t))return!0;return e(Qe(t))}}catch{}return!1}function wa(t){var e;return null==(e=t?.proposer)?void 0:e.publicKey}function xa(t){return t?.topic}function va(t,e){let n=null;return it(t?.publicKey,!1)||(n=Et("MISSING_OR_INVALID",`${e} controller public key should be a string`)),n}function Hn(t){let e=!0;return me(t)?t.length&&(e=t.every(n=>it(n,!1))):e=!1,e}function ns(t,e,n){let r=null;return Object.entries(t).forEach(([o,s])=>{if(r)return;const i=function es(t,e,n){let r=null;return me(e)&&e.length?e.forEach(o=>{r||we(o)||(r=Kt("UNSUPPORTED_CHAINS",`${n}, chain ${o} should be a string and conform to "namespace:chainId" format`))}):we(t)||(r=Kt("UNSUPPORTED_CHAINS",`${n}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),r}(o,ve(o,s),`${e} ${n}`);i&&(r=i)}),r}function rs(t,e){let n=null;return me(t)?t.forEach(r=>{n||function ts(t){if(it(t,!1)&&t.includes(":")){const e=t.split(":");if(3===e.length){const n=e[0]+":"+e[1];return!!e[2]&&we(n)}}return!1}(r)||(n=Kt("UNSUPPORTED_ACCOUNTS",`${e}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):n=Kt("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),n}function Dn(t,e){let n=null;return Object.values(t).forEach(r=>{if(n)return;const o=function ss(t,e){let n=null;return Hn(t?.methods)?Hn(t?.events)||(n=Kt("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):n=Kt("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),n}(r,`${e}, namespace`);o&&(n=o)}),n}function Ea(t,e,n){let r=null;if(t&&Ve(t)){const o=Dn(t,e);o&&(r=o);const s=ns(t,e,n);s&&(r=s)}else r=Et("MISSING_OR_INVALID",`${e}, ${n} should be an object with data`);return r}function is(t,e){let n=null;if(t&&Ve(t)){const r=Dn(t,e);r&&(n=r);const o=function os(t,e){let n=null;return Object.values(t).forEach(r=>{if(n)return;const o=rs(r?.accounts,`${e} namespace`);o&&(n=o)}),n}(t,e);o&&(n=o)}else n=Et("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return n}function fs(t){return it(t.protocol,!0)}function Ba(t,e){let n=!1;return e&&!t?n=!0:t&&me(t)&&t.length&&t.forEach(r=>{n=fs(r)}),n}function Ia(t){return"number"==typeof t}function Aa(t){return typeof t<"u"&&null!==typeof t}function Sa(t){return!!(t&&"object"==typeof t&&t.code&&qe(t.code,!1)&&t.message&&it(t.message,!1))}function Na(t){return!(kt(t)||!it(t.method,!1))}function Oa(t){return!(kt(t)||kt(t.result)&&kt(t.error)||!qe(t.id,!1)||!it(t.jsonrpc,!1))}function Ua(t){return!(kt(t)||!it(t.name,!1))}function _a(t,e){return!(!we(e)||!function Go(t){const e=[];return Object.values(t).forEach(n=>{e.push(...qt(n.accounts))}),e}(t).includes(e))}function Ta(t,e,n){return!!it(n,!1)&&function Zo(t,e){const n=[];return Object.values(t).forEach(r=>{qt(r.accounts).includes(e)&&n.push(...r.methods)}),n}(t,e).includes(n)}function Ra(t,e,n){return!!it(n,!1)&&function Wo(t,e){const n=[];return Object.values(t).forEach(r=>{qt(r.accounts).includes(e)&&n.push(...r.events)}),n}(t,e).includes(n)}function cs(t,e,n){let r=null;const o=function $a(t){const e={};return Object.keys(t).forEach(n=>{var r;n.includes(":")?e[n]=t[n]:null==(r=t[n].chains)||r.forEach(o=>{e[o]={methods:t[n].methods,events:t[n].events}})}),e}(t),s=function Ca(t){const e={};return Object.keys(t).forEach(n=>{if(n.includes(":"))e[n]=t[n];else{const r=qt(t[n].accounts);r?.forEach(o=>{e[o]={accounts:t[n].accounts.filter(s=>s.includes(`${o}:`)),methods:t[n].methods,events:t[n].events}})}}),e}(e),i=Object.keys(o),f=Object.keys(s),a=as(Object.keys(t)),l=as(Object.keys(e)),c=a.filter(u=>!l.includes(u));return c.length&&(r=Et("NON_CONFORMING_NAMESPACES",`${n} namespaces keys don't satisfy requiredNamespaces.\n      Required: ${c.toString()}\n      Received: ${Object.keys(e).toString()}`)),It(i,f)||(r=Et("NON_CONFORMING_NAMESPACES",`${n} namespaces chains don't satisfy required namespaces.\n      Required: ${i.toString()}\n      Approved: ${f.toString()}`)),Object.keys(e).forEach(u=>{if(!u.includes(":")||r)return;const h=qt(e[u].accounts);h.includes(u)||(r=Et("NON_CONFORMING_NAMESPACES",`${n} namespaces accounts don't satisfy namespace accounts for ${u}\n        Required: ${u}\n        Approved: ${h.toString()}`))}),i.forEach(u=>{r||(It(o[u].methods,s[u].methods)?It(o[u].events,s[u].events)||(r=Et("NON_CONFORMING_NAMESPACES",`${n} namespaces events don't satisfy namespace events for ${u}`)):r=Et("NON_CONFORMING_NAMESPACES",`${n} namespaces methods don't satisfy namespace methods for ${u}`))}),r}function as(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function La(t,e){return qe(t,!1)&&t<=e.max&&t>=e.min}function ja(){const t=Pt();return new Promise(e=>{switch(t){case J.browser:e(function us(){return zt()&&navigator?.onLine}());break;case J.reactNative:e(async function ls(){if(Bt()&&typeof __webpack_require__.g<"u"&&null!=__webpack_require__.g&&__webpack_require__.g.NetInfo){const t=await(null==__webpack_require__.g?void 0:__webpack_require__.g.NetInfo.fetch());return t?.isConnected}return!0}());break;case J.node:default:e(!0)}})}function ka(t){switch(Pt()){case J.browser:!function hs(t){!Bt()&&zt()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}(t);break;case J.reactNative:!function ps(t){Bt()&&typeof __webpack_require__.g<"u"&&null!=__webpack_require__.g&&__webpack_require__.g.NetInfo&&__webpack_require__.g?.NetInfo.addEventListener(e=>t(e?.isConnected))}(t);case J.node:}}function Pa(){var t;return!zt()||!(0,dist_cjs.getDocument)()||"visible"===(null==(t=(0,dist_cjs.getDocument)())?void 0:t.visibilityState)}const Mn={};class Ha{static get(e){return Mn[e]}static set(e,n){Mn[e]=n}static delete(e){delete Mn[e]}}function bs({publicKey:t,signature:e,payload:n}){var r;const o=Vn(n.method),s=128|parseInt((null==(r=n.version)?void 0:r.toString())||"4"),i=function Ma(t){const e=esm.A.decode(t)[0];return 42===e?0:60===e?2:1}(n.address),f="00"===n.era?new Uint8Array([0]):Vn(n.era);if(1!==f.length&&2!==f.length)throw new Error("Invalid era length");const a=parseInt(n.nonce,16),l=new Uint8Array([255&a,a>>8&255]),c=BigInt(`0x${function Da(t){return t.startsWith("0x")?t.slice(2):t}(n.tip)}`),u=function qa(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){const e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}if(t<BigInt(1)<<BigInt(30)){const e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}throw new Error("BigInt compact encoding not supported > 2^30")}(c),h=new Uint8Array([0,...t,i,...e,...f,...l,...u,...o]),g=function Va(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){const e=t<<2|1;return new Uint8Array([255&e,e>>8&255])}if(t<1<<30){const e=t<<2|2;return new Uint8Array([255&e,e>>8&255,e>>16&255,e>>24&255])}throw new Error("Compact encoding > 2^30 not supported")}(h.length+1);return new Uint8Array([...g,s,...h])}function Vn(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function Ka(t){const e=Uint8Array.from(Buffer.from(t.signature,"hex")),n=function gs(t){const e=esm.A.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}(t.transaction.address),r=bs({publicKey:n,signature:e,payload:t.transaction});return function ys(t){const e=Vn(t),n=(0,blakejs.blake2b)(e,void 0,32);return"0x"+Buffer.from(n).toString("hex")}(Buffer.from(r).toString("hex"))}},"./node_modules/@walletconnect/window-getters/dist/cjs/index.js":(__unused_webpack_module,exports)=>{"use strict";function getFromWindow(name){let res;return"undefined"!=typeof window&&void 0!==window[name]&&(res=window[name]),res}function getFromWindowOrThrow(name){const res=getFromWindow(name);if(!res)throw new Error(`${name} is not defined in Window`);return res}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getLocalStorage=exports.getLocalStorageOrThrow=exports.getCrypto=exports.getCryptoOrThrow=exports.getLocation=exports.getLocationOrThrow=exports.getNavigator=exports.getNavigatorOrThrow=exports.getDocument=exports.getDocumentOrThrow=exports.getFromWindowOrThrow=exports.getFromWindow=void 0,exports.getFromWindow=getFromWindow,exports.getFromWindowOrThrow=getFromWindowOrThrow,exports.getDocumentOrThrow=function getDocumentOrThrow(){return getFromWindowOrThrow("document")},exports.getDocument=function getDocument(){return getFromWindow("document")},exports.getNavigatorOrThrow=function getNavigatorOrThrow(){return getFromWindowOrThrow("navigator")},exports.getNavigator=function getNavigator(){return getFromWindow("navigator")},exports.getLocationOrThrow=function getLocationOrThrow(){return getFromWindowOrThrow("location")},exports.getLocation=function getLocation(){return getFromWindow("location")},exports.getCryptoOrThrow=function getCryptoOrThrow(){return getFromWindowOrThrow("crypto")},exports.getCrypto=function getCrypto(){return getFromWindow("crypto")},exports.getLocalStorageOrThrow=function getLocalStorageOrThrow(){return getFromWindowOrThrow("localStorage")},exports.getLocalStorage=function getLocalStorage(){return getFromWindow("localStorage")}},"./node_modules/@walletconnect/window-metadata/dist/cjs/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";exports.g=void 0;const window_getters_1=__webpack_require__("./node_modules/@walletconnect/window-getters/dist/cjs/index.js");exports.g=function getWindowMetadata(){let doc,loc;try{doc=window_getters_1.getDocumentOrThrow(),loc=window_getters_1.getLocationOrThrow()}catch(e){return null}function getWindowMetadataOfAny(...args){const metaTags=doc.getElementsByTagName("meta");for(let i=0;i<metaTags.length;i++){const tag=metaTags[i],attributes=["itemprop","property","name"].map(target=>tag.getAttribute(target)).filter(attr=>!!attr&&args.includes(attr));if(attributes.length&&attributes){const content=tag.getAttribute("content");if(content)return content}}return""}const name=function getName(){let name=getWindowMetadataOfAny("name","og:site_name","og:title","twitter:title");return name||(name=doc.title),name}();return{description:function getDescription(){return getWindowMetadataOfAny("description","og:description","twitter:description","keywords")}(),url:loc.origin,icons:function getIcons(){const links=doc.getElementsByTagName("link"),icons=[];for(let i=0;i<links.length;i++){const link=links[i],rel=link.getAttribute("rel");if(rel&&rel.toLowerCase().indexOf("icon")>-1){const href=link.getAttribute("href");if(href)if(-1===href.toLowerCase().indexOf("https:")&&-1===href.toLowerCase().indexOf("http:")&&0!==href.indexOf("//")){let absoluteHref=loc.protocol+"//"+loc.host;if(0===href.indexOf("/"))absoluteHref+=href;else{const path=loc.pathname.split("/");path.pop();absoluteHref+=path.join("/")+"/"+href}icons.push(absoluteHref)}else if(0===href.indexOf("//")){const absoluteUrl=loc.protocol+href;icons.push(absoluteUrl)}else icons.push(href)}}return icons}(),name}}},"./node_modules/blakejs/blake2b.js":(module,__unused_webpack_exports,__webpack_require__)=>{const util=__webpack_require__("./node_modules/blakejs/util.js");function ADD64AA(v,a,b){const o0=v[a]+v[b];let o1=v[a+1]+v[b+1];o0>=4294967296&&o1++,v[a]=o0,v[a+1]=o1}function ADD64AC(v,a,b0,b1){let o0=v[a]+b0;b0<0&&(o0+=4294967296);let o1=v[a+1]+b1;o0>=4294967296&&o1++,v[a]=o0,v[a+1]=o1}function B2B_GET32(arr,i){return arr[i]^arr[i+1]<<8^arr[i+2]<<16^arr[i+3]<<24}function B2B_G(a,b,c,d,ix,iy){const x0=m[ix],x1=m[ix+1],y0=m[iy],y1=m[iy+1];ADD64AA(v,a,b),ADD64AC(v,a,x0,x1);let xor0=v[d]^v[a],xor1=v[d+1]^v[a+1];v[d]=xor1,v[d+1]=xor0,ADD64AA(v,c,d),xor0=v[b]^v[c],xor1=v[b+1]^v[c+1],v[b]=xor0>>>24^xor1<<8,v[b+1]=xor1>>>24^xor0<<8,ADD64AA(v,a,b),ADD64AC(v,a,y0,y1),xor0=v[d]^v[a],xor1=v[d+1]^v[a+1],v[d]=xor0>>>16^xor1<<16,v[d+1]=xor1>>>16^xor0<<16,ADD64AA(v,c,d),xor0=v[b]^v[c],xor1=v[b+1]^v[c+1],v[b]=xor1>>>31^xor0<<1,v[b+1]=xor0>>>31^xor1<<1}const BLAKE2B_IV32=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),SIGMA82=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3].map(function(x){return 2*x})),v=new Uint32Array(32),m=new Uint32Array(32);function blake2bCompress(ctx,last){let i=0;for(i=0;i<16;i++)v[i]=ctx.h[i],v[i+16]=BLAKE2B_IV32[i];for(v[24]=v[24]^ctx.t,v[25]=v[25]^ctx.t/4294967296,last&&(v[28]=~v[28],v[29]=~v[29]),i=0;i<32;i++)m[i]=B2B_GET32(ctx.b,4*i);for(i=0;i<12;i++)B2B_G(0,8,16,24,SIGMA82[16*i+0],SIGMA82[16*i+1]),B2B_G(2,10,18,26,SIGMA82[16*i+2],SIGMA82[16*i+3]),B2B_G(4,12,20,28,SIGMA82[16*i+4],SIGMA82[16*i+5]),B2B_G(6,14,22,30,SIGMA82[16*i+6],SIGMA82[16*i+7]),B2B_G(0,10,20,30,SIGMA82[16*i+8],SIGMA82[16*i+9]),B2B_G(2,12,22,24,SIGMA82[16*i+10],SIGMA82[16*i+11]),B2B_G(4,14,16,26,SIGMA82[16*i+12],SIGMA82[16*i+13]),B2B_G(6,8,18,28,SIGMA82[16*i+14],SIGMA82[16*i+15]);for(i=0;i<16;i++)ctx.h[i]=ctx.h[i]^v[i]^v[i+16]}const parameterBlock=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function blake2bInit(outlen,key,salt,personal){if(0===outlen||outlen>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(key&&key.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(salt&&16!==salt.length)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(personal&&16!==personal.length)throw new Error("Illegal personal, expected Uint8Array with length is 16");const ctx={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen};parameterBlock.fill(0),parameterBlock[0]=outlen,key&&(parameterBlock[1]=key.length),parameterBlock[2]=1,parameterBlock[3]=1,salt&&parameterBlock.set(salt,32),personal&&parameterBlock.set(personal,48);for(let i=0;i<16;i++)ctx.h[i]=BLAKE2B_IV32[i]^B2B_GET32(parameterBlock,4*i);return key&&(blake2bUpdate(ctx,key),ctx.c=128),ctx}function blake2bUpdate(ctx,input){for(let i=0;i<input.length;i++)128===ctx.c&&(ctx.t+=ctx.c,blake2bCompress(ctx,!1),ctx.c=0),ctx.b[ctx.c++]=input[i]}function blake2bFinal(ctx){for(ctx.t+=ctx.c;ctx.c<128;)ctx.b[ctx.c++]=0;blake2bCompress(ctx,!0);const out=new Uint8Array(ctx.outlen);for(let i=0;i<ctx.outlen;i++)out[i]=ctx.h[i>>2]>>8*(3&i);return out}function blake2b(input,key,outlen,salt,personal){outlen=outlen||64,input=util.normalizeInput(input),salt&&(salt=util.normalizeInput(salt)),personal&&(personal=util.normalizeInput(personal));const ctx=blake2bInit(outlen,key,salt,personal);return blake2bUpdate(ctx,input),blake2bFinal(ctx)}module.exports={blake2b,blake2bHex:function blake2bHex(input,key,outlen,salt,personal){const output=blake2b(input,key,outlen,salt,personal);return util.toHex(output)},blake2bInit,blake2bUpdate,blake2bFinal}},"./node_modules/blakejs/blake2s.js":(module,__unused_webpack_exports,__webpack_require__)=>{const util=__webpack_require__("./node_modules/blakejs/util.js");function B2S_GET32(v,i){return v[i]^v[i+1]<<8^v[i+2]<<16^v[i+3]<<24}function B2S_G(a,b,c,d,x,y){v[a]=v[a]+v[b]+x,v[d]=ROTR32(v[d]^v[a],16),v[c]=v[c]+v[d],v[b]=ROTR32(v[b]^v[c],12),v[a]=v[a]+v[b]+y,v[d]=ROTR32(v[d]^v[a],8),v[c]=v[c]+v[d],v[b]=ROTR32(v[b]^v[c],7)}function ROTR32(x,y){return x>>>y^x<<32-y}const BLAKE2S_IV=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SIGMA=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),v=new Uint32Array(16),m=new Uint32Array(16);function blake2sCompress(ctx,last){let i=0;for(i=0;i<8;i++)v[i]=ctx.h[i],v[i+8]=BLAKE2S_IV[i];for(v[12]^=ctx.t,v[13]^=ctx.t/4294967296,last&&(v[14]=~v[14]),i=0;i<16;i++)m[i]=B2S_GET32(ctx.b,4*i);for(i=0;i<10;i++)B2S_G(0,4,8,12,m[SIGMA[16*i+0]],m[SIGMA[16*i+1]]),B2S_G(1,5,9,13,m[SIGMA[16*i+2]],m[SIGMA[16*i+3]]),B2S_G(2,6,10,14,m[SIGMA[16*i+4]],m[SIGMA[16*i+5]]),B2S_G(3,7,11,15,m[SIGMA[16*i+6]],m[SIGMA[16*i+7]]),B2S_G(0,5,10,15,m[SIGMA[16*i+8]],m[SIGMA[16*i+9]]),B2S_G(1,6,11,12,m[SIGMA[16*i+10]],m[SIGMA[16*i+11]]),B2S_G(2,7,8,13,m[SIGMA[16*i+12]],m[SIGMA[16*i+13]]),B2S_G(3,4,9,14,m[SIGMA[16*i+14]],m[SIGMA[16*i+15]]);for(i=0;i<8;i++)ctx.h[i]^=v[i]^v[i+8]}function blake2sInit(outlen,key){if(!(outlen>0&&outlen<=32))throw new Error("Incorrect output length, should be in [1, 32]");const keylen=key?key.length:0;if(key&&!(keylen>0&&keylen<=32))throw new Error("Incorrect key length, should be in [1, 32]");const ctx={h:new Uint32Array(BLAKE2S_IV),b:new Uint8Array(64),c:0,t:0,outlen};return ctx.h[0]^=16842752^keylen<<8^outlen,keylen>0&&(blake2sUpdate(ctx,key),ctx.c=64),ctx}function blake2sUpdate(ctx,input){for(let i=0;i<input.length;i++)64===ctx.c&&(ctx.t+=ctx.c,blake2sCompress(ctx,!1),ctx.c=0),ctx.b[ctx.c++]=input[i]}function blake2sFinal(ctx){for(ctx.t+=ctx.c;ctx.c<64;)ctx.b[ctx.c++]=0;blake2sCompress(ctx,!0);const out=new Uint8Array(ctx.outlen);for(let i=0;i<ctx.outlen;i++)out[i]=ctx.h[i>>2]>>8*(3&i)&255;return out}function blake2s(input,key,outlen){outlen=outlen||32,input=util.normalizeInput(input);const ctx=blake2sInit(outlen,key);return blake2sUpdate(ctx,input),blake2sFinal(ctx)}module.exports={blake2s,blake2sHex:function blake2sHex(input,key,outlen){const output=blake2s(input,key,outlen);return util.toHex(output)},blake2sInit,blake2sUpdate,blake2sFinal}},"./node_modules/blakejs/index.js":(module,__unused_webpack_exports,__webpack_require__)=>{const b2b=__webpack_require__("./node_modules/blakejs/blake2b.js"),b2s=__webpack_require__("./node_modules/blakejs/blake2s.js");module.exports={blake2b:b2b.blake2b,blake2bHex:b2b.blake2bHex,blake2bInit:b2b.blake2bInit,blake2bUpdate:b2b.blake2bUpdate,blake2bFinal:b2b.blake2bFinal,blake2s:b2s.blake2s,blake2sHex:b2s.blake2sHex,blake2sInit:b2s.blake2sInit,blake2sUpdate:b2s.blake2sUpdate,blake2sFinal:b2s.blake2sFinal}},"./node_modules/blakejs/util.js":(module,__unused_webpack_exports,__webpack_require__)=>{var console=__webpack_require__("./node_modules/console-browserify/index.js");function uint32ToHex(val){return(4294967296+val).toString(16).substring(1)}module.exports={normalizeInput:function normalizeInput(input){let ret;if(input instanceof Uint8Array)ret=input;else{if("string"!=typeof input)throw new Error("Input must be an string, Buffer or Uint8Array");ret=(new TextEncoder).encode(input)}return ret},toHex:function toHex(bytes){return Array.prototype.map.call(bytes,function(n){return(n<16?"0":"")+n.toString(16)}).join("")},debugPrint:function debugPrint(label,arr,size){let msg="\n"+label+" = ";for(let i=0;i<arr.length;i+=2){if(32===size)msg+=uint32ToHex(arr[i]).toUpperCase(),msg+=" ",msg+=uint32ToHex(arr[i+1]).toUpperCase();else{if(64!==size)throw new Error("Invalid size "+size);msg+=uint32ToHex(arr[i+1]).toUpperCase(),msg+=uint32ToHex(arr[i]).toUpperCase()}i%6==4?msg+="\n"+new Array(label.length+4).join(" "):i<arr.length-2&&(msg+=" ")}console.log(msg)},testSpeed:function testSpeed(hashFn,N,M){let startMs=(new Date).getTime();const input=new Uint8Array(N);for(let i=0;i<N;i++)input[i]=i%256;const genMs=(new Date).getTime();console.log("Generated random input in "+(genMs-startMs)+"ms"),startMs=genMs;for(let i=0;i<M;i++){const hashHex=hashFn(input),hashMs=(new Date).getTime(),ms=hashMs-startMs;startMs=hashMs,console.log("Hashed in "+ms+"ms: "+hashHex.substring(0,20)+"..."),console.log(Math.round(N/(1<<20)/(ms/1e3)*100)/100+" MB PER SECOND")}}}},"./node_modules/bs58/src/esm/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>src_esm});const esm=function base(ALPHABET){if(ALPHABET.length>=255)throw new TypeError("Alphabet too long");const BASE_MAP=new Uint8Array(256);for(let j=0;j<BASE_MAP.length;j++)BASE_MAP[j]=255;for(let i=0;i<ALPHABET.length;i++){const x=ALPHABET.charAt(i),xc=x.charCodeAt(0);if(255!==BASE_MAP[xc])throw new TypeError(x+" is ambiguous");BASE_MAP[xc]=i}const BASE=ALPHABET.length,LEADER=ALPHABET.charAt(0),FACTOR=Math.log(BASE)/Math.log(256),iFACTOR=Math.log(256)/Math.log(BASE);function decodeUnsafe(source){if("string"!=typeof source)throw new TypeError("Expected String");if(0===source.length)return new Uint8Array;let psz=0,zeroes=0,length=0;for(;source[psz]===LEADER;)zeroes++,psz++;const size=(source.length-psz)*FACTOR+1>>>0,b256=new Uint8Array(size);for(;psz<source.length;){const charCode=source.charCodeAt(psz);if(charCode>255)return;let carry=BASE_MAP[charCode];if(255===carry)return;let i=0;for(let it3=size-1;(0!==carry||i<length)&&-1!==it3;it3--,i++)carry+=BASE*b256[it3]>>>0,b256[it3]=carry%256>>>0,carry=carry/256>>>0;if(0!==carry)throw new Error("Non-zero carry");length=i,psz++}let it4=size-length;for(;it4!==size&&0===b256[it4];)it4++;const vch=new Uint8Array(zeroes+(size-it4));let j=zeroes;for(;it4!==size;)vch[j++]=b256[it4++];return vch}return{encode:function encode(source){if(source instanceof Uint8Array||(ArrayBuffer.isView(source)?source=new Uint8Array(source.buffer,source.byteOffset,source.byteLength):Array.isArray(source)&&(source=Uint8Array.from(source))),!(source instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===source.length)return"";let zeroes=0,length=0,pbegin=0;const pend=source.length;for(;pbegin!==pend&&0===source[pbegin];)pbegin++,zeroes++;const size=(pend-pbegin)*iFACTOR+1>>>0,b58=new Uint8Array(size);for(;pbegin!==pend;){let carry=source[pbegin],i=0;for(let it1=size-1;(0!==carry||i<length)&&-1!==it1;it1--,i++)carry+=256*b58[it1]>>>0,b58[it1]=carry%BASE>>>0,carry=carry/BASE>>>0;if(0!==carry)throw new Error("Non-zero carry");length=i,pbegin++}let it2=size-length;for(;it2!==size&&0===b58[it2];)it2++;let str=LEADER.repeat(zeroes);for(;it2<size;++it2)str+=ALPHABET.charAt(b58[it2]);return str},decodeUnsafe,decode:function decode(string){const buffer=decodeUnsafe(string);if(buffer)return buffer;throw new Error("Non-base"+BASE+" character")}}};const src_esm=esm("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")},"./node_modules/multiformats/esm/src/basics.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Fo:()=>bases});var identity_namespaceObject={};__webpack_require__.r(identity_namespaceObject),__webpack_require__.d(identity_namespaceObject,{identity:()=>identity});var base2_namespaceObject={};__webpack_require__.r(base2_namespaceObject),__webpack_require__.d(base2_namespaceObject,{base2:()=>base2});var base8_namespaceObject={};__webpack_require__.r(base8_namespaceObject),__webpack_require__.d(base8_namespaceObject,{base8:()=>base8});var base10_namespaceObject={};__webpack_require__.r(base10_namespaceObject),__webpack_require__.d(base10_namespaceObject,{base10:()=>base10});var base16_namespaceObject={};__webpack_require__.r(base16_namespaceObject),__webpack_require__.d(base16_namespaceObject,{base16:()=>base16,base16upper:()=>base16upper});var base32_namespaceObject={};__webpack_require__.r(base32_namespaceObject),__webpack_require__.d(base32_namespaceObject,{base32:()=>base32,base32hex:()=>base32hex,base32hexpad:()=>base32hexpad,base32hexpadupper:()=>base32hexpadupper,base32hexupper:()=>base32hexupper,base32pad:()=>base32pad,base32padupper:()=>base32padupper,base32upper:()=>base32upper,base32z:()=>base32z});var base36_namespaceObject={};__webpack_require__.r(base36_namespaceObject),__webpack_require__.d(base36_namespaceObject,{base36:()=>base36,base36upper:()=>base36upper});var base58_namespaceObject={};__webpack_require__.r(base58_namespaceObject),__webpack_require__.d(base58_namespaceObject,{base58btc:()=>base58btc,base58flickr:()=>base58flickr});var base64_namespaceObject={};__webpack_require__.r(base64_namespaceObject),__webpack_require__.d(base64_namespaceObject,{base64:()=>base64,base64pad:()=>base64pad,base64url:()=>base64url,base64urlpad:()=>base64urlpad});var base256emoji_namespaceObject={};__webpack_require__.r(base256emoji_namespaceObject),__webpack_require__.d(base256emoji_namespaceObject,{base256emoji:()=>base256emoji});var sha2_browser_namespaceObject={};__webpack_require__.r(sha2_browser_namespaceObject),__webpack_require__.d(sha2_browser_namespaceObject,{sha256:()=>sha256,sha512:()=>sha512});var hashes_identity_namespaceObject={};__webpack_require__.r(hashes_identity_namespaceObject),__webpack_require__.d(hashes_identity_namespaceObject,{identity:()=>identity_identity});var raw_namespaceObject={};__webpack_require__.r(raw_namespaceObject),__webpack_require__.d(raw_namespaceObject,{code:()=>raw_code,decode:()=>raw_decode,encode:()=>raw_encode,name:()=>raw_name});var json_namespaceObject={};__webpack_require__.r(json_namespaceObject),__webpack_require__.d(json_namespaceObject,{code:()=>json_code,decode:()=>json_decode,encode:()=>json_encode,name:()=>json_name});const base_x=function base(ALPHABET,name){if(ALPHABET.length>=255)throw new TypeError("Alphabet too long");for(var BASE_MAP=new Uint8Array(256),j=0;j<BASE_MAP.length;j++)BASE_MAP[j]=255;for(var i=0;i<ALPHABET.length;i++){var x=ALPHABET.charAt(i),xc=x.charCodeAt(0);if(255!==BASE_MAP[xc])throw new TypeError(x+" is ambiguous");BASE_MAP[xc]=i}var BASE=ALPHABET.length,LEADER=ALPHABET.charAt(0),FACTOR=Math.log(BASE)/Math.log(256),iFACTOR=Math.log(256)/Math.log(BASE);function decodeUnsafe(source){if("string"!=typeof source)throw new TypeError("Expected String");if(0===source.length)return new Uint8Array;var psz=0;if(" "!==source[psz]){for(var zeroes=0,length=0;source[psz]===LEADER;)zeroes++,psz++;for(var size=(source.length-psz)*FACTOR+1>>>0,b256=new Uint8Array(size);source[psz];){var carry=BASE_MAP[source.charCodeAt(psz)];if(255===carry)return;for(var i=0,it3=size-1;(0!==carry||i<length)&&-1!==it3;it3--,i++)carry+=BASE*b256[it3]>>>0,b256[it3]=carry%256>>>0,carry=carry/256>>>0;if(0!==carry)throw new Error("Non-zero carry");length=i,psz++}if(" "!==source[psz]){for(var it4=size-length;it4!==size&&0===b256[it4];)it4++;for(var vch=new Uint8Array(zeroes+(size-it4)),j=zeroes;it4!==size;)vch[j++]=b256[it4++];return vch}}}return{encode:function encode(source){if(source instanceof Uint8Array||(ArrayBuffer.isView(source)?source=new Uint8Array(source.buffer,source.byteOffset,source.byteLength):Array.isArray(source)&&(source=Uint8Array.from(source))),!(source instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===source.length)return"";for(var zeroes=0,length=0,pbegin=0,pend=source.length;pbegin!==pend&&0===source[pbegin];)pbegin++,zeroes++;for(var size=(pend-pbegin)*iFACTOR+1>>>0,b58=new Uint8Array(size);pbegin!==pend;){for(var carry=source[pbegin],i=0,it1=size-1;(0!==carry||i<length)&&-1!==it1;it1--,i++)carry+=256*b58[it1]>>>0,b58[it1]=carry%BASE>>>0,carry=carry/BASE>>>0;if(0!==carry)throw new Error("Non-zero carry");length=i,pbegin++}for(var it2=size-length;it2!==size&&0===b58[it2];)it2++;for(var str=LEADER.repeat(zeroes);it2<size;++it2)str+=ALPHABET.charAt(b58[it2]);return str},decodeUnsafe,decode:function decode(string){var buffer=decodeUnsafe(string);if(buffer)return buffer;throw new Error(`Non-${name} character`)}}},coerce=(new Uint8Array(0),o=>{if(o instanceof Uint8Array&&"Uint8Array"===o.constructor.name)return o;if(o instanceof ArrayBuffer)return new Uint8Array(o);if(ArrayBuffer.isView(o))return new Uint8Array(o.buffer,o.byteOffset,o.byteLength);throw new Error("Unknown type, must be binary type")});class Encoder{constructor(name,prefix,baseEncode){this.name=name,this.prefix=prefix,this.baseEncode=baseEncode}encode(bytes){if(bytes instanceof Uint8Array)return`${this.prefix}${this.baseEncode(bytes)}`;throw Error("Unknown type, must be binary type")}}class Decoder{constructor(name,prefix,baseDecode){if(this.name=name,this.prefix=prefix,void 0===prefix.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=prefix.codePointAt(0),this.baseDecode=baseDecode}decode(text){if("string"==typeof text){if(text.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(text)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(text.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(decoder){return or(this,decoder)}}class ComposedDecoder{constructor(decoders){this.decoders=decoders}or(decoder){return or(this,decoder)}decode(input){const prefix=input[0],decoder=this.decoders[prefix];if(decoder)return decoder.decode(input);throw RangeError(`Unable to decode multibase string ${JSON.stringify(input)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const or=(left,right)=>new ComposedDecoder({...left.decoders||{[left.prefix]:left},...right.decoders||{[right.prefix]:right}});class Codec{constructor(name,prefix,baseEncode,baseDecode){this.name=name,this.prefix=prefix,this.baseEncode=baseEncode,this.baseDecode=baseDecode,this.encoder=new Encoder(name,prefix,baseEncode),this.decoder=new Decoder(name,prefix,baseDecode)}encode(input){return this.encoder.encode(input)}decode(input){return this.decoder.decode(input)}}const from=({name,prefix,encode,decode})=>new Codec(name,prefix,encode,decode),baseX=({prefix,name,alphabet})=>{const{encode,decode}=base_x(alphabet,name);return from({prefix,name,encode,decode:text=>coerce(decode(text))})},rfc4648=({name,prefix,bitsPerChar,alphabet})=>from({prefix,name,encode:input=>((data,alphabet,bitsPerChar)=>{const pad="="===alphabet[alphabet.length-1],mask=(1<<bitsPerChar)-1;let out="",bits=0,buffer=0;for(let i=0;i<data.length;++i)for(buffer=buffer<<8|data[i],bits+=8;bits>bitsPerChar;)bits-=bitsPerChar,out+=alphabet[mask&buffer>>bits];if(bits&&(out+=alphabet[mask&buffer<<bitsPerChar-bits]),pad)for(;out.length*bitsPerChar&7;)out+="=";return out})(input,alphabet,bitsPerChar),decode:input=>((string,alphabet,bitsPerChar,name)=>{const codes={};for(let i=0;i<alphabet.length;++i)codes[alphabet[i]]=i;let end=string.length;for(;"="===string[end-1];)--end;const out=new Uint8Array(end*bitsPerChar/8|0);let bits=0,buffer=0,written=0;for(let i=0;i<end;++i){const value=codes[string[i]];if(void 0===value)throw new SyntaxError(`Non-${name} character`);buffer=buffer<<bitsPerChar|value,bits+=bitsPerChar,bits>=8&&(bits-=8,out[written++]=255&buffer>>bits)}if(bits>=bitsPerChar||255&buffer<<8-bits)throw new SyntaxError("Unexpected end of data");return out})(input,alphabet,bitsPerChar,name)}),identity=from({prefix:"\0",name:"identity",encode:buf=>{return b=buf,(new TextDecoder).decode(b);var b},decode:str=>(str=>(new TextEncoder).encode(str))(str)}),base2=rfc4648({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),base8=rfc4648({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),base10=baseX({prefix:"9",name:"base10",alphabet:"0123456789"}),base16=rfc4648({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper=rfc4648({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),base32=rfc4648({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper=rfc4648({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad=rfc4648({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper=rfc4648({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex=rfc4648({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper=rfc4648({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad=rfc4648({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper=rfc4648({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z=rfc4648({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base36=baseX({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper=baseX({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base58btc=baseX({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr=baseX({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base64=rfc4648({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad=rfc4648({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url=rfc4648({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad=rfc4648({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),alphabet=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),alphabetBytesToChars=alphabet.reduce((p,c,i)=>(p[i]=c,p),[]),alphabetCharsToBytes=alphabet.reduce((p,c,i)=>(p[c.codePointAt(0)]=i,p),[]);const base256emoji=from({prefix:"🚀",name:"base256emoji",encode:function base256emoji_encode(data){return data.reduce((p,c)=>p+=alphabetBytesToChars[c],"")},decode:function base256emoji_decode(str){const byts=[];for(const char of str){const byt=alphabetCharsToBytes[char.codePointAt(0)];if(void 0===byt)throw new Error(`Non-base256emoji character: ${char}`);byts.push(byt)}return new Uint8Array(byts)}});var encode_1=function varint_encode(num,out,offset){out=out||[];var oldOffset=offset=offset||0;for(;num>=INT;)out[offset++]=255&num|MSB,num/=128;for(;num&MSBALL;)out[offset++]=255&num|MSB,num>>>=7;return out[offset]=0|num,varint_encode.bytes=offset-oldOffset+1,out},MSB=128,MSBALL=-128,INT=Math.pow(2,31);var varint_decode=function read(buf,offset){var b,res=0,shift=0,counter=offset=offset||0,l=buf.length;do{if(counter>=l)throw read.bytes=0,new RangeError("Could not decode varint");b=buf[counter++],res+=shift<28?(b&REST$1)<<shift:(b&REST$1)*Math.pow(2,shift),shift+=7}while(b>=MSB$1);return read.bytes=counter-offset,res},MSB$1=128,REST$1=127;var N1=Math.pow(2,7),N2=Math.pow(2,14),N3=Math.pow(2,21),N4=Math.pow(2,28),N5=Math.pow(2,35),N6=Math.pow(2,42),N7=Math.pow(2,49),N8=Math.pow(2,56),N9=Math.pow(2,63);const vendor_varint={encode:encode_1,decode:varint_decode,encodingLength:function(value){return value<N1?1:value<N2?2:value<N3?3:value<N4?4:value<N5?5:value<N6?6:value<N7?7:value<N8?8:value<N9?9:10}},encodeTo=(int,target,offset=0)=>(vendor_varint.encode(int,target,offset),target),encodingLength=int=>vendor_varint.encodingLength(int),create=(code,digest)=>{const size=digest.byteLength,sizeOffset=encodingLength(code),digestOffset=sizeOffset+encodingLength(size),bytes=new Uint8Array(digestOffset+size);return encodeTo(code,bytes,0),encodeTo(size,bytes,sizeOffset),bytes.set(digest,digestOffset),new Digest(code,size,digest,bytes)};class Digest{constructor(code,size,digest,bytes){this.code=code,this.size=size,this.digest=digest,this.bytes=bytes}}const hasher_from=({name,code,encode})=>new Hasher(name,code,encode);class Hasher{constructor(name,code,encode){this.name=name,this.code=code,this.encode=encode}digest(input){if(input instanceof Uint8Array){const result=this.encode(input);return result instanceof Uint8Array?create(this.code,result):result.then(digest=>create(this.code,digest))}throw Error("Unknown type, must be binary type")}}const sha=name=>async data=>new Uint8Array(await crypto.subtle.digest(name,data)),sha256=hasher_from({name:"sha2-256",code:18,encode:sha("SHA-256")}),sha512=hasher_from({name:"sha2-512",code:19,encode:sha("SHA-512")}),identity_encode=coerce,identity_identity={code:0,name:"identity",encode:identity_encode,digest:input=>create(0,identity_encode(input))},raw_name="raw",raw_code=85,raw_encode=node=>coerce(node),raw_decode=data=>coerce(data),textEncoder=new TextEncoder,textDecoder=new TextDecoder,json_name="json",json_code=512,json_encode=node=>textEncoder.encode(JSON.stringify(node)),json_decode=data=>JSON.parse(textDecoder.decode(data));__webpack_require__("./node_modules/console-browserify/index.js");Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom");Symbol.for("@ipld/js-cid/CID");const bases={...identity_namespaceObject,...base2_namespaceObject,...base8_namespaceObject,...base10_namespaceObject,...base16_namespaceObject,...base32_namespaceObject,...base36_namespaceObject,...base58_namespaceObject,...base64_namespaceObject,...base256emoji_namespaceObject}},"./node_modules/pino/browser.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";const format=__webpack_require__("./node_modules/quick-format-unescaped/index.js");module.exports=pino;const _console=function pfGlobalThisOrFallback(){function defd(o){return void 0!==o&&o}try{return"undefined"!=typeof globalThis||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch(e){return defd(self)||defd(window)||defd(this)||{}}}().console||{},stdSerializers={mapHttpRequest:mock,mapHttpResponse:mock,wrapRequestSerializer:passthrough,wrapResponseSerializer:passthrough,wrapErrorSerializer:passthrough,req:mock,res:mock,err:function asErrValue(err){const obj={type:err.constructor.name,msg:err.message,stack:err.stack};for(const key in err)void 0===obj[key]&&(obj[key]=err[key]);return obj}};function pino(opts){(opts=opts||{}).browser=opts.browser||{};const transmit=opts.browser.transmit;if(transmit&&"function"!=typeof transmit.send)throw Error("pino: transmit option must have a send function");const proto=opts.browser.write||_console;opts.browser.write&&(opts.browser.asObject=!0);const serializers=opts.serializers||{},serialize=function shouldSerialize(serialize,serializers){if(Array.isArray(serialize))return serialize.filter(function(k){return"!stdSerializers.err"!==k});return!0===serialize&&Object.keys(serializers)}(opts.browser.serialize,serializers);let stdErrSerialize=opts.browser.serialize;Array.isArray(opts.browser.serialize)&&opts.browser.serialize.indexOf("!stdSerializers.err")>-1&&(stdErrSerialize=!1);"function"==typeof proto&&(proto.error=proto.fatal=proto.warn=proto.info=proto.debug=proto.trace=proto),!1===opts.enabled&&(opts.level="silent");const level=opts.level||"info",logger=Object.create(proto);logger.log||(logger.log=noop),Object.defineProperty(logger,"levelVal",{get:function getLevelVal(){return"silent"===this.level?1/0:this.levels.values[this.level]}}),Object.defineProperty(logger,"level",{get:function getLevel(){return this._level},set:function setLevel(level){if("silent"!==level&&!this.levels.values[level])throw Error("unknown level "+level);this._level=level,set(setOpts,logger,"error","log"),set(setOpts,logger,"fatal","error"),set(setOpts,logger,"warn","error"),set(setOpts,logger,"info","log"),set(setOpts,logger,"debug","log"),set(setOpts,logger,"trace","log")}});const setOpts={transmit,serialize,asObject:opts.browser.asObject,levels:["error","fatal","warn","info","debug","trace"],timestamp:getTimeFunction(opts)};return logger.levels=pino.levels,logger.level=level,logger.setMaxListeners=logger.getMaxListeners=logger.emit=logger.addListener=logger.on=logger.prependListener=logger.once=logger.prependOnceListener=logger.removeListener=logger.removeAllListeners=logger.listeners=logger.listenerCount=logger.eventNames=logger.write=logger.flush=noop,logger.serializers=serializers,logger._serialize=serialize,logger._stdErrSerialize=stdErrSerialize,logger.child=function child(bindings,childOptions){if(!bindings)throw new Error("missing bindings for child Pino");childOptions=childOptions||{},serialize&&bindings.serializers&&(childOptions.serializers=bindings.serializers);const childOptionsSerializers=childOptions.serializers;if(serialize&&childOptionsSerializers){var childSerializers=Object.assign({},serializers,childOptionsSerializers),childSerialize=!0===opts.browser.serialize?Object.keys(childSerializers):serialize;delete bindings.serializers,applySerializers([bindings],childSerialize,childSerializers,this._stdErrSerialize)}function Child(parent){this._childLevel=1+(0|parent._childLevel),this.error=bind(parent,bindings,"error"),this.fatal=bind(parent,bindings,"fatal"),this.warn=bind(parent,bindings,"warn"),this.info=bind(parent,bindings,"info"),this.debug=bind(parent,bindings,"debug"),this.trace=bind(parent,bindings,"trace"),childSerializers&&(this.serializers=childSerializers,this._serialize=childSerialize),transmit&&(this._logEvent=createLogEventShape([].concat(parent._logEvent.bindings,bindings)))}return Child.prototype=this,new Child(this)},transmit&&(logger._logEvent=createLogEventShape()),logger}function set(opts,logger,level,fallback){const proto=Object.getPrototypeOf(logger);logger[level]=logger.levelVal>logger.levels.values[level]?noop:proto[level]?proto[level]:_console[level]||_console[fallback]||noop,function wrap(opts,logger,level){if(!opts.transmit&&logger[level]===noop)return;logger[level]=(write=logger[level],function LOG(){const ts=opts.timestamp(),args=new Array(arguments.length),proto=Object.getPrototypeOf&&Object.getPrototypeOf(this)===_console?_console:this;for(var i=0;i<args.length;i++)args[i]=arguments[i];if(opts.serialize&&!opts.asObject&&applySerializers(args,this._serialize,this.serializers,this._stdErrSerialize),opts.asObject?write.call(proto,function asObject(logger,level,args,ts){logger._serialize&&applySerializers(args,logger._serialize,logger.serializers,logger._stdErrSerialize);const argsCloned=args.slice();let msg=argsCloned[0];const o={};ts&&(o.time=ts),o.level=pino.levels.values[level];let lvl=1+(0|logger._childLevel);if(lvl<1&&(lvl=1),null!==msg&&"object"==typeof msg){for(;lvl--&&"object"==typeof argsCloned[0];)Object.assign(o,argsCloned.shift());msg=argsCloned.length?format(argsCloned.shift(),argsCloned):void 0}else"string"==typeof msg&&(msg=format(argsCloned.shift(),argsCloned));return void 0!==msg&&(o.msg=msg),o}(this,level,args,ts)):write.apply(proto,args),opts.transmit){const transmitLevel=opts.transmit.level||logger.level,transmitValue=pino.levels.values[transmitLevel],methodValue=pino.levels.values[level];if(methodValue<transmitValue)return;!function transmit(logger,opts,args){const send=opts.send,ts=opts.ts,methodLevel=opts.methodLevel,methodValue=opts.methodValue,val=opts.val,bindings=logger._logEvent.bindings;applySerializers(args,logger._serialize||Object.keys(logger.serializers),logger.serializers,void 0===logger._stdErrSerialize||logger._stdErrSerialize),logger._logEvent.ts=ts,logger._logEvent.messages=args.filter(function(arg){return-1===bindings.indexOf(arg)}),logger._logEvent.level.label=methodLevel,logger._logEvent.level.value=methodValue,send(methodLevel,logger._logEvent,val),logger._logEvent=createLogEventShape(bindings)}(this,{ts,methodLevel:level,methodValue,transmitLevel,transmitValue:pino.levels.values[opts.transmit.level||logger.level],send:opts.transmit.send,val:logger.levelVal},args)}});var write}(opts,logger,level)}function applySerializers(args,serialize,serializers,stdErrSerialize){for(const i in args)if(stdErrSerialize&&args[i]instanceof Error)args[i]=pino.stdSerializers.err(args[i]);else if("object"==typeof args[i]&&!Array.isArray(args[i]))for(const k in args[i])serialize&&serialize.indexOf(k)>-1&&k in serializers&&(args[i][k]=serializers[k](args[i][k]))}function bind(parent,bindings,level){return function(){const args=new Array(1+arguments.length);args[0]=bindings;for(var i=1;i<args.length;i++)args[i]=arguments[i-1];return parent[level].apply(this,args)}}function createLogEventShape(bindings){return{ts:0,messages:[],bindings:bindings||[],level:{label:"",value:0}}}function getTimeFunction(opts){return"function"==typeof opts.timestamp?opts.timestamp:!1===opts.timestamp?nullTime:epochTime}function mock(){return{}}function passthrough(a){return a}function noop(){}function nullTime(){return!1}function epochTime(){return Date.now()}pino.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},pino.stdSerializers=stdSerializers,pino.stdTimeFunctions=Object.assign({},{nullTime,epochTime,unixTime:function unixTime(){return Math.round(Date.now()/1e3)},isoTime:function isoTime(){return new Date(Date.now()).toISOString()}})},"./node_modules/quick-format-unescaped/index.js":module=>{"use strict";function tryStringify(o){try{return JSON.stringify(o)}catch(e){return'"[Circular]"'}}module.exports=function format(f,args,opts){var ss=opts&&opts.stringify||tryStringify;if("object"==typeof f&&null!==f){var len=args.length+1;if(1===len)return f;var objects=new Array(len);objects[0]=ss(f);for(var index=1;index<len;index++)objects[index]=ss(args[index]);return objects.join(" ")}if("string"!=typeof f)return f;var argLen=args.length;if(0===argLen)return f;for(var str="",a=0,lastPos=-1,flen=f&&f.length||0,i=0;i<flen;){if(37===f.charCodeAt(i)&&i+1<flen){switch(lastPos=lastPos>-1?lastPos:0,f.charCodeAt(i+1)){case 100:case 102:if(a>=argLen)break;if(null==args[a])break;lastPos<i&&(str+=f.slice(lastPos,i)),str+=Number(args[a]),lastPos=i+2,i++;break;case 105:if(a>=argLen)break;if(null==args[a])break;lastPos<i&&(str+=f.slice(lastPos,i)),str+=Math.floor(Number(args[a])),lastPos=i+2,i++;break;case 79:case 111:case 106:if(a>=argLen)break;if(void 0===args[a])break;lastPos<i&&(str+=f.slice(lastPos,i));var type=typeof args[a];if("string"===type){str+="'"+args[a]+"'",lastPos=i+2,i++;break}if("function"===type){str+=args[a].name||"<anonymous>",lastPos=i+2,i++;break}str+=ss(args[a]),lastPos=i+2,i++;break;case 115:if(a>=argLen)break;lastPos<i&&(str+=f.slice(lastPos,i)),str+=String(args[a]),lastPos=i+2,i++;break;case 37:lastPos<i&&(str+=f.slice(lastPos,i)),str+="%",lastPos=i+2,i++,a--}++a}++i}if(-1===lastPos)return f;lastPos<flen&&(str+=f.slice(lastPos));return str}},"./node_modules/uint8arrays/esm/src/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function as_uint8array_asUint8Array(buf){return null!=globalThis.Buffer?new Uint8Array(buf.buffer,buf.byteOffset,buf.byteLength):buf}function allocUnsafe(size=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?as_uint8array_asUint8Array(globalThis.Buffer.allocUnsafe(size)):new Uint8Array(size)}function concat(arrays,length){length||(length=arrays.reduce((acc,curr)=>acc+curr.length,0));const output=allocUnsafe(length);let offset=0;for(const arr of arrays)output.set(arr,offset),offset+=arr.length;return as_uint8array_asUint8Array(output)}__webpack_require__.d(__webpack_exports__,{xW:()=>concat,sH:()=>fromString,dI:()=>to_string_toString});var basics=__webpack_require__("./node_modules/multiformats/esm/src/basics.js");function createCodec(name,prefix,encode,decode){return{name,prefix,encoder:{name,prefix,encode},decoder:{decode}}}const string=createCodec("utf8","u",buf=>"u"+new TextDecoder("utf8").decode(buf),str=>(new TextEncoder).encode(str.substring(1))),ascii=createCodec("ascii","a",buf=>{let string="a";for(let i=0;i<buf.length;i++)string+=String.fromCharCode(buf[i]);return string},str=>{const buf=allocUnsafe((str=str.substring(1)).length);for(let i=0;i<str.length;i++)buf[i]=str.charCodeAt(i);return buf}),bases={utf8:string,"utf-8":string,hex:basics.Fo.base16,latin1:ascii,ascii,binary:ascii,...basics.Fo};function fromString(string,encoding="utf8"){const base=bases[encoding];if(!base)throw new Error(`Unsupported encoding "${encoding}"`);return"utf8"!==encoding&&"utf-8"!==encoding||null==globalThis.Buffer||null==globalThis.Buffer.from?base.decoder.decode(`${base.prefix}${string}`):as_uint8array_asUint8Array(globalThis.Buffer.from(string,"utf-8"))}function to_string_toString(array,encoding="utf8"){const base=bases[encoding];if(!base)throw new Error(`Unsupported encoding "${encoding}"`);return"utf8"!==encoding&&"utf-8"!==encoding||null==globalThis.Buffer||null==globalThis.Buffer.from?base.encoder.encode(array).substring(1):globalThis.Buffer.from(array.buffer,array.byteOffset,array.byteLength).toString("utf8")}}}]);