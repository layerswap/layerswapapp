"use strict";(self.webpackChunklayerswap=self.webpackChunklayerswap||[]).push([[5772],{"./node_modules/starknetkit/dist/webwalletConnector.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ConnectAndSignSessionError:()=>L,WEBWALLET_LOGOUT_EVENT:()=>P,WebWalletConnector:()=>lt,WebwalletError:()=>B,handleWebwalletLogoutEvent:()=>ct});var starknet__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/starknet/dist/index.mjs"),_connector_d58f0dd8_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/starknetkit/dist/connector-d58f0dd8.js"),_trpc_63ec2300_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/starknetkit/dist/trpc-63ec2300.js"),_lastConnected_c0cae438_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/starknetkit/dist/lastConnected-c0cae438.js"),A=Object.defineProperty,u=(a,n,s)=>(((a,n,s)=>{n in a?A(a,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[n]=s})(a,"symbol"!=typeof n?n+"":n,s),s);class L extends Error{constructor(s,t){super(s),u(this,"code"),this.name="ConnectAndSignSessionError",this.code=t}}class B extends Error{constructor(s,t){super(s),u(this,"code"),this.name="WebwalletError",this.code=t}}const m=[],I="argent-webwallet-iframe",y=async(a,n,s)=>{const t=typeof window<"u"?window:void 0;if(!t)throw new Error("window is not defined");const e=((a,n)=>({...a,getLoginStatus:()=>n.getLoginStatus.mutate(),connectWebwallet:(t={})=>{const{theme:e}=t;return n.connectWebwallet.mutate({theme:e})},connectAndSignSession:t=>n.connectAndSignSession.mutate(t),connectWebwalletSSO:(t,e)=>n.connectWebwalletSSO.mutate({token:t,authorizedPartyId:e}),async request(t){switch(t.type){case"wallet_requestAccounts":return n.requestAccounts.mutate(t.params);case"wallet_signTypedData":{const e=t.params,o="Session"===e?.primaryType&&"SessionAccount.session"===e?.domain.name;(0,_trpc_63ec2300_js__WEBPACK_IMPORTED_MODULE_2__.s)({width:385,height:440,location:o?"/signSessionKeys":"/signMessage"});const r=Array.isArray(t.params)?t.params:[t.params];return n.signTypedData.mutate(r)}case"wallet_getPermissions":return n.getPermissions.mutate();case"wallet_addInvokeTransaction":{const e=t.params.calls;return(0,_trpc_63ec2300_js__WEBPACK_IMPORTED_MODULE_2__.s)({width:385,height:775,location:"/review"}),{transaction_hash:await n.addInvokeTransaction.mutate(e)}}case"wallet_requestChainId":return await n.requestChainId.mutate();case"wallet_addStarknetChain":return n.addStarknetChain.mutate(t.params);case"wallet_switchStarknetChain":return n.switchStarknetChain.mutate(t.params);case"wallet_watchAsset":return n.watchAsset.mutate();case"wallet_deploymentData":return n.deploymentData.mutate();default:throw new Error("not implemented")}},on:(t,e)=>{if("accountsChanged"===t)m.push({type:t,handler:e});else{if("networkChanged"!==t)throw new Error(`Unknwown event: ${t}`);m.push({type:t,handler:e})}},off:(t,e)=>{if("accountsChanged"!==t&&"networkChanged"!==t)throw new Error(`Unknwown event: ${t}`);const o=m.findIndex(r=>r.type===t&&r.handler===e);o>=0&&m.splice(o,1)}}))({host:t.location.origin,id:"argentWebWallet",icon:"https://www.ready.co/favicon.ico",name:"Web Wallet",version:"1.0.0"},n);if(s){const{iframe:o,backdrop:r}=s;n.updateModal.subscribe(void 0,{onData(i){switch(i.action){case"show":((a,n)=>{a.style.display="block",n.style.display="block"})(o,r);break;case"hide":((a,n)=>{a.style.display="none",n.style.display="none"})(o,r);break;case"updateSize":((a,n,s)=>{a.style.width=`${n}px`,a.style.height=`${s}px`})(o,i.width,i.height)}}})}return e},W="allowed-dapps",et=async a=>{const{userAgent:n}=navigator,s=!(!navigator.vendor||0!==navigator.vendor.indexOf("Google")||void 0!==navigator.brave||n.match(/Edg/)||n.match(/OPR/)),t=await(async a=>new Promise(n=>{if(!a)return n(!1);try{navigator.webkitTemporaryStorage.queryUsageAndQuota((t,e)=>{n(Math.round(e/1048576)<2*Math.round((performance?.memory?.jsHeapSizeLimit??1073741824)/1048576))},()=>n(!1))}catch{n(!1)}}))(s);if(!s||t){const r=(0,_trpc_63ec2300_js__WEBPACK_IMPORTED_MODULE_2__.t)({});return await y(0,r,void 0)}const e=(0,_trpc_63ec2300_js__WEBPACK_IMPORTED_MODULE_2__.m)(a),{allowedDapps:o}=await(async a=>{const n=a===starknet__WEBPACK_IMPORTED_MODULE_0__.AA.NetworkName.SN_MAIN?_trpc_63ec2300_js__WEBPACK_IMPORTED_MODULE_2__.M:_trpc_63ec2300_js__WEBPACK_IMPORTED_MODULE_2__.T;try{const t=await(await caches.open(W)).match(n);if(t){const w=parseInt(t.headers.get("X-Cache-Timestamp")??"0",10);if(((new Date).getTime()-w)/36e5<24)return t.json()}const e=await fetch(n),o=new Headers(e.headers);o.set("X-Cache-Timestamp",(new Date).getTime().toString());const r=await e.json(),i=new Response(JSON.stringify(r),{status:e.status,statusText:e.statusText,headers:o});return await(await caches.open(W)).put(n,i),r}catch(s){throw new Error(s)}})(e);if(o.includes(window.location.hostname)){const r="argent-webwallet-backdrop",i="argent-webwallet-iframe",c=document.getElementById(r),w=document.getElementById(i);w&&w&&c&&(w.remove(),c.remove());const{iframe:p,backdrop:f}=await(async(a,n)=>{const s="argent-webwallet-backdrop",t=new URL(a);t.pathname="/iframes/comms",a=t.toString();const e=document.createElement("iframe");e.src=a,e.loading="eager",e.sandbox.add("allow-scripts","allow-same-origin","allow-forms","allow-top-navigation","allow-popups"),e.allow="clipboard-write",e.id=I,e.setAttribute("allowtransparency","true"),e.setAttribute("transparent","true"),(a=>{a.style.display="none",a.style.borderRadius="40px",a.style.inset="0",a.style.position="fixed",a.style.top="50%",a.style.left="50%",a.style.transform="translate(-50%, -50%)",a.style.backgroundColor="transparent",a.style.zIndex="999999",a.style.height="438px",a.style.width="420px"})(e),e.style.display=n?"block":"none";const o=document.createElement("div");o.id=s,o.style.position="fixed",o.style.inset="0",o.style.backgroundColor="rgba(0,0,0,0.5)",o.style.zIndex="999998",o.style.width="100dvw",o.style.height="100dvh",o.style.backdropFilter="blur(4px)";const r=document.getElementById(I);return r&&(r.remove(),document.getElementById(s)?.remove()),window.document.body.appendChild(e),await new Promise((i,c)=>{const w=setTimeout(()=>c(new Error("Timeout while loading an iframe")),2e4);e.addEventListener("load",async()=>{clearTimeout(w),i()})}),window.document.body.appendChild(o),{iframe:e,backdrop:o}})(a,!1),b=(0,_trpc_63ec2300_js__WEBPACK_IMPORTED_MODULE_2__.t)({iframe:p.contentWindow??void 0});return await y(0,b,{iframe:p,backdrop:f})}{const r=(0,_trpc_63ec2300_js__WEBPACK_IMPORTED_MODULE_2__.t)({});return await y(0,r,void 0)}},P="webwallet_logout";let l=null,h=null;class lt extends _connector_d58f0dd8_js__WEBPACK_IMPORTED_MODULE_1__.C{constructor(s={}){super(),u(this,"_wallet",null),u(this,"_options"),this._options=s}available(){return!0}async ready(){if(this._wallet||await this.ensureWallet(),!this._wallet)return this._wallet=null,h=null,!1;try{return(await this._wallet.request({type:"wallet_getPermissions"})).includes(_lastConnected_c0cae438_js__WEBPACK_IMPORTED_MODULE_3__.P.ACCOUNTS)}catch{return!1}}get id(){return this._wallet=l,this._wallet?.id||"argentWebWallet"}get name(){return this._wallet=l,this._wallet?.name||"Web Wallet"}get icon(){return{light:_trpc_63ec2300_js__WEBPACK_IMPORTED_MODULE_2__.a,dark:_trpc_63ec2300_js__WEBPACK_IMPORTED_MODULE_2__.a}}get wallet(){if(!this._wallet)throw new _connector_d58f0dd8_js__WEBPACK_IMPORTED_MODULE_1__.a;return this._wallet}get title(){return"Email"}get subtitle(){return"Powered by Ready"}async connectAndSignSession({callbackData:s,approvalRequests:t,sessionTypedData:e}){if(this._wallet||await this.ensureWallet(),!this._wallet)throw new _connector_d58f0dd8_js__WEBPACK_IMPORTED_MODULE_1__.b;try{return await this._wallet.connectAndSignSession({callbackData:s,approvalRequests:t,sessionTypedData:e,theme:this._options.theme})}catch(o){if(o instanceof Error&&("TRPCClientError"===o.constructor.name||"TRPCClientError"===o.name)){const r=o,i=r.shape.data.webwalletErrorMessage||r.message,c=r.shape.data.webwalletErrorCode||r.shape.message;throw new L(i,c)}throw new Error(o instanceof Error?o.message:String(o))}}async connect(s={}){if(this._wallet||await this.ensureWallet(),!this._wallet)throw new _connector_d58f0dd8_js__WEBPACK_IMPORTED_MODULE_1__.b;try{let t,e;if(this._options.ssoToken){const r=await this._wallet.connectWebwalletSSO(this._options.ssoToken,this._options.authorizedPartyId);t=r.account,e=r.chainId}else{const r=await this._wallet.connectWebwallet({theme:this._options.theme});t=r.account,e=r.chainId}if(!t||!e)return{};const o=(0,_trpc_63ec2300_js__WEBPACK_IMPORTED_MODULE_2__.g)(e);return h=t[0],{account:t[0],chainId:BigInt(o)}}catch{throw new _connector_d58f0dd8_js__WEBPACK_IMPORTED_MODULE_1__.U}}async request(s){if(this._wallet||await this.ensureWallet(),!this._wallet)throw new _connector_d58f0dd8_js__WEBPACK_IMPORTED_MODULE_1__.a;try{return await this._wallet.request(s)}catch(t){if(t instanceof Error&&("TRPCClientError"===t.constructor.name||"TRPCClientError"===t.name)){const e=t,o=e.shape.data.webwalletErrorMessage||e.message,r=e.shape.data.webwalletErrorCode||e.shape.message;throw"USER_LOGGED_OUT"===r&&(l=null,h=null,this._wallet=null,document.dispatchEvent(new Event(P))),new B(o,r)}throw new _connector_d58f0dd8_js__WEBPACK_IMPORTED_MODULE_1__.U}}async disconnect(){if(!this.available()&&!this._wallet)throw new _connector_d58f0dd8_js__WEBPACK_IMPORTED_MODULE_1__.b;l=null,h=null,this._wallet=l,(0,_lastConnected_c0cae438_js__WEBPACK_IMPORTED_MODULE_3__.r)()}async account(s){if(this._wallet=l,!this._wallet)throw new _connector_d58f0dd8_js__WEBPACK_IMPORTED_MODULE_1__.a;if(!h)throw new _connector_d58f0dd8_js__WEBPACK_IMPORTED_MODULE_1__.a;return new starknet__WEBPACK_IMPORTED_MODULE_0__.WalletAccount(s,this._wallet,void 0,h)}async chainId(){if(!this._wallet)throw new _connector_d58f0dd8_js__WEBPACK_IMPORTED_MODULE_1__.a;const s=await this._wallet.request({type:"wallet_requestChainId"}),t=(0,_trpc_63ec2300_js__WEBPACK_IMPORTED_MODULE_2__.g)(s);return BigInt(t)}async initEventListener(s){if(this._wallet=l,!this._wallet)throw new _connector_d58f0dd8_js__WEBPACK_IMPORTED_MODULE_1__.a;this._wallet.on("accountsChanged",s)}async removeEventListener(s){if(this._wallet=l,!this._wallet)throw new _connector_d58f0dd8_js__WEBPACK_IMPORTED_MODULE_1__.a;this._wallet.off("accountsChanged",s),l=null,h=null,this._wallet=null}async ensureWallet(){const s=this._options.url||_trpc_63ec2300_js__WEBPACK_IMPORTED_MODULE_2__.D;(0,_trpc_63ec2300_js__WEBPACK_IMPORTED_MODULE_2__.s)({origin:s,location:"/interstitialLogin"}),l=await et(s)??null,this._wallet=l}}const ct=a=>{document.addEventListener(P,()=>{a()})}}}]);